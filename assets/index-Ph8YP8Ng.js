(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function wE(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Nf={exports:{}},Po={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A0;function Ax(){if(A0)return Po;A0=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var u in s)u!=="key"&&(o[u]=s[u])}else o=s;return s=o.ref,{$$typeof:i,type:n,key:l,ref:s!==void 0?s:null,props:o}}return Po.Fragment=e,Po.jsx=t,Po.jsxs=t,Po}var _0;function _x(){return _0||(_0=1,Nf.exports=Ax()),Nf.exports}var W=_x(),Pf={exports:{}},Ie={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x0;function xx(){if(x0)return Ie;x0=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function S(w){return w===null||typeof w!="object"?null:(w=y&&w[y]||w["@@iterator"],typeof w=="function"?w:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,x={};function C(w,V,se){this.props=w,this.context=V,this.refs=x,this.updater=se||A}C.prototype.isReactComponent={},C.prototype.setState=function(w,V){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,V,"setState")},C.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function b(){}b.prototype=C.prototype;function L(w,V,se){this.props=w,this.context=V,this.refs=x,this.updater=se||A}var M=L.prototype=new b;M.constructor=L,_(M,C.prototype),M.isPureReactComponent=!0;var P=Array.isArray;function G(){}var N={H:null,A:null,T:null,S:null},$=Object.prototype.hasOwnProperty;function U(w,V,se){var ae=se.ref;return{$$typeof:i,type:w,key:V,ref:ae!==void 0?ae:null,props:se}}function O(w,V){return U(w.type,V,w.props)}function J(w){return typeof w=="object"&&w!==null&&w.$$typeof===i}function re(w){var V={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(se){return V[se]})}var oe=/\/+/g;function ce(w,V){return typeof w=="object"&&w!==null&&w.key!=null?re(""+w.key):V.toString(36)}function fe(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(G,G):(w.status="pending",w.then(function(V){w.status==="pending"&&(w.status="fulfilled",w.value=V)},function(V){w.status==="pending"&&(w.status="rejected",w.reason=V)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function F(w,V,se,ae,ue){var ge=typeof w;(ge==="undefined"||ge==="boolean")&&(w=null);var Ae=!1;if(w===null)Ae=!0;else switch(ge){case"bigint":case"string":case"number":Ae=!0;break;case"object":switch(w.$$typeof){case i:case e:Ae=!0;break;case h:return Ae=w._init,F(Ae(w._payload),V,se,ae,ue)}}if(Ae)return ue=ue(w),Ae=ae===""?"."+ce(w,0):ae,P(ue)?(se="",Ae!=null&&(se=Ae.replace(oe,"$&/")+"/"),F(ue,V,se,"",function(kt){return kt})):ue!=null&&(J(ue)&&(ue=O(ue,se+(ue.key==null||w&&w.key===ue.key?"":(""+ue.key).replace(oe,"$&/")+"/")+Ae)),V.push(ue)),1;Ae=0;var Fe=ae===""?".":ae+":";if(P(w))for(var Oe=0;Oe<w.length;Oe++)ae=w[Oe],ge=Fe+ce(ae,Oe),Ae+=F(ae,V,se,ge,ue);else if(Oe=S(w),typeof Oe=="function")for(w=Oe.call(w),Oe=0;!(ae=w.next()).done;)ae=ae.value,ge=Fe+ce(ae,Oe++),Ae+=F(ae,V,se,ge,ue);else if(ge==="object"){if(typeof w.then=="function")return F(fe(w),V,se,ae,ue);throw V=String(w),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Ae}function Q(w,V,se){if(w==null)return w;var ae=[],ue=0;return F(w,ae,"","",function(ge){return V.call(se,ge,ue++)}),ae}function ee(w){if(w._status===-1){var V=w._result;V=V(),V.then(function(se){(w._status===0||w._status===-1)&&(w._status=1,w._result=se)},function(se){(w._status===0||w._status===-1)&&(w._status=2,w._result=se)}),w._status===-1&&(w._status=0,w._result=V)}if(w._status===1)return w._result.default;throw w._result}var le=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)},de={map:Q,forEach:function(w,V,se){Q(w,function(){V.apply(this,arguments)},se)},count:function(w){var V=0;return Q(w,function(){V++}),V},toArray:function(w){return Q(w,function(V){return V})||[]},only:function(w){if(!J(w))throw Error("React.Children.only expected to receive a single React element child.");return w}};return Ie.Activity=m,Ie.Children=de,Ie.Component=C,Ie.Fragment=t,Ie.Profiler=s,Ie.PureComponent=L,Ie.StrictMode=n,Ie.Suspense=d,Ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,Ie.__COMPILER_RUNTIME={__proto__:null,c:function(w){return N.H.useMemoCache(w)}},Ie.cache=function(w){return function(){return w.apply(null,arguments)}},Ie.cacheSignal=function(){return null},Ie.cloneElement=function(w,V,se){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var ae=_({},w.props),ue=w.key;if(V!=null)for(ge in V.key!==void 0&&(ue=""+V.key),V)!$.call(V,ge)||ge==="key"||ge==="__self"||ge==="__source"||ge==="ref"&&V.ref===void 0||(ae[ge]=V[ge]);var ge=arguments.length-2;if(ge===1)ae.children=se;else if(1<ge){for(var Ae=Array(ge),Fe=0;Fe<ge;Fe++)Ae[Fe]=arguments[Fe+2];ae.children=Ae}return U(w.type,ue,ae)},Ie.createContext=function(w){return w={$$typeof:l,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:o,_context:w},w},Ie.createElement=function(w,V,se){var ae,ue={},ge=null;if(V!=null)for(ae in V.key!==void 0&&(ge=""+V.key),V)$.call(V,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(ue[ae]=V[ae]);var Ae=arguments.length-2;if(Ae===1)ue.children=se;else if(1<Ae){for(var Fe=Array(Ae),Oe=0;Oe<Ae;Oe++)Fe[Oe]=arguments[Oe+2];ue.children=Fe}if(w&&w.defaultProps)for(ae in Ae=w.defaultProps,Ae)ue[ae]===void 0&&(ue[ae]=Ae[ae]);return U(w,ge,ue)},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(w){return{$$typeof:u,render:w}},Ie.isValidElement=J,Ie.lazy=function(w){return{$$typeof:h,_payload:{_status:-1,_result:w},_init:ee}},Ie.memo=function(w,V){return{$$typeof:f,type:w,compare:V===void 0?null:V}},Ie.startTransition=function(w){var V=N.T,se={};N.T=se;try{var ae=w(),ue=N.S;ue!==null&&ue(se,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(G,le)}catch(ge){le(ge)}finally{V!==null&&se.types!==null&&(V.types=se.types),N.T=V}},Ie.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},Ie.use=function(w){return N.H.use(w)},Ie.useActionState=function(w,V,se){return N.H.useActionState(w,V,se)},Ie.useCallback=function(w,V){return N.H.useCallback(w,V)},Ie.useContext=function(w){return N.H.useContext(w)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(w,V){return N.H.useDeferredValue(w,V)},Ie.useEffect=function(w,V){return N.H.useEffect(w,V)},Ie.useEffectEvent=function(w){return N.H.useEffectEvent(w)},Ie.useId=function(){return N.H.useId()},Ie.useImperativeHandle=function(w,V,se){return N.H.useImperativeHandle(w,V,se)},Ie.useInsertionEffect=function(w,V){return N.H.useInsertionEffect(w,V)},Ie.useLayoutEffect=function(w,V){return N.H.useLayoutEffect(w,V)},Ie.useMemo=function(w,V){return N.H.useMemo(w,V)},Ie.useOptimistic=function(w,V){return N.H.useOptimistic(w,V)},Ie.useReducer=function(w,V,se){return N.H.useReducer(w,V,se)},Ie.useRef=function(w){return N.H.useRef(w)},Ie.useState=function(w){return N.H.useState(w)},Ie.useSyncExternalStore=function(w,V,se){return N.H.useSyncExternalStore(w,V,se)},Ie.useTransition=function(){return N.H.useTransition()},Ie.version="19.2.3",Ie}var R0;function qd(){return R0||(R0=1,Pf.exports=xx()),Pf.exports}var lt=qd();const Rx=wE(lt);var kf={exports:{}},ko={},Uf={exports:{}},Of={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I0;function Ix(){return I0||(I0=1,(function(i){function e(F,Q){var ee=F.length;F.push(Q);e:for(;0<ee;){var le=ee-1>>>1,de=F[le];if(0<s(de,Q))F[le]=Q,F[ee]=de,ee=le;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var Q=F[0],ee=F.pop();if(ee!==Q){F[0]=ee;e:for(var le=0,de=F.length,w=de>>>1;le<w;){var V=2*(le+1)-1,se=F[V],ae=V+1,ue=F[ae];if(0>s(se,ee))ae<de&&0>s(ue,se)?(F[le]=ue,F[ae]=ee,le=ae):(F[le]=se,F[V]=ee,le=V);else if(ae<de&&0>s(ue,ee))F[le]=ue,F[ae]=ee,le=ae;else break e}}return Q}function s(F,Q){var ee=F.sortIndex-Q.sortIndex;return ee!==0?ee:F.id-Q.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var d=[],f=[],h=1,m=null,y=3,S=!1,A=!1,_=!1,x=!1,C=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function M(F){for(var Q=t(f);Q!==null;){if(Q.callback===null)n(f);else if(Q.startTime<=F)n(f),Q.sortIndex=Q.expirationTime,e(d,Q);else break;Q=t(f)}}function P(F){if(_=!1,M(F),!A)if(t(d)!==null)A=!0,G||(G=!0,re());else{var Q=t(f);Q!==null&&fe(P,Q.startTime-F)}}var G=!1,N=-1,$=5,U=-1;function O(){return x?!0:!(i.unstable_now()-U<$)}function J(){if(x=!1,G){var F=i.unstable_now();U=F;var Q=!0;try{e:{A=!1,_&&(_=!1,b(N),N=-1),S=!0;var ee=y;try{t:{for(M(F),m=t(d);m!==null&&!(m.expirationTime>F&&O());){var le=m.callback;if(typeof le=="function"){m.callback=null,y=m.priorityLevel;var de=le(m.expirationTime<=F);if(F=i.unstable_now(),typeof de=="function"){m.callback=de,M(F),Q=!0;break t}m===t(d)&&n(d),M(F)}else n(d);m=t(d)}if(m!==null)Q=!0;else{var w=t(f);w!==null&&fe(P,w.startTime-F),Q=!1}}break e}finally{m=null,y=ee,S=!1}Q=void 0}}finally{Q?re():G=!1}}}var re;if(typeof L=="function")re=function(){L(J)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,ce=oe.port2;oe.port1.onmessage=J,re=function(){ce.postMessage(null)}}else re=function(){C(J,0)};function fe(F,Q){N=C(function(){F(i.unstable_now())},Q)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(F){F.callback=null},i.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<F?Math.floor(1e3/F):5},i.unstable_getCurrentPriorityLevel=function(){return y},i.unstable_next=function(F){switch(y){case 1:case 2:case 3:var Q=3;break;default:Q=y}var ee=y;y=Q;try{return F()}finally{y=ee}},i.unstable_requestPaint=function(){x=!0},i.unstable_runWithPriority=function(F,Q){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var ee=y;y=F;try{return Q()}finally{y=ee}},i.unstable_scheduleCallback=function(F,Q,ee){var le=i.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?le+ee:le):ee=le,F){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=ee+de,F={id:h++,callback:Q,priorityLevel:F,startTime:ee,expirationTime:de,sortIndex:-1},ee>le?(F.sortIndex=ee,e(f,F),t(d)===null&&F===t(f)&&(_?(b(N),N=-1):_=!0,fe(P,ee-le))):(F.sortIndex=de,e(d,F),A||S||(A=!0,G||(G=!0,re()))),F},i.unstable_shouldYield=O,i.unstable_wrapCallback=function(F){var Q=y;return function(){var ee=y;y=Q;try{return F.apply(this,arguments)}finally{y=ee}}}})(Of)),Of}var C0;function Cx(){return C0||(C0=1,Uf.exports=Ix()),Uf.exports}var Ff={exports:{}},Ut={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L0;function Lx(){if(L0)return Ut;L0=1;var i=qd();function e(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)f+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(d,f,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:d,containerInfo:f,implementation:h}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Ut.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Ut.createPortal=function(d,f){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(d,f,null,h)},Ut.flushSync=function(d){var f=l.T,h=n.p;try{if(l.T=null,n.p=2,d)return d()}finally{l.T=f,n.p=h,n.d.f()}},Ut.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(d,f))},Ut.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},Ut.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var h=f.as,m=u(h,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,S=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;h==="style"?n.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:S}):h==="script"&&n.d.X(d,{crossOrigin:m,integrity:y,fetchPriority:S,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Ut.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var h=u(f.as,f.crossOrigin);n.d.M(d,{crossOrigin:h,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(d)},Ut.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var h=f.as,m=u(h,f.crossOrigin);n.d.L(d,h,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Ut.preloadModule=function(d,f){if(typeof d=="string")if(f){var h=u(f.as,f.crossOrigin);n.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:h,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(d)},Ut.requestFormReset=function(d){n.d.r(d)},Ut.unstable_batchedUpdates=function(d,f){return d(f)},Ut.useFormState=function(d,f,h){return l.H.useFormState(d,f,h)},Ut.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ut.version="19.2.3",Ut}var b0;function bx(){if(b0)return Ff.exports;b0=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ff.exports=Lx(),Ff.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0;function Dx(){if(D0)return ko;D0=1;var i=Cx(),e=qd(),t=bx();function n(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,c=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(c=a.return),r=a.return;while(r)}return a.tag===3?c:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function u(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function d(r){if(o(r)!==r)throw Error(n(188))}function f(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(n(188));return a!==r?null:r}for(var c=r,g=a;;){var E=c.return;if(E===null)break;var T=E.alternate;if(T===null){if(g=E.return,g!==null){c=g;continue}break}if(E.child===T.child){for(T=E.child;T;){if(T===c)return d(E),r;if(T===g)return d(E),a;T=T.sibling}throw Error(n(188))}if(c.return!==g.return)c=E,g=T;else{for(var R=!1,D=E.child;D;){if(D===c){R=!0,c=E,g=T;break}if(D===g){R=!0,g=E,c=T;break}D=D.sibling}if(!R){for(D=T.child;D;){if(D===c){R=!0,c=T,g=E;break}if(D===g){R=!0,g=T,c=E;break}D=D.sibling}if(!R)throw Error(n(189))}}if(c.alternate!==g)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?r:a}function h(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=h(r),a!==null)return a;r=r.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),L=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),J=Symbol.iterator;function re(r){return r===null||typeof r!="object"?null:(r=J&&r[J]||r["@@iterator"],typeof r=="function"?r:null)}var oe=Symbol.for("react.client.reference");function ce(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===oe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case _:return"Fragment";case C:return"Profiler";case x:return"StrictMode";case P:return"Suspense";case G:return"SuspenseList";case U:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case A:return"Portal";case L:return r.displayName||"Context";case b:return(r._context.displayName||"Context")+".Consumer";case M:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case N:return a=r.displayName||null,a!==null?a:ce(r.type)||"Memo";case $:a=r._payload,r=r._init;try{return ce(r(a))}catch{}}return null}var fe=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},le=[],de=-1;function w(r){return{current:r}}function V(r){0>de||(r.current=le[de],le[de]=null,de--)}function se(r,a){de++,le[de]=r.current,r.current=a}var ae=w(null),ue=w(null),ge=w(null),Ae=w(null);function Fe(r,a){switch(se(ge,a),se(ue,r),se(ae,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?Kp(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=Kp(a),r=zp(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}V(ae),se(ae,r)}function Oe(){V(ae),V(ue),V(ge)}function kt(r){r.memoizedState!==null&&se(Ae,r);var a=ae.current,c=zp(a,r.type);a!==c&&(se(ue,r),se(ae,c))}function mn(r){ue.current===r&&(V(ae),V(ue)),Ae.current===r&&(V(Ae),Do._currentValue=ee)}var Fr,Ms;function Dn(r){if(Fr===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);Fr=a&&a[1]||"",Ms=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Fr+r+Ms}var Qo=!1;function Ne(r,a){if(!r||Qo)return"";Qo=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(a){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(Z){var X=Z}Reflect.construct(r,[],ie)}else{try{ie.call()}catch(Z){X=Z}r.call(ie.prototype)}}else{try{throw Error()}catch(Z){X=Z}(ie=r())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(Z){if(Z&&X&&typeof Z.stack=="string")return[Z.stack,X.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=g.DetermineComponentFrameRoot(),R=T[0],D=T[1];if(R&&D){var k=R.split(`
`),Y=D.split(`
`);for(E=g=0;g<k.length&&!k[g].includes("DetermineComponentFrameRoot");)g++;for(;E<Y.length&&!Y[E].includes("DetermineComponentFrameRoot");)E++;if(g===k.length||E===Y.length)for(g=k.length-1,E=Y.length-1;1<=g&&0<=E&&k[g]!==Y[E];)E--;for(;1<=g&&0<=E;g--,E--)if(k[g]!==Y[E]){if(g!==1||E!==1)do if(g--,E--,0>E||k[g]!==Y[E]){var j=`
`+k[g].replace(" at new "," at ");return r.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",r.displayName)),j}while(1<=g&&0<=E);break}}}finally{Qo=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Dn(c):""}function Tt(r,a){switch(r.tag){case 26:case 27:case 5:return Dn(r.type);case 16:return Dn("Lazy");case 13:return r.child!==a&&a!==null?Dn("Suspense Fallback"):Dn("Suspense");case 19:return Dn("SuspenseList");case 0:case 15:return Ne(r.type,!1);case 11:return Ne(r.type.render,!1);case 1:return Ne(r.type,!0);case 31:return Dn("Activity");default:return""}}function Ft(r){try{var a="",c=null;do a+=Tt(r,c),c=r,r=r.return;while(r);return a}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var Mn=Object.prototype.hasOwnProperty,Bt=i.unstable_scheduleCallback,Gn=i.unstable_cancelCallback,jn=i.unstable_shouldYield,Zo=i.unstable_requestPaint,St=i.unstable_now,jo=i.unstable_getCurrentPriorityLevel,Ri=i.unstable_ImmediatePriority,Br=i.unstable_UserBlockingPriority,ws=i.unstable_NormalPriority,ea=i.unstable_LowPriority,Gr=i.unstable_IdlePriority,rs=i.log,rA=i.unstable_setDisableYieldValue,$r=null,jt=null;function Ii(r){if(typeof rs=="function"&&rA(r),jt&&typeof jt.setStrictMode=="function")try{jt.setStrictMode($r,r)}catch{}}var en=Math.clz32?Math.clz32:lA,oA=Math.log,aA=Math.LN2;function lA(r){return r>>>=0,r===0?32:31-(oA(r)/aA|0)|0}var ta=256,na=262144,ia=4194304;function os(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function sa(r,a,c){var g=r.pendingLanes;if(g===0)return 0;var E=0,T=r.suspendedLanes,R=r.pingedLanes;r=r.warmLanes;var D=g&134217727;return D!==0?(g=D&~T,g!==0?E=os(g):(R&=D,R!==0?E=os(R):c||(c=D&~r,c!==0&&(E=os(c))))):(D=g&~T,D!==0?E=os(D):R!==0?E=os(R):c||(c=g&~r,c!==0&&(E=os(c)))),E===0?0:a!==0&&a!==E&&(a&T)===0&&(T=E&-E,c=a&-a,T>=c||T===32&&(c&4194048)!==0)?a:E}function Vr(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function uA(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ih(){var r=ia;return ia<<=1,(ia&62914560)===0&&(ia=4194304),r}function Tu(r){for(var a=[],c=0;31>c;c++)a.push(r);return a}function Hr(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function cA(r,a,c,g,E,T){var R=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var D=r.entanglements,k=r.expirationTimes,Y=r.hiddenUpdates;for(c=R&~c;0<c;){var j=31-en(c),ie=1<<j;D[j]=0,k[j]=-1;var X=Y[j];if(X!==null)for(Y[j]=null,j=0;j<X.length;j++){var Z=X[j];Z!==null&&(Z.lane&=-536870913)}c&=~ie}g!==0&&Ch(r,g,0),T!==0&&E===0&&r.tag!==0&&(r.suspendedLanes|=T&~(R&~a))}function Ch(r,a,c){r.pendingLanes|=a,r.suspendedLanes&=~a;var g=31-en(a);r.entangledLanes|=a,r.entanglements[g]=r.entanglements[g]|1073741824|c&261930}function Lh(r,a){var c=r.entangledLanes|=a;for(r=r.entanglements;c;){var g=31-en(c),E=1<<g;E&a|r[g]&a&&(r[g]|=a),c&=~E}}function bh(r,a){var c=a&-a;return c=(c&42)!==0?1:Su(c),(c&(r.suspendedLanes|a))!==0?0:c}function Su(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Au(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Dh(){var r=Q.p;return r!==0?r:(r=window.event,r===void 0?32:m0(r.type))}function Mh(r,a){var c=Q.p;try{return Q.p=r,a()}finally{Q.p=c}}var Ci=Math.random().toString(36).slice(2),It="__reactFiber$"+Ci,qt="__reactProps$"+Ci,Ns="__reactContainer$"+Ci,_u="__reactEvents$"+Ci,fA="__reactListeners$"+Ci,dA="__reactHandles$"+Ci,wh="__reactResources$"+Ci,qr="__reactMarker$"+Ci;function xu(r){delete r[It],delete r[qt],delete r[_u],delete r[fA],delete r[dA]}function Ps(r){var a=r[It];if(a)return a;for(var c=r.parentNode;c;){if(a=c[Ns]||c[It]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(r=jp(r);r!==null;){if(c=r[It])return c;r=jp(r)}return a}r=c,c=r.parentNode}return null}function ks(r){if(r=r[It]||r[Ns]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function Kr(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(n(33))}function Us(r){var a=r[wh];return a||(a=r[wh]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function At(r){r[qr]=!0}var Nh=new Set,Ph={};function as(r,a){Os(r,a),Os(r+"Capture",a)}function Os(r,a){for(Ph[r]=a,r=0;r<a.length;r++)Nh.add(a[r])}var hA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),kh={},Uh={};function gA(r){return Mn.call(Uh,r)?!0:Mn.call(kh,r)?!1:hA.test(r)?Uh[r]=!0:(kh[r]=!0,!1)}function ra(r,a,c){if(gA(a))if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var g=a.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+c)}}function oa(r,a,c){if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+c)}}function ei(r,a,c,g){if(g===null)r.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(a,c,""+g)}}function pn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Oh(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function mA(r,a,c){var g=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var E=g.get,T=g.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return E.call(this)},set:function(R){c=""+R,T.call(this,R)}}),Object.defineProperty(r,a,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function Ru(r){if(!r._valueTracker){var a=Oh(r)?"checked":"value";r._valueTracker=mA(r,a,""+r[a])}}function Fh(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var c=a.getValue(),g="";return r&&(g=Oh(r)?r.checked?"true":"false":r.value),r=g,r!==c?(a.setValue(r),!0):!1}function aa(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var pA=/[\n"\\]/g;function yn(r){return r.replace(pA,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Iu(r,a,c,g,E,T,R,D){r.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?r.type=R:r.removeAttribute("type"),a!=null?R==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+pn(a)):r.value!==""+pn(a)&&(r.value=""+pn(a)):R!=="submit"&&R!=="reset"||r.removeAttribute("value"),a!=null?Cu(r,R,pn(a)):c!=null?Cu(r,R,pn(c)):g!=null&&r.removeAttribute("value"),E==null&&T!=null&&(r.defaultChecked=!!T),E!=null&&(r.checked=E&&typeof E!="function"&&typeof E!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?r.name=""+pn(D):r.removeAttribute("name")}function Bh(r,a,c,g,E,T,R,D){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(r.type=T),a!=null||c!=null){if(!(T!=="submit"&&T!=="reset"||a!=null)){Ru(r);return}c=c!=null?""+pn(c):"",a=a!=null?""+pn(a):c,D||a===r.value||(r.value=a),r.defaultValue=a}g=g??E,g=typeof g!="function"&&typeof g!="symbol"&&!!g,r.checked=D?r.checked:!!g,r.defaultChecked=!!g,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(r.name=R),Ru(r)}function Cu(r,a,c){a==="number"&&aa(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Fs(r,a,c,g){if(r=r.options,a){a={};for(var E=0;E<c.length;E++)a["$"+c[E]]=!0;for(c=0;c<r.length;c++)E=a.hasOwnProperty("$"+r[c].value),r[c].selected!==E&&(r[c].selected=E),E&&g&&(r[c].defaultSelected=!0)}else{for(c=""+pn(c),a=null,E=0;E<r.length;E++){if(r[E].value===c){r[E].selected=!0,g&&(r[E].defaultSelected=!0);return}a!==null||r[E].disabled||(a=r[E])}a!==null&&(a.selected=!0)}}function Gh(r,a,c){if(a!=null&&(a=""+pn(a),a!==r.value&&(r.value=a),c==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=c!=null?""+pn(c):""}function $h(r,a,c,g){if(a==null){if(g!=null){if(c!=null)throw Error(n(92));if(fe(g)){if(1<g.length)throw Error(n(93));g=g[0]}c=g}c==null&&(c=""),a=c}c=pn(a),r.defaultValue=c,g=r.textContent,g===c&&g!==""&&g!==null&&(r.value=g),Ru(r)}function Bs(r,a){if(a){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=a;return}}r.textContent=a}var yA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Vh(r,a,c){var g=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":g?r.setProperty(a,c):typeof c!="number"||c===0||yA.has(a)?a==="float"?r.cssFloat=c:r[a]=(""+c).trim():r[a]=c+"px"}function Hh(r,a,c){if(a!=null&&typeof a!="object")throw Error(n(62));if(r=r.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||a!=null&&a.hasOwnProperty(g)||(g.indexOf("--")===0?r.setProperty(g,""):g==="float"?r.cssFloat="":r[g]="");for(var E in a)g=a[E],a.hasOwnProperty(E)&&c[E]!==g&&Vh(r,E,g)}else for(var T in a)a.hasOwnProperty(T)&&Vh(r,T,a[T])}function Lu(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),EA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function la(r){return EA.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function ti(){}var bu=null;function Du(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Gs=null,$s=null;function qh(r){var a=ks(r);if(a&&(r=a.stateNode)){var c=r[qt]||null;e:switch(r=a.stateNode,a.type){case"input":if(Iu(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+yn(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var g=c[a];if(g!==r&&g.form===r.form){var E=g[qt]||null;if(!E)throw Error(n(90));Iu(g,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(a=0;a<c.length;a++)g=c[a],g.form===r.form&&Fh(g)}break e;case"textarea":Gh(r,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Fs(r,!!c.multiple,a,!1)}}}var Mu=!1;function Kh(r,a,c){if(Mu)return r(a,c);Mu=!0;try{var g=r(a);return g}finally{if(Mu=!1,(Gs!==null||$s!==null)&&(Ja(),Gs&&(a=Gs,r=$s,$s=Gs=null,qh(a),r)))for(a=0;a<r.length;a++)qh(r[a])}}function zr(r,a){var c=r.stateNode;if(c===null)return null;var g=c[qt]||null;if(g===null)return null;c=g[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(r=r.type,g=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!g;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(n(231,a,typeof c));return c}var ni=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wu=!1;if(ni)try{var Yr={};Object.defineProperty(Yr,"passive",{get:function(){wu=!0}}),window.addEventListener("test",Yr,Yr),window.removeEventListener("test",Yr,Yr)}catch{wu=!1}var Li=null,Nu=null,ua=null;function zh(){if(ua)return ua;var r,a=Nu,c=a.length,g,E="value"in Li?Li.value:Li.textContent,T=E.length;for(r=0;r<c&&a[r]===E[r];r++);var R=c-r;for(g=1;g<=R&&a[c-g]===E[T-g];g++);return ua=E.slice(r,1<g?1-g:void 0)}function ca(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function fa(){return!0}function Yh(){return!1}function Kt(r){function a(c,g,E,T,R){this._reactName=c,this._targetInst=E,this.type=g,this.nativeEvent=T,this.target=R,this.currentTarget=null;for(var D in r)r.hasOwnProperty(D)&&(c=r[D],this[D]=c?c(T):T[D]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?fa:Yh,this.isPropagationStopped=Yh,this}return m(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=fa)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=fa)},persist:function(){},isPersistent:fa}),a}var ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},da=Kt(ls),Xr=m({},ls,{view:0,detail:0}),TA=Kt(Xr),Pu,ku,Jr,ha=m({},Xr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ou,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Jr&&(Jr&&r.type==="mousemove"?(Pu=r.screenX-Jr.screenX,ku=r.screenY-Jr.screenY):ku=Pu=0,Jr=r),Pu)},movementY:function(r){return"movementY"in r?r.movementY:ku}}),Xh=Kt(ha),SA=m({},ha,{dataTransfer:0}),AA=Kt(SA),_A=m({},Xr,{relatedTarget:0}),Uu=Kt(_A),xA=m({},ls,{animationName:0,elapsedTime:0,pseudoElement:0}),RA=Kt(xA),IA=m({},ls,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),CA=Kt(IA),LA=m({},ls,{data:0}),Jh=Kt(LA),bA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},DA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wA(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=MA[r])?!!a[r]:!1}function Ou(){return wA}var NA=m({},Xr,{key:function(r){if(r.key){var a=bA[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=ca(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?DA[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ou,charCode:function(r){return r.type==="keypress"?ca(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ca(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),PA=Kt(NA),kA=m({},ha,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wh=Kt(kA),UA=m({},Xr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ou}),OA=Kt(UA),FA=m({},ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),BA=Kt(FA),GA=m({},ha,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),$A=Kt(GA),VA=m({},ls,{newState:0,oldState:0}),HA=Kt(VA),qA=[9,13,27,32],Fu=ni&&"CompositionEvent"in window,Wr=null;ni&&"documentMode"in document&&(Wr=document.documentMode);var KA=ni&&"TextEvent"in window&&!Wr,Qh=ni&&(!Fu||Wr&&8<Wr&&11>=Wr),Zh=" ",jh=!1;function eg(r,a){switch(r){case"keyup":return qA.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tg(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Vs=!1;function zA(r,a){switch(r){case"compositionend":return tg(a);case"keypress":return a.which!==32?null:(jh=!0,Zh);case"textInput":return r=a.data,r===Zh&&jh?null:r;default:return null}}function YA(r,a){if(Vs)return r==="compositionend"||!Fu&&eg(r,a)?(r=zh(),ua=Nu=Li=null,Vs=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Qh&&a.locale!=="ko"?null:a.data;default:return null}}var XA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ng(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!XA[r.type]:a==="textarea"}function ig(r,a,c,g){Gs?$s?$s.push(g):$s=[g]:Gs=g,a=nl(a,"onChange"),0<a.length&&(c=new da("onChange","change",null,c,g),r.push({event:c,listeners:a}))}var Qr=null,Zr=null;function JA(r){Bp(r,0)}function ga(r){var a=Kr(r);if(Fh(a))return r}function sg(r,a){if(r==="change")return a}var rg=!1;if(ni){var Bu;if(ni){var Gu="oninput"in document;if(!Gu){var og=document.createElement("div");og.setAttribute("oninput","return;"),Gu=typeof og.oninput=="function"}Bu=Gu}else Bu=!1;rg=Bu&&(!document.documentMode||9<document.documentMode)}function ag(){Qr&&(Qr.detachEvent("onpropertychange",lg),Zr=Qr=null)}function lg(r){if(r.propertyName==="value"&&ga(Zr)){var a=[];ig(a,Zr,r,Du(r)),Kh(JA,a)}}function WA(r,a,c){r==="focusin"?(ag(),Qr=a,Zr=c,Qr.attachEvent("onpropertychange",lg)):r==="focusout"&&ag()}function QA(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return ga(Zr)}function ZA(r,a){if(r==="click")return ga(a)}function jA(r,a){if(r==="input"||r==="change")return ga(a)}function e_(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var tn=typeof Object.is=="function"?Object.is:e_;function jr(r,a){if(tn(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var c=Object.keys(r),g=Object.keys(a);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var E=c[g];if(!Mn.call(a,E)||!tn(r[E],a[E]))return!1}return!0}function ug(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function cg(r,a){var c=ug(r);r=0;for(var g;c;){if(c.nodeType===3){if(g=r+c.textContent.length,r<=a&&g>=a)return{node:c,offset:a-r};r=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=ug(c)}}function fg(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?fg(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function dg(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=aa(r.document);a instanceof r.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)r=a.contentWindow;else break;a=aa(r.document)}return a}function $u(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var t_=ni&&"documentMode"in document&&11>=document.documentMode,Hs=null,Vu=null,eo=null,Hu=!1;function hg(r,a,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Hu||Hs==null||Hs!==aa(g)||(g=Hs,"selectionStart"in g&&$u(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),eo&&jr(eo,g)||(eo=g,g=nl(Vu,"onSelect"),0<g.length&&(a=new da("onSelect","select",null,a,c),r.push({event:a,listeners:g}),a.target=Hs)))}function us(r,a){var c={};return c[r.toLowerCase()]=a.toLowerCase(),c["Webkit"+r]="webkit"+a,c["Moz"+r]="moz"+a,c}var qs={animationend:us("Animation","AnimationEnd"),animationiteration:us("Animation","AnimationIteration"),animationstart:us("Animation","AnimationStart"),transitionrun:us("Transition","TransitionRun"),transitionstart:us("Transition","TransitionStart"),transitioncancel:us("Transition","TransitionCancel"),transitionend:us("Transition","TransitionEnd")},qu={},gg={};ni&&(gg=document.createElement("div").style,"AnimationEvent"in window||(delete qs.animationend.animation,delete qs.animationiteration.animation,delete qs.animationstart.animation),"TransitionEvent"in window||delete qs.transitionend.transition);function cs(r){if(qu[r])return qu[r];if(!qs[r])return r;var a=qs[r],c;for(c in a)if(a.hasOwnProperty(c)&&c in gg)return qu[r]=a[c];return r}var mg=cs("animationend"),pg=cs("animationiteration"),yg=cs("animationstart"),n_=cs("transitionrun"),i_=cs("transitionstart"),s_=cs("transitioncancel"),vg=cs("transitionend"),Eg=new Map,Ku="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ku.push("scrollEnd");function wn(r,a){Eg.set(r,a),as(a,[r])}var ma=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},vn=[],Ks=0,zu=0;function pa(){for(var r=Ks,a=zu=Ks=0;a<r;){var c=vn[a];vn[a++]=null;var g=vn[a];vn[a++]=null;var E=vn[a];vn[a++]=null;var T=vn[a];if(vn[a++]=null,g!==null&&E!==null){var R=g.pending;R===null?E.next=E:(E.next=R.next,R.next=E),g.pending=E}T!==0&&Tg(c,E,T)}}function ya(r,a,c,g){vn[Ks++]=r,vn[Ks++]=a,vn[Ks++]=c,vn[Ks++]=g,zu|=g,r.lanes|=g,r=r.alternate,r!==null&&(r.lanes|=g)}function Yu(r,a,c,g){return ya(r,a,c,g),va(r)}function fs(r,a){return ya(r,null,null,a),va(r)}function Tg(r,a,c){r.lanes|=c;var g=r.alternate;g!==null&&(g.lanes|=c);for(var E=!1,T=r.return;T!==null;)T.childLanes|=c,g=T.alternate,g!==null&&(g.childLanes|=c),T.tag===22&&(r=T.stateNode,r===null||r._visibility&1||(E=!0)),r=T,T=T.return;return r.tag===3?(T=r.stateNode,E&&a!==null&&(E=31-en(c),r=T.hiddenUpdates,g=r[E],g===null?r[E]=[a]:g.push(a),a.lane=c|536870912),T):null}function va(r){if(50<_o)throw _o=0,nf=null,Error(n(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var zs={};function r_(r,a,c,g){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nn(r,a,c,g){return new r_(r,a,c,g)}function Xu(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ii(r,a){var c=r.alternate;return c===null?(c=nn(r.tag,a,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=a,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,a=r.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Sg(r,a){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,a=c.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function Ea(r,a,c,g,E,T){var R=0;if(g=r,typeof r=="function")Xu(r)&&(R=1);else if(typeof r=="string")R=cx(r,c,ae.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case U:return r=nn(31,c,a,E),r.elementType=U,r.lanes=T,r;case _:return ds(c.children,E,T,a);case x:R=8,E|=24;break;case C:return r=nn(12,c,a,E|2),r.elementType=C,r.lanes=T,r;case P:return r=nn(13,c,a,E),r.elementType=P,r.lanes=T,r;case G:return r=nn(19,c,a,E),r.elementType=G,r.lanes=T,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case L:R=10;break e;case b:R=9;break e;case M:R=11;break e;case N:R=14;break e;case $:R=16,g=null;break e}R=29,c=Error(n(130,r===null?"null":typeof r,"")),g=null}return a=nn(R,c,a,E),a.elementType=r,a.type=g,a.lanes=T,a}function ds(r,a,c,g){return r=nn(7,r,g,a),r.lanes=c,r}function Ju(r,a,c){return r=nn(6,r,null,a),r.lanes=c,r}function Ag(r){var a=nn(18,null,null,0);return a.stateNode=r,a}function Wu(r,a,c){return a=nn(4,r.children!==null?r.children:[],r.key,a),a.lanes=c,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var _g=new WeakMap;function En(r,a){if(typeof r=="object"&&r!==null){var c=_g.get(r);return c!==void 0?c:(a={value:r,source:a,stack:Ft(a)},_g.set(r,a),a)}return{value:r,source:a,stack:Ft(a)}}var Ys=[],Xs=0,Ta=null,to=0,Tn=[],Sn=0,bi=null,$n=1,Vn="";function si(r,a){Ys[Xs++]=to,Ys[Xs++]=Ta,Ta=r,to=a}function xg(r,a,c){Tn[Sn++]=$n,Tn[Sn++]=Vn,Tn[Sn++]=bi,bi=r;var g=$n;r=Vn;var E=32-en(g)-1;g&=~(1<<E),c+=1;var T=32-en(a)+E;if(30<T){var R=E-E%5;T=(g&(1<<R)-1).toString(32),g>>=R,E-=R,$n=1<<32-en(a)+E|c<<E|g,Vn=T+r}else $n=1<<T|c<<E|g,Vn=r}function Qu(r){r.return!==null&&(si(r,1),xg(r,1,0))}function Zu(r){for(;r===Ta;)Ta=Ys[--Xs],Ys[Xs]=null,to=Ys[--Xs],Ys[Xs]=null;for(;r===bi;)bi=Tn[--Sn],Tn[Sn]=null,Vn=Tn[--Sn],Tn[Sn]=null,$n=Tn[--Sn],Tn[Sn]=null}function Rg(r,a){Tn[Sn++]=$n,Tn[Sn++]=Vn,Tn[Sn++]=bi,$n=a.id,Vn=a.overflow,bi=r}var Ct=null,et=null,Ue=!1,Di=null,An=!1,ju=Error(n(519));function Mi(r){var a=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw no(En(a,r)),ju}function Ig(r){var a=r.stateNode,c=r.type,g=r.memoizedProps;switch(a[It]=r,a[qt]=g,c){case"dialog":we("cancel",a),we("close",a);break;case"iframe":case"object":case"embed":we("load",a);break;case"video":case"audio":for(c=0;c<Ro.length;c++)we(Ro[c],a);break;case"source":we("error",a);break;case"img":case"image":case"link":we("error",a),we("load",a);break;case"details":we("toggle",a);break;case"input":we("invalid",a),Bh(a,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":we("invalid",a);break;case"textarea":we("invalid",a),$h(a,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||g.suppressHydrationWarning===!0||Hp(a.textContent,c)?(g.popover!=null&&(we("beforetoggle",a),we("toggle",a)),g.onScroll!=null&&we("scroll",a),g.onScrollEnd!=null&&we("scrollend",a),g.onClick!=null&&(a.onclick=ti),a=!0):a=!1,a||Mi(r,!0)}function Cg(r){for(Ct=r.return;Ct;)switch(Ct.tag){case 5:case 31:case 13:An=!1;return;case 27:case 3:An=!0;return;default:Ct=Ct.return}}function Js(r){if(r!==Ct)return!1;if(!Ue)return Cg(r),Ue=!0,!1;var a=r.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||vf(r.type,r.memoizedProps)),c=!c),c&&et&&Mi(r),Cg(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));et=Zp(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));et=Zp(r)}else a===27?(a=et,Ki(r.type)?(r=_f,_f=null,et=r):et=a):et=Ct?xn(r.stateNode.nextSibling):null;return!0}function hs(){et=Ct=null,Ue=!1}function ec(){var r=Di;return r!==null&&(Jt===null?Jt=r:Jt.push.apply(Jt,r),Di=null),r}function no(r){Di===null?Di=[r]:Di.push(r)}var tc=w(null),gs=null,ri=null;function wi(r,a,c){se(tc,a._currentValue),a._currentValue=c}function oi(r){r._currentValue=tc.current,V(tc)}function nc(r,a,c){for(;r!==null;){var g=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,g!==null&&(g.childLanes|=a)):g!==null&&(g.childLanes&a)!==a&&(g.childLanes|=a),r===c)break;r=r.return}}function ic(r,a,c,g){var E=r.child;for(E!==null&&(E.return=r);E!==null;){var T=E.dependencies;if(T!==null){var R=E.child;T=T.firstContext;e:for(;T!==null;){var D=T;T=E;for(var k=0;k<a.length;k++)if(D.context===a[k]){T.lanes|=c,D=T.alternate,D!==null&&(D.lanes|=c),nc(T.return,c,r),g||(R=null);break e}T=D.next}}else if(E.tag===18){if(R=E.return,R===null)throw Error(n(341));R.lanes|=c,T=R.alternate,T!==null&&(T.lanes|=c),nc(R,c,r),R=null}else R=E.child;if(R!==null)R.return=E;else for(R=E;R!==null;){if(R===r){R=null;break}if(E=R.sibling,E!==null){E.return=R.return,R=E;break}R=R.return}E=R}}function Ws(r,a,c,g){r=null;for(var E=a,T=!1;E!==null;){if(!T){if((E.flags&524288)!==0)T=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var R=E.alternate;if(R===null)throw Error(n(387));if(R=R.memoizedProps,R!==null){var D=E.type;tn(E.pendingProps.value,R.value)||(r!==null?r.push(D):r=[D])}}else if(E===Ae.current){if(R=E.alternate,R===null)throw Error(n(387));R.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(r!==null?r.push(Do):r=[Do])}E=E.return}r!==null&&ic(a,r,c,g),a.flags|=262144}function Sa(r){for(r=r.firstContext;r!==null;){if(!tn(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function ms(r){gs=r,ri=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Lt(r){return Lg(gs,r)}function Aa(r,a){return gs===null&&ms(r),Lg(r,a)}function Lg(r,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ri===null){if(r===null)throw Error(n(308));ri=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else ri=ri.next=a;return c}var o_=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(c,g){r.push(g)}};this.abort=function(){a.aborted=!0,r.forEach(function(c){return c()})}},a_=i.unstable_scheduleCallback,l_=i.unstable_NormalPriority,dt={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sc(){return{controller:new o_,data:new Map,refCount:0}}function io(r){r.refCount--,r.refCount===0&&a_(l_,function(){r.controller.abort()})}var so=null,rc=0,Qs=0,Zs=null;function u_(r,a){if(so===null){var c=so=[];rc=0,Qs=uf(),Zs={status:"pending",value:void 0,then:function(g){c.push(g)}}}return rc++,a.then(bg,bg),a}function bg(){if(--rc===0&&so!==null){Zs!==null&&(Zs.status="fulfilled");var r=so;so=null,Qs=0,Zs=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function c_(r,a){var c=[],g={status:"pending",value:null,reason:null,then:function(E){c.push(E)}};return r.then(function(){g.status="fulfilled",g.value=a;for(var E=0;E<c.length;E++)(0,c[E])(a)},function(E){for(g.status="rejected",g.reason=E,E=0;E<c.length;E++)(0,c[E])(void 0)}),g}var Dg=F.S;F.S=function(r,a){hp=St(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&u_(r,a),Dg!==null&&Dg(r,a)};var ps=w(null);function oc(){var r=ps.current;return r!==null?r:Qe.pooledCache}function _a(r,a){a===null?se(ps,ps.current):se(ps,a.pool)}function Mg(){var r=oc();return r===null?null:{parent:dt._currentValue,pool:r}}var js=Error(n(460)),ac=Error(n(474)),xa=Error(n(542)),Ra={then:function(){}};function wg(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Ng(r,a,c){switch(c=r[c],c===void 0?r.push(a):c!==a&&(a.then(ti,ti),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,kg(r),r;default:if(typeof a.status=="string")a.then(ti,ti);else{if(r=Qe,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=a,r.status="pending",r.then(function(g){if(a.status==="pending"){var E=a;E.status="fulfilled",E.value=g}},function(g){if(a.status==="pending"){var E=a;E.status="rejected",E.reason=g}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,kg(r),r}throw vs=a,js}}function ys(r){try{var a=r._init;return a(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(vs=c,js):c}}var vs=null;function Pg(){if(vs===null)throw Error(n(459));var r=vs;return vs=null,r}function kg(r){if(r===js||r===xa)throw Error(n(483))}var er=null,ro=0;function Ia(r){var a=ro;return ro+=1,er===null&&(er=[]),Ng(er,r,a)}function oo(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function Ca(r,a){throw a.$$typeof===y?Error(n(525)):(r=Object.prototype.toString.call(a),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function Ug(r){function a(H,B){if(r){var z=H.deletions;z===null?(H.deletions=[B],H.flags|=16):z.push(B)}}function c(H,B){if(!r)return null;for(;B!==null;)a(H,B),B=B.sibling;return null}function g(H){for(var B=new Map;H!==null;)H.key!==null?B.set(H.key,H):B.set(H.index,H),H=H.sibling;return B}function E(H,B){return H=ii(H,B),H.index=0,H.sibling=null,H}function T(H,B,z){return H.index=z,r?(z=H.alternate,z!==null?(z=z.index,z<B?(H.flags|=67108866,B):z):(H.flags|=67108866,B)):(H.flags|=1048576,B)}function R(H){return r&&H.alternate===null&&(H.flags|=67108866),H}function D(H,B,z,ne){return B===null||B.tag!==6?(B=Ju(z,H.mode,ne),B.return=H,B):(B=E(B,z),B.return=H,B)}function k(H,B,z,ne){var Te=z.type;return Te===_?j(H,B,z.props.children,ne,z.key):B!==null&&(B.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===$&&ys(Te)===B.type)?(B=E(B,z.props),oo(B,z),B.return=H,B):(B=Ea(z.type,z.key,z.props,null,H.mode,ne),oo(B,z),B.return=H,B)}function Y(H,B,z,ne){return B===null||B.tag!==4||B.stateNode.containerInfo!==z.containerInfo||B.stateNode.implementation!==z.implementation?(B=Wu(z,H.mode,ne),B.return=H,B):(B=E(B,z.children||[]),B.return=H,B)}function j(H,B,z,ne,Te){return B===null||B.tag!==7?(B=ds(z,H.mode,ne,Te),B.return=H,B):(B=E(B,z),B.return=H,B)}function ie(H,B,z){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=Ju(""+B,H.mode,z),B.return=H,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case S:return z=Ea(B.type,B.key,B.props,null,H.mode,z),oo(z,B),z.return=H,z;case A:return B=Wu(B,H.mode,z),B.return=H,B;case $:return B=ys(B),ie(H,B,z)}if(fe(B)||re(B))return B=ds(B,H.mode,z,null),B.return=H,B;if(typeof B.then=="function")return ie(H,Ia(B),z);if(B.$$typeof===L)return ie(H,Aa(H,B),z);Ca(H,B)}return null}function X(H,B,z,ne){var Te=B!==null?B.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return Te!==null?null:D(H,B,""+z,ne);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case S:return z.key===Te?k(H,B,z,ne):null;case A:return z.key===Te?Y(H,B,z,ne):null;case $:return z=ys(z),X(H,B,z,ne)}if(fe(z)||re(z))return Te!==null?null:j(H,B,z,ne,null);if(typeof z.then=="function")return X(H,B,Ia(z),ne);if(z.$$typeof===L)return X(H,B,Aa(H,z),ne);Ca(H,z)}return null}function Z(H,B,z,ne,Te){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return H=H.get(z)||null,D(B,H,""+ne,Te);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case S:return H=H.get(ne.key===null?z:ne.key)||null,k(B,H,ne,Te);case A:return H=H.get(ne.key===null?z:ne.key)||null,Y(B,H,ne,Te);case $:return ne=ys(ne),Z(H,B,z,ne,Te)}if(fe(ne)||re(ne))return H=H.get(z)||null,j(B,H,ne,Te,null);if(typeof ne.then=="function")return Z(H,B,z,Ia(ne),Te);if(ne.$$typeof===L)return Z(H,B,z,Aa(B,ne),Te);Ca(B,ne)}return null}function ye(H,B,z,ne){for(var Te=null,Be=null,ve=B,Le=B=0,ke=null;ve!==null&&Le<z.length;Le++){ve.index>Le?(ke=ve,ve=null):ke=ve.sibling;var Ge=X(H,ve,z[Le],ne);if(Ge===null){ve===null&&(ve=ke);break}r&&ve&&Ge.alternate===null&&a(H,ve),B=T(Ge,B,Le),Be===null?Te=Ge:Be.sibling=Ge,Be=Ge,ve=ke}if(Le===z.length)return c(H,ve),Ue&&si(H,Le),Te;if(ve===null){for(;Le<z.length;Le++)ve=ie(H,z[Le],ne),ve!==null&&(B=T(ve,B,Le),Be===null?Te=ve:Be.sibling=ve,Be=ve);return Ue&&si(H,Le),Te}for(ve=g(ve);Le<z.length;Le++)ke=Z(ve,H,Le,z[Le],ne),ke!==null&&(r&&ke.alternate!==null&&ve.delete(ke.key===null?Le:ke.key),B=T(ke,B,Le),Be===null?Te=ke:Be.sibling=ke,Be=ke);return r&&ve.forEach(function(Wi){return a(H,Wi)}),Ue&&si(H,Le),Te}function Se(H,B,z,ne){if(z==null)throw Error(n(151));for(var Te=null,Be=null,ve=B,Le=B=0,ke=null,Ge=z.next();ve!==null&&!Ge.done;Le++,Ge=z.next()){ve.index>Le?(ke=ve,ve=null):ke=ve.sibling;var Wi=X(H,ve,Ge.value,ne);if(Wi===null){ve===null&&(ve=ke);break}r&&ve&&Wi.alternate===null&&a(H,ve),B=T(Wi,B,Le),Be===null?Te=Wi:Be.sibling=Wi,Be=Wi,ve=ke}if(Ge.done)return c(H,ve),Ue&&si(H,Le),Te;if(ve===null){for(;!Ge.done;Le++,Ge=z.next())Ge=ie(H,Ge.value,ne),Ge!==null&&(B=T(Ge,B,Le),Be===null?Te=Ge:Be.sibling=Ge,Be=Ge);return Ue&&si(H,Le),Te}for(ve=g(ve);!Ge.done;Le++,Ge=z.next())Ge=Z(ve,H,Le,Ge.value,ne),Ge!==null&&(r&&Ge.alternate!==null&&ve.delete(Ge.key===null?Le:Ge.key),B=T(Ge,B,Le),Be===null?Te=Ge:Be.sibling=Ge,Be=Ge);return r&&ve.forEach(function(Sx){return a(H,Sx)}),Ue&&si(H,Le),Te}function Je(H,B,z,ne){if(typeof z=="object"&&z!==null&&z.type===_&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case S:e:{for(var Te=z.key;B!==null;){if(B.key===Te){if(Te=z.type,Te===_){if(B.tag===7){c(H,B.sibling),ne=E(B,z.props.children),ne.return=H,H=ne;break e}}else if(B.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===$&&ys(Te)===B.type){c(H,B.sibling),ne=E(B,z.props),oo(ne,z),ne.return=H,H=ne;break e}c(H,B);break}else a(H,B);B=B.sibling}z.type===_?(ne=ds(z.props.children,H.mode,ne,z.key),ne.return=H,H=ne):(ne=Ea(z.type,z.key,z.props,null,H.mode,ne),oo(ne,z),ne.return=H,H=ne)}return R(H);case A:e:{for(Te=z.key;B!==null;){if(B.key===Te)if(B.tag===4&&B.stateNode.containerInfo===z.containerInfo&&B.stateNode.implementation===z.implementation){c(H,B.sibling),ne=E(B,z.children||[]),ne.return=H,H=ne;break e}else{c(H,B);break}else a(H,B);B=B.sibling}ne=Wu(z,H.mode,ne),ne.return=H,H=ne}return R(H);case $:return z=ys(z),Je(H,B,z,ne)}if(fe(z))return ye(H,B,z,ne);if(re(z)){if(Te=re(z),typeof Te!="function")throw Error(n(150));return z=Te.call(z),Se(H,B,z,ne)}if(typeof z.then=="function")return Je(H,B,Ia(z),ne);if(z.$$typeof===L)return Je(H,B,Aa(H,z),ne);Ca(H,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,B!==null&&B.tag===6?(c(H,B.sibling),ne=E(B,z),ne.return=H,H=ne):(c(H,B),ne=Ju(z,H.mode,ne),ne.return=H,H=ne),R(H)):c(H,B)}return function(H,B,z,ne){try{ro=0;var Te=Je(H,B,z,ne);return er=null,Te}catch(ve){if(ve===js||ve===xa)throw ve;var Be=nn(29,ve,null,H.mode);return Be.lanes=ne,Be.return=H,Be}finally{}}}var Es=Ug(!0),Og=Ug(!1),Ni=!1;function lc(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function uc(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Pi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function ki(r,a,c){var g=r.updateQueue;if(g===null)return null;if(g=g.shared,(Ve&2)!==0){var E=g.pending;return E===null?a.next=a:(a.next=E.next,E.next=a),g.pending=a,a=va(r),Tg(r,null,c),a}return ya(r,g,a,c),va(r)}function ao(r,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var g=a.lanes;g&=r.pendingLanes,c|=g,a.lanes=c,Lh(r,c)}}function cc(r,a){var c=r.updateQueue,g=r.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var E=null,T=null;if(c=c.firstBaseUpdate,c!==null){do{var R={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};T===null?E=T=R:T=T.next=R,c=c.next}while(c!==null);T===null?E=T=a:T=T.next=a}else E=T=a;c={baseState:g.baseState,firstBaseUpdate:E,lastBaseUpdate:T,shared:g.shared,callbacks:g.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=a:r.next=a,c.lastBaseUpdate=a}var fc=!1;function lo(){if(fc){var r=Zs;if(r!==null)throw r}}function uo(r,a,c,g){fc=!1;var E=r.updateQueue;Ni=!1;var T=E.firstBaseUpdate,R=E.lastBaseUpdate,D=E.shared.pending;if(D!==null){E.shared.pending=null;var k=D,Y=k.next;k.next=null,R===null?T=Y:R.next=Y,R=k;var j=r.alternate;j!==null&&(j=j.updateQueue,D=j.lastBaseUpdate,D!==R&&(D===null?j.firstBaseUpdate=Y:D.next=Y,j.lastBaseUpdate=k))}if(T!==null){var ie=E.baseState;R=0,j=Y=k=null,D=T;do{var X=D.lane&-536870913,Z=X!==D.lane;if(Z?(Pe&X)===X:(g&X)===X){X!==0&&X===Qs&&(fc=!0),j!==null&&(j=j.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var ye=r,Se=D;X=a;var Je=c;switch(Se.tag){case 1:if(ye=Se.payload,typeof ye=="function"){ie=ye.call(Je,ie,X);break e}ie=ye;break e;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=Se.payload,X=typeof ye=="function"?ye.call(Je,ie,X):ye,X==null)break e;ie=m({},ie,X);break e;case 2:Ni=!0}}X=D.callback,X!==null&&(r.flags|=64,Z&&(r.flags|=8192),Z=E.callbacks,Z===null?E.callbacks=[X]:Z.push(X))}else Z={lane:X,tag:D.tag,payload:D.payload,callback:D.callback,next:null},j===null?(Y=j=Z,k=ie):j=j.next=Z,R|=X;if(D=D.next,D===null){if(D=E.shared.pending,D===null)break;Z=D,D=Z.next,Z.next=null,E.lastBaseUpdate=Z,E.shared.pending=null}}while(!0);j===null&&(k=ie),E.baseState=k,E.firstBaseUpdate=Y,E.lastBaseUpdate=j,T===null&&(E.shared.lanes=0),Gi|=R,r.lanes=R,r.memoizedState=ie}}function Fg(r,a){if(typeof r!="function")throw Error(n(191,r));r.call(a)}function Bg(r,a){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Fg(c[r],a)}var tr=w(null),La=w(0);function Gg(r,a){r=mi,se(La,r),se(tr,a),mi=r|a.baseLanes}function dc(){se(La,mi),se(tr,tr.current)}function hc(){mi=La.current,V(tr),V(La)}var sn=w(null),_n=null;function Ui(r){var a=r.alternate;se(ut,ut.current&1),se(sn,r),_n===null&&(a===null||tr.current!==null||a.memoizedState!==null)&&(_n=r)}function gc(r){se(ut,ut.current),se(sn,r),_n===null&&(_n=r)}function $g(r){r.tag===22?(se(ut,ut.current),se(sn,r),_n===null&&(_n=r)):Oi()}function Oi(){se(ut,ut.current),se(sn,sn.current)}function rn(r){V(sn),_n===r&&(_n=null),V(ut)}var ut=w(0);function ba(r){for(var a=r;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Sf(c)||Af(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ai=0,Ce=null,Ye=null,ht=null,Da=!1,nr=!1,Ts=!1,Ma=0,co=0,ir=null,f_=0;function rt(){throw Error(n(321))}function mc(r,a){if(a===null)return!1;for(var c=0;c<a.length&&c<r.length;c++)if(!tn(r[c],a[c]))return!1;return!0}function pc(r,a,c,g,E,T){return ai=T,Ce=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,F.H=r===null||r.memoizedState===null?xm:Mc,Ts=!1,T=c(g,E),Ts=!1,nr&&(T=Hg(a,c,g,E)),Vg(r),T}function Vg(r){F.H=go;var a=Ye!==null&&Ye.next!==null;if(ai=0,ht=Ye=Ce=null,Da=!1,co=0,ir=null,a)throw Error(n(300));r===null||gt||(r=r.dependencies,r!==null&&Sa(r)&&(gt=!0))}function Hg(r,a,c,g){Ce=r;var E=0;do{if(nr&&(ir=null),co=0,nr=!1,25<=E)throw Error(n(301));if(E+=1,ht=Ye=null,r.updateQueue!=null){var T=r.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}F.H=Rm,T=a(c,g)}while(nr);return T}function d_(){var r=F.H,a=r.useState()[0];return a=typeof a.then=="function"?fo(a):a,r=r.useState()[0],(Ye!==null?Ye.memoizedState:null)!==r&&(Ce.flags|=1024),a}function yc(){var r=Ma!==0;return Ma=0,r}function vc(r,a,c){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~c}function Ec(r){if(Da){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Da=!1}ai=0,ht=Ye=Ce=null,nr=!1,co=Ma=0,ir=null}function Gt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ht===null?Ce.memoizedState=ht=r:ht=ht.next=r,ht}function ct(){if(Ye===null){var r=Ce.alternate;r=r!==null?r.memoizedState:null}else r=Ye.next;var a=ht===null?Ce.memoizedState:ht.next;if(a!==null)ht=a,Ye=r;else{if(r===null)throw Ce.alternate===null?Error(n(467)):Error(n(310));Ye=r,r={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},ht===null?Ce.memoizedState=ht=r:ht=ht.next=r}return ht}function wa(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function fo(r){var a=co;return co+=1,ir===null&&(ir=[]),r=Ng(ir,r,a),a=Ce,(ht===null?a.memoizedState:ht.next)===null&&(a=a.alternate,F.H=a===null||a.memoizedState===null?xm:Mc),r}function Na(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return fo(r);if(r.$$typeof===L)return Lt(r)}throw Error(n(438,String(r)))}function Tc(r){var a=null,c=Ce.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var g=Ce.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(a={data:g.data.map(function(E){return E.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=wa(),Ce.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(r),g=0;g<r;g++)c[g]=O;return a.index++,c}function li(r,a){return typeof a=="function"?a(r):a}function Pa(r){var a=ct();return Sc(a,Ye,r)}function Sc(r,a,c){var g=r.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=c;var E=r.baseQueue,T=g.pending;if(T!==null){if(E!==null){var R=E.next;E.next=T.next,T.next=R}a.baseQueue=E=T,g.pending=null}if(T=r.baseState,E===null)r.memoizedState=T;else{a=E.next;var D=R=null,k=null,Y=a,j=!1;do{var ie=Y.lane&-536870913;if(ie!==Y.lane?(Pe&ie)===ie:(ai&ie)===ie){var X=Y.revertLane;if(X===0)k!==null&&(k=k.next={lane:0,revertLane:0,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),ie===Qs&&(j=!0);else if((ai&X)===X){Y=Y.next,X===Qs&&(j=!0);continue}else ie={lane:0,revertLane:Y.revertLane,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},k===null?(D=k=ie,R=T):k=k.next=ie,Ce.lanes|=X,Gi|=X;ie=Y.action,Ts&&c(T,ie),T=Y.hasEagerState?Y.eagerState:c(T,ie)}else X={lane:ie,revertLane:Y.revertLane,gesture:Y.gesture,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},k===null?(D=k=X,R=T):k=k.next=X,Ce.lanes|=ie,Gi|=ie;Y=Y.next}while(Y!==null&&Y!==a);if(k===null?R=T:k.next=D,!tn(T,r.memoizedState)&&(gt=!0,j&&(c=Zs,c!==null)))throw c;r.memoizedState=T,r.baseState=R,r.baseQueue=k,g.lastRenderedState=T}return E===null&&(g.lanes=0),[r.memoizedState,g.dispatch]}function Ac(r){var a=ct(),c=a.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=r;var g=c.dispatch,E=c.pending,T=a.memoizedState;if(E!==null){c.pending=null;var R=E=E.next;do T=r(T,R.action),R=R.next;while(R!==E);tn(T,a.memoizedState)||(gt=!0),a.memoizedState=T,a.baseQueue===null&&(a.baseState=T),c.lastRenderedState=T}return[T,g]}function qg(r,a,c){var g=Ce,E=ct(),T=Ue;if(T){if(c===void 0)throw Error(n(407));c=c()}else c=a();var R=!tn((Ye||E).memoizedState,c);if(R&&(E.memoizedState=c,gt=!0),E=E.queue,Rc(Yg.bind(null,g,E,r),[r]),E.getSnapshot!==a||R||ht!==null&&ht.memoizedState.tag&1){if(g.flags|=2048,sr(9,{destroy:void 0},zg.bind(null,g,E,c,a),null),Qe===null)throw Error(n(349));T||(ai&127)!==0||Kg(g,a,c)}return c}function Kg(r,a,c){r.flags|=16384,r={getSnapshot:a,value:c},a=Ce.updateQueue,a===null?(a=wa(),Ce.updateQueue=a,a.stores=[r]):(c=a.stores,c===null?a.stores=[r]:c.push(r))}function zg(r,a,c,g){a.value=c,a.getSnapshot=g,Xg(a)&&Jg(r)}function Yg(r,a,c){return c(function(){Xg(a)&&Jg(r)})}function Xg(r){var a=r.getSnapshot;r=r.value;try{var c=a();return!tn(r,c)}catch{return!0}}function Jg(r){var a=fs(r,2);a!==null&&Wt(a,r,2)}function _c(r){var a=Gt();if(typeof r=="function"){var c=r;if(r=c(),Ts){Ii(!0);try{c()}finally{Ii(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:r},a}function Wg(r,a,c,g){return r.baseState=c,Sc(r,Ye,typeof g=="function"?g:li)}function h_(r,a,c,g,E){if(Oa(r))throw Error(n(485));if(r=a.action,r!==null){var T={payload:E,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){T.listeners.push(R)}};F.T!==null?c(!0):T.isTransition=!1,g(T),c=a.pending,c===null?(T.next=a.pending=T,Qg(a,T)):(T.next=c.next,a.pending=c.next=T)}}function Qg(r,a){var c=a.action,g=a.payload,E=r.state;if(a.isTransition){var T=F.T,R={};F.T=R;try{var D=c(E,g),k=F.S;k!==null&&k(R,D),Zg(r,a,D)}catch(Y){xc(r,a,Y)}finally{T!==null&&R.types!==null&&(T.types=R.types),F.T=T}}else try{T=c(E,g),Zg(r,a,T)}catch(Y){xc(r,a,Y)}}function Zg(r,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){jg(r,a,g)},function(g){return xc(r,a,g)}):jg(r,a,c)}function jg(r,a,c){a.status="fulfilled",a.value=c,em(a),r.state=c,a=r.pending,a!==null&&(c=a.next,c===a?r.pending=null:(c=c.next,a.next=c,Qg(r,c)))}function xc(r,a,c){var g=r.pending;if(r.pending=null,g!==null){g=g.next;do a.status="rejected",a.reason=c,em(a),a=a.next;while(a!==g)}r.action=null}function em(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function tm(r,a){return a}function nm(r,a){if(Ue){var c=Qe.formState;if(c!==null){e:{var g=Ce;if(Ue){if(et){t:{for(var E=et,T=An;E.nodeType!==8;){if(!T){E=null;break t}if(E=xn(E.nextSibling),E===null){E=null;break t}}T=E.data,E=T==="F!"||T==="F"?E:null}if(E){et=xn(E.nextSibling),g=E.data==="F!";break e}}Mi(g)}g=!1}g&&(a=c[0])}}return c=Gt(),c.memoizedState=c.baseState=a,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tm,lastRenderedState:a},c.queue=g,c=Sm.bind(null,Ce,g),g.dispatch=c,g=_c(!1),T=Dc.bind(null,Ce,!1,g.queue),g=Gt(),E={state:a,dispatch:null,action:r,pending:null},g.queue=E,c=h_.bind(null,Ce,E,T,c),E.dispatch=c,g.memoizedState=r,[a,c,!1]}function im(r){var a=ct();return sm(a,Ye,r)}function sm(r,a,c){if(a=Sc(r,a,tm)[0],r=Pa(li)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var g=fo(a)}catch(R){throw R===js?xa:R}else g=a;a=ct();var E=a.queue,T=E.dispatch;return c!==a.memoizedState&&(Ce.flags|=2048,sr(9,{destroy:void 0},g_.bind(null,E,c),null)),[g,T,r]}function g_(r,a){r.action=a}function rm(r){var a=ct(),c=Ye;if(c!==null)return sm(a,c,r);ct(),a=a.memoizedState,c=ct();var g=c.queue.dispatch;return c.memoizedState=r,[a,g,!1]}function sr(r,a,c,g){return r={tag:r,create:c,deps:g,inst:a,next:null},a=Ce.updateQueue,a===null&&(a=wa(),Ce.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=r.next=r:(g=c.next,c.next=r,r.next=g,a.lastEffect=r),r}function om(){return ct().memoizedState}function ka(r,a,c,g){var E=Gt();Ce.flags|=r,E.memoizedState=sr(1|a,{destroy:void 0},c,g===void 0?null:g)}function Ua(r,a,c,g){var E=ct();g=g===void 0?null:g;var T=E.memoizedState.inst;Ye!==null&&g!==null&&mc(g,Ye.memoizedState.deps)?E.memoizedState=sr(a,T,c,g):(Ce.flags|=r,E.memoizedState=sr(1|a,T,c,g))}function am(r,a){ka(8390656,8,r,a)}function Rc(r,a){Ua(2048,8,r,a)}function m_(r){Ce.flags|=4;var a=Ce.updateQueue;if(a===null)a=wa(),Ce.updateQueue=a,a.events=[r];else{var c=a.events;c===null?a.events=[r]:c.push(r)}}function lm(r){var a=ct().memoizedState;return m_({ref:a,nextImpl:r}),function(){if((Ve&2)!==0)throw Error(n(440));return a.impl.apply(void 0,arguments)}}function um(r,a){return Ua(4,2,r,a)}function cm(r,a){return Ua(4,4,r,a)}function fm(r,a){if(typeof a=="function"){r=r();var c=a(r);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function dm(r,a,c){c=c!=null?c.concat([r]):null,Ua(4,4,fm.bind(null,a,r),c)}function Ic(){}function hm(r,a){var c=ct();a=a===void 0?null:a;var g=c.memoizedState;return a!==null&&mc(a,g[1])?g[0]:(c.memoizedState=[r,a],r)}function gm(r,a){var c=ct();a=a===void 0?null:a;var g=c.memoizedState;if(a!==null&&mc(a,g[1]))return g[0];if(g=r(),Ts){Ii(!0);try{r()}finally{Ii(!1)}}return c.memoizedState=[g,a],g}function Cc(r,a,c){return c===void 0||(ai&1073741824)!==0&&(Pe&261930)===0?r.memoizedState=a:(r.memoizedState=c,r=mp(),Ce.lanes|=r,Gi|=r,c)}function mm(r,a,c,g){return tn(c,a)?c:tr.current!==null?(r=Cc(r,c,g),tn(r,a)||(gt=!0),r):(ai&42)===0||(ai&1073741824)!==0&&(Pe&261930)===0?(gt=!0,r.memoizedState=c):(r=mp(),Ce.lanes|=r,Gi|=r,a)}function pm(r,a,c,g,E){var T=Q.p;Q.p=T!==0&&8>T?T:8;var R=F.T,D={};F.T=D,Dc(r,!1,a,c);try{var k=E(),Y=F.S;if(Y!==null&&Y(D,k),k!==null&&typeof k=="object"&&typeof k.then=="function"){var j=c_(k,g);ho(r,a,j,ln(r))}else ho(r,a,g,ln(r))}catch(ie){ho(r,a,{then:function(){},status:"rejected",reason:ie},ln())}finally{Q.p=T,R!==null&&D.types!==null&&(R.types=D.types),F.T=R}}function p_(){}function Lc(r,a,c,g){if(r.tag!==5)throw Error(n(476));var E=ym(r).queue;pm(r,E,a,ee,c===null?p_:function(){return vm(r),c(g)})}function ym(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:ee},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:c},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function vm(r){var a=ym(r);a.next===null&&(a=r.alternate.memoizedState),ho(r,a.next.queue,{},ln())}function bc(){return Lt(Do)}function Em(){return ct().memoizedState}function Tm(){return ct().memoizedState}function y_(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var c=ln();r=Pi(c);var g=ki(a,r,c);g!==null&&(Wt(g,a,c),ao(g,a,c)),a={cache:sc()},r.payload=a;return}a=a.return}}function v_(r,a,c){var g=ln();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Oa(r)?Am(a,c):(c=Yu(r,a,c,g),c!==null&&(Wt(c,r,g),_m(c,a,g)))}function Sm(r,a,c){var g=ln();ho(r,a,c,g)}function ho(r,a,c,g){var E={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Oa(r))Am(a,E);else{var T=r.alternate;if(r.lanes===0&&(T===null||T.lanes===0)&&(T=a.lastRenderedReducer,T!==null))try{var R=a.lastRenderedState,D=T(R,c);if(E.hasEagerState=!0,E.eagerState=D,tn(D,R))return ya(r,a,E,0),Qe===null&&pa(),!1}catch{}finally{}if(c=Yu(r,a,E,g),c!==null)return Wt(c,r,g),_m(c,a,g),!0}return!1}function Dc(r,a,c,g){if(g={lane:2,revertLane:uf(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Oa(r)){if(a)throw Error(n(479))}else a=Yu(r,c,g,2),a!==null&&Wt(a,r,2)}function Oa(r){var a=r.alternate;return r===Ce||a!==null&&a===Ce}function Am(r,a){nr=Da=!0;var c=r.pending;c===null?a.next=a:(a.next=c.next,c.next=a),r.pending=a}function _m(r,a,c){if((c&4194048)!==0){var g=a.lanes;g&=r.pendingLanes,c|=g,a.lanes=c,Lh(r,c)}}var go={readContext:Lt,use:Na,useCallback:rt,useContext:rt,useEffect:rt,useImperativeHandle:rt,useLayoutEffect:rt,useInsertionEffect:rt,useMemo:rt,useReducer:rt,useRef:rt,useState:rt,useDebugValue:rt,useDeferredValue:rt,useTransition:rt,useSyncExternalStore:rt,useId:rt,useHostTransitionStatus:rt,useFormState:rt,useActionState:rt,useOptimistic:rt,useMemoCache:rt,useCacheRefresh:rt};go.useEffectEvent=rt;var xm={readContext:Lt,use:Na,useCallback:function(r,a){return Gt().memoizedState=[r,a===void 0?null:a],r},useContext:Lt,useEffect:am,useImperativeHandle:function(r,a,c){c=c!=null?c.concat([r]):null,ka(4194308,4,fm.bind(null,a,r),c)},useLayoutEffect:function(r,a){return ka(4194308,4,r,a)},useInsertionEffect:function(r,a){ka(4,2,r,a)},useMemo:function(r,a){var c=Gt();a=a===void 0?null:a;var g=r();if(Ts){Ii(!0);try{r()}finally{Ii(!1)}}return c.memoizedState=[g,a],g},useReducer:function(r,a,c){var g=Gt();if(c!==void 0){var E=c(a);if(Ts){Ii(!0);try{c(a)}finally{Ii(!1)}}}else E=a;return g.memoizedState=g.baseState=E,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:E},g.queue=r,r=r.dispatch=v_.bind(null,Ce,r),[g.memoizedState,r]},useRef:function(r){var a=Gt();return r={current:r},a.memoizedState=r},useState:function(r){r=_c(r);var a=r.queue,c=Sm.bind(null,Ce,a);return a.dispatch=c,[r.memoizedState,c]},useDebugValue:Ic,useDeferredValue:function(r,a){var c=Gt();return Cc(c,r,a)},useTransition:function(){var r=_c(!1);return r=pm.bind(null,Ce,r.queue,!0,!1),Gt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,c){var g=Ce,E=Gt();if(Ue){if(c===void 0)throw Error(n(407));c=c()}else{if(c=a(),Qe===null)throw Error(n(349));(Pe&127)!==0||Kg(g,a,c)}E.memoizedState=c;var T={value:c,getSnapshot:a};return E.queue=T,am(Yg.bind(null,g,T,r),[r]),g.flags|=2048,sr(9,{destroy:void 0},zg.bind(null,g,T,c,a),null),c},useId:function(){var r=Gt(),a=Qe.identifierPrefix;if(Ue){var c=Vn,g=$n;c=(g&~(1<<32-en(g)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Ma++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=f_++,a="_"+a+"r_"+c.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:bc,useFormState:nm,useActionState:nm,useOptimistic:function(r){var a=Gt();a.memoizedState=a.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Dc.bind(null,Ce,!0,c),c.dispatch=a,[r,a]},useMemoCache:Tc,useCacheRefresh:function(){return Gt().memoizedState=y_.bind(null,Ce)},useEffectEvent:function(r){var a=Gt(),c={impl:r};return a.memoizedState=c,function(){if((Ve&2)!==0)throw Error(n(440));return c.impl.apply(void 0,arguments)}}},Mc={readContext:Lt,use:Na,useCallback:hm,useContext:Lt,useEffect:Rc,useImperativeHandle:dm,useInsertionEffect:um,useLayoutEffect:cm,useMemo:gm,useReducer:Pa,useRef:om,useState:function(){return Pa(li)},useDebugValue:Ic,useDeferredValue:function(r,a){var c=ct();return mm(c,Ye.memoizedState,r,a)},useTransition:function(){var r=Pa(li)[0],a=ct().memoizedState;return[typeof r=="boolean"?r:fo(r),a]},useSyncExternalStore:qg,useId:Em,useHostTransitionStatus:bc,useFormState:im,useActionState:im,useOptimistic:function(r,a){var c=ct();return Wg(c,Ye,r,a)},useMemoCache:Tc,useCacheRefresh:Tm};Mc.useEffectEvent=lm;var Rm={readContext:Lt,use:Na,useCallback:hm,useContext:Lt,useEffect:Rc,useImperativeHandle:dm,useInsertionEffect:um,useLayoutEffect:cm,useMemo:gm,useReducer:Ac,useRef:om,useState:function(){return Ac(li)},useDebugValue:Ic,useDeferredValue:function(r,a){var c=ct();return Ye===null?Cc(c,r,a):mm(c,Ye.memoizedState,r,a)},useTransition:function(){var r=Ac(li)[0],a=ct().memoizedState;return[typeof r=="boolean"?r:fo(r),a]},useSyncExternalStore:qg,useId:Em,useHostTransitionStatus:bc,useFormState:rm,useActionState:rm,useOptimistic:function(r,a){var c=ct();return Ye!==null?Wg(c,Ye,r,a):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Tc,useCacheRefresh:Tm};Rm.useEffectEvent=lm;function wc(r,a,c,g){a=r.memoizedState,c=c(g,a),c=c==null?a:m({},a,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Nc={enqueueSetState:function(r,a,c){r=r._reactInternals;var g=ln(),E=Pi(g);E.payload=a,c!=null&&(E.callback=c),a=ki(r,E,g),a!==null&&(Wt(a,r,g),ao(a,r,g))},enqueueReplaceState:function(r,a,c){r=r._reactInternals;var g=ln(),E=Pi(g);E.tag=1,E.payload=a,c!=null&&(E.callback=c),a=ki(r,E,g),a!==null&&(Wt(a,r,g),ao(a,r,g))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var c=ln(),g=Pi(c);g.tag=2,a!=null&&(g.callback=a),a=ki(r,g,c),a!==null&&(Wt(a,r,c),ao(a,r,c))}};function Im(r,a,c,g,E,T,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(g,T,R):a.prototype&&a.prototype.isPureReactComponent?!jr(c,g)||!jr(E,T):!0}function Cm(r,a,c,g){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,g),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,g),a.state!==r&&Nc.enqueueReplaceState(a,a.state,null)}function Ss(r,a){var c=a;if("ref"in a){c={};for(var g in a)g!=="ref"&&(c[g]=a[g])}if(r=r.defaultProps){c===a&&(c=m({},c));for(var E in r)c[E]===void 0&&(c[E]=r[E])}return c}function Lm(r){ma(r)}function bm(r){console.error(r)}function Dm(r){ma(r)}function Fa(r,a){try{var c=r.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(g){setTimeout(function(){throw g})}}function Mm(r,a,c){try{var g=r.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function Pc(r,a,c){return c=Pi(c),c.tag=3,c.payload={element:null},c.callback=function(){Fa(r,a)},c}function wm(r){return r=Pi(r),r.tag=3,r}function Nm(r,a,c,g){var E=c.type.getDerivedStateFromError;if(typeof E=="function"){var T=g.value;r.payload=function(){return E(T)},r.callback=function(){Mm(a,c,g)}}var R=c.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(r.callback=function(){Mm(a,c,g),typeof E!="function"&&($i===null?$i=new Set([this]):$i.add(this));var D=g.stack;this.componentDidCatch(g.value,{componentStack:D!==null?D:""})})}function E_(r,a,c,g,E){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(a=c.alternate,a!==null&&Ws(a,c,E,!0),c=sn.current,c!==null){switch(c.tag){case 31:case 13:return _n===null?Wa():c.alternate===null&&ot===0&&(ot=3),c.flags&=-257,c.flags|=65536,c.lanes=E,g===Ra?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([g]):a.add(g),of(r,g,E)),!1;case 22:return c.flags|=65536,g===Ra?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([g]):c.add(g)),of(r,g,E)),!1}throw Error(n(435,c.tag))}return of(r,g,E),Wa(),!1}if(Ue)return a=sn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=E,g!==ju&&(r=Error(n(422),{cause:g}),no(En(r,c)))):(g!==ju&&(a=Error(n(423),{cause:g}),no(En(a,c))),r=r.current.alternate,r.flags|=65536,E&=-E,r.lanes|=E,g=En(g,c),E=Pc(r.stateNode,g,E),cc(r,E),ot!==4&&(ot=2)),!1;var T=Error(n(520),{cause:g});if(T=En(T,c),Ao===null?Ao=[T]:Ao.push(T),ot!==4&&(ot=2),a===null)return!0;g=En(g,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,r=E&-E,c.lanes|=r,r=Pc(c.stateNode,g,r),cc(c,r),!1;case 1:if(a=c.type,T=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&($i===null||!$i.has(T))))return c.flags|=65536,E&=-E,c.lanes|=E,E=wm(E),Nm(E,r,c,g),cc(c,E),!1}c=c.return}while(c!==null);return!1}var kc=Error(n(461)),gt=!1;function bt(r,a,c,g){a.child=r===null?Og(a,null,c,g):Es(a,r.child,c,g)}function Pm(r,a,c,g,E){c=c.render;var T=a.ref;if("ref"in g){var R={};for(var D in g)D!=="ref"&&(R[D]=g[D])}else R=g;return ms(a),g=pc(r,a,c,R,T,E),D=yc(),r!==null&&!gt?(vc(r,a,E),ui(r,a,E)):(Ue&&D&&Qu(a),a.flags|=1,bt(r,a,g,E),a.child)}function km(r,a,c,g,E){if(r===null){var T=c.type;return typeof T=="function"&&!Xu(T)&&T.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=T,Um(r,a,T,g,E)):(r=Ea(c.type,null,g,a,a.mode,E),r.ref=a.ref,r.return=a,a.child=r)}if(T=r.child,!Hc(r,E)){var R=T.memoizedProps;if(c=c.compare,c=c!==null?c:jr,c(R,g)&&r.ref===a.ref)return ui(r,a,E)}return a.flags|=1,r=ii(T,g),r.ref=a.ref,r.return=a,a.child=r}function Um(r,a,c,g,E){if(r!==null){var T=r.memoizedProps;if(jr(T,g)&&r.ref===a.ref)if(gt=!1,a.pendingProps=g=T,Hc(r,E))(r.flags&131072)!==0&&(gt=!0);else return a.lanes=r.lanes,ui(r,a,E)}return Uc(r,a,c,g,E)}function Om(r,a,c,g){var E=g.children,T=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((a.flags&128)!==0){if(T=T!==null?T.baseLanes|c:c,r!==null){for(g=a.child=r.child,E=0;g!==null;)E=E|g.lanes|g.childLanes,g=g.sibling;g=E&~T}else g=0,a.child=null;return Fm(r,a,T,c,g)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&_a(a,T!==null?T.cachePool:null),T!==null?Gg(a,T):dc(),$g(a);else return g=a.lanes=536870912,Fm(r,a,T!==null?T.baseLanes|c:c,c,g)}else T!==null?(_a(a,T.cachePool),Gg(a,T),Oi(),a.memoizedState=null):(r!==null&&_a(a,null),dc(),Oi());return bt(r,a,E,c),a.child}function mo(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Fm(r,a,c,g,E){var T=oc();return T=T===null?null:{parent:dt._currentValue,pool:T},a.memoizedState={baseLanes:c,cachePool:T},r!==null&&_a(a,null),dc(),$g(a),r!==null&&Ws(r,a,g,!0),a.childLanes=E,null}function Ba(r,a){return a=$a({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function Bm(r,a,c){return Es(a,r.child,null,c),r=Ba(a,a.pendingProps),r.flags|=2,rn(a),a.memoizedState=null,r}function T_(r,a,c){var g=a.pendingProps,E=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(Ue){if(g.mode==="hidden")return r=Ba(a,g),a.lanes=536870912,mo(null,r);if(gc(a),(r=et)?(r=Qp(r,An),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:bi!==null?{id:$n,overflow:Vn}:null,retryLane:536870912,hydrationErrors:null},c=Ag(r),c.return=a,a.child=c,Ct=a,et=null)):r=null,r===null)throw Mi(a);return a.lanes=536870912,null}return Ba(a,g)}var T=r.memoizedState;if(T!==null){var R=T.dehydrated;if(gc(a),E)if(a.flags&256)a.flags&=-257,a=Bm(r,a,c);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(n(558));else if(gt||Ws(r,a,c,!1),E=(c&r.childLanes)!==0,gt||E){if(g=Qe,g!==null&&(R=bh(g,c),R!==0&&R!==T.retryLane))throw T.retryLane=R,fs(r,R),Wt(g,r,R),kc;Wa(),a=Bm(r,a,c)}else r=T.treeContext,et=xn(R.nextSibling),Ct=a,Ue=!0,Di=null,An=!1,r!==null&&Rg(a,r),a=Ba(a,g),a.flags|=4096;return a}return r=ii(r.child,{mode:g.mode,children:g.children}),r.ref=a.ref,a.child=r,r.return=a,r}function Ga(r,a){var c=a.ref;if(c===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(r===null||r.ref!==c)&&(a.flags|=4194816)}}function Uc(r,a,c,g,E){return ms(a),c=pc(r,a,c,g,void 0,E),g=yc(),r!==null&&!gt?(vc(r,a,E),ui(r,a,E)):(Ue&&g&&Qu(a),a.flags|=1,bt(r,a,c,E),a.child)}function Gm(r,a,c,g,E,T){return ms(a),a.updateQueue=null,c=Hg(a,g,c,E),Vg(r),g=yc(),r!==null&&!gt?(vc(r,a,T),ui(r,a,T)):(Ue&&g&&Qu(a),a.flags|=1,bt(r,a,c,T),a.child)}function $m(r,a,c,g,E){if(ms(a),a.stateNode===null){var T=zs,R=c.contextType;typeof R=="object"&&R!==null&&(T=Lt(R)),T=new c(g,T),a.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=Nc,a.stateNode=T,T._reactInternals=a,T=a.stateNode,T.props=g,T.state=a.memoizedState,T.refs={},lc(a),R=c.contextType,T.context=typeof R=="object"&&R!==null?Lt(R):zs,T.state=a.memoizedState,R=c.getDerivedStateFromProps,typeof R=="function"&&(wc(a,c,R,g),T.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(R=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),R!==T.state&&Nc.enqueueReplaceState(T,T.state,null),uo(a,g,T,E),lo(),T.state=a.memoizedState),typeof T.componentDidMount=="function"&&(a.flags|=4194308),g=!0}else if(r===null){T=a.stateNode;var D=a.memoizedProps,k=Ss(c,D);T.props=k;var Y=T.context,j=c.contextType;R=zs,typeof j=="object"&&j!==null&&(R=Lt(j));var ie=c.getDerivedStateFromProps;j=typeof ie=="function"||typeof T.getSnapshotBeforeUpdate=="function",D=a.pendingProps!==D,j||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(D||Y!==R)&&Cm(a,T,g,R),Ni=!1;var X=a.memoizedState;T.state=X,uo(a,g,T,E),lo(),Y=a.memoizedState,D||X!==Y||Ni?(typeof ie=="function"&&(wc(a,c,ie,g),Y=a.memoizedState),(k=Ni||Im(a,c,k,g,X,Y,R))?(j||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(a.flags|=4194308)):(typeof T.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=g,a.memoizedState=Y),T.props=g,T.state=Y,T.context=R,g=k):(typeof T.componentDidMount=="function"&&(a.flags|=4194308),g=!1)}else{T=a.stateNode,uc(r,a),R=a.memoizedProps,j=Ss(c,R),T.props=j,ie=a.pendingProps,X=T.context,Y=c.contextType,k=zs,typeof Y=="object"&&Y!==null&&(k=Lt(Y)),D=c.getDerivedStateFromProps,(Y=typeof D=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(R!==ie||X!==k)&&Cm(a,T,g,k),Ni=!1,X=a.memoizedState,T.state=X,uo(a,g,T,E),lo();var Z=a.memoizedState;R!==ie||X!==Z||Ni||r!==null&&r.dependencies!==null&&Sa(r.dependencies)?(typeof D=="function"&&(wc(a,c,D,g),Z=a.memoizedState),(j=Ni||Im(a,c,j,g,X,Z,k)||r!==null&&r.dependencies!==null&&Sa(r.dependencies))?(Y||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(g,Z,k),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(g,Z,k)),typeof T.componentDidUpdate=="function"&&(a.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof T.componentDidUpdate!="function"||R===r.memoizedProps&&X===r.memoizedState||(a.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&X===r.memoizedState||(a.flags|=1024),a.memoizedProps=g,a.memoizedState=Z),T.props=g,T.state=Z,T.context=k,g=j):(typeof T.componentDidUpdate!="function"||R===r.memoizedProps&&X===r.memoizedState||(a.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&X===r.memoizedState||(a.flags|=1024),g=!1)}return T=g,Ga(r,a),g=(a.flags&128)!==0,T||g?(T=a.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:T.render(),a.flags|=1,r!==null&&g?(a.child=Es(a,r.child,null,E),a.child=Es(a,null,c,E)):bt(r,a,c,E),a.memoizedState=T.state,r=a.child):r=ui(r,a,E),r}function Vm(r,a,c,g){return hs(),a.flags|=256,bt(r,a,c,g),a.child}var Oc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Fc(r){return{baseLanes:r,cachePool:Mg()}}function Bc(r,a,c){return r=r!==null?r.childLanes&~c:0,a&&(r|=an),r}function Hm(r,a,c){var g=a.pendingProps,E=!1,T=(a.flags&128)!==0,R;if((R=T)||(R=r!==null&&r.memoizedState===null?!1:(ut.current&2)!==0),R&&(E=!0,a.flags&=-129),R=(a.flags&32)!==0,a.flags&=-33,r===null){if(Ue){if(E?Ui(a):Oi(),(r=et)?(r=Qp(r,An),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:bi!==null?{id:$n,overflow:Vn}:null,retryLane:536870912,hydrationErrors:null},c=Ag(r),c.return=a,a.child=c,Ct=a,et=null)):r=null,r===null)throw Mi(a);return Af(r)?a.lanes=32:a.lanes=536870912,null}var D=g.children;return g=g.fallback,E?(Oi(),E=a.mode,D=$a({mode:"hidden",children:D},E),g=ds(g,E,c,null),D.return=a,g.return=a,D.sibling=g,a.child=D,g=a.child,g.memoizedState=Fc(c),g.childLanes=Bc(r,R,c),a.memoizedState=Oc,mo(null,g)):(Ui(a),Gc(a,D))}var k=r.memoizedState;if(k!==null&&(D=k.dehydrated,D!==null)){if(T)a.flags&256?(Ui(a),a.flags&=-257,a=$c(r,a,c)):a.memoizedState!==null?(Oi(),a.child=r.child,a.flags|=128,a=null):(Oi(),D=g.fallback,E=a.mode,g=$a({mode:"visible",children:g.children},E),D=ds(D,E,c,null),D.flags|=2,g.return=a,D.return=a,g.sibling=D,a.child=g,Es(a,r.child,null,c),g=a.child,g.memoizedState=Fc(c),g.childLanes=Bc(r,R,c),a.memoizedState=Oc,a=mo(null,g));else if(Ui(a),Af(D)){if(R=D.nextSibling&&D.nextSibling.dataset,R)var Y=R.dgst;R=Y,g=Error(n(419)),g.stack="",g.digest=R,no({value:g,source:null,stack:null}),a=$c(r,a,c)}else if(gt||Ws(r,a,c,!1),R=(c&r.childLanes)!==0,gt||R){if(R=Qe,R!==null&&(g=bh(R,c),g!==0&&g!==k.retryLane))throw k.retryLane=g,fs(r,g),Wt(R,r,g),kc;Sf(D)||Wa(),a=$c(r,a,c)}else Sf(D)?(a.flags|=192,a.child=r.child,a=null):(r=k.treeContext,et=xn(D.nextSibling),Ct=a,Ue=!0,Di=null,An=!1,r!==null&&Rg(a,r),a=Gc(a,g.children),a.flags|=4096);return a}return E?(Oi(),D=g.fallback,E=a.mode,k=r.child,Y=k.sibling,g=ii(k,{mode:"hidden",children:g.children}),g.subtreeFlags=k.subtreeFlags&65011712,Y!==null?D=ii(Y,D):(D=ds(D,E,c,null),D.flags|=2),D.return=a,g.return=a,g.sibling=D,a.child=g,mo(null,g),g=a.child,D=r.child.memoizedState,D===null?D=Fc(c):(E=D.cachePool,E!==null?(k=dt._currentValue,E=E.parent!==k?{parent:k,pool:k}:E):E=Mg(),D={baseLanes:D.baseLanes|c,cachePool:E}),g.memoizedState=D,g.childLanes=Bc(r,R,c),a.memoizedState=Oc,mo(r.child,g)):(Ui(a),c=r.child,r=c.sibling,c=ii(c,{mode:"visible",children:g.children}),c.return=a,c.sibling=null,r!==null&&(R=a.deletions,R===null?(a.deletions=[r],a.flags|=16):R.push(r)),a.child=c,a.memoizedState=null,c)}function Gc(r,a){return a=$a({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function $a(r,a){return r=nn(22,r,null,a),r.lanes=0,r}function $c(r,a,c){return Es(a,r.child,null,c),r=Gc(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function qm(r,a,c){r.lanes|=a;var g=r.alternate;g!==null&&(g.lanes|=a),nc(r.return,a,c)}function Vc(r,a,c,g,E,T){var R=r.memoizedState;R===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:E,treeForkCount:T}:(R.isBackwards=a,R.rendering=null,R.renderingStartTime=0,R.last=g,R.tail=c,R.tailMode=E,R.treeForkCount=T)}function Km(r,a,c){var g=a.pendingProps,E=g.revealOrder,T=g.tail;g=g.children;var R=ut.current,D=(R&2)!==0;if(D?(R=R&1|2,a.flags|=128):R&=1,se(ut,R),bt(r,a,g,c),g=Ue?to:0,!D&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&qm(r,c,a);else if(r.tag===19)qm(r,c,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(E){case"forwards":for(c=a.child,E=null;c!==null;)r=c.alternate,r!==null&&ba(r)===null&&(E=c),c=c.sibling;c=E,c===null?(E=a.child,a.child=null):(E=c.sibling,c.sibling=null),Vc(a,!1,E,c,T,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,E=a.child,a.child=null;E!==null;){if(r=E.alternate,r!==null&&ba(r)===null){a.child=E;break}r=E.sibling,E.sibling=c,c=E,E=r}Vc(a,!0,c,null,T,g);break;case"together":Vc(a,!1,null,null,void 0,g);break;default:a.memoizedState=null}return a.child}function ui(r,a,c){if(r!==null&&(a.dependencies=r.dependencies),Gi|=a.lanes,(c&a.childLanes)===0)if(r!==null){if(Ws(r,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(n(153));if(a.child!==null){for(r=a.child,c=ii(r,r.pendingProps),a.child=c,c.return=a;r.sibling!==null;)r=r.sibling,c=c.sibling=ii(r,r.pendingProps),c.return=a;c.sibling=null}return a.child}function Hc(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&Sa(r)))}function S_(r,a,c){switch(a.tag){case 3:Fe(a,a.stateNode.containerInfo),wi(a,dt,r.memoizedState.cache),hs();break;case 27:case 5:kt(a);break;case 4:Fe(a,a.stateNode.containerInfo);break;case 10:wi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,gc(a),null;break;case 13:var g=a.memoizedState;if(g!==null)return g.dehydrated!==null?(Ui(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Hm(r,a,c):(Ui(a),r=ui(r,a,c),r!==null?r.sibling:null);Ui(a);break;case 19:var E=(r.flags&128)!==0;if(g=(c&a.childLanes)!==0,g||(Ws(r,a,c,!1),g=(c&a.childLanes)!==0),E){if(g)return Km(r,a,c);a.flags|=128}if(E=a.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),se(ut,ut.current),g)break;return null;case 22:return a.lanes=0,Om(r,a,c,a.pendingProps);case 24:wi(a,dt,r.memoizedState.cache)}return ui(r,a,c)}function zm(r,a,c){if(r!==null)if(r.memoizedProps!==a.pendingProps)gt=!0;else{if(!Hc(r,c)&&(a.flags&128)===0)return gt=!1,S_(r,a,c);gt=(r.flags&131072)!==0}else gt=!1,Ue&&(a.flags&1048576)!==0&&xg(a,to,a.index);switch(a.lanes=0,a.tag){case 16:e:{var g=a.pendingProps;if(r=ys(a.elementType),a.type=r,typeof r=="function")Xu(r)?(g=Ss(r,g),a.tag=1,a=$m(null,a,r,g,c)):(a.tag=0,a=Uc(null,a,r,g,c));else{if(r!=null){var E=r.$$typeof;if(E===M){a.tag=11,a=Pm(null,a,r,g,c);break e}else if(E===N){a.tag=14,a=km(null,a,r,g,c);break e}}throw a=ce(r)||r,Error(n(306,a,""))}}return a;case 0:return Uc(r,a,a.type,a.pendingProps,c);case 1:return g=a.type,E=Ss(g,a.pendingProps),$m(r,a,g,E,c);case 3:e:{if(Fe(a,a.stateNode.containerInfo),r===null)throw Error(n(387));g=a.pendingProps;var T=a.memoizedState;E=T.element,uc(r,a),uo(a,g,null,c);var R=a.memoizedState;if(g=R.cache,wi(a,dt,g),g!==T.cache&&ic(a,[dt],c,!0),lo(),g=R.element,T.isDehydrated)if(T={element:g,isDehydrated:!1,cache:R.cache},a.updateQueue.baseState=T,a.memoizedState=T,a.flags&256){a=Vm(r,a,g,c);break e}else if(g!==E){E=En(Error(n(424)),a),no(E),a=Vm(r,a,g,c);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(et=xn(r.firstChild),Ct=a,Ue=!0,Di=null,An=!0,c=Og(a,null,g,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(hs(),g===E){a=ui(r,a,c);break e}bt(r,a,g,c)}a=a.child}return a;case 26:return Ga(r,a),r===null?(c=i0(a.type,null,a.pendingProps,null))?a.memoizedState=c:Ue||(c=a.type,r=a.pendingProps,g=il(ge.current).createElement(c),g[It]=a,g[qt]=r,Dt(g,c,r),At(g),a.stateNode=g):a.memoizedState=i0(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return kt(a),r===null&&Ue&&(g=a.stateNode=e0(a.type,a.pendingProps,ge.current),Ct=a,An=!0,E=et,Ki(a.type)?(_f=E,et=xn(g.firstChild)):et=E),bt(r,a,a.pendingProps.children,c),Ga(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&Ue&&((E=g=et)&&(g=Q_(g,a.type,a.pendingProps,An),g!==null?(a.stateNode=g,Ct=a,et=xn(g.firstChild),An=!1,E=!0):E=!1),E||Mi(a)),kt(a),E=a.type,T=a.pendingProps,R=r!==null?r.memoizedProps:null,g=T.children,vf(E,T)?g=null:R!==null&&vf(E,R)&&(a.flags|=32),a.memoizedState!==null&&(E=pc(r,a,d_,null,null,c),Do._currentValue=E),Ga(r,a),bt(r,a,g,c),a.child;case 6:return r===null&&Ue&&((r=c=et)&&(c=Z_(c,a.pendingProps,An),c!==null?(a.stateNode=c,Ct=a,et=null,r=!0):r=!1),r||Mi(a)),null;case 13:return Hm(r,a,c);case 4:return Fe(a,a.stateNode.containerInfo),g=a.pendingProps,r===null?a.child=Es(a,null,g,c):bt(r,a,g,c),a.child;case 11:return Pm(r,a,a.type,a.pendingProps,c);case 7:return bt(r,a,a.pendingProps,c),a.child;case 8:return bt(r,a,a.pendingProps.children,c),a.child;case 12:return bt(r,a,a.pendingProps.children,c),a.child;case 10:return g=a.pendingProps,wi(a,a.type,g.value),bt(r,a,g.children,c),a.child;case 9:return E=a.type._context,g=a.pendingProps.children,ms(a),E=Lt(E),g=g(E),a.flags|=1,bt(r,a,g,c),a.child;case 14:return km(r,a,a.type,a.pendingProps,c);case 15:return Um(r,a,a.type,a.pendingProps,c);case 19:return Km(r,a,c);case 31:return T_(r,a,c);case 22:return Om(r,a,c,a.pendingProps);case 24:return ms(a),g=Lt(dt),r===null?(E=oc(),E===null&&(E=Qe,T=sc(),E.pooledCache=T,T.refCount++,T!==null&&(E.pooledCacheLanes|=c),E=T),a.memoizedState={parent:g,cache:E},lc(a),wi(a,dt,E)):((r.lanes&c)!==0&&(uc(r,a),uo(a,null,null,c),lo()),E=r.memoizedState,T=a.memoizedState,E.parent!==g?(E={parent:g,cache:g},a.memoizedState=E,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=E),wi(a,dt,g)):(g=T.cache,wi(a,dt,g),g!==E.cache&&ic(a,[dt],c,!0))),bt(r,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function ci(r){r.flags|=4}function qc(r,a,c,g,E){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(E&335544128)===E)if(r.stateNode.complete)r.flags|=8192;else if(Ep())r.flags|=8192;else throw vs=Ra,ac}else r.flags&=-16777217}function Ym(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!l0(a))if(Ep())r.flags|=8192;else throw vs=Ra,ac}function Va(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?Ih():536870912,r.lanes|=a,lr|=a)}function po(r,a){if(!Ue)switch(r.tailMode){case"hidden":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:g.sibling=null}}function tt(r){var a=r.alternate!==null&&r.alternate.child===r.child,c=0,g=0;if(a)for(var E=r.child;E!==null;)c|=E.lanes|E.childLanes,g|=E.subtreeFlags&65011712,g|=E.flags&65011712,E.return=r,E=E.sibling;else for(E=r.child;E!==null;)c|=E.lanes|E.childLanes,g|=E.subtreeFlags,g|=E.flags,E.return=r,E=E.sibling;return r.subtreeFlags|=g,r.childLanes=c,a}function A_(r,a,c){var g=a.pendingProps;switch(Zu(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tt(a),null;case 1:return tt(a),null;case 3:return c=a.stateNode,g=null,r!==null&&(g=r.memoizedState.cache),a.memoizedState.cache!==g&&(a.flags|=2048),oi(dt),Oe(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Js(a)?ci(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,ec())),tt(a),null;case 26:var E=a.type,T=a.memoizedState;return r===null?(ci(a),T!==null?(tt(a),Ym(a,T)):(tt(a),qc(a,E,null,g,c))):T?T!==r.memoizedState?(ci(a),tt(a),Ym(a,T)):(tt(a),a.flags&=-16777217):(r=r.memoizedProps,r!==g&&ci(a),tt(a),qc(a,E,r,g,c)),null;case 27:if(mn(a),c=ge.current,E=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==g&&ci(a);else{if(!g){if(a.stateNode===null)throw Error(n(166));return tt(a),null}r=ae.current,Js(a)?Ig(a):(r=e0(E,g,c),a.stateNode=r,ci(a))}return tt(a),null;case 5:if(mn(a),E=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==g&&ci(a);else{if(!g){if(a.stateNode===null)throw Error(n(166));return tt(a),null}if(T=ae.current,Js(a))Ig(a);else{var R=il(ge.current);switch(T){case 1:T=R.createElementNS("http://www.w3.org/2000/svg",E);break;case 2:T=R.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;default:switch(E){case"svg":T=R.createElementNS("http://www.w3.org/2000/svg",E);break;case"math":T=R.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;case"script":T=R.createElement("div"),T.innerHTML="<script><\/script>",T=T.removeChild(T.firstChild);break;case"select":T=typeof g.is=="string"?R.createElement("select",{is:g.is}):R.createElement("select"),g.multiple?T.multiple=!0:g.size&&(T.size=g.size);break;default:T=typeof g.is=="string"?R.createElement(E,{is:g.is}):R.createElement(E)}}T[It]=a,T[qt]=g;e:for(R=a.child;R!==null;){if(R.tag===5||R.tag===6)T.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===a)break e;for(;R.sibling===null;){if(R.return===null||R.return===a)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}a.stateNode=T;e:switch(Dt(T,E,g),E){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&ci(a)}}return tt(a),qc(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,c),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==g&&ci(a);else{if(typeof g!="string"&&a.stateNode===null)throw Error(n(166));if(r=ge.current,Js(a)){if(r=a.stateNode,c=a.memoizedProps,g=null,E=Ct,E!==null)switch(E.tag){case 27:case 5:g=E.memoizedProps}r[It]=a,r=!!(r.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||Hp(r.nodeValue,c)),r||Mi(a,!0)}else r=il(r).createTextNode(g),r[It]=a,a.stateNode=r}return tt(a),null;case 31:if(c=a.memoizedState,r===null||r.memoizedState!==null){if(g=Js(a),c!==null){if(r===null){if(!g)throw Error(n(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(557));r[It]=a}else hs(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;tt(a),r=!1}else c=ec(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return a.flags&256?(rn(a),a):(rn(a),null);if((a.flags&128)!==0)throw Error(n(558))}return tt(a),null;case 13:if(g=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(E=Js(a),g!==null&&g.dehydrated!==null){if(r===null){if(!E)throw Error(n(318));if(E=a.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(n(317));E[It]=a}else hs(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;tt(a),E=!1}else E=ec(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=E),E=!0;if(!E)return a.flags&256?(rn(a),a):(rn(a),null)}return rn(a),(a.flags&128)!==0?(a.lanes=c,a):(c=g!==null,r=r!==null&&r.memoizedState!==null,c&&(g=a.child,E=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(E=g.alternate.memoizedState.cachePool.pool),T=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(T=g.memoizedState.cachePool.pool),T!==E&&(g.flags|=2048)),c!==r&&c&&(a.child.flags|=8192),Va(a,a.updateQueue),tt(a),null);case 4:return Oe(),r===null&&hf(a.stateNode.containerInfo),tt(a),null;case 10:return oi(a.type),tt(a),null;case 19:if(V(ut),g=a.memoizedState,g===null)return tt(a),null;if(E=(a.flags&128)!==0,T=g.rendering,T===null)if(E)po(g,!1);else{if(ot!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(T=ba(r),T!==null){for(a.flags|=128,po(g,!1),r=T.updateQueue,a.updateQueue=r,Va(a,r),a.subtreeFlags=0,r=c,c=a.child;c!==null;)Sg(c,r),c=c.sibling;return se(ut,ut.current&1|2),Ue&&si(a,g.treeForkCount),a.child}r=r.sibling}g.tail!==null&&St()>Ya&&(a.flags|=128,E=!0,po(g,!1),a.lanes=4194304)}else{if(!E)if(r=ba(T),r!==null){if(a.flags|=128,E=!0,r=r.updateQueue,a.updateQueue=r,Va(a,r),po(g,!0),g.tail===null&&g.tailMode==="hidden"&&!T.alternate&&!Ue)return tt(a),null}else 2*St()-g.renderingStartTime>Ya&&c!==536870912&&(a.flags|=128,E=!0,po(g,!1),a.lanes=4194304);g.isBackwards?(T.sibling=a.child,a.child=T):(r=g.last,r!==null?r.sibling=T:a.child=T,g.last=T)}return g.tail!==null?(r=g.tail,g.rendering=r,g.tail=r.sibling,g.renderingStartTime=St(),r.sibling=null,c=ut.current,se(ut,E?c&1|2:c&1),Ue&&si(a,g.treeForkCount),r):(tt(a),null);case 22:case 23:return rn(a),hc(),g=a.memoizedState!==null,r!==null?r.memoizedState!==null!==g&&(a.flags|=8192):g&&(a.flags|=8192),g?(c&536870912)!==0&&(a.flags&128)===0&&(tt(a),a.subtreeFlags&6&&(a.flags|=8192)):tt(a),c=a.updateQueue,c!==null&&Va(a,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),g=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(g=a.memoizedState.cachePool.pool),g!==c&&(a.flags|=2048),r!==null&&V(ps),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),oi(dt),tt(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function __(r,a){switch(Zu(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return oi(dt),Oe(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return mn(a),null;case 31:if(a.memoizedState!==null){if(rn(a),a.alternate===null)throw Error(n(340));hs()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(rn(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(n(340));hs()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return V(ut),null;case 4:return Oe(),null;case 10:return oi(a.type),null;case 22:case 23:return rn(a),hc(),r!==null&&V(ps),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return oi(dt),null;case 25:return null;default:return null}}function Xm(r,a){switch(Zu(a),a.tag){case 3:oi(dt),Oe();break;case 26:case 27:case 5:mn(a);break;case 4:Oe();break;case 31:a.memoizedState!==null&&rn(a);break;case 13:rn(a);break;case 19:V(ut);break;case 10:oi(a.type);break;case 22:case 23:rn(a),hc(),r!==null&&V(ps);break;case 24:oi(dt)}}function yo(r,a){try{var c=a.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var E=g.next;c=E;do{if((c.tag&r)===r){g=void 0;var T=c.create,R=c.inst;g=T(),R.destroy=g}c=c.next}while(c!==E)}}catch(D){qe(a,a.return,D)}}function Fi(r,a,c){try{var g=a.updateQueue,E=g!==null?g.lastEffect:null;if(E!==null){var T=E.next;g=T;do{if((g.tag&r)===r){var R=g.inst,D=R.destroy;if(D!==void 0){R.destroy=void 0,E=a;var k=c,Y=D;try{Y()}catch(j){qe(E,k,j)}}}g=g.next}while(g!==T)}}catch(j){qe(a,a.return,j)}}function Jm(r){var a=r.updateQueue;if(a!==null){var c=r.stateNode;try{Bg(a,c)}catch(g){qe(r,r.return,g)}}}function Wm(r,a,c){c.props=Ss(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(g){qe(r,a,g)}}function vo(r,a){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var g=r.stateNode;break;case 30:g=r.stateNode;break;default:g=r.stateNode}typeof c=="function"?r.refCleanup=c(g):c.current=g}}catch(E){qe(r,a,E)}}function Hn(r,a){var c=r.ref,g=r.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(E){qe(r,a,E)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(E){qe(r,a,E)}else c.current=null}function Qm(r){var a=r.type,c=r.memoizedProps,g=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(E){qe(r,r.return,E)}}function Kc(r,a,c){try{var g=r.stateNode;K_(g,r.type,c,a),g[qt]=a}catch(E){qe(r,r.return,E)}}function Zm(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Ki(r.type)||r.tag===4}function zc(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Zm(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Ki(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Yc(r,a,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(r),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=ti));else if(g!==4&&(g===27&&Ki(r.type)&&(c=r.stateNode,a=null),r=r.child,r!==null))for(Yc(r,a,c),r=r.sibling;r!==null;)Yc(r,a,c),r=r.sibling}function Ha(r,a,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,a?c.insertBefore(r,a):c.appendChild(r);else if(g!==4&&(g===27&&Ki(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Ha(r,a,c),r=r.sibling;r!==null;)Ha(r,a,c),r=r.sibling}function jm(r){var a=r.stateNode,c=r.memoizedProps;try{for(var g=r.type,E=a.attributes;E.length;)a.removeAttributeNode(E[0]);Dt(a,g,c),a[It]=r,a[qt]=c}catch(T){qe(r,r.return,T)}}var fi=!1,mt=!1,Xc=!1,ep=typeof WeakSet=="function"?WeakSet:Set,_t=null;function x_(r,a){if(r=r.containerInfo,pf=cl,r=dg(r),$u(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var E=g.anchorOffset,T=g.focusNode;g=g.focusOffset;try{c.nodeType,T.nodeType}catch{c=null;break e}var R=0,D=-1,k=-1,Y=0,j=0,ie=r,X=null;t:for(;;){for(var Z;ie!==c||E!==0&&ie.nodeType!==3||(D=R+E),ie!==T||g!==0&&ie.nodeType!==3||(k=R+g),ie.nodeType===3&&(R+=ie.nodeValue.length),(Z=ie.firstChild)!==null;)X=ie,ie=Z;for(;;){if(ie===r)break t;if(X===c&&++Y===E&&(D=R),X===T&&++j===g&&(k=R),(Z=ie.nextSibling)!==null)break;ie=X,X=ie.parentNode}ie=Z}c=D===-1||k===-1?null:{start:D,end:k}}else c=null}c=c||{start:0,end:0}}else c=null;for(yf={focusedElem:r,selectionRange:c},cl=!1,_t=a;_t!==null;)if(a=_t,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,_t=r;else for(;_t!==null;){switch(a=_t,T=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)E=r[c],E.ref.impl=E.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&T!==null){r=void 0,c=a,E=T.memoizedProps,T=T.memoizedState,g=c.stateNode;try{var ye=Ss(c.type,E);r=g.getSnapshotBeforeUpdate(ye,T),g.__reactInternalSnapshotBeforeUpdate=r}catch(Se){qe(c,c.return,Se)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,c=r.nodeType,c===9)Tf(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Tf(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=a.sibling,r!==null){r.return=a.return,_t=r;break}_t=a.return}}function tp(r,a,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:hi(r,c),g&4&&yo(5,c);break;case 1:if(hi(r,c),g&4)if(r=c.stateNode,a===null)try{r.componentDidMount()}catch(R){qe(c,c.return,R)}else{var E=Ss(c.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(E,a,r.__reactInternalSnapshotBeforeUpdate)}catch(R){qe(c,c.return,R)}}g&64&&Jm(c),g&512&&vo(c,c.return);break;case 3:if(hi(r,c),g&64&&(r=c.updateQueue,r!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{Bg(r,a)}catch(R){qe(c,c.return,R)}}break;case 27:a===null&&g&4&&jm(c);case 26:case 5:hi(r,c),a===null&&g&4&&Qm(c),g&512&&vo(c,c.return);break;case 12:hi(r,c);break;case 31:hi(r,c),g&4&&sp(r,c);break;case 13:hi(r,c),g&4&&rp(r,c),g&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=N_.bind(null,c),j_(r,c))));break;case 22:if(g=c.memoizedState!==null||fi,!g){a=a!==null&&a.memoizedState!==null||mt,E=fi;var T=mt;fi=g,(mt=a)&&!T?gi(r,c,(c.subtreeFlags&8772)!==0):hi(r,c),fi=E,mt=T}break;case 30:break;default:hi(r,c)}}function np(r){var a=r.alternate;a!==null&&(r.alternate=null,np(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&xu(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var nt=null,zt=!1;function di(r,a,c){for(c=c.child;c!==null;)ip(r,a,c),c=c.sibling}function ip(r,a,c){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount($r,c)}catch{}switch(c.tag){case 26:mt||Hn(c,a),di(r,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:mt||Hn(c,a);var g=nt,E=zt;Ki(c.type)&&(nt=c.stateNode,zt=!1),di(r,a,c),Co(c.stateNode),nt=g,zt=E;break;case 5:mt||Hn(c,a);case 6:if(g=nt,E=zt,nt=null,di(r,a,c),nt=g,zt=E,nt!==null)if(zt)try{(nt.nodeType===9?nt.body:nt.nodeName==="HTML"?nt.ownerDocument.body:nt).removeChild(c.stateNode)}catch(T){qe(c,a,T)}else try{nt.removeChild(c.stateNode)}catch(T){qe(c,a,T)}break;case 18:nt!==null&&(zt?(r=nt,Jp(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),pr(r)):Jp(nt,c.stateNode));break;case 4:g=nt,E=zt,nt=c.stateNode.containerInfo,zt=!0,di(r,a,c),nt=g,zt=E;break;case 0:case 11:case 14:case 15:Fi(2,c,a),mt||Fi(4,c,a),di(r,a,c);break;case 1:mt||(Hn(c,a),g=c.stateNode,typeof g.componentWillUnmount=="function"&&Wm(c,a,g)),di(r,a,c);break;case 21:di(r,a,c);break;case 22:mt=(g=mt)||c.memoizedState!==null,di(r,a,c),mt=g;break;default:di(r,a,c)}}function sp(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{pr(r)}catch(c){qe(a,a.return,c)}}}function rp(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{pr(r)}catch(c){qe(a,a.return,c)}}function R_(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new ep),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new ep),a;default:throw Error(n(435,r.tag))}}function qa(r,a){var c=R_(r);a.forEach(function(g){if(!c.has(g)){c.add(g);var E=P_.bind(null,r,g);g.then(E,E)}})}function Yt(r,a){var c=a.deletions;if(c!==null)for(var g=0;g<c.length;g++){var E=c[g],T=r,R=a,D=R;e:for(;D!==null;){switch(D.tag){case 27:if(Ki(D.type)){nt=D.stateNode,zt=!1;break e}break;case 5:nt=D.stateNode,zt=!1;break e;case 3:case 4:nt=D.stateNode.containerInfo,zt=!0;break e}D=D.return}if(nt===null)throw Error(n(160));ip(T,R,E),nt=null,zt=!1,T=E.alternate,T!==null&&(T.return=null),E.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)op(a,r),a=a.sibling}var Nn=null;function op(r,a){var c=r.alternate,g=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Yt(a,r),Xt(r),g&4&&(Fi(3,r,r.return),yo(3,r),Fi(5,r,r.return));break;case 1:Yt(a,r),Xt(r),g&512&&(mt||c===null||Hn(c,c.return)),g&64&&fi&&(r=r.updateQueue,r!==null&&(g=r.callbacks,g!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var E=Nn;if(Yt(a,r),Xt(r),g&512&&(mt||c===null||Hn(c,c.return)),g&4){var T=c!==null?c.memoizedState:null;if(g=r.memoizedState,c===null)if(g===null)if(r.stateNode===null){e:{g=r.type,c=r.memoizedProps,E=E.ownerDocument||E;t:switch(g){case"title":T=E.getElementsByTagName("title")[0],(!T||T[qr]||T[It]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=E.createElement(g),E.head.insertBefore(T,E.querySelector("head > title"))),Dt(T,g,c),T[It]=r,At(T),g=T;break e;case"link":var R=o0("link","href",E).get(g+(c.href||""));if(R){for(var D=0;D<R.length;D++)if(T=R[D],T.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&T.getAttribute("rel")===(c.rel==null?null:c.rel)&&T.getAttribute("title")===(c.title==null?null:c.title)&&T.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){R.splice(D,1);break t}}T=E.createElement(g),Dt(T,g,c),E.head.appendChild(T);break;case"meta":if(R=o0("meta","content",E).get(g+(c.content||""))){for(D=0;D<R.length;D++)if(T=R[D],T.getAttribute("content")===(c.content==null?null:""+c.content)&&T.getAttribute("name")===(c.name==null?null:c.name)&&T.getAttribute("property")===(c.property==null?null:c.property)&&T.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&T.getAttribute("charset")===(c.charSet==null?null:c.charSet)){R.splice(D,1);break t}}T=E.createElement(g),Dt(T,g,c),E.head.appendChild(T);break;default:throw Error(n(468,g))}T[It]=r,At(T),g=T}r.stateNode=g}else a0(E,r.type,r.stateNode);else r.stateNode=r0(E,g,r.memoizedProps);else T!==g?(T===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):T.count--,g===null?a0(E,r.type,r.stateNode):r0(E,g,r.memoizedProps)):g===null&&r.stateNode!==null&&Kc(r,r.memoizedProps,c.memoizedProps)}break;case 27:Yt(a,r),Xt(r),g&512&&(mt||c===null||Hn(c,c.return)),c!==null&&g&4&&Kc(r,r.memoizedProps,c.memoizedProps);break;case 5:if(Yt(a,r),Xt(r),g&512&&(mt||c===null||Hn(c,c.return)),r.flags&32){E=r.stateNode;try{Bs(E,"")}catch(ye){qe(r,r.return,ye)}}g&4&&r.stateNode!=null&&(E=r.memoizedProps,Kc(r,E,c!==null?c.memoizedProps:E)),g&1024&&(Xc=!0);break;case 6:if(Yt(a,r),Xt(r),g&4){if(r.stateNode===null)throw Error(n(162));g=r.memoizedProps,c=r.stateNode;try{c.nodeValue=g}catch(ye){qe(r,r.return,ye)}}break;case 3:if(ol=null,E=Nn,Nn=sl(a.containerInfo),Yt(a,r),Nn=E,Xt(r),g&4&&c!==null&&c.memoizedState.isDehydrated)try{pr(a.containerInfo)}catch(ye){qe(r,r.return,ye)}Xc&&(Xc=!1,ap(r));break;case 4:g=Nn,Nn=sl(r.stateNode.containerInfo),Yt(a,r),Xt(r),Nn=g;break;case 12:Yt(a,r),Xt(r);break;case 31:Yt(a,r),Xt(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,qa(r,g)));break;case 13:Yt(a,r),Xt(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(za=St()),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,qa(r,g)));break;case 22:E=r.memoizedState!==null;var k=c!==null&&c.memoizedState!==null,Y=fi,j=mt;if(fi=Y||E,mt=j||k,Yt(a,r),mt=j,fi=Y,Xt(r),g&8192)e:for(a=r.stateNode,a._visibility=E?a._visibility&-2:a._visibility|1,E&&(c===null||k||fi||mt||As(r)),c=null,a=r;;){if(a.tag===5||a.tag===26){if(c===null){k=c=a;try{if(T=k.stateNode,E)R=T.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{D=k.stateNode;var ie=k.memoizedProps.style,X=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;D.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(ye){qe(k,k.return,ye)}}}else if(a.tag===6){if(c===null){k=a;try{k.stateNode.nodeValue=E?"":k.memoizedProps}catch(ye){qe(k,k.return,ye)}}}else if(a.tag===18){if(c===null){k=a;try{var Z=k.stateNode;E?Wp(Z,!0):Wp(k.stateNode,!1)}catch(ye){qe(k,k.return,ye)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}g&4&&(g=r.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,qa(r,c))));break;case 19:Yt(a,r),Xt(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,qa(r,g)));break;case 30:break;case 21:break;default:Yt(a,r),Xt(r)}}function Xt(r){var a=r.flags;if(a&2){try{for(var c,g=r.return;g!==null;){if(Zm(g)){c=g;break}g=g.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var E=c.stateNode,T=zc(r);Ha(r,T,E);break;case 5:var R=c.stateNode;c.flags&32&&(Bs(R,""),c.flags&=-33);var D=zc(r);Ha(r,D,R);break;case 3:case 4:var k=c.stateNode.containerInfo,Y=zc(r);Yc(r,Y,k);break;default:throw Error(n(161))}}catch(j){qe(r,r.return,j)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function ap(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;ap(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function hi(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)tp(r,a.alternate,a),a=a.sibling}function As(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Fi(4,a,a.return),As(a);break;case 1:Hn(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Wm(a,a.return,c),As(a);break;case 27:Co(a.stateNode);case 26:case 5:Hn(a,a.return),As(a);break;case 22:a.memoizedState===null&&As(a);break;case 30:As(a);break;default:As(a)}r=r.sibling}}function gi(r,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var g=a.alternate,E=r,T=a,R=T.flags;switch(T.tag){case 0:case 11:case 15:gi(E,T,c),yo(4,T);break;case 1:if(gi(E,T,c),g=T,E=g.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Y){qe(g,g.return,Y)}if(g=T,E=g.updateQueue,E!==null){var D=g.stateNode;try{var k=E.shared.hiddenCallbacks;if(k!==null)for(E.shared.hiddenCallbacks=null,E=0;E<k.length;E++)Fg(k[E],D)}catch(Y){qe(g,g.return,Y)}}c&&R&64&&Jm(T),vo(T,T.return);break;case 27:jm(T);case 26:case 5:gi(E,T,c),c&&g===null&&R&4&&Qm(T),vo(T,T.return);break;case 12:gi(E,T,c);break;case 31:gi(E,T,c),c&&R&4&&sp(E,T);break;case 13:gi(E,T,c),c&&R&4&&rp(E,T);break;case 22:T.memoizedState===null&&gi(E,T,c),vo(T,T.return);break;case 30:break;default:gi(E,T,c)}a=a.sibling}}function Jc(r,a){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&io(c))}function Wc(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&io(r))}function Pn(r,a,c,g){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)lp(r,a,c,g),a=a.sibling}function lp(r,a,c,g){var E=a.flags;switch(a.tag){case 0:case 11:case 15:Pn(r,a,c,g),E&2048&&yo(9,a);break;case 1:Pn(r,a,c,g);break;case 3:Pn(r,a,c,g),E&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&io(r)));break;case 12:if(E&2048){Pn(r,a,c,g),r=a.stateNode;try{var T=a.memoizedProps,R=T.id,D=T.onPostCommit;typeof D=="function"&&D(R,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(k){qe(a,a.return,k)}}else Pn(r,a,c,g);break;case 31:Pn(r,a,c,g);break;case 13:Pn(r,a,c,g);break;case 23:break;case 22:T=a.stateNode,R=a.alternate,a.memoizedState!==null?T._visibility&2?Pn(r,a,c,g):Eo(r,a):T._visibility&2?Pn(r,a,c,g):(T._visibility|=2,rr(r,a,c,g,(a.subtreeFlags&10256)!==0||!1)),E&2048&&Jc(R,a);break;case 24:Pn(r,a,c,g),E&2048&&Wc(a.alternate,a);break;default:Pn(r,a,c,g)}}function rr(r,a,c,g,E){for(E=E&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var T=r,R=a,D=c,k=g,Y=R.flags;switch(R.tag){case 0:case 11:case 15:rr(T,R,D,k,E),yo(8,R);break;case 23:break;case 22:var j=R.stateNode;R.memoizedState!==null?j._visibility&2?rr(T,R,D,k,E):Eo(T,R):(j._visibility|=2,rr(T,R,D,k,E)),E&&Y&2048&&Jc(R.alternate,R);break;case 24:rr(T,R,D,k,E),E&&Y&2048&&Wc(R.alternate,R);break;default:rr(T,R,D,k,E)}a=a.sibling}}function Eo(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=r,g=a,E=g.flags;switch(g.tag){case 22:Eo(c,g),E&2048&&Jc(g.alternate,g);break;case 24:Eo(c,g),E&2048&&Wc(g.alternate,g);break;default:Eo(c,g)}a=a.sibling}}var To=8192;function or(r,a,c){if(r.subtreeFlags&To)for(r=r.child;r!==null;)up(r,a,c),r=r.sibling}function up(r,a,c){switch(r.tag){case 26:or(r,a,c),r.flags&To&&r.memoizedState!==null&&fx(c,Nn,r.memoizedState,r.memoizedProps);break;case 5:or(r,a,c);break;case 3:case 4:var g=Nn;Nn=sl(r.stateNode.containerInfo),or(r,a,c),Nn=g;break;case 22:r.memoizedState===null&&(g=r.alternate,g!==null&&g.memoizedState!==null?(g=To,To=16777216,or(r,a,c),To=g):or(r,a,c));break;default:or(r,a,c)}}function cp(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function So(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var g=a[c];_t=g,dp(g,r)}cp(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)fp(r),r=r.sibling}function fp(r){switch(r.tag){case 0:case 11:case 15:So(r),r.flags&2048&&Fi(9,r,r.return);break;case 3:So(r);break;case 12:So(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,Ka(r)):So(r);break;default:So(r)}}function Ka(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var g=a[c];_t=g,dp(g,r)}cp(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Fi(8,a,a.return),Ka(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Ka(a));break;default:Ka(a)}r=r.sibling}}function dp(r,a){for(;_t!==null;){var c=_t;switch(c.tag){case 0:case 11:case 15:Fi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:io(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,_t=g;else e:for(c=r;_t!==null;){g=_t;var E=g.sibling,T=g.return;if(np(g),g===c){_t=null;break e}if(E!==null){E.return=T,_t=E;break e}_t=T}}}var I_={getCacheForType:function(r){var a=Lt(dt),c=a.data.get(r);return c===void 0&&(c=r(),a.data.set(r,c)),c},cacheSignal:function(){return Lt(dt).controller.signal}},C_=typeof WeakMap=="function"?WeakMap:Map,Ve=0,Qe=null,Me=null,Pe=0,He=0,on=null,Bi=!1,ar=!1,Qc=!1,mi=0,ot=0,Gi=0,_s=0,Zc=0,an=0,lr=0,Ao=null,Jt=null,jc=!1,za=0,hp=0,Ya=1/0,Xa=null,$i=null,pt=0,Vi=null,ur=null,pi=0,ef=0,tf=null,gp=null,_o=0,nf=null;function ln(){return(Ve&2)!==0&&Pe!==0?Pe&-Pe:F.T!==null?uf():Dh()}function mp(){if(an===0)if((Pe&536870912)===0||Ue){var r=na;na<<=1,(na&3932160)===0&&(na=262144),an=r}else an=536870912;return r=sn.current,r!==null&&(r.flags|=32),an}function Wt(r,a,c){(r===Qe&&(He===2||He===9)||r.cancelPendingCommit!==null)&&(cr(r,0),Hi(r,Pe,an,!1)),Hr(r,c),((Ve&2)===0||r!==Qe)&&(r===Qe&&((Ve&2)===0&&(_s|=c),ot===4&&Hi(r,Pe,an,!1)),qn(r))}function pp(r,a,c){if((Ve&6)!==0)throw Error(n(327));var g=!c&&(a&127)===0&&(a&r.expiredLanes)===0||Vr(r,a),E=g?D_(r,a):rf(r,a,!0),T=g;do{if(E===0){ar&&!g&&Hi(r,a,0,!1);break}else{if(c=r.current.alternate,T&&!L_(c)){E=rf(r,a,!1),T=!1;continue}if(E===2){if(T=a,r.errorRecoveryDisabledLanes&T)var R=0;else R=r.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){a=R;e:{var D=r;E=Ao;var k=D.current.memoizedState.isDehydrated;if(k&&(cr(D,R).flags|=256),R=rf(D,R,!1),R!==2){if(Qc&&!k){D.errorRecoveryDisabledLanes|=T,_s|=T,E=4;break e}T=Jt,Jt=E,T!==null&&(Jt===null?Jt=T:Jt.push.apply(Jt,T))}E=R}if(T=!1,E!==2)continue}}if(E===1){cr(r,0),Hi(r,a,0,!0);break}e:{switch(g=r,T=E,T){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Hi(g,a,an,!Bi);break e;case 2:Jt=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(E=za+300-St(),10<E)){if(Hi(g,a,an,!Bi),sa(g,0,!0)!==0)break e;pi=a,g.timeoutHandle=Yp(yp.bind(null,g,c,Jt,Xa,jc,a,an,_s,lr,Bi,T,"Throttled",-0,0),E);break e}yp(g,c,Jt,Xa,jc,a,an,_s,lr,Bi,T,null,-0,0)}}break}while(!0);qn(r)}function yp(r,a,c,g,E,T,R,D,k,Y,j,ie,X,Z){if(r.timeoutHandle=-1,ie=a.subtreeFlags,ie&8192||(ie&16785408)===16785408){ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ti},up(a,T,ie);var ye=(T&62914560)===T?za-St():(T&4194048)===T?hp-St():0;if(ye=dx(ie,ye),ye!==null){pi=T,r.cancelPendingCommit=ye(Rp.bind(null,r,a,T,c,g,E,R,D,k,j,ie,null,X,Z)),Hi(r,T,R,!Y);return}}Rp(r,a,T,c,g,E,R,D,k)}function L_(r){for(var a=r;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var E=c[g],T=E.getSnapshot;E=E.value;try{if(!tn(T(),E))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Hi(r,a,c,g){a&=~Zc,a&=~_s,r.suspendedLanes|=a,r.pingedLanes&=~a,g&&(r.warmLanes|=a),g=r.expirationTimes;for(var E=a;0<E;){var T=31-en(E),R=1<<T;g[T]=-1,E&=~R}c!==0&&Ch(r,c,a)}function Ja(){return(Ve&6)===0?(xo(0),!1):!0}function sf(){if(Me!==null){if(He===0)var r=Me.return;else r=Me,ri=gs=null,Ec(r),er=null,ro=0,r=Me;for(;r!==null;)Xm(r.alternate,r),r=r.return;Me=null}}function cr(r,a){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,X_(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),pi=0,sf(),Qe=r,Me=c=ii(r.current,null),Pe=a,He=0,on=null,Bi=!1,ar=Vr(r,a),Qc=!1,lr=an=Zc=_s=Gi=ot=0,Jt=Ao=null,jc=!1,(a&8)!==0&&(a|=a&32);var g=r.entangledLanes;if(g!==0)for(r=r.entanglements,g&=a;0<g;){var E=31-en(g),T=1<<E;a|=r[E],g&=~T}return mi=a,pa(),c}function vp(r,a){Ce=null,F.H=go,a===js||a===xa?(a=Pg(),He=3):a===ac?(a=Pg(),He=4):He=a===kc?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,on=a,Me===null&&(ot=1,Fa(r,En(a,r.current)))}function Ep(){var r=sn.current;return r===null?!0:(Pe&4194048)===Pe?_n===null:(Pe&62914560)===Pe||(Pe&536870912)!==0?r===_n:!1}function Tp(){var r=F.H;return F.H=go,r===null?go:r}function Sp(){var r=F.A;return F.A=I_,r}function Wa(){ot=4,Bi||(Pe&4194048)!==Pe&&sn.current!==null||(ar=!0),(Gi&134217727)===0&&(_s&134217727)===0||Qe===null||Hi(Qe,Pe,an,!1)}function rf(r,a,c){var g=Ve;Ve|=2;var E=Tp(),T=Sp();(Qe!==r||Pe!==a)&&(Xa=null,cr(r,a)),a=!1;var R=ot;e:do try{if(He!==0&&Me!==null){var D=Me,k=on;switch(He){case 8:sf(),R=6;break e;case 3:case 2:case 9:case 6:sn.current===null&&(a=!0);var Y=He;if(He=0,on=null,fr(r,D,k,Y),c&&ar){R=0;break e}break;default:Y=He,He=0,on=null,fr(r,D,k,Y)}}b_(),R=ot;break}catch(j){vp(r,j)}while(!0);return a&&r.shellSuspendCounter++,ri=gs=null,Ve=g,F.H=E,F.A=T,Me===null&&(Qe=null,Pe=0,pa()),R}function b_(){for(;Me!==null;)Ap(Me)}function D_(r,a){var c=Ve;Ve|=2;var g=Tp(),E=Sp();Qe!==r||Pe!==a?(Xa=null,Ya=St()+500,cr(r,a)):ar=Vr(r,a);e:do try{if(He!==0&&Me!==null){a=Me;var T=on;t:switch(He){case 1:He=0,on=null,fr(r,a,T,1);break;case 2:case 9:if(wg(T)){He=0,on=null,_p(a);break}a=function(){He!==2&&He!==9||Qe!==r||(He=7),qn(r)},T.then(a,a);break e;case 3:He=7;break e;case 4:He=5;break e;case 7:wg(T)?(He=0,on=null,_p(a)):(He=0,on=null,fr(r,a,T,7));break;case 5:var R=null;switch(Me.tag){case 26:R=Me.memoizedState;case 5:case 27:var D=Me;if(R?l0(R):D.stateNode.complete){He=0,on=null;var k=D.sibling;if(k!==null)Me=k;else{var Y=D.return;Y!==null?(Me=Y,Qa(Y)):Me=null}break t}}He=0,on=null,fr(r,a,T,5);break;case 6:He=0,on=null,fr(r,a,T,6);break;case 8:sf(),ot=6;break e;default:throw Error(n(462))}}M_();break}catch(j){vp(r,j)}while(!0);return ri=gs=null,F.H=g,F.A=E,Ve=c,Me!==null?0:(Qe=null,Pe=0,pa(),ot)}function M_(){for(;Me!==null&&!jn();)Ap(Me)}function Ap(r){var a=zm(r.alternate,r,mi);r.memoizedProps=r.pendingProps,a===null?Qa(r):Me=a}function _p(r){var a=r,c=a.alternate;switch(a.tag){case 15:case 0:a=Gm(c,a,a.pendingProps,a.type,void 0,Pe);break;case 11:a=Gm(c,a,a.pendingProps,a.type.render,a.ref,Pe);break;case 5:Ec(a);default:Xm(c,a),a=Me=Sg(a,mi),a=zm(c,a,mi)}r.memoizedProps=r.pendingProps,a===null?Qa(r):Me=a}function fr(r,a,c,g){ri=gs=null,Ec(a),er=null,ro=0;var E=a.return;try{if(E_(r,E,a,c,Pe)){ot=1,Fa(r,En(c,r.current)),Me=null;return}}catch(T){if(E!==null)throw Me=E,T;ot=1,Fa(r,En(c,r.current)),Me=null;return}a.flags&32768?(Ue||g===1?r=!0:ar||(Pe&536870912)!==0?r=!1:(Bi=r=!0,(g===2||g===9||g===3||g===6)&&(g=sn.current,g!==null&&g.tag===13&&(g.flags|=16384))),xp(a,r)):Qa(a)}function Qa(r){var a=r;do{if((a.flags&32768)!==0){xp(a,Bi);return}r=a.return;var c=A_(a.alternate,a,mi);if(c!==null){Me=c;return}if(a=a.sibling,a!==null){Me=a;return}Me=a=r}while(a!==null);ot===0&&(ot=5)}function xp(r,a){do{var c=__(r.alternate,r);if(c!==null){c.flags&=32767,Me=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(r=r.sibling,r!==null)){Me=r;return}Me=r=c}while(r!==null);ot=6,Me=null}function Rp(r,a,c,g,E,T,R,D,k){r.cancelPendingCommit=null;do Za();while(pt!==0);if((Ve&6)!==0)throw Error(n(327));if(a!==null){if(a===r.current)throw Error(n(177));if(T=a.lanes|a.childLanes,T|=zu,cA(r,c,T,R,D,k),r===Qe&&(Me=Qe=null,Pe=0),ur=a,Vi=r,pi=c,ef=T,tf=E,gp=g,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,k_(ws,function(){return Dp(),null})):(r.callbackNode=null,r.callbackPriority=0),g=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||g){g=F.T,F.T=null,E=Q.p,Q.p=2,R=Ve,Ve|=4;try{x_(r,a,c)}finally{Ve=R,Q.p=E,F.T=g}}pt=1,Ip(),Cp(),Lp()}}function Ip(){if(pt===1){pt=0;var r=Vi,a=ur,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=F.T,F.T=null;var g=Q.p;Q.p=2;var E=Ve;Ve|=4;try{op(a,r);var T=yf,R=dg(r.containerInfo),D=T.focusedElem,k=T.selectionRange;if(R!==D&&D&&D.ownerDocument&&fg(D.ownerDocument.documentElement,D)){if(k!==null&&$u(D)){var Y=k.start,j=k.end;if(j===void 0&&(j=Y),"selectionStart"in D)D.selectionStart=Y,D.selectionEnd=Math.min(j,D.value.length);else{var ie=D.ownerDocument||document,X=ie&&ie.defaultView||window;if(X.getSelection){var Z=X.getSelection(),ye=D.textContent.length,Se=Math.min(k.start,ye),Je=k.end===void 0?Se:Math.min(k.end,ye);!Z.extend&&Se>Je&&(R=Je,Je=Se,Se=R);var H=cg(D,Se),B=cg(D,Je);if(H&&B&&(Z.rangeCount!==1||Z.anchorNode!==H.node||Z.anchorOffset!==H.offset||Z.focusNode!==B.node||Z.focusOffset!==B.offset)){var z=ie.createRange();z.setStart(H.node,H.offset),Z.removeAllRanges(),Se>Je?(Z.addRange(z),Z.extend(B.node,B.offset)):(z.setEnd(B.node,B.offset),Z.addRange(z))}}}}for(ie=[],Z=D;Z=Z.parentNode;)Z.nodeType===1&&ie.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<ie.length;D++){var ne=ie[D];ne.element.scrollLeft=ne.left,ne.element.scrollTop=ne.top}}cl=!!pf,yf=pf=null}finally{Ve=E,Q.p=g,F.T=c}}r.current=a,pt=2}}function Cp(){if(pt===2){pt=0;var r=Vi,a=ur,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=F.T,F.T=null;var g=Q.p;Q.p=2;var E=Ve;Ve|=4;try{tp(r,a.alternate,a)}finally{Ve=E,Q.p=g,F.T=c}}pt=3}}function Lp(){if(pt===4||pt===3){pt=0,Zo();var r=Vi,a=ur,c=pi,g=gp;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?pt=5:(pt=0,ur=Vi=null,bp(r,r.pendingLanes));var E=r.pendingLanes;if(E===0&&($i=null),Au(c),a=a.stateNode,jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot($r,a,void 0,(a.current.flags&128)===128)}catch{}if(g!==null){a=F.T,E=Q.p,Q.p=2,F.T=null;try{for(var T=r.onRecoverableError,R=0;R<g.length;R++){var D=g[R];T(D.value,{componentStack:D.stack})}}finally{F.T=a,Q.p=E}}(pi&3)!==0&&Za(),qn(r),E=r.pendingLanes,(c&261930)!==0&&(E&42)!==0?r===nf?_o++:(_o=0,nf=r):_o=0,xo(0)}}function bp(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,io(a)))}function Za(){return Ip(),Cp(),Lp(),Dp()}function Dp(){if(pt!==5)return!1;var r=Vi,a=ef;ef=0;var c=Au(pi),g=F.T,E=Q.p;try{Q.p=32>c?32:c,F.T=null,c=tf,tf=null;var T=Vi,R=pi;if(pt=0,ur=Vi=null,pi=0,(Ve&6)!==0)throw Error(n(331));var D=Ve;if(Ve|=4,fp(T.current),lp(T,T.current,R,c),Ve=D,xo(0,!1),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot($r,T)}catch{}return!0}finally{Q.p=E,F.T=g,bp(r,a)}}function Mp(r,a,c){a=En(c,a),a=Pc(r.stateNode,a,2),r=ki(r,a,2),r!==null&&(Hr(r,2),qn(r))}function qe(r,a,c){if(r.tag===3)Mp(r,r,c);else for(;a!==null;){if(a.tag===3){Mp(a,r,c);break}else if(a.tag===1){var g=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&($i===null||!$i.has(g))){r=En(c,r),c=wm(2),g=ki(a,c,2),g!==null&&(Nm(c,g,a,r),Hr(g,2),qn(g));break}}a=a.return}}function of(r,a,c){var g=r.pingCache;if(g===null){g=r.pingCache=new C_;var E=new Set;g.set(a,E)}else E=g.get(a),E===void 0&&(E=new Set,g.set(a,E));E.has(c)||(Qc=!0,E.add(c),r=w_.bind(null,r,a,c),a.then(r,r))}function w_(r,a,c){var g=r.pingCache;g!==null&&g.delete(a),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Qe===r&&(Pe&c)===c&&(ot===4||ot===3&&(Pe&62914560)===Pe&&300>St()-za?(Ve&2)===0&&cr(r,0):Zc|=c,lr===Pe&&(lr=0)),qn(r)}function wp(r,a){a===0&&(a=Ih()),r=fs(r,a),r!==null&&(Hr(r,a),qn(r))}function N_(r){var a=r.memoizedState,c=0;a!==null&&(c=a.retryLane),wp(r,c)}function P_(r,a){var c=0;switch(r.tag){case 31:case 13:var g=r.stateNode,E=r.memoizedState;E!==null&&(c=E.retryLane);break;case 19:g=r.stateNode;break;case 22:g=r.stateNode._retryCache;break;default:throw Error(n(314))}g!==null&&g.delete(a),wp(r,c)}function k_(r,a){return Bt(r,a)}var ja=null,dr=null,af=!1,el=!1,lf=!1,qi=0;function qn(r){r!==dr&&r.next===null&&(dr===null?ja=dr=r:dr=dr.next=r),el=!0,af||(af=!0,O_())}function xo(r,a){if(!lf&&el){lf=!0;do for(var c=!1,g=ja;g!==null;){if(r!==0){var E=g.pendingLanes;if(E===0)var T=0;else{var R=g.suspendedLanes,D=g.pingedLanes;T=(1<<31-en(42|r)+1)-1,T&=E&~(R&~D),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(c=!0,Up(g,T))}else T=Pe,T=sa(g,g===Qe?T:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(T&3)===0||Vr(g,T)||(c=!0,Up(g,T));g=g.next}while(c);lf=!1}}function U_(){Np()}function Np(){el=af=!1;var r=0;qi!==0&&Y_()&&(r=qi);for(var a=St(),c=null,g=ja;g!==null;){var E=g.next,T=Pp(g,a);T===0?(g.next=null,c===null?ja=E:c.next=E,E===null&&(dr=c)):(c=g,(r!==0||(T&3)!==0)&&(el=!0)),g=E}pt!==0&&pt!==5||xo(r),qi!==0&&(qi=0)}function Pp(r,a){for(var c=r.suspendedLanes,g=r.pingedLanes,E=r.expirationTimes,T=r.pendingLanes&-62914561;0<T;){var R=31-en(T),D=1<<R,k=E[R];k===-1?((D&c)===0||(D&g)!==0)&&(E[R]=uA(D,a)):k<=a&&(r.expiredLanes|=D),T&=~D}if(a=Qe,c=Pe,c=sa(r,r===a?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g=r.callbackNode,c===0||r===a&&(He===2||He===9)||r.cancelPendingCommit!==null)return g!==null&&g!==null&&Gn(g),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Vr(r,c)){if(a=c&-c,a===r.callbackPriority)return a;switch(g!==null&&Gn(g),Au(c)){case 2:case 8:c=Br;break;case 32:c=ws;break;case 268435456:c=Gr;break;default:c=ws}return g=kp.bind(null,r),c=Bt(c,g),r.callbackPriority=a,r.callbackNode=c,a}return g!==null&&g!==null&&Gn(g),r.callbackPriority=2,r.callbackNode=null,2}function kp(r,a){if(pt!==0&&pt!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Za()&&r.callbackNode!==c)return null;var g=Pe;return g=sa(r,r===Qe?g:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g===0?null:(pp(r,g,a),Pp(r,St()),r.callbackNode!=null&&r.callbackNode===c?kp.bind(null,r):null)}function Up(r,a){if(Za())return null;pp(r,a,!0)}function O_(){J_(function(){(Ve&6)!==0?Bt(Ri,U_):Np()})}function uf(){if(qi===0){var r=Qs;r===0&&(r=ta,ta<<=1,(ta&261888)===0&&(ta=256)),qi=r}return qi}function Op(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:la(""+r)}function Fp(r,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,r.id&&c.setAttribute("form",r.id),a.parentNode.insertBefore(c,a),r=new FormData(r),c.parentNode.removeChild(c),r}function F_(r,a,c,g,E){if(a==="submit"&&c&&c.stateNode===E){var T=Op((E[qt]||null).action),R=g.submitter;R&&(a=(a=R[qt]||null)?Op(a.formAction):R.getAttribute("formAction"),a!==null&&(T=a,R=null));var D=new da("action","action",null,g,E);r.push({event:D,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(qi!==0){var k=R?Fp(E,R):new FormData(E);Lc(c,{pending:!0,data:k,method:E.method,action:T},null,k)}}else typeof T=="function"&&(D.preventDefault(),k=R?Fp(E,R):new FormData(E),Lc(c,{pending:!0,data:k,method:E.method,action:T},T,k))},currentTarget:E}]})}}for(var cf=0;cf<Ku.length;cf++){var ff=Ku[cf],B_=ff.toLowerCase(),G_=ff[0].toUpperCase()+ff.slice(1);wn(B_,"on"+G_)}wn(mg,"onAnimationEnd"),wn(pg,"onAnimationIteration"),wn(yg,"onAnimationStart"),wn("dblclick","onDoubleClick"),wn("focusin","onFocus"),wn("focusout","onBlur"),wn(n_,"onTransitionRun"),wn(i_,"onTransitionStart"),wn(s_,"onTransitionCancel"),wn(vg,"onTransitionEnd"),Os("onMouseEnter",["mouseout","mouseover"]),Os("onMouseLeave",["mouseout","mouseover"]),Os("onPointerEnter",["pointerout","pointerover"]),Os("onPointerLeave",["pointerout","pointerover"]),as("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),as("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),as("onBeforeInput",["compositionend","keypress","textInput","paste"]),as("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ro="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ro));function Bp(r,a){a=(a&4)!==0;for(var c=0;c<r.length;c++){var g=r[c],E=g.event;g=g.listeners;e:{var T=void 0;if(a)for(var R=g.length-1;0<=R;R--){var D=g[R],k=D.instance,Y=D.currentTarget;if(D=D.listener,k!==T&&E.isPropagationStopped())break e;T=D,E.currentTarget=Y;try{T(E)}catch(j){ma(j)}E.currentTarget=null,T=k}else for(R=0;R<g.length;R++){if(D=g[R],k=D.instance,Y=D.currentTarget,D=D.listener,k!==T&&E.isPropagationStopped())break e;T=D,E.currentTarget=Y;try{T(E)}catch(j){ma(j)}E.currentTarget=null,T=k}}}}function we(r,a){var c=a[_u];c===void 0&&(c=a[_u]=new Set);var g=r+"__bubble";c.has(g)||(Gp(a,r,2,!1),c.add(g))}function df(r,a,c){var g=0;a&&(g|=4),Gp(c,r,g,a)}var tl="_reactListening"+Math.random().toString(36).slice(2);function hf(r){if(!r[tl]){r[tl]=!0,Nh.forEach(function(c){c!=="selectionchange"&&($_.has(c)||df(c,!1,r),df(c,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[tl]||(a[tl]=!0,df("selectionchange",!1,a))}}function Gp(r,a,c,g){switch(m0(a)){case 2:var E=mx;break;case 8:E=px;break;default:E=Lf}c=E.bind(null,a,c,r),E=void 0,!wu||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(E=!0),g?E!==void 0?r.addEventListener(a,c,{capture:!0,passive:E}):r.addEventListener(a,c,!0):E!==void 0?r.addEventListener(a,c,{passive:E}):r.addEventListener(a,c,!1)}function gf(r,a,c,g,E){var T=g;if((a&1)===0&&(a&2)===0&&g!==null)e:for(;;){if(g===null)return;var R=g.tag;if(R===3||R===4){var D=g.stateNode.containerInfo;if(D===E)break;if(R===4)for(R=g.return;R!==null;){var k=R.tag;if((k===3||k===4)&&R.stateNode.containerInfo===E)return;R=R.return}for(;D!==null;){if(R=Ps(D),R===null)return;if(k=R.tag,k===5||k===6||k===26||k===27){g=T=R;continue e}D=D.parentNode}}g=g.return}Kh(function(){var Y=T,j=Du(c),ie=[];e:{var X=Eg.get(r);if(X!==void 0){var Z=da,ye=r;switch(r){case"keypress":if(ca(c)===0)break e;case"keydown":case"keyup":Z=PA;break;case"focusin":ye="focus",Z=Uu;break;case"focusout":ye="blur",Z=Uu;break;case"beforeblur":case"afterblur":Z=Uu;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Xh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=AA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=OA;break;case mg:case pg:case yg:Z=RA;break;case vg:Z=BA;break;case"scroll":case"scrollend":Z=TA;break;case"wheel":Z=$A;break;case"copy":case"cut":case"paste":Z=CA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Wh;break;case"toggle":case"beforetoggle":Z=HA}var Se=(a&4)!==0,Je=!Se&&(r==="scroll"||r==="scrollend"),H=Se?X!==null?X+"Capture":null:X;Se=[];for(var B=Y,z;B!==null;){var ne=B;if(z=ne.stateNode,ne=ne.tag,ne!==5&&ne!==26&&ne!==27||z===null||H===null||(ne=zr(B,H),ne!=null&&Se.push(Io(B,ne,z))),Je)break;B=B.return}0<Se.length&&(X=new Z(X,ye,null,c,j),ie.push({event:X,listeners:Se}))}}if((a&7)===0){e:{if(X=r==="mouseover"||r==="pointerover",Z=r==="mouseout"||r==="pointerout",X&&c!==bu&&(ye=c.relatedTarget||c.fromElement)&&(Ps(ye)||ye[Ns]))break e;if((Z||X)&&(X=j.window===j?j:(X=j.ownerDocument)?X.defaultView||X.parentWindow:window,Z?(ye=c.relatedTarget||c.toElement,Z=Y,ye=ye?Ps(ye):null,ye!==null&&(Je=o(ye),Se=ye.tag,ye!==Je||Se!==5&&Se!==27&&Se!==6)&&(ye=null)):(Z=null,ye=Y),Z!==ye)){if(Se=Xh,ne="onMouseLeave",H="onMouseEnter",B="mouse",(r==="pointerout"||r==="pointerover")&&(Se=Wh,ne="onPointerLeave",H="onPointerEnter",B="pointer"),Je=Z==null?X:Kr(Z),z=ye==null?X:Kr(ye),X=new Se(ne,B+"leave",Z,c,j),X.target=Je,X.relatedTarget=z,ne=null,Ps(j)===Y&&(Se=new Se(H,B+"enter",ye,c,j),Se.target=z,Se.relatedTarget=Je,ne=Se),Je=ne,Z&&ye)t:{for(Se=V_,H=Z,B=ye,z=0,ne=H;ne;ne=Se(ne))z++;ne=0;for(var Te=B;Te;Te=Se(Te))ne++;for(;0<z-ne;)H=Se(H),z--;for(;0<ne-z;)B=Se(B),ne--;for(;z--;){if(H===B||B!==null&&H===B.alternate){Se=H;break t}H=Se(H),B=Se(B)}Se=null}else Se=null;Z!==null&&$p(ie,X,Z,Se,!1),ye!==null&&Je!==null&&$p(ie,Je,ye,Se,!0)}}e:{if(X=Y?Kr(Y):window,Z=X.nodeName&&X.nodeName.toLowerCase(),Z==="select"||Z==="input"&&X.type==="file")var Be=sg;else if(ng(X))if(rg)Be=jA;else{Be=QA;var ve=WA}else Z=X.nodeName,!Z||Z.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?Y&&Lu(Y.elementType)&&(Be=sg):Be=ZA;if(Be&&(Be=Be(r,Y))){ig(ie,Be,c,j);break e}ve&&ve(r,X,Y),r==="focusout"&&Y&&X.type==="number"&&Y.memoizedProps.value!=null&&Cu(X,"number",X.value)}switch(ve=Y?Kr(Y):window,r){case"focusin":(ng(ve)||ve.contentEditable==="true")&&(Hs=ve,Vu=Y,eo=null);break;case"focusout":eo=Vu=Hs=null;break;case"mousedown":Hu=!0;break;case"contextmenu":case"mouseup":case"dragend":Hu=!1,hg(ie,c,j);break;case"selectionchange":if(t_)break;case"keydown":case"keyup":hg(ie,c,j)}var Le;if(Fu)e:{switch(r){case"compositionstart":var ke="onCompositionStart";break e;case"compositionend":ke="onCompositionEnd";break e;case"compositionupdate":ke="onCompositionUpdate";break e}ke=void 0}else Vs?eg(r,c)&&(ke="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(ke="onCompositionStart");ke&&(Qh&&c.locale!=="ko"&&(Vs||ke!=="onCompositionStart"?ke==="onCompositionEnd"&&Vs&&(Le=zh()):(Li=j,Nu="value"in Li?Li.value:Li.textContent,Vs=!0)),ve=nl(Y,ke),0<ve.length&&(ke=new Jh(ke,r,null,c,j),ie.push({event:ke,listeners:ve}),Le?ke.data=Le:(Le=tg(c),Le!==null&&(ke.data=Le)))),(Le=KA?zA(r,c):YA(r,c))&&(ke=nl(Y,"onBeforeInput"),0<ke.length&&(ve=new Jh("onBeforeInput","beforeinput",null,c,j),ie.push({event:ve,listeners:ke}),ve.data=Le)),F_(ie,r,Y,c,j)}Bp(ie,a)})}function Io(r,a,c){return{instance:r,listener:a,currentTarget:c}}function nl(r,a){for(var c=a+"Capture",g=[];r!==null;){var E=r,T=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||T===null||(E=zr(r,c),E!=null&&g.unshift(Io(r,E,T)),E=zr(r,a),E!=null&&g.push(Io(r,E,T))),r.tag===3)return g;r=r.return}return[]}function V_(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function $p(r,a,c,g,E){for(var T=a._reactName,R=[];c!==null&&c!==g;){var D=c,k=D.alternate,Y=D.stateNode;if(D=D.tag,k!==null&&k===g)break;D!==5&&D!==26&&D!==27||Y===null||(k=Y,E?(Y=zr(c,T),Y!=null&&R.unshift(Io(c,Y,k))):E||(Y=zr(c,T),Y!=null&&R.push(Io(c,Y,k)))),c=c.return}R.length!==0&&r.push({event:a,listeners:R})}var H_=/\r\n?/g,q_=/\u0000|\uFFFD/g;function Vp(r){return(typeof r=="string"?r:""+r).replace(H_,`
`).replace(q_,"")}function Hp(r,a){return a=Vp(a),Vp(r)===a}function Xe(r,a,c,g,E,T){switch(c){case"children":typeof g=="string"?a==="body"||a==="textarea"&&g===""||Bs(r,g):(typeof g=="number"||typeof g=="bigint")&&a!=="body"&&Bs(r,""+g);break;case"className":oa(r,"class",g);break;case"tabIndex":oa(r,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":oa(r,c,g);break;case"style":Hh(r,g,T);break;case"data":if(a!=="object"){oa(r,"data",g);break}case"src":case"href":if(g===""&&(a!=="a"||c!=="href")){r.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=la(""+g),r.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(c==="formAction"?(a!=="input"&&Xe(r,a,"name",E.name,E,null),Xe(r,a,"formEncType",E.formEncType,E,null),Xe(r,a,"formMethod",E.formMethod,E,null),Xe(r,a,"formTarget",E.formTarget,E,null)):(Xe(r,a,"encType",E.encType,E,null),Xe(r,a,"method",E.method,E,null),Xe(r,a,"target",E.target,E,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=la(""+g),r.setAttribute(c,g);break;case"onClick":g!=null&&(r.onclick=ti);break;case"onScroll":g!=null&&we("scroll",r);break;case"onScrollEnd":g!=null&&we("scrollend",r);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(c=g.__html,c!=null){if(E.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"multiple":r.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":r.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){r.removeAttribute("xlink:href");break}c=la(""+g),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""+g):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":g===!0?r.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,g):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?r.setAttribute(c,g):r.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?r.removeAttribute(c):r.setAttribute(c,g);break;case"popover":we("beforetoggle",r),we("toggle",r),ra(r,"popover",g);break;case"xlinkActuate":ei(r,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":ei(r,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":ei(r,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":ei(r,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":ei(r,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":ei(r,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":ei(r,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":ei(r,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":ei(r,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":ra(r,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=vA.get(c)||c,ra(r,c,g))}}function mf(r,a,c,g,E,T){switch(c){case"style":Hh(r,g,T);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(c=g.__html,c!=null){if(E.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"children":typeof g=="string"?Bs(r,g):(typeof g=="number"||typeof g=="bigint")&&Bs(r,""+g);break;case"onScroll":g!=null&&we("scroll",r);break;case"onScrollEnd":g!=null&&we("scrollend",r);break;case"onClick":g!=null&&(r.onclick=ti);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ph.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(E=c.endsWith("Capture"),a=c.slice(2,E?c.length-7:void 0),T=r[qt]||null,T=T!=null?T[c]:null,typeof T=="function"&&r.removeEventListener(a,T,E),typeof g=="function")){typeof T!="function"&&T!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(a,g,E);break e}c in r?r[c]=g:g===!0?r.setAttribute(c,""):ra(r,c,g)}}}function Dt(r,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":we("error",r),we("load",r);var g=!1,E=!1,T;for(T in c)if(c.hasOwnProperty(T)){var R=c[T];if(R!=null)switch(T){case"src":g=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:Xe(r,a,T,R,c,null)}}E&&Xe(r,a,"srcSet",c.srcSet,c,null),g&&Xe(r,a,"src",c.src,c,null);return;case"input":we("invalid",r);var D=T=R=E=null,k=null,Y=null;for(g in c)if(c.hasOwnProperty(g)){var j=c[g];if(j!=null)switch(g){case"name":E=j;break;case"type":R=j;break;case"checked":k=j;break;case"defaultChecked":Y=j;break;case"value":T=j;break;case"defaultValue":D=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(n(137,a));break;default:Xe(r,a,g,j,c,null)}}Bh(r,T,D,k,Y,R,E,!1);return;case"select":we("invalid",r),g=R=T=null;for(E in c)if(c.hasOwnProperty(E)&&(D=c[E],D!=null))switch(E){case"value":T=D;break;case"defaultValue":R=D;break;case"multiple":g=D;default:Xe(r,a,E,D,c,null)}a=T,c=R,r.multiple=!!g,a!=null?Fs(r,!!g,a,!1):c!=null&&Fs(r,!!g,c,!0);return;case"textarea":we("invalid",r),T=E=g=null;for(R in c)if(c.hasOwnProperty(R)&&(D=c[R],D!=null))switch(R){case"value":g=D;break;case"defaultValue":E=D;break;case"children":T=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(n(91));break;default:Xe(r,a,R,D,c,null)}$h(r,g,E,T);return;case"option":for(k in c)if(c.hasOwnProperty(k)&&(g=c[k],g!=null))switch(k){case"selected":r.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Xe(r,a,k,g,c,null)}return;case"dialog":we("beforetoggle",r),we("toggle",r),we("cancel",r),we("close",r);break;case"iframe":case"object":we("load",r);break;case"video":case"audio":for(g=0;g<Ro.length;g++)we(Ro[g],r);break;case"image":we("error",r),we("load",r);break;case"details":we("toggle",r);break;case"embed":case"source":case"link":we("error",r),we("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in c)if(c.hasOwnProperty(Y)&&(g=c[Y],g!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:Xe(r,a,Y,g,c,null)}return;default:if(Lu(a)){for(j in c)c.hasOwnProperty(j)&&(g=c[j],g!==void 0&&mf(r,a,j,g,c,void 0));return}}for(D in c)c.hasOwnProperty(D)&&(g=c[D],g!=null&&Xe(r,a,D,g,c,null))}function K_(r,a,c,g){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,T=null,R=null,D=null,k=null,Y=null,j=null;for(Z in c){var ie=c[Z];if(c.hasOwnProperty(Z)&&ie!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":k=ie;default:g.hasOwnProperty(Z)||Xe(r,a,Z,null,g,ie)}}for(var X in g){var Z=g[X];if(ie=c[X],g.hasOwnProperty(X)&&(Z!=null||ie!=null))switch(X){case"type":T=Z;break;case"name":E=Z;break;case"checked":Y=Z;break;case"defaultChecked":j=Z;break;case"value":R=Z;break;case"defaultValue":D=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(n(137,a));break;default:Z!==ie&&Xe(r,a,X,Z,g,ie)}}Iu(r,R,D,k,Y,j,T,E);return;case"select":Z=R=D=X=null;for(T in c)if(k=c[T],c.hasOwnProperty(T)&&k!=null)switch(T){case"value":break;case"multiple":Z=k;default:g.hasOwnProperty(T)||Xe(r,a,T,null,g,k)}for(E in g)if(T=g[E],k=c[E],g.hasOwnProperty(E)&&(T!=null||k!=null))switch(E){case"value":X=T;break;case"defaultValue":D=T;break;case"multiple":R=T;default:T!==k&&Xe(r,a,E,T,g,k)}a=D,c=R,g=Z,X!=null?Fs(r,!!c,X,!1):!!g!=!!c&&(a!=null?Fs(r,!!c,a,!0):Fs(r,!!c,c?[]:"",!1));return;case"textarea":Z=X=null;for(D in c)if(E=c[D],c.hasOwnProperty(D)&&E!=null&&!g.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:Xe(r,a,D,null,g,E)}for(R in g)if(E=g[R],T=c[R],g.hasOwnProperty(R)&&(E!=null||T!=null))switch(R){case"value":X=E;break;case"defaultValue":Z=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:E!==T&&Xe(r,a,R,E,g,T)}Gh(r,X,Z);return;case"option":for(var ye in c)if(X=c[ye],c.hasOwnProperty(ye)&&X!=null&&!g.hasOwnProperty(ye))switch(ye){case"selected":r.selected=!1;break;default:Xe(r,a,ye,null,g,X)}for(k in g)if(X=g[k],Z=c[k],g.hasOwnProperty(k)&&X!==Z&&(X!=null||Z!=null))switch(k){case"selected":r.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:Xe(r,a,k,X,g,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Se in c)X=c[Se],c.hasOwnProperty(Se)&&X!=null&&!g.hasOwnProperty(Se)&&Xe(r,a,Se,null,g,X);for(Y in g)if(X=g[Y],Z=c[Y],g.hasOwnProperty(Y)&&X!==Z&&(X!=null||Z!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(n(137,a));break;default:Xe(r,a,Y,X,g,Z)}return;default:if(Lu(a)){for(var Je in c)X=c[Je],c.hasOwnProperty(Je)&&X!==void 0&&!g.hasOwnProperty(Je)&&mf(r,a,Je,void 0,g,X);for(j in g)X=g[j],Z=c[j],!g.hasOwnProperty(j)||X===Z||X===void 0&&Z===void 0||mf(r,a,j,X,g,Z);return}}for(var H in c)X=c[H],c.hasOwnProperty(H)&&X!=null&&!g.hasOwnProperty(H)&&Xe(r,a,H,null,g,X);for(ie in g)X=g[ie],Z=c[ie],!g.hasOwnProperty(ie)||X===Z||X==null&&Z==null||Xe(r,a,ie,X,g,Z)}function qp(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function z_(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var E=c[g],T=E.transferSize,R=E.initiatorType,D=E.duration;if(T&&D&&qp(R)){for(R=0,D=E.responseEnd,g+=1;g<c.length;g++){var k=c[g],Y=k.startTime;if(Y>D)break;var j=k.transferSize,ie=k.initiatorType;j&&qp(ie)&&(k=k.responseEnd,R+=j*(k<D?1:(D-Y)/(k-Y)))}if(--g,a+=8*(T+R)/(E.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var pf=null,yf=null;function il(r){return r.nodeType===9?r:r.ownerDocument}function Kp(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function zp(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function vf(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ef=null;function Y_(){var r=window.event;return r&&r.type==="popstate"?r===Ef?!1:(Ef=r,!0):(Ef=null,!1)}var Yp=typeof setTimeout=="function"?setTimeout:void 0,X_=typeof clearTimeout=="function"?clearTimeout:void 0,Xp=typeof Promise=="function"?Promise:void 0,J_=typeof queueMicrotask=="function"?queueMicrotask:typeof Xp<"u"?function(r){return Xp.resolve(null).then(r).catch(W_)}:Yp;function W_(r){setTimeout(function(){throw r})}function Ki(r){return r==="head"}function Jp(r,a){var c=a,g=0;do{var E=c.nextSibling;if(r.removeChild(c),E&&E.nodeType===8)if(c=E.data,c==="/$"||c==="/&"){if(g===0){r.removeChild(E),pr(a);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")Co(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,Co(c);for(var T=c.firstChild;T;){var R=T.nextSibling,D=T.nodeName;T[qr]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&T.rel.toLowerCase()==="stylesheet"||c.removeChild(T),T=R}}else c==="body"&&Co(r.ownerDocument.body);c=E}while(c);pr(a)}function Wp(r,a){var c=r;r=0;do{var g=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=g}while(c)}function Tf(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Tf(c),xu(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function Q_(r,a,c,g){for(;r.nodeType===1;){var E=c;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!g&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(g){if(!r[qr])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(T=r.getAttribute("rel"),T==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(T!==E.rel||r.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||r.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||r.getAttribute("title")!==(E.title==null?null:E.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(T=r.getAttribute("src"),(T!==(E.src==null?null:E.src)||r.getAttribute("type")!==(E.type==null?null:E.type)||r.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&T&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var T=E.name==null?null:""+E.name;if(E.type==="hidden"&&r.getAttribute("name")===T)return r}else return r;if(r=xn(r.nextSibling),r===null)break}return null}function Z_(r,a,c){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=xn(r.nextSibling),r===null))return null;return r}function Qp(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=xn(r.nextSibling),r===null))return null;return r}function Sf(r){return r.data==="$?"||r.data==="$~"}function Af(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function j_(r,a){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||c.readyState!=="loading")a();else{var g=function(){a(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),r._reactRetry=g}}function xn(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var _f=null;function Zp(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(a===0)return xn(r.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}r=r.nextSibling}return null}function jp(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return r;a--}else c!=="/$"&&c!=="/&"||a++}r=r.previousSibling}return null}function e0(r,a,c){switch(a=il(c),r){case"html":if(r=a.documentElement,!r)throw Error(n(452));return r;case"head":if(r=a.head,!r)throw Error(n(453));return r;case"body":if(r=a.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function Co(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);xu(r)}var Rn=new Map,t0=new Set;function sl(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var yi=Q.d;Q.d={f:ex,r:tx,D:nx,C:ix,L:sx,m:rx,X:ax,S:ox,M:lx};function ex(){var r=yi.f(),a=Ja();return r||a}function tx(r){var a=ks(r);a!==null&&a.tag===5&&a.type==="form"?vm(a):yi.r(r)}var hr=typeof document>"u"?null:document;function n0(r,a,c){var g=hr;if(g&&typeof a=="string"&&a){var E=yn(a);E='link[rel="'+r+'"][href="'+E+'"]',typeof c=="string"&&(E+='[crossorigin="'+c+'"]'),t0.has(E)||(t0.add(E),r={rel:r,crossOrigin:c,href:a},g.querySelector(E)===null&&(a=g.createElement("link"),Dt(a,"link",r),At(a),g.head.appendChild(a)))}}function nx(r){yi.D(r),n0("dns-prefetch",r,null)}function ix(r,a){yi.C(r,a),n0("preconnect",r,a)}function sx(r,a,c){yi.L(r,a,c);var g=hr;if(g&&r&&a){var E='link[rel="preload"][as="'+yn(a)+'"]';a==="image"&&c&&c.imageSrcSet?(E+='[imagesrcset="'+yn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(E+='[imagesizes="'+yn(c.imageSizes)+'"]')):E+='[href="'+yn(r)+'"]';var T=E;switch(a){case"style":T=gr(r);break;case"script":T=mr(r)}Rn.has(T)||(r=m({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:r,as:a},c),Rn.set(T,r),g.querySelector(E)!==null||a==="style"&&g.querySelector(Lo(T))||a==="script"&&g.querySelector(bo(T))||(a=g.createElement("link"),Dt(a,"link",r),At(a),g.head.appendChild(a)))}}function rx(r,a){yi.m(r,a);var c=hr;if(c&&r){var g=a&&typeof a.as=="string"?a.as:"script",E='link[rel="modulepreload"][as="'+yn(g)+'"][href="'+yn(r)+'"]',T=E;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=mr(r)}if(!Rn.has(T)&&(r=m({rel:"modulepreload",href:r},a),Rn.set(T,r),c.querySelector(E)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(bo(T)))return}g=c.createElement("link"),Dt(g,"link",r),At(g),c.head.appendChild(g)}}}function ox(r,a,c){yi.S(r,a,c);var g=hr;if(g&&r){var E=Us(g).hoistableStyles,T=gr(r);a=a||"default";var R=E.get(T);if(!R){var D={loading:0,preload:null};if(R=g.querySelector(Lo(T)))D.loading=5;else{r=m({rel:"stylesheet",href:r,"data-precedence":a},c),(c=Rn.get(T))&&xf(r,c);var k=R=g.createElement("link");At(k),Dt(k,"link",r),k._p=new Promise(function(Y,j){k.onload=Y,k.onerror=j}),k.addEventListener("load",function(){D.loading|=1}),k.addEventListener("error",function(){D.loading|=2}),D.loading|=4,rl(R,a,g)}R={type:"stylesheet",instance:R,count:1,state:D},E.set(T,R)}}}function ax(r,a){yi.X(r,a);var c=hr;if(c&&r){var g=Us(c).hoistableScripts,E=mr(r),T=g.get(E);T||(T=c.querySelector(bo(E)),T||(r=m({src:r,async:!0},a),(a=Rn.get(E))&&Rf(r,a),T=c.createElement("script"),At(T),Dt(T,"link",r),c.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},g.set(E,T))}}function lx(r,a){yi.M(r,a);var c=hr;if(c&&r){var g=Us(c).hoistableScripts,E=mr(r),T=g.get(E);T||(T=c.querySelector(bo(E)),T||(r=m({src:r,async:!0,type:"module"},a),(a=Rn.get(E))&&Rf(r,a),T=c.createElement("script"),At(T),Dt(T,"link",r),c.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},g.set(E,T))}}function i0(r,a,c,g){var E=(E=ge.current)?sl(E):null;if(!E)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=gr(c.href),c=Us(E).hoistableStyles,g=c.get(a),g||(g={type:"style",instance:null,count:0,state:null},c.set(a,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=gr(c.href);var T=Us(E).hoistableStyles,R=T.get(r);if(R||(E=E.ownerDocument||E,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(r,R),(T=E.querySelector(Lo(r)))&&!T._p&&(R.instance=T,R.state.loading=5),Rn.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Rn.set(r,c),T||ux(E,r,c,R.state))),a&&g===null)throw Error(n(528,""));return R}if(a&&g!==null)throw Error(n(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=mr(c),c=Us(E).hoistableScripts,g=c.get(a),g||(g={type:"script",instance:null,count:0,state:null},c.set(a,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function gr(r){return'href="'+yn(r)+'"'}function Lo(r){return'link[rel="stylesheet"]['+r+"]"}function s0(r){return m({},r,{"data-precedence":r.precedence,precedence:null})}function ux(r,a,c,g){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?g.loading=1:(a=r.createElement("link"),g.preload=a,a.addEventListener("load",function(){return g.loading|=1}),a.addEventListener("error",function(){return g.loading|=2}),Dt(a,"link",c),At(a),r.head.appendChild(a))}function mr(r){return'[src="'+yn(r)+'"]'}function bo(r){return"script[async]"+r}function r0(r,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var g=r.querySelector('style[data-href~="'+yn(c.href)+'"]');if(g)return a.instance=g,At(g),g;var E=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(r.ownerDocument||r).createElement("style"),At(g),Dt(g,"style",E),rl(g,c.precedence,r),a.instance=g;case"stylesheet":E=gr(c.href);var T=r.querySelector(Lo(E));if(T)return a.state.loading|=4,a.instance=T,At(T),T;g=s0(c),(E=Rn.get(E))&&xf(g,E),T=(r.ownerDocument||r).createElement("link"),At(T);var R=T;return R._p=new Promise(function(D,k){R.onload=D,R.onerror=k}),Dt(T,"link",g),a.state.loading|=4,rl(T,c.precedence,r),a.instance=T;case"script":return T=mr(c.src),(E=r.querySelector(bo(T)))?(a.instance=E,At(E),E):(g=c,(E=Rn.get(T))&&(g=m({},c),Rf(g,E)),r=r.ownerDocument||r,E=r.createElement("script"),At(E),Dt(E,"link",g),r.head.appendChild(E),a.instance=E);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(g=a.instance,a.state.loading|=4,rl(g,c.precedence,r));return a.instance}function rl(r,a,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=g.length?g[g.length-1]:null,T=E,R=0;R<g.length;R++){var D=g[R];if(D.dataset.precedence===a)T=D;else if(T!==E)break}T?T.parentNode.insertBefore(r,T.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(r,a.firstChild))}function xf(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Rf(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var ol=null;function o0(r,a,c){if(ol===null){var g=new Map,E=ol=new Map;E.set(c,g)}else E=ol,g=E.get(c),g||(g=new Map,E.set(c,g));if(g.has(r))return g;for(g.set(r,null),c=c.getElementsByTagName(r),E=0;E<c.length;E++){var T=c[E];if(!(T[qr]||T[It]||r==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var R=T.getAttribute(a)||"";R=r+R;var D=g.get(R);D?D.push(T):g.set(R,[T])}}return g}function a0(r,a,c){r=r.ownerDocument||r,r.head.insertBefore(c,a==="title"?r.querySelector("head > title"):null)}function cx(r,a,c){if(c===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function l0(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function fx(r,a,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var E=gr(g.href),T=a.querySelector(Lo(E));if(T){a=T._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=al.bind(r),a.then(r,r)),c.state.loading|=4,c.instance=T,At(T);return}T=a.ownerDocument||a,g=s0(g),(E=Rn.get(E))&&xf(g,E),T=T.createElement("link"),At(T);var R=T;R._p=new Promise(function(D,k){R.onload=D,R.onerror=k}),Dt(T,"link",g),c.instance=T}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=al.bind(r),a.addEventListener("load",c),a.addEventListener("error",c))}}var If=0;function dx(r,a){return r.stylesheets&&r.count===0&&ul(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var g=setTimeout(function(){if(r.stylesheets&&ul(r,r.stylesheets),r.unsuspend){var T=r.unsuspend;r.unsuspend=null,T()}},6e4+a);0<r.imgBytes&&If===0&&(If=62500*z_());var E=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&ul(r,r.stylesheets),r.unsuspend)){var T=r.unsuspend;r.unsuspend=null,T()}},(r.imgBytes>If?50:800)+a);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(g),clearTimeout(E)}}:null}function al(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ul(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var ll=null;function ul(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,ll=new Map,a.forEach(hx,r),ll=null,al.call(r))}function hx(r,a){if(!(a.state.loading&4)){var c=ll.get(r);if(c)var g=c.get(null);else{c=new Map,ll.set(r,c);for(var E=r.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<E.length;T++){var R=E[T];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(c.set(R.dataset.precedence,R),g=R)}g&&c.set(null,g)}E=a.instance,R=E.getAttribute("data-precedence"),T=c.get(R)||g,T===g&&c.set(null,E),c.set(R,E),this.count++,g=al.bind(this),E.addEventListener("load",g),E.addEventListener("error",g),T?T.parentNode.insertBefore(E,T.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(E,r.firstChild)),a.state.loading|=4}}var Do={$$typeof:L,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function gx(r,a,c,g,E,T,R,D,k){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Tu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tu(0),this.hiddenUpdates=Tu(null),this.identifierPrefix=g,this.onUncaughtError=E,this.onCaughtError=T,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=k,this.incompleteTransitions=new Map}function u0(r,a,c,g,E,T,R,D,k,Y,j,ie){return r=new gx(r,a,c,R,k,Y,j,ie,D),a=1,T===!0&&(a|=24),T=nn(3,null,null,a),r.current=T,T.stateNode=r,a=sc(),a.refCount++,r.pooledCache=a,a.refCount++,T.memoizedState={element:g,isDehydrated:c,cache:a},lc(T),r}function c0(r){return r?(r=zs,r):zs}function f0(r,a,c,g,E,T){E=c0(E),g.context===null?g.context=E:g.pendingContext=E,g=Pi(a),g.payload={element:c},T=T===void 0?null:T,T!==null&&(g.callback=T),c=ki(r,g,a),c!==null&&(Wt(c,r,a),ao(c,r,a))}function d0(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<a?c:a}}function Cf(r,a){d0(r,a),(r=r.alternate)&&d0(r,a)}function h0(r){if(r.tag===13||r.tag===31){var a=fs(r,67108864);a!==null&&Wt(a,r,67108864),Cf(r,67108864)}}function g0(r){if(r.tag===13||r.tag===31){var a=ln();a=Su(a);var c=fs(r,a);c!==null&&Wt(c,r,a),Cf(r,a)}}var cl=!0;function mx(r,a,c,g){var E=F.T;F.T=null;var T=Q.p;try{Q.p=2,Lf(r,a,c,g)}finally{Q.p=T,F.T=E}}function px(r,a,c,g){var E=F.T;F.T=null;var T=Q.p;try{Q.p=8,Lf(r,a,c,g)}finally{Q.p=T,F.T=E}}function Lf(r,a,c,g){if(cl){var E=bf(g);if(E===null)gf(r,a,g,fl,c),p0(r,g);else if(vx(E,r,a,c,g))g.stopPropagation();else if(p0(r,g),a&4&&-1<yx.indexOf(r)){for(;E!==null;){var T=ks(E);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var R=os(T.pendingLanes);if(R!==0){var D=T;for(D.pendingLanes|=2,D.entangledLanes|=2;R;){var k=1<<31-en(R);D.entanglements[1]|=k,R&=~k}qn(T),(Ve&6)===0&&(Ya=St()+500,xo(0))}}break;case 31:case 13:D=fs(T,2),D!==null&&Wt(D,T,2),Ja(),Cf(T,2)}if(T=bf(g),T===null&&gf(r,a,g,fl,c),T===E)break;E=T}E!==null&&g.stopPropagation()}else gf(r,a,g,null,c)}}function bf(r){return r=Du(r),Df(r)}var fl=null;function Df(r){if(fl=null,r=Ps(r),r!==null){var a=o(r);if(a===null)r=null;else{var c=a.tag;if(c===13){if(r=l(a),r!==null)return r;r=null}else if(c===31){if(r=u(a),r!==null)return r;r=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return fl=r,null}function m0(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(jo()){case Ri:return 2;case Br:return 8;case ws:case ea:return 32;case Gr:return 268435456;default:return 32}default:return 32}}var Mf=!1,zi=null,Yi=null,Xi=null,Mo=new Map,wo=new Map,Ji=[],yx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function p0(r,a){switch(r){case"focusin":case"focusout":zi=null;break;case"dragenter":case"dragleave":Yi=null;break;case"mouseover":case"mouseout":Xi=null;break;case"pointerover":case"pointerout":Mo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(a.pointerId)}}function No(r,a,c,g,E,T){return r===null||r.nativeEvent!==T?(r={blockedOn:a,domEventName:c,eventSystemFlags:g,nativeEvent:T,targetContainers:[E]},a!==null&&(a=ks(a),a!==null&&h0(a)),r):(r.eventSystemFlags|=g,a=r.targetContainers,E!==null&&a.indexOf(E)===-1&&a.push(E),r)}function vx(r,a,c,g,E){switch(a){case"focusin":return zi=No(zi,r,a,c,g,E),!0;case"dragenter":return Yi=No(Yi,r,a,c,g,E),!0;case"mouseover":return Xi=No(Xi,r,a,c,g,E),!0;case"pointerover":var T=E.pointerId;return Mo.set(T,No(Mo.get(T)||null,r,a,c,g,E)),!0;case"gotpointercapture":return T=E.pointerId,wo.set(T,No(wo.get(T)||null,r,a,c,g,E)),!0}return!1}function y0(r){var a=Ps(r.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){r.blockedOn=a,Mh(r.priority,function(){g0(c)});return}}else if(a===31){if(a=u(c),a!==null){r.blockedOn=a,Mh(r.priority,function(){g0(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function dl(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var c=bf(r.nativeEvent);if(c===null){c=r.nativeEvent;var g=new c.constructor(c.type,c);bu=g,c.target.dispatchEvent(g),bu=null}else return a=ks(c),a!==null&&h0(a),r.blockedOn=c,!1;a.shift()}return!0}function v0(r,a,c){dl(r)&&c.delete(a)}function Ex(){Mf=!1,zi!==null&&dl(zi)&&(zi=null),Yi!==null&&dl(Yi)&&(Yi=null),Xi!==null&&dl(Xi)&&(Xi=null),Mo.forEach(v0),wo.forEach(v0)}function hl(r,a){r.blockedOn===a&&(r.blockedOn=null,Mf||(Mf=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ex)))}var gl=null;function E0(r){gl!==r&&(gl=r,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){gl===r&&(gl=null);for(var a=0;a<r.length;a+=3){var c=r[a],g=r[a+1],E=r[a+2];if(typeof g!="function"){if(Df(g||c)===null)continue;break}var T=ks(c);T!==null&&(r.splice(a,3),a-=3,Lc(T,{pending:!0,data:E,method:c.method,action:g},g,E))}}))}function pr(r){function a(k){return hl(k,r)}zi!==null&&hl(zi,r),Yi!==null&&hl(Yi,r),Xi!==null&&hl(Xi,r),Mo.forEach(a),wo.forEach(a);for(var c=0;c<Ji.length;c++){var g=Ji[c];g.blockedOn===r&&(g.blockedOn=null)}for(;0<Ji.length&&(c=Ji[0],c.blockedOn===null);)y0(c),c.blockedOn===null&&Ji.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var E=c[g],T=c[g+1],R=E[qt]||null;if(typeof T=="function")R||E0(c);else if(R){var D=null;if(T&&T.hasAttribute("formAction")){if(E=T,R=T[qt]||null)D=R.formAction;else if(Df(E)!==null)continue}else D=R.action;typeof D=="function"?c[g+1]=D:(c.splice(g,3),g-=3),E0(c)}}}function T0(){function r(T){T.canIntercept&&T.info==="react-transition"&&T.intercept({handler:function(){return new Promise(function(R){return E=R})},focusReset:"manual",scroll:"manual"})}function a(){E!==null&&(E(),E=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var T=navigation.currentEntry;T&&T.url!=null&&navigation.navigate(T.url,{state:T.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,E=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),E!==null&&(E(),E=null)}}}function wf(r){this._internalRoot=r}ml.prototype.render=wf.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(n(409));var c=a.current,g=ln();f0(c,g,r,a,null,null)},ml.prototype.unmount=wf.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;f0(r.current,2,null,r,null,null),Ja(),a[Ns]=null}};function ml(r){this._internalRoot=r}ml.prototype.unstable_scheduleHydration=function(r){if(r){var a=Dh();r={blockedOn:null,target:r,priority:a};for(var c=0;c<Ji.length&&a!==0&&a<Ji[c].priority;c++);Ji.splice(c,0,r),c===0&&y0(r)}};var S0=e.version;if(S0!=="19.2.3")throw Error(n(527,S0,"19.2.3"));Q.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=f(a),r=r!==null?h(r):null,r=r===null?null:r.stateNode,r};var Tx={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pl.isDisabled&&pl.supportsFiber)try{$r=pl.inject(Tx),jt=pl}catch{}}return ko.createRoot=function(r,a){if(!s(r))throw Error(n(299));var c=!1,g="",E=Lm,T=bm,R=Dm;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(g=a.identifierPrefix),a.onUncaughtError!==void 0&&(E=a.onUncaughtError),a.onCaughtError!==void 0&&(T=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError)),a=u0(r,1,!1,null,null,c,g,null,E,T,R,T0),r[Ns]=a.current,hf(r),new wf(a)},ko.hydrateRoot=function(r,a,c){if(!s(r))throw Error(n(299));var g=!1,E="",T=Lm,R=bm,D=Dm,k=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(E=c.identifierPrefix),c.onUncaughtError!==void 0&&(T=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&(D=c.onRecoverableError),c.formState!==void 0&&(k=c.formState)),a=u0(r,1,!0,a,c??null,g,E,k,T,R,D,T0),a.context=c0(null),c=a.current,g=ln(),g=Su(g),E=Pi(g),E.callback=null,ki(c,E,g),c=g,a.current.lanes=c,Hr(a,c),qn(a),r[Ns]=a.current,hf(r),new ml(a)},ko.version="19.2.3",ko}var M0;function Mx(){if(M0)return kf.exports;M0=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),kf.exports=Dx(),kf.exports}var wx=Mx();const Nx=wE(wx);var Px={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let kx,Ux;function Ox(){return{geminiUrl:kx,vertexUrl:Ux}}function Fx(i,e,t,n){var s,o;if(!(i!=null&&i.baseUrl)){const l=Ox();return e?(s=l.vertexUrl)!==null&&s!==void 0?s:t:(o=l.geminiUrl)!==null&&o!==void 0?o:n}return i.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _i{}function me(i,e){const t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const o=e[s];return o!=null?String(o):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function v(i,e,t){for(let o=0;o<e.length-1;o++){const l=e[o];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in i))if(Array.isArray(t))i[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(i[u])){const d=i[u];if(Array.isArray(t))for(let f=0;f<d.length;f++){const h=d[f];v(h,e.slice(o+1),t[f])}else for(const f of d)v(f,e.slice(o+1),t)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in i||(i[u]=[{}]);const d=i[u];v(d[0],e.slice(o+1),t);return}(!i[l]||typeof i[l]!="object")&&(i[l]={}),i=i[l]}const n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function p(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;const s=e[n];if(s.endsWith("[]")){const o=s.slice(0,-2);if(o in i){const l=i[o];return Array.isArray(l)?l.map(u=>p(u,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function Bx(i,e){for(const[t,n]of Object.entries(e)){const s=t.split("."),o=n.split("."),l=new Set;let u=-1;for(let d=0;d<s.length;d++)if(s[d]==="*"){u=d;break}if(u!==-1&&o.length>u)for(let d=u;d<o.length;d++){const f=o[d];f!=="*"&&!f.endsWith("[]")&&!f.endsWith("[0]")&&l.add(f)}fd(i,s,o,0,l)}}function fd(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;const o=e[n];if(o.endsWith("[]")){const l=o.slice(0,-2),u=i;if(l in u&&Array.isArray(u[l]))for(const d of u[l])fd(d,e,t,n+1,s)}else if(o==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){const l=i,u=Object.keys(l).filter(f=>!f.startsWith("_")&&!s.has(f)),d={};for(const f of u)d[f]=l[f];for(const[f,h]of Object.entries(d)){const m=[];for(const y of t.slice(n))y==="*"?m.push(f):m.push(y);v(l,m,h)}for(const f of u)delete l[f]}}else{const l=i;o in l&&fd(l[o],e,t,n+1,s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Kd(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gx(i){const e={},t=p(i,["operationName"]);t!=null&&v(e,["operationName"],t);const n=p(i,["resourceName"]);return n!=null&&v(e,["_url","resourceName"],n),e}function $x(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response","generateVideoResponse"]);return l!=null&&v(e,["response"],Hx(l)),e}function Vx(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response"]);return l!=null&&v(e,["response"],qx(l)),e}function Hx(i){const e={},t=p(i,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>Kx(l))),v(e,["generatedVideos"],o)}const n=p(i,["raiMediaFilteredCount"]);n!=null&&v(e,["raiMediaFilteredCount"],n);const s=p(i,["raiMediaFilteredReasons"]);return s!=null&&v(e,["raiMediaFilteredReasons"],s),e}function qx(i){const e={},t=p(i,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>zx(l))),v(e,["generatedVideos"],o)}const n=p(i,["raiMediaFilteredCount"]);n!=null&&v(e,["raiMediaFilteredCount"],n);const s=p(i,["raiMediaFilteredReasons"]);return s!=null&&v(e,["raiMediaFilteredReasons"],s),e}function Kx(i){const e={},t=p(i,["video"]);return t!=null&&v(e,["video"],Zx(t)),e}function zx(i){const e={},t=p(i,["_self"]);return t!=null&&v(e,["video"],jx(t)),e}function Yx(i){const e={},t=p(i,["operationName"]);return t!=null&&v(e,["_url","operationName"],t),e}function Xx(i){const e={},t=p(i,["operationName"]);return t!=null&&v(e,["_url","operationName"],t),e}function Jx(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response"]);return l!=null&&v(e,["response"],Wx(l)),e}function Wx(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["parent"]);n!=null&&v(e,["parent"],n);const s=p(i,["documentName"]);return s!=null&&v(e,["documentName"],s),e}function NE(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response"]);return l!=null&&v(e,["response"],Qx(l)),e}function Qx(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["parent"]);n!=null&&v(e,["parent"],n);const s=p(i,["documentName"]);return s!=null&&v(e,["documentName"],s),e}function Zx(i){const e={},t=p(i,["uri"]);t!=null&&v(e,["uri"],t);const n=p(i,["encodedVideo"]);n!=null&&v(e,["videoBytes"],Kd(n));const s=p(i,["encoding"]);return s!=null&&v(e,["mimeType"],s),e}function jx(i){const e={},t=p(i,["gcsUri"]);t!=null&&v(e,["uri"],t);const n=p(i,["bytesBase64Encoded"]);n!=null&&v(e,["videoBytes"],Kd(n));const s=p(i,["mimeType"]);return s!=null&&v(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var w0;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(w0||(w0={}));var N0;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(N0||(N0={}));var P0;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(P0||(P0={}));var vt;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(vt||(vt={}));var k0;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(k0||(k0={}));var U0;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(U0||(U0={}));var O0;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(O0||(O0={}));var F0;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(F0||(F0={}));var B0;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(B0||(B0={}));var G0;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(G0||(G0={}));var $0;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})($0||($0={}));var V0;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(V0||(V0={}));var H0;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(H0||(H0={}));var q0;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(q0||(q0={}));var K0;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(K0||(K0={}));var z0;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(z0||(z0={}));var Y0;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Y0||(Y0={}));var X0;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(X0||(X0={}));var J0;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(J0||(J0={}));var Yl;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(Yl||(Yl={}));var W0;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(W0||(W0={}));var Q0;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Q0||(Q0={}));var Z0;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Z0||(Z0={}));var dd;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(dd||(dd={}));var j0;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(j0||(j0={}));var ey;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(ey||(ey={}));var ty;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(ty||(ty={}));var ny;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(ny||(ny={}));var iy;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(iy||(iy={}));var sy;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(sy||(sy={}));var ry;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(ry||(ry={}));var oy;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(oy||(oy={}));var ay;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(ay||(ay={}));var ly;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(ly||(ly={}));var uy;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(uy||(uy={}));var cy;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(cy||(cy={}));var fy;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(fy||(fy={}));var dy;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(dy||(dy={}));var hy;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(hy||(hy={}));var gy;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(gy||(gy={}));var my;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(my||(my={}));var py;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(py||(py={}));var yy;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING"})(yy||(yy={}));var vy;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(vy||(vy={}));var Ey;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(Ey||(Ey={}));var Ty;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(Ty||(Ty={}));var Sy;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Sy||(Sy={}));var Ay;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(Ay||(Ay={}));var _y;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(_y||(_y={}));var xy;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(xy||(xy={}));var Ry;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Ry||(Ry={}));var Iy;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(Iy||(Iy={}));var Cy;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Cy||(Cy={}));var Ly;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Ly||(Ly={}));var by;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(by||(by={}));var xr;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(xr||(xr={}));class hd{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Uo{get text(){var e,t,n,s,o,l,u,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let f="",h=!1;const m=[];for(const y of(d=(u=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[S,A]of Object.entries(y))S!=="text"&&S!=="thought"&&S!=="thoughtSignature"&&(A!==null||A!==void 0)&&m.push(S);if(typeof y.text=="string"){if(typeof y.thought=="boolean"&&y.thought)continue;h=!0,f+=y.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?f:void 0}get data(){var e,t,n,s,o,l,u,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let f="";const h=[];for(const m of(d=(u=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[y,S]of Object.entries(m))y!=="inlineData"&&(S!==null||S!==void 0)&&h.push(y);m.inlineData&&typeof m.inlineData.data=="string"&&(f+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),f.length>0?btoa(f):void 0}get functionCalls(){var e,t,n,s,o,l,u,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const f=(d=(u=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((f==null?void 0:f.length)!==0)return f}get executableCode(){var e,t,n,s,o,l,u,d,f;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(d=(u=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(f=h==null?void 0:h[0])===null||f===void 0?void 0:f.code}get codeExecutionResult(){var e,t,n,s,o,l,u,d,f;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(d=(u=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(f=h==null?void 0:h[0])===null||f===void 0?void 0:f.output}}class Dy{}class My{}class eR{}class tR{}class nR{}class iR{}class wy{}class Ny{}class Py{}class sR{}class Xl{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new Xl;let s;const o=e;return t?s=Vx(o):s=$x(o),Object.assign(n,s),n}}class ky{}class Uy{}class Oy{}class Fy{}class rR{}class oR{}class aR{}class zd{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new zd,o=Jx(e);return Object.assign(n,o),n}}class lR{}class uR{}class cR{}class By{}class fR{get text(){var e,t,n;let s="",o=!1;const l=[];for(const u of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[d,f]of Object.entries(u))d!=="text"&&d!=="thought"&&f!==null&&l.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;o=!0,s+=u.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?s:void 0}get data(){var e,t,n;let s="";const o=[];for(const l of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[u,d]of Object.entries(l))u!=="inlineData"&&d!==null&&o.push(u);l.inlineData&&typeof l.inlineData.data=="string"&&(s+=atob(l.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class dR{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Yd{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new Yd,o=NE(e);return Object.assign(n,o),n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $e(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function PE(i,e){const t=$e(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function kE(i){return Array.isArray(i)?i.map(e=>Jl(e)):[Jl(i)]}function Jl(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function UE(i){const e=Jl(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function OE(i){const e=Jl(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Gy(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function FE(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>Gy(e)):[Gy(i)]}function gd(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function $y(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function Vy(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function Ot(i){if(i==null)throw new Error("ContentUnion is required");return gd(i)?i:{role:"user",parts:FE(i)}}function Xd(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const n=Ot(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){const t=Ot(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Ot(t)):[Ot(e)]}function In(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if($y(i)||Vy(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ot(i)]}const e=[],t=[],n=gd(i[0]);for(const s of i){const o=gd(s);if(o!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(s);else{if($y(s)||Vy(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:FE(t)}),e}function hR(i,e){i.includes("null")&&(e.nullable=!0);const t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(vt).includes(t[0].toUpperCase())?t[0].toUpperCase():vt.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of t)e.anyOf.push({type:Object.values(vt).includes(n.toUpperCase())?n.toUpperCase():vt.TYPE_UNSPECIFIED})}}function Cr(i){const e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=i.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,i=o[1]):o[1].type==="null"&&(e.nullable=!0,i=o[0])),i.type instanceof Array&&hR(i.type,e);for(const[l,u]of Object.entries(i))if(u!=null)if(l=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(vt).includes(u.toUpperCase())?u.toUpperCase():vt.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=Cr(u);else if(n.includes(l)){const d=[];for(const f of u){if(f.type=="null"){e.nullable=!0;continue}d.push(Cr(f))}e[l]=d}else if(s.includes(l)){const d={};for(const[f,h]of Object.entries(u))d[f]=Cr(h);e[l]=d}else{if(l==="additionalProperties")continue;e[l]=u}return e}function Jd(i){return Cr(i)}function Wd(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function Qd(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function kr(i){if(i.functionDeclarations)for(const e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Cr(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Cr(e.response));return i}function Ur(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of i)e.push(t);return e}function gR(i,e,t,n=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function xi(i,e){if(typeof e!="string")throw new Error("name must be a string");return gR(i,e,"cachedContents")}function BE(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function ss(i){return Kd(i)}function mR(i){return i!=null&&typeof i=="object"&&"name"in i}function pR(i){return i!=null&&typeof i=="object"&&"video"in i}function yR(i){return i!=null&&typeof i=="object"&&"uri"in i}function GE(i){var e;let t;if(mR(i)&&(t=i.name),!(yR(i)&&(t=i.uri,t===void 0))&&!(pR(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function $E(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function VE(i){for(const e of["models","tunedModels","publisherModels"])if(vR(i,e))return i[e];return[]}function vR(i,e){return i!==null&&typeof i=="object"&&e in i}function ER(i,e={}){const t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function TR(i,e={}){const t=[],n=new Set;for(const s of i){const o=s.name;if(n.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);n.add(o);const l=ER(s,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function HE(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function SR(i){if(typeof i!="string")return i;const e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function qE(i){if(typeof i!="object"||i===null)return{};const e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;const s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let o=!1;for(const l of s){if(typeof l!="object"||l===null)continue;const d=l.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function Or(i,e){const t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function KE(i){const e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AR(i){const e={},t=p(i,["responsesFile"]);t!=null&&v(e,["fileName"],t);const n=p(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>nI(l))),v(e,["inlinedResponses"],o)}const s=p(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["inlinedEmbedContentResponses"],o)}return e}function _R(i){const e={},t=p(i,["predictionsFormat"]);t!=null&&v(e,["format"],t);const n=p(i,["gcsDestination","outputUriPrefix"]);n!=null&&v(e,["gcsUri"],n);const s=p(i,["bigqueryDestination","outputUri"]);return s!=null&&v(e,["bigqueryUri"],s),e}function xR(i){const e={},t=p(i,["format"]);t!=null&&v(e,["predictionsFormat"],t);const n=p(i,["gcsUri"]);n!=null&&v(e,["gcsDestination","outputUriPrefix"],n);const s=p(i,["bigqueryUri"]);if(s!=null&&v(e,["bigqueryDestination","outputUri"],s),p(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(p(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(p(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Ol(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata","displayName"]);n!=null&&v(e,["displayName"],n);const s=p(i,["metadata","state"]);s!=null&&v(e,["state"],KE(s));const o=p(i,["metadata","createTime"]);o!=null&&v(e,["createTime"],o);const l=p(i,["metadata","endTime"]);l!=null&&v(e,["endTime"],l);const u=p(i,["metadata","updateTime"]);u!=null&&v(e,["updateTime"],u);const d=p(i,["metadata","model"]);d!=null&&v(e,["model"],d);const f=p(i,["metadata","output"]);return f!=null&&v(e,["dest"],AR(qE(f))),e}function md(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["displayName"]);n!=null&&v(e,["displayName"],n);const s=p(i,["state"]);s!=null&&v(e,["state"],KE(s));const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["createTime"]);l!=null&&v(e,["createTime"],l);const u=p(i,["startTime"]);u!=null&&v(e,["startTime"],u);const d=p(i,["endTime"]);d!=null&&v(e,["endTime"],d);const f=p(i,["updateTime"]);f!=null&&v(e,["updateTime"],f);const h=p(i,["model"]);h!=null&&v(e,["model"],h);const m=p(i,["inputConfig"]);m!=null&&v(e,["src"],RR(m));const y=p(i,["outputConfig"]);y!=null&&v(e,["dest"],_R(qE(y)));const S=p(i,["completionStats"]);return S!=null&&v(e,["completionStats"],S),e}function RR(i){const e={},t=p(i,["instancesFormat"]);t!=null&&v(e,["format"],t);const n=p(i,["gcsSource","uris"]);n!=null&&v(e,["gcsUri"],n);const s=p(i,["bigquerySource","inputUri"]);return s!=null&&v(e,["bigqueryUri"],s),e}function IR(i,e){const t={};if(p(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(p(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(p(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const n=p(e,["fileName"]);n!=null&&v(t,["fileName"],n);const s=p(e,["inlinedRequests"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>tI(i,l))),v(t,["requests","requests"],o)}return t}function CR(i){const e={},t=p(i,["format"]);t!=null&&v(e,["instancesFormat"],t);const n=p(i,["gcsUri"]);n!=null&&v(e,["gcsSource","uris"],n);const s=p(i,["bigqueryUri"]);if(s!=null&&v(e,["bigquerySource","inputUri"],s),p(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(p(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function LR(i){const e={},t=p(i,["data"]);if(t!=null&&v(e,["data"],t),p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function bR(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],Or(i,n)),t}function DR(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],Or(i,n)),t}function MR(i){const e={},t=p(i,["content"]);t!=null&&v(e,["content"],t);const n=p(i,["citationMetadata"]);n!=null&&v(e,["citationMetadata"],wR(n));const s=p(i,["tokenCount"]);s!=null&&v(e,["tokenCount"],s);const o=p(i,["finishReason"]);o!=null&&v(e,["finishReason"],o);const l=p(i,["avgLogprobs"]);l!=null&&v(e,["avgLogprobs"],l);const u=p(i,["groundingMetadata"]);u!=null&&v(e,["groundingMetadata"],u);const d=p(i,["index"]);d!=null&&v(e,["index"],d);const f=p(i,["logprobsResult"]);f!=null&&v(e,["logprobsResult"],f);const h=p(i,["safetyRatings"]);if(h!=null){let y=h;Array.isArray(y)&&(y=y.map(S=>S)),v(e,["safetyRatings"],y)}const m=p(i,["urlContextMetadata"]);return m!=null&&v(e,["urlContextMetadata"],m),e}function wR(i){const e={},t=p(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),v(e,["citations"],n)}return e}function zE(i){const e={},t=p(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>uI(o))),v(e,["parts"],s)}const n=p(i,["role"]);return n!=null&&v(e,["role"],n),e}function NR(i,e){const t={},n=p(i,["displayName"]);if(e!==void 0&&n!=null&&v(e,["batch","displayName"],n),p(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function PR(i,e){const t={},n=p(i,["displayName"]);e!==void 0&&n!=null&&v(e,["displayName"],n);const s=p(i,["dest"]);return e!==void 0&&s!=null&&v(e,["outputConfig"],xR(SR(s))),t}function Hy(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["src"]);s!=null&&v(t,["batch","inputConfig"],IR(i,HE(i,s)));const o=p(e,["config"]);return o!=null&&NR(o,t),t}function kR(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["model"],$e(i,n));const s=p(e,["src"]);s!=null&&v(t,["inputConfig"],CR(HE(i,s)));const o=p(e,["config"]);return o!=null&&PR(o,t),t}function UR(i,e){const t={},n=p(i,["displayName"]);return e!==void 0&&n!=null&&v(e,["batch","displayName"],n),t}function OR(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["src"]);s!=null&&v(t,["batch","inputConfig"],qR(i,s));const o=p(e,["config"]);return o!=null&&UR(o,t),t}function FR(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],Or(i,n)),t}function BR(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],Or(i,n)),t}function GR(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["name"]);n!=null&&v(e,["name"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);return o!=null&&v(e,["error"],o),e}function $R(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["name"]);n!=null&&v(e,["name"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);return o!=null&&v(e,["error"],o),e}function VR(i,e){const t={},n=p(e,["contents"]);if(n!=null){let o=Xd(i,n);Array.isArray(o)&&(o=o.map(l=>l)),v(t,["requests[]","request","content"],o)}const s=p(e,["config"]);return s!=null&&(v(t,["_self"],HR(s,t)),Bx(t,{"requests[].*":"requests[].request.*"})),t}function HR(i,e){const t={},n=p(i,["taskType"]);e!==void 0&&n!=null&&v(e,["requests[]","taskType"],n);const s=p(i,["title"]);e!==void 0&&s!=null&&v(e,["requests[]","title"],s);const o=p(i,["outputDimensionality"]);if(e!==void 0&&o!=null&&v(e,["requests[]","outputDimensionality"],o),p(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(p(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function qR(i,e){const t={},n=p(e,["fileName"]);n!=null&&v(t,["file_name"],n);const s=p(e,["inlinedRequests"]);return s!=null&&v(t,["requests"],VR(i,s)),t}function KR(i){const e={};if(p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=p(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function zR(i){const e={},t=p(i,["id"]);t!=null&&v(e,["id"],t);const n=p(i,["args"]);n!=null&&v(e,["args"],n);const s=p(i,["name"]);if(s!=null&&v(e,["name"],s),p(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(p(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function YR(i){const e={},t=p(i,["mode"]);t!=null&&v(e,["mode"],t);const n=p(i,["allowedFunctionNames"]);if(n!=null&&v(e,["allowedFunctionNames"],n),p(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function XR(i,e,t){const n={},s=p(e,["systemInstruction"]);t!==void 0&&s!=null&&v(t,["systemInstruction"],zE(Ot(s)));const o=p(e,["temperature"]);o!=null&&v(n,["temperature"],o);const l=p(e,["topP"]);l!=null&&v(n,["topP"],l);const u=p(e,["topK"]);u!=null&&v(n,["topK"],u);const d=p(e,["candidateCount"]);d!=null&&v(n,["candidateCount"],d);const f=p(e,["maxOutputTokens"]);f!=null&&v(n,["maxOutputTokens"],f);const h=p(e,["stopSequences"]);h!=null&&v(n,["stopSequences"],h);const m=p(e,["responseLogprobs"]);m!=null&&v(n,["responseLogprobs"],m);const y=p(e,["logprobs"]);y!=null&&v(n,["logprobs"],y);const S=p(e,["presencePenalty"]);S!=null&&v(n,["presencePenalty"],S);const A=p(e,["frequencyPenalty"]);A!=null&&v(n,["frequencyPenalty"],A);const _=p(e,["seed"]);_!=null&&v(n,["seed"],_);const x=p(e,["responseMimeType"]);x!=null&&v(n,["responseMimeType"],x);const C=p(e,["responseSchema"]);C!=null&&v(n,["responseSchema"],Jd(C));const b=p(e,["responseJsonSchema"]);if(b!=null&&v(n,["responseJsonSchema"],b),p(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(p(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const L=p(e,["safetySettings"]);if(t!==void 0&&L!=null){let oe=L;Array.isArray(oe)&&(oe=oe.map(ce=>cI(ce))),v(t,["safetySettings"],oe)}const M=p(e,["tools"]);if(t!==void 0&&M!=null){let oe=Ur(M);Array.isArray(oe)&&(oe=oe.map(ce=>dI(kr(ce)))),v(t,["tools"],oe)}const P=p(e,["toolConfig"]);if(t!==void 0&&P!=null&&v(t,["toolConfig"],fI(P)),p(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const G=p(e,["cachedContent"]);t!==void 0&&G!=null&&v(t,["cachedContent"],xi(i,G));const N=p(e,["responseModalities"]);N!=null&&v(n,["responseModalities"],N);const $=p(e,["mediaResolution"]);$!=null&&v(n,["mediaResolution"],$);const U=p(e,["speechConfig"]);if(U!=null&&v(n,["speechConfig"],Wd(U)),p(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=p(e,["thinkingConfig"]);O!=null&&v(n,["thinkingConfig"],O);const J=p(e,["imageConfig"]);J!=null&&v(n,["imageConfig"],eI(J));const re=p(e,["enableEnhancedCivicAnswers"]);return re!=null&&v(n,["enableEnhancedCivicAnswers"],re),n}function JR(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(f=>MR(f))),v(e,["candidates"],d)}const s=p(i,["modelVersion"]);s!=null&&v(e,["modelVersion"],s);const o=p(i,["promptFeedback"]);o!=null&&v(e,["promptFeedback"],o);const l=p(i,["responseId"]);l!=null&&v(e,["responseId"],l);const u=p(i,["usageMetadata"]);return u!=null&&v(e,["usageMetadata"],u),e}function WR(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],Or(i,n)),t}function QR(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],Or(i,n)),t}function ZR(i){const e={};if(p(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=p(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function jR(i){const e={};if(p(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=p(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function eI(i){const e={},t=p(i,["aspectRatio"]);t!=null&&v(e,["aspectRatio"],t);const n=p(i,["imageSize"]);if(n!=null&&v(e,["imageSize"],n),p(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(p(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function tI(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["request","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let u=In(s);Array.isArray(u)&&(u=u.map(d=>zE(d))),v(t,["request","contents"],u)}const o=p(e,["metadata"]);o!=null&&v(t,["metadata"],o);const l=p(e,["config"]);return l!=null&&v(t,["request","generationConfig"],XR(i,l,p(t,["request"],{}))),t}function nI(i){const e={},t=p(i,["response"]);t!=null&&v(e,["response"],JR(t));const n=p(i,["error"]);return n!=null&&v(e,["error"],n),e}function iI(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);if(e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),p(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function sI(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);e!==void 0&&s!=null&&v(e,["_query","pageToken"],s);const o=p(i,["filter"]);return e!==void 0&&o!=null&&v(e,["_query","filter"],o),t}function rI(i){const e={},t=p(i,["config"]);return t!=null&&iI(t,e),e}function oI(i){const e={},t=p(i,["config"]);return t!=null&&sI(t,e),e}function aI(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["operations"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>Ol(l))),v(e,["batchJobs"],o)}return e}function lI(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["batchPredictionJobs"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>md(l))),v(e,["batchJobs"],o)}return e}function uI(i){const e={},t=p(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=p(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=p(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=p(i,["fileData"]);o!=null&&v(e,["fileData"],KR(o));const l=p(i,["functionCall"]);l!=null&&v(e,["functionCall"],zR(l));const u=p(i,["functionResponse"]);u!=null&&v(e,["functionResponse"],u);const d=p(i,["inlineData"]);d!=null&&v(e,["inlineData"],LR(d));const f=p(i,["text"]);f!=null&&v(e,["text"],f);const h=p(i,["thought"]);h!=null&&v(e,["thought"],h);const m=p(i,["thoughtSignature"]);m!=null&&v(e,["thoughtSignature"],m);const y=p(i,["videoMetadata"]);return y!=null&&v(e,["videoMetadata"],y),e}function cI(i){const e={},t=p(i,["category"]);if(t!=null&&v(e,["category"],t),p(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=p(i,["threshold"]);return n!=null&&v(e,["threshold"],n),e}function fI(i){const e={},t=p(i,["functionCallingConfig"]);t!=null&&v(e,["functionCallingConfig"],YR(t));const n=p(i,["retrievalConfig"]);return n!=null&&v(e,["retrievalConfig"],n),e}function dI(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),v(e,["functionDeclarations"],h)}if(p(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=p(i,["googleSearchRetrieval"]);n!=null&&v(e,["googleSearchRetrieval"],n);const s=p(i,["computerUse"]);s!=null&&v(e,["computerUse"],s);const o=p(i,["fileSearch"]);o!=null&&v(e,["fileSearch"],o);const l=p(i,["codeExecution"]);if(l!=null&&v(e,["codeExecution"],l),p(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=p(i,["googleMaps"]);u!=null&&v(e,["googleMaps"],ZR(u));const d=p(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],jR(d));const f=p(i,["urlContext"]);return f!=null&&v(e,["urlContext"],f),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ai;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(Ai||(Ai={}));class Ds{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!n||Object.keys(n).length===0?l={config:{}}:typeof n=="object"?l=Object.assign({},n):l=n,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(o=(s=l.config)===null||s===void 0?void 0:s.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hI extends _i{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ds(Ai.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=Hy(this.apiClient,e),n=t._url,s=me("{model}:batchGenerateContent",n),u=t.batch.inputConfig.requests,d=u.requests,f=[];for(const h of d){const m=Object.assign({},h);if(m.systemInstruction){const y=m.systemInstruction;delete m.systemInstruction;const S=m.request;S.systemInstruction=y,m.request=S}f.push(m)}return u.requests=f,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){const o=this.getGcsUri(e),l=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?n.dest=`${o.slice(0,-6)}/dest`:n.dest=`${o}_dest_${s}`;else if(l)n.dest=`${l}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=kR(this.apiClient,e);return u=me("batchPredictionJobs",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>md(h))}else{const f=Hy(this.apiClient,e);return u=me("{model}:batchGenerateContent",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>Ol(h))}}async createEmbeddingsInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=OR(this.apiClient,e);return o=me("{model}:asyncBatchEmbedContent",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>Ol(d))}}async get(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=QR(this.apiClient,e);return u=me("batchPredictionJobs/{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>md(h))}else{const f=WR(this.apiClient,e);return u=me("batches/{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>Ol(h))}}async cancel(e){var t,n,s,o;let l="",u={};if(this.apiClient.isVertexAI()){const d=DR(this.apiClient,e);l=me("batchPredictionJobs/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{const d=bR(this.apiClient,e);l=me("batches/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=oI(e);return u=me("batchPredictionJobs",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=lI(h),y=new By;return Object.assign(y,m),y})}else{const f=rI(e);return u=me("batches",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=aI(h),y=new By;return Object.assign(y,m),y})}}async delete(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=BR(this.apiClient,e);return u=me("batchPredictionJobs/{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>$R(h))}else{const f=FR(this.apiClient,e);return u=me("batches/{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>GR(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gI(i){const e={},t=p(i,["data"]);if(t!=null&&v(e,["data"],t),p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function qy(i){const e={},t=p(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>OI(o))),v(e,["parts"],s)}const n=p(i,["role"]);return n!=null&&v(e,["role"],n),e}function mI(i,e){const t={},n=p(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=p(i,["expireTime"]);e!==void 0&&s!=null&&v(e,["expireTime"],s);const o=p(i,["displayName"]);e!==void 0&&o!=null&&v(e,["displayName"],o);const l=p(i,["contents"]);if(e!==void 0&&l!=null){let h=In(l);Array.isArray(h)&&(h=h.map(m=>qy(m))),v(e,["contents"],h)}const u=p(i,["systemInstruction"]);e!==void 0&&u!=null&&v(e,["systemInstruction"],qy(Ot(u)));const d=p(i,["tools"]);if(e!==void 0&&d!=null){let h=d;Array.isArray(h)&&(h=h.map(m=>BI(m))),v(e,["tools"],h)}const f=p(i,["toolConfig"]);if(e!==void 0&&f!=null&&v(e,["toolConfig"],FI(f)),p(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function pI(i,e){const t={},n=p(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=p(i,["expireTime"]);e!==void 0&&s!=null&&v(e,["expireTime"],s);const o=p(i,["displayName"]);e!==void 0&&o!=null&&v(e,["displayName"],o);const l=p(i,["contents"]);if(e!==void 0&&l!=null){let m=In(l);Array.isArray(m)&&(m=m.map(y=>y)),v(e,["contents"],m)}const u=p(i,["systemInstruction"]);e!==void 0&&u!=null&&v(e,["systemInstruction"],Ot(u));const d=p(i,["tools"]);if(e!==void 0&&d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>GI(y))),v(e,["tools"],m)}const f=p(i,["toolConfig"]);e!==void 0&&f!=null&&v(e,["toolConfig"],f);const h=p(i,["kmsKeyName"]);return e!==void 0&&h!=null&&v(e,["encryption_spec","kmsKeyName"],h),t}function yI(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["model"],PE(i,n));const s=p(e,["config"]);return s!=null&&mI(s,t),t}function vI(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["model"],PE(i,n));const s=p(e,["config"]);return s!=null&&pI(s,t),t}function EI(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],xi(i,n)),t}function TI(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],xi(i,n)),t}function SI(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function AI(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function _I(i){const e={};if(p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=p(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function xI(i){const e={},t=p(i,["id"]);t!=null&&v(e,["id"],t);const n=p(i,["args"]);n!=null&&v(e,["args"],n);const s=p(i,["name"]);if(s!=null&&v(e,["name"],s),p(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(p(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function RI(i){const e={},t=p(i,["mode"]);t!=null&&v(e,["mode"],t);const n=p(i,["allowedFunctionNames"]);if(n!=null&&v(e,["allowedFunctionNames"],n),p(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function II(i){const e={};if(p(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=p(i,["description"]);t!=null&&v(e,["description"],t);const n=p(i,["name"]);n!=null&&v(e,["name"],n);const s=p(i,["parameters"]);s!=null&&v(e,["parameters"],s);const o=p(i,["parametersJsonSchema"]);o!=null&&v(e,["parametersJsonSchema"],o);const l=p(i,["response"]);l!=null&&v(e,["response"],l);const u=p(i,["responseJsonSchema"]);return u!=null&&v(e,["responseJsonSchema"],u),e}function CI(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],xi(i,n)),t}function LI(i,e){const t={},n=p(e,["name"]);return n!=null&&v(t,["_url","name"],xi(i,n)),t}function bI(i){const e={};if(p(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=p(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function DI(i){const e={};if(p(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=p(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function MI(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function wI(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function NI(i){const e={},t=p(i,["config"]);return t!=null&&MI(t,e),e}function PI(i){const e={},t=p(i,["config"]);return t!=null&&wI(t,e),e}function kI(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["cachedContents"],o)}return e}function UI(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["cachedContents"],o)}return e}function OI(i){const e={},t=p(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=p(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=p(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=p(i,["fileData"]);o!=null&&v(e,["fileData"],_I(o));const l=p(i,["functionCall"]);l!=null&&v(e,["functionCall"],xI(l));const u=p(i,["functionResponse"]);u!=null&&v(e,["functionResponse"],u);const d=p(i,["inlineData"]);d!=null&&v(e,["inlineData"],gI(d));const f=p(i,["text"]);f!=null&&v(e,["text"],f);const h=p(i,["thought"]);h!=null&&v(e,["thought"],h);const m=p(i,["thoughtSignature"]);m!=null&&v(e,["thoughtSignature"],m);const y=p(i,["videoMetadata"]);return y!=null&&v(e,["videoMetadata"],y),e}function FI(i){const e={},t=p(i,["functionCallingConfig"]);t!=null&&v(e,["functionCallingConfig"],RI(t));const n=p(i,["retrievalConfig"]);return n!=null&&v(e,["retrievalConfig"],n),e}function BI(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),v(e,["functionDeclarations"],h)}if(p(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=p(i,["googleSearchRetrieval"]);n!=null&&v(e,["googleSearchRetrieval"],n);const s=p(i,["computerUse"]);s!=null&&v(e,["computerUse"],s);const o=p(i,["fileSearch"]);o!=null&&v(e,["fileSearch"],o);const l=p(i,["codeExecution"]);if(l!=null&&v(e,["codeExecution"],l),p(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=p(i,["googleMaps"]);u!=null&&v(e,["googleMaps"],bI(u));const d=p(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],DI(d));const f=p(i,["urlContext"]);return f!=null&&v(e,["urlContext"],f),e}function GI(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(y=>II(y))),v(e,["functionDeclarations"],m)}const n=p(i,["retrieval"]);n!=null&&v(e,["retrieval"],n);const s=p(i,["googleSearchRetrieval"]);s!=null&&v(e,["googleSearchRetrieval"],s);const o=p(i,["computerUse"]);if(o!=null&&v(e,["computerUse"],o),p(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=p(i,["codeExecution"]);l!=null&&v(e,["codeExecution"],l);const u=p(i,["enterpriseWebSearch"]);u!=null&&v(e,["enterpriseWebSearch"],u);const d=p(i,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=p(i,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=p(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function $I(i,e){const t={},n=p(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=p(i,["expireTime"]);return e!==void 0&&s!=null&&v(e,["expireTime"],s),t}function VI(i,e){const t={},n=p(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=p(i,["expireTime"]);return e!==void 0&&s!=null&&v(e,["expireTime"],s),t}function HI(i,e){const t={},n=p(e,["name"]);n!=null&&v(t,["_url","name"],xi(i,n));const s=p(e,["config"]);return s!=null&&$I(s,t),t}function qI(i,e){const t={},n=p(e,["name"]);n!=null&&v(t,["_url","name"],xi(i,n));const s=p(e,["config"]);return s!=null&&VI(s,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KI extends _i{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ds(Ai.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=vI(this.apiClient,e);return u=me("cachedContents",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>h)}else{const f=yI(this.apiClient,e);return u=me("cachedContents",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>h)}}async get(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=LI(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>h)}else{const f=CI(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>h)}}async delete(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=TI(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=AI(h),y=new Oy;return Object.assign(y,m),y})}else{const f=EI(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=SI(h),y=new Oy;return Object.assign(y,m),y})}}async update(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=qI(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>h)}else{const f=HI(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>h)}}async listInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=PI(e);return u=me("cachedContents",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=UI(h),y=new Fy;return Object.assign(y,m),y})}else{const f=NI(e);return u=me("cachedContents",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=kI(h),y=new Fy;return Object.assign(y,m),y})}}}function Wl(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function Ky(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xe(i){return this instanceof xe?(this.v=i,this):new xe(i)}function On(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),s[Symbol.asyncIterator]=function(){return this},s;function l(S){return function(A){return Promise.resolve(A).then(S,m)}}function u(S,A){n[S]&&(s[S]=function(_){return new Promise(function(x,C){o.push([S,_,x,C])>1||d(S,_)})},A&&(s[S]=A(s[S])))}function d(S,A){try{f(n[S](A))}catch(_){y(o[0][3],_)}}function f(S){S.value instanceof xe?Promise.resolve(S.value.v).then(h,m):y(o[0][2],S)}function h(S){d("next",S)}function m(S){d("throw",S)}function y(S,A){S(A),o.shift(),o.length&&d(o[0][0],o[0][1])}}function Fn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Ky=="function"?Ky(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=i[o]&&function(l){return new Promise(function(u,d){l=i[o](l),s(u,d,l.done,l.value)})}}function s(o,l,u,d){Promise.resolve(d).then(function(f){o({value:f,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zI(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;const t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:YE(t)}function YE(i){if(i.parts===void 0||i.parts.length===0)return!1;for(const e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function YI(i){if(i.length!==0){for(const e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function zy(i){if(i===void 0||i.length===0)return[];const e=[],t=i.length;let n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{const s=[];let o=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),o&&!YE(i[n])&&(o=!1),n++;o?e.push(...s):e.pop()}return e}class XI{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new JI(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class JI{constructor(e,t,n,s={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=o,this.sendPromise=Promise.resolve(),YI(o)}async sendMessage(e){var t;await this.sendPromise;const n=Ot(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,l,u;const d=await s,f=(l=(o=d.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content,h=d.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let y=[];h!=null&&(y=(u=h.slice(m))!==null&&u!==void 0?u:[]);const S=f?[f]:[];this.recordHistory(n,S,y)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const n=Ot(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const o=await s;return this.processStreamResponse(o,n)}getHistory(e=!1){const t=e?zy(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return On(this,arguments,function*(){var s,o,l,u,d,f;const h=[];try{for(var m=!0,y=Fn(e),S;S=yield xe(y.next()),s=S.done,!s;m=!0){u=S.value,m=!1;const A=u;if(zI(A)){const _=(f=(d=A.candidates)===null||d===void 0?void 0:d[0])===null||f===void 0?void 0:f.content;_!==void 0&&h.push(_)}yield yield xe(A)}}catch(A){o={error:A}}finally{try{!m&&!s&&(l=y.return)&&(yield xe(l.call(y)))}finally{if(o)throw o.error}}this.recordHistory(t,h)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(o=>o.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...zy(n)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cu extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,cu.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WI(i){const e={},t=p(i,["file"]);return t!=null&&v(e,["file"],t),e}function QI(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function ZI(i){const e={},t=p(i,["name"]);return t!=null&&v(e,["_url","file"],GE(t)),e}function jI(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function eC(i){const e={},t=p(i,["name"]);return t!=null&&v(e,["_url","file"],GE(t)),e}function tC(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function nC(i){const e={},t=p(i,["config"]);return t!=null&&tC(t,e),e}function iC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["files"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sC extends _i{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ds(Ai.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=nC(e);return o=me("files",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>{const f=iC(d),h=new lR;return Object.assign(h,f),h})}}async createInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=WI(e);return o=me("upload/v1beta/files",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=QI(d),h=new uR;return Object.assign(h,f),h})}}async get(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=eC(e);return o=me("files/{file}",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async delete(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ZI(e);return o=me("files/{file}",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>{const f=jI(d),h=new cR;return Object.assign(h,f),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fl(i){const e={},t=p(i,["data"]);if(t!=null&&v(e,["data"],t),p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function rC(i){const e={},t=p(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>SC(o))),v(e,["parts"],s)}const n=p(i,["role"]);return n!=null&&v(e,["role"],n),e}function oC(i){const e={};if(p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=p(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function aC(i){const e={},t=p(i,["id"]);t!=null&&v(e,["id"],t);const n=p(i,["args"]);n!=null&&v(e,["args"],n);const s=p(i,["name"]);if(s!=null&&v(e,["name"],s),p(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(p(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function lC(i){const e={};if(p(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=p(i,["description"]);t!=null&&v(e,["description"],t);const n=p(i,["name"]);n!=null&&v(e,["name"],n);const s=p(i,["parameters"]);s!=null&&v(e,["parameters"],s);const o=p(i,["parametersJsonSchema"]);o!=null&&v(e,["parametersJsonSchema"],o);const l=p(i,["response"]);l!=null&&v(e,["response"],l);const u=p(i,["responseJsonSchema"]);return u!=null&&v(e,["responseJsonSchema"],u),e}function uC(i){const e={},t=p(i,["modelSelectionConfig"]);t!=null&&v(e,["modelConfig"],t);const n=p(i,["responseJsonSchema"]);n!=null&&v(e,["responseJsonSchema"],n);const s=p(i,["audioTimestamp"]);s!=null&&v(e,["audioTimestamp"],s);const o=p(i,["candidateCount"]);o!=null&&v(e,["candidateCount"],o);const l=p(i,["enableAffectiveDialog"]);l!=null&&v(e,["enableAffectiveDialog"],l);const u=p(i,["frequencyPenalty"]);u!=null&&v(e,["frequencyPenalty"],u);const d=p(i,["logprobs"]);d!=null&&v(e,["logprobs"],d);const f=p(i,["maxOutputTokens"]);f!=null&&v(e,["maxOutputTokens"],f);const h=p(i,["mediaResolution"]);h!=null&&v(e,["mediaResolution"],h);const m=p(i,["presencePenalty"]);m!=null&&v(e,["presencePenalty"],m);const y=p(i,["responseLogprobs"]);y!=null&&v(e,["responseLogprobs"],y);const S=p(i,["responseMimeType"]);S!=null&&v(e,["responseMimeType"],S);const A=p(i,["responseModalities"]);A!=null&&v(e,["responseModalities"],A);const _=p(i,["responseSchema"]);_!=null&&v(e,["responseSchema"],_);const x=p(i,["routingConfig"]);x!=null&&v(e,["routingConfig"],x);const C=p(i,["seed"]);C!=null&&v(e,["seed"],C);const b=p(i,["speechConfig"]);b!=null&&v(e,["speechConfig"],b);const L=p(i,["stopSequences"]);L!=null&&v(e,["stopSequences"],L);const M=p(i,["temperature"]);M!=null&&v(e,["temperature"],M);const P=p(i,["thinkingConfig"]);P!=null&&v(e,["thinkingConfig"],P);const G=p(i,["topK"]);G!=null&&v(e,["topK"],G);const N=p(i,["topP"]);if(N!=null&&v(e,["topP"],N),p(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function cC(i){const e={};if(p(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=p(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function fC(i){const e={};if(p(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=p(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function dC(i,e){const t={},n=p(i,["generationConfig"]);e!==void 0&&n!=null&&v(e,["setup","generationConfig"],n);const s=p(i,["responseModalities"]);e!==void 0&&s!=null&&v(e,["setup","generationConfig","responseModalities"],s);const o=p(i,["temperature"]);e!==void 0&&o!=null&&v(e,["setup","generationConfig","temperature"],o);const l=p(i,["topP"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","topP"],l);const u=p(i,["topK"]);e!==void 0&&u!=null&&v(e,["setup","generationConfig","topK"],u);const d=p(i,["maxOutputTokens"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","maxOutputTokens"],d);const f=p(i,["mediaResolution"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","mediaResolution"],f);const h=p(i,["seed"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","seed"],h);const m=p(i,["speechConfig"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","speechConfig"],Qd(m));const y=p(i,["thinkingConfig"]);e!==void 0&&y!=null&&v(e,["setup","generationConfig","thinkingConfig"],y);const S=p(i,["enableAffectiveDialog"]);e!==void 0&&S!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],S);const A=p(i,["systemInstruction"]);e!==void 0&&A!=null&&v(e,["setup","systemInstruction"],rC(Ot(A)));const _=p(i,["tools"]);if(e!==void 0&&_!=null){let G=Ur(_);Array.isArray(G)&&(G=G.map(N=>_C(kr(N)))),v(e,["setup","tools"],G)}const x=p(i,["sessionResumption"]);e!==void 0&&x!=null&&v(e,["setup","sessionResumption"],AC(x));const C=p(i,["inputAudioTranscription"]);e!==void 0&&C!=null&&v(e,["setup","inputAudioTranscription"],C);const b=p(i,["outputAudioTranscription"]);e!==void 0&&b!=null&&v(e,["setup","outputAudioTranscription"],b);const L=p(i,["realtimeInputConfig"]);e!==void 0&&L!=null&&v(e,["setup","realtimeInputConfig"],L);const M=p(i,["contextWindowCompression"]);e!==void 0&&M!=null&&v(e,["setup","contextWindowCompression"],M);const P=p(i,["proactivity"]);if(e!==void 0&&P!=null&&v(e,["setup","proactivity"],P),p(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function hC(i,e){const t={},n=p(i,["generationConfig"]);e!==void 0&&n!=null&&v(e,["setup","generationConfig"],uC(n));const s=p(i,["responseModalities"]);e!==void 0&&s!=null&&v(e,["setup","generationConfig","responseModalities"],s);const o=p(i,["temperature"]);e!==void 0&&o!=null&&v(e,["setup","generationConfig","temperature"],o);const l=p(i,["topP"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","topP"],l);const u=p(i,["topK"]);e!==void 0&&u!=null&&v(e,["setup","generationConfig","topK"],u);const d=p(i,["maxOutputTokens"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","maxOutputTokens"],d);const f=p(i,["mediaResolution"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","mediaResolution"],f);const h=p(i,["seed"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","seed"],h);const m=p(i,["speechConfig"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","speechConfig"],Qd(m));const y=p(i,["thinkingConfig"]);e!==void 0&&y!=null&&v(e,["setup","generationConfig","thinkingConfig"],y);const S=p(i,["enableAffectiveDialog"]);e!==void 0&&S!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],S);const A=p(i,["systemInstruction"]);e!==void 0&&A!=null&&v(e,["setup","systemInstruction"],Ot(A));const _=p(i,["tools"]);if(e!==void 0&&_!=null){let N=Ur(_);Array.isArray(N)&&(N=N.map($=>xC(kr($)))),v(e,["setup","tools"],N)}const x=p(i,["sessionResumption"]);e!==void 0&&x!=null&&v(e,["setup","sessionResumption"],x);const C=p(i,["inputAudioTranscription"]);e!==void 0&&C!=null&&v(e,["setup","inputAudioTranscription"],C);const b=p(i,["outputAudioTranscription"]);e!==void 0&&b!=null&&v(e,["setup","outputAudioTranscription"],b);const L=p(i,["realtimeInputConfig"]);e!==void 0&&L!=null&&v(e,["setup","realtimeInputConfig"],L);const M=p(i,["contextWindowCompression"]);e!==void 0&&M!=null&&v(e,["setup","contextWindowCompression"],M);const P=p(i,["proactivity"]);e!==void 0&&P!=null&&v(e,["setup","proactivity"],P);const G=p(i,["explicitVadSignal"]);return e!==void 0&&G!=null&&v(e,["setup","explicitVadSignal"],G),t}function gC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["setup","model"],$e(i,n));const s=p(e,["config"]);return s!=null&&v(t,["config"],dC(s,t)),t}function mC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["setup","model"],$e(i,n));const s=p(e,["config"]);return s!=null&&v(t,["config"],hC(s,t)),t}function pC(i){const e={},t=p(i,["musicGenerationConfig"]);return t!=null&&v(e,["musicGenerationConfig"],t),e}function yC(i){const e={},t=p(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),v(e,["weightedPrompts"],n)}return e}function vC(i){const e={},t=p(i,["media"]);if(t!=null){let f=kE(t);Array.isArray(f)&&(f=f.map(h=>Fl(h))),v(e,["mediaChunks"],f)}const n=p(i,["audio"]);n!=null&&v(e,["audio"],Fl(OE(n)));const s=p(i,["audioStreamEnd"]);s!=null&&v(e,["audioStreamEnd"],s);const o=p(i,["video"]);o!=null&&v(e,["video"],Fl(UE(o)));const l=p(i,["text"]);l!=null&&v(e,["text"],l);const u=p(i,["activityStart"]);u!=null&&v(e,["activityStart"],u);const d=p(i,["activityEnd"]);return d!=null&&v(e,["activityEnd"],d),e}function EC(i){const e={},t=p(i,["media"]);if(t!=null){let f=kE(t);Array.isArray(f)&&(f=f.map(h=>h)),v(e,["mediaChunks"],f)}const n=p(i,["audio"]);n!=null&&v(e,["audio"],OE(n));const s=p(i,["audioStreamEnd"]);s!=null&&v(e,["audioStreamEnd"],s);const o=p(i,["video"]);o!=null&&v(e,["video"],UE(o));const l=p(i,["text"]);l!=null&&v(e,["text"],l);const u=p(i,["activityStart"]);u!=null&&v(e,["activityStart"],u);const d=p(i,["activityEnd"]);return d!=null&&v(e,["activityEnd"],d),e}function TC(i){const e={},t=p(i,["setupComplete"]);t!=null&&v(e,["setupComplete"],t);const n=p(i,["serverContent"]);n!=null&&v(e,["serverContent"],n);const s=p(i,["toolCall"]);s!=null&&v(e,["toolCall"],s);const o=p(i,["toolCallCancellation"]);o!=null&&v(e,["toolCallCancellation"],o);const l=p(i,["usageMetadata"]);l!=null&&v(e,["usageMetadata"],RC(l));const u=p(i,["goAway"]);u!=null&&v(e,["goAway"],u);const d=p(i,["sessionResumptionUpdate"]);d!=null&&v(e,["sessionResumptionUpdate"],d);const f=p(i,["voiceActivityDetectionSignal"]);return f!=null&&v(e,["voiceActivityDetectionSignal"],f),e}function SC(i){const e={},t=p(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=p(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=p(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=p(i,["fileData"]);o!=null&&v(e,["fileData"],oC(o));const l=p(i,["functionCall"]);l!=null&&v(e,["functionCall"],aC(l));const u=p(i,["functionResponse"]);u!=null&&v(e,["functionResponse"],u);const d=p(i,["inlineData"]);d!=null&&v(e,["inlineData"],Fl(d));const f=p(i,["text"]);f!=null&&v(e,["text"],f);const h=p(i,["thought"]);h!=null&&v(e,["thought"],h);const m=p(i,["thoughtSignature"]);m!=null&&v(e,["thoughtSignature"],m);const y=p(i,["videoMetadata"]);return y!=null&&v(e,["videoMetadata"],y),e}function AC(i){const e={},t=p(i,["handle"]);if(t!=null&&v(e,["handle"],t),p(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function _C(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),v(e,["functionDeclarations"],h)}if(p(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=p(i,["googleSearchRetrieval"]);n!=null&&v(e,["googleSearchRetrieval"],n);const s=p(i,["computerUse"]);s!=null&&v(e,["computerUse"],s);const o=p(i,["fileSearch"]);o!=null&&v(e,["fileSearch"],o);const l=p(i,["codeExecution"]);if(l!=null&&v(e,["codeExecution"],l),p(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=p(i,["googleMaps"]);u!=null&&v(e,["googleMaps"],cC(u));const d=p(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],fC(d));const f=p(i,["urlContext"]);return f!=null&&v(e,["urlContext"],f),e}function xC(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(y=>lC(y))),v(e,["functionDeclarations"],m)}const n=p(i,["retrieval"]);n!=null&&v(e,["retrieval"],n);const s=p(i,["googleSearchRetrieval"]);s!=null&&v(e,["googleSearchRetrieval"],s);const o=p(i,["computerUse"]);if(o!=null&&v(e,["computerUse"],o),p(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=p(i,["codeExecution"]);l!=null&&v(e,["codeExecution"],l);const u=p(i,["enterpriseWebSearch"]);u!=null&&v(e,["enterpriseWebSearch"],u);const d=p(i,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=p(i,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=p(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function RC(i){const e={},t=p(i,["promptTokenCount"]);t!=null&&v(e,["promptTokenCount"],t);const n=p(i,["cachedContentTokenCount"]);n!=null&&v(e,["cachedContentTokenCount"],n);const s=p(i,["candidatesTokenCount"]);s!=null&&v(e,["responseTokenCount"],s);const o=p(i,["toolUsePromptTokenCount"]);o!=null&&v(e,["toolUsePromptTokenCount"],o);const l=p(i,["thoughtsTokenCount"]);l!=null&&v(e,["thoughtsTokenCount"],l);const u=p(i,["totalTokenCount"]);u!=null&&v(e,["totalTokenCount"],u);const d=p(i,["promptTokensDetails"]);if(d!=null){let S=d;Array.isArray(S)&&(S=S.map(A=>A)),v(e,["promptTokensDetails"],S)}const f=p(i,["cacheTokensDetails"]);if(f!=null){let S=f;Array.isArray(S)&&(S=S.map(A=>A)),v(e,["cacheTokensDetails"],S)}const h=p(i,["candidatesTokensDetails"]);if(h!=null){let S=h;Array.isArray(S)&&(S=S.map(A=>A)),v(e,["responseTokensDetails"],S)}const m=p(i,["toolUsePromptTokensDetails"]);if(m!=null){let S=m;Array.isArray(S)&&(S=S.map(A=>A)),v(e,["toolUsePromptTokensDetails"],S)}const y=p(i,["trafficType"]);return y!=null&&v(e,["trafficType"],y),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IC(i){const e={},t=p(i,["data"]);if(t!=null&&v(e,["data"],t),p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function CC(i){const e={},t=p(i,["content"]);t!=null&&v(e,["content"],t);const n=p(i,["citationMetadata"]);n!=null&&v(e,["citationMetadata"],LC(n));const s=p(i,["tokenCount"]);s!=null&&v(e,["tokenCount"],s);const o=p(i,["finishReason"]);o!=null&&v(e,["finishReason"],o);const l=p(i,["avgLogprobs"]);l!=null&&v(e,["avgLogprobs"],l);const u=p(i,["groundingMetadata"]);u!=null&&v(e,["groundingMetadata"],u);const d=p(i,["index"]);d!=null&&v(e,["index"],d);const f=p(i,["logprobsResult"]);f!=null&&v(e,["logprobsResult"],f);const h=p(i,["safetyRatings"]);if(h!=null){let y=h;Array.isArray(y)&&(y=y.map(S=>S)),v(e,["safetyRatings"],y)}const m=p(i,["urlContextMetadata"]);return m!=null&&v(e,["urlContextMetadata"],m),e}function LC(i){const e={},t=p(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),v(e,["citations"],n)}return e}function bC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let o=In(s);Array.isArray(o)&&(o=o.map(l=>l)),v(t,["contents"],o)}return t}function DC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["tokensInfo"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>o)),v(e,["tokensInfo"],s)}return e}function MC(i){const e={},t=p(i,["values"]);t!=null&&v(e,["values"],t);const n=p(i,["statistics"]);return n!=null&&v(e,["statistics"],wC(n)),e}function wC(i){const e={},t=p(i,["truncated"]);t!=null&&v(e,["truncated"],t);const n=p(i,["token_count"]);return n!=null&&v(e,["tokenCount"],n),e}function fu(i){const e={},t=p(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>$L(o))),v(e,["parts"],s)}const n=p(i,["role"]);return n!=null&&v(e,["role"],n),e}function NC(i){const e={},t=p(i,["controlType"]);t!=null&&v(e,["controlType"],t);const n=p(i,["enableControlImageComputation"]);return n!=null&&v(e,["computeControl"],n),e}function PC(i){const e={};if(p(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(p(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(p(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function kC(i,e){const t={},n=p(i,["systemInstruction"]);e!==void 0&&n!=null&&v(e,["systemInstruction"],Ot(n));const s=p(i,["tools"]);if(e!==void 0&&s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>QE(u))),v(e,["tools"],l)}const o=p(i,["generationConfig"]);return e!==void 0&&o!=null&&v(e,["generationConfig"],IL(o)),t}function UC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let l=In(s);Array.isArray(l)&&(l=l.map(u=>fu(u))),v(t,["contents"],l)}const o=p(e,["config"]);return o!=null&&PC(o),t}function OC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let l=In(s);Array.isArray(l)&&(l=l.map(u=>u)),v(t,["contents"],l)}const o=p(e,["config"]);return o!=null&&kC(o,t),t}function FC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["totalTokens"]);n!=null&&v(e,["totalTokens"],n);const s=p(i,["cachedContentTokenCount"]);return s!=null&&v(e,["cachedContentTokenCount"],s),e}function BC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["totalTokens"]);return n!=null&&v(e,["totalTokens"],n),e}function GC(i,e){const t={},n=p(e,["model"]);return n!=null&&v(t,["_url","name"],$e(i,n)),t}function $C(i,e){const t={},n=p(e,["model"]);return n!=null&&v(t,["_url","name"],$e(i,n)),t}function VC(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function HC(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function qC(i,e){const t={},n=p(i,["outputGcsUri"]);e!==void 0&&n!=null&&v(e,["parameters","storageUri"],n);const s=p(i,["negativePrompt"]);e!==void 0&&s!=null&&v(e,["parameters","negativePrompt"],s);const o=p(i,["numberOfImages"]);e!==void 0&&o!=null&&v(e,["parameters","sampleCount"],o);const l=p(i,["aspectRatio"]);e!==void 0&&l!=null&&v(e,["parameters","aspectRatio"],l);const u=p(i,["guidanceScale"]);e!==void 0&&u!=null&&v(e,["parameters","guidanceScale"],u);const d=p(i,["seed"]);e!==void 0&&d!=null&&v(e,["parameters","seed"],d);const f=p(i,["safetyFilterLevel"]);e!==void 0&&f!=null&&v(e,["parameters","safetySetting"],f);const h=p(i,["personGeneration"]);e!==void 0&&h!=null&&v(e,["parameters","personGeneration"],h);const m=p(i,["includeSafetyAttributes"]);e!==void 0&&m!=null&&v(e,["parameters","includeSafetyAttributes"],m);const y=p(i,["includeRaiReason"]);e!==void 0&&y!=null&&v(e,["parameters","includeRaiReason"],y);const S=p(i,["language"]);e!==void 0&&S!=null&&v(e,["parameters","language"],S);const A=p(i,["outputMimeType"]);e!==void 0&&A!=null&&v(e,["parameters","outputOptions","mimeType"],A);const _=p(i,["outputCompressionQuality"]);e!==void 0&&_!=null&&v(e,["parameters","outputOptions","compressionQuality"],_);const x=p(i,["addWatermark"]);e!==void 0&&x!=null&&v(e,["parameters","addWatermark"],x);const C=p(i,["labels"]);e!==void 0&&C!=null&&v(e,["labels"],C);const b=p(i,["editMode"]);e!==void 0&&b!=null&&v(e,["parameters","editMode"],b);const L=p(i,["baseSteps"]);return e!==void 0&&L!=null&&v(e,["parameters","editConfig","baseSteps"],L),t}function KC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["prompt"]);s!=null&&v(t,["instances[0]","prompt"],s);const o=p(e,["referenceImages"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>YL(d))),v(t,["instances[0]","referenceImages"],u)}const l=p(e,["config"]);return l!=null&&qC(l,t),t}function zC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>du(o))),v(e,["generatedImages"],s)}return e}function YC(i,e){const t={},n=p(i,["taskType"]);e!==void 0&&n!=null&&v(e,["requests[]","taskType"],n);const s=p(i,["title"]);e!==void 0&&s!=null&&v(e,["requests[]","title"],s);const o=p(i,["outputDimensionality"]);if(e!==void 0&&o!=null&&v(e,["requests[]","outputDimensionality"],o),p(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(p(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function XC(i,e){const t={},n=p(i,["taskType"]);e!==void 0&&n!=null&&v(e,["instances[]","task_type"],n);const s=p(i,["title"]);e!==void 0&&s!=null&&v(e,["instances[]","title"],s);const o=p(i,["outputDimensionality"]);e!==void 0&&o!=null&&v(e,["parameters","outputDimensionality"],o);const l=p(i,["mimeType"]);e!==void 0&&l!=null&&v(e,["instances[]","mimeType"],l);const u=p(i,["autoTruncate"]);return e!==void 0&&u!=null&&v(e,["parameters","autoTruncate"],u),t}function JC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let u=Xd(i,s);Array.isArray(u)&&(u=u.map(d=>d)),v(t,["requests[]","content"],u)}const o=p(e,["config"]);o!=null&&YC(o,t);const l=p(e,["model"]);return l!==void 0&&v(t,["requests[]","model"],$e(i,l)),t}function WC(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let l=Xd(i,s);Array.isArray(l)&&(l=l.map(u=>u)),v(t,["instances[]","content"],l)}const o=p(e,["config"]);return o!=null&&XC(o,t),t}function QC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["embeddings"],o)}const s=p(i,["metadata"]);return s!=null&&v(e,["metadata"],s),e}function ZC(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>MC(l))),v(e,["embeddings"],o)}const s=p(i,["metadata"]);return s!=null&&v(e,["metadata"],s),e}function jC(i){const e={},t=p(i,["endpoint"]);t!=null&&v(e,["name"],t);const n=p(i,["deployedModelId"]);return n!=null&&v(e,["deployedModelId"],n),e}function eL(i){const e={};if(p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=p(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function tL(i){const e={},t=p(i,["id"]);t!=null&&v(e,["id"],t);const n=p(i,["args"]);n!=null&&v(e,["args"],n);const s=p(i,["name"]);if(s!=null&&v(e,["name"],s),p(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(p(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function nL(i){const e={},t=p(i,["mode"]);t!=null&&v(e,["mode"],t);const n=p(i,["allowedFunctionNames"]);if(n!=null&&v(e,["allowedFunctionNames"],n),p(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function iL(i){const e={};if(p(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=p(i,["description"]);t!=null&&v(e,["description"],t);const n=p(i,["name"]);n!=null&&v(e,["name"],n);const s=p(i,["parameters"]);s!=null&&v(e,["parameters"],s);const o=p(i,["parametersJsonSchema"]);o!=null&&v(e,["parametersJsonSchema"],o);const l=p(i,["response"]);l!=null&&v(e,["response"],l);const u=p(i,["responseJsonSchema"]);return u!=null&&v(e,["responseJsonSchema"],u),e}function sL(i,e,t){const n={},s=p(e,["systemInstruction"]);t!==void 0&&s!=null&&v(t,["systemInstruction"],fu(Ot(s)));const o=p(e,["temperature"]);o!=null&&v(n,["temperature"],o);const l=p(e,["topP"]);l!=null&&v(n,["topP"],l);const u=p(e,["topK"]);u!=null&&v(n,["topK"],u);const d=p(e,["candidateCount"]);d!=null&&v(n,["candidateCount"],d);const f=p(e,["maxOutputTokens"]);f!=null&&v(n,["maxOutputTokens"],f);const h=p(e,["stopSequences"]);h!=null&&v(n,["stopSequences"],h);const m=p(e,["responseLogprobs"]);m!=null&&v(n,["responseLogprobs"],m);const y=p(e,["logprobs"]);y!=null&&v(n,["logprobs"],y);const S=p(e,["presencePenalty"]);S!=null&&v(n,["presencePenalty"],S);const A=p(e,["frequencyPenalty"]);A!=null&&v(n,["frequencyPenalty"],A);const _=p(e,["seed"]);_!=null&&v(n,["seed"],_);const x=p(e,["responseMimeType"]);x!=null&&v(n,["responseMimeType"],x);const C=p(e,["responseSchema"]);C!=null&&v(n,["responseSchema"],Jd(C));const b=p(e,["responseJsonSchema"]);if(b!=null&&v(n,["responseJsonSchema"],b),p(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(p(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const L=p(e,["safetySettings"]);if(t!==void 0&&L!=null){let oe=L;Array.isArray(oe)&&(oe=oe.map(ce=>XL(ce))),v(t,["safetySettings"],oe)}const M=p(e,["tools"]);if(t!==void 0&&M!=null){let oe=Ur(M);Array.isArray(oe)&&(oe=oe.map(ce=>tb(kr(ce)))),v(t,["tools"],oe)}const P=p(e,["toolConfig"]);if(t!==void 0&&P!=null&&v(t,["toolConfig"],eb(P)),p(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const G=p(e,["cachedContent"]);t!==void 0&&G!=null&&v(t,["cachedContent"],xi(i,G));const N=p(e,["responseModalities"]);N!=null&&v(n,["responseModalities"],N);const $=p(e,["mediaResolution"]);$!=null&&v(n,["mediaResolution"],$);const U=p(e,["speechConfig"]);if(U!=null&&v(n,["speechConfig"],Wd(U)),p(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=p(e,["thinkingConfig"]);O!=null&&v(n,["thinkingConfig"],O);const J=p(e,["imageConfig"]);J!=null&&v(n,["imageConfig"],ML(J));const re=p(e,["enableEnhancedCivicAnswers"]);return re!=null&&v(n,["enableEnhancedCivicAnswers"],re),n}function rL(i,e,t){const n={},s=p(e,["systemInstruction"]);t!==void 0&&s!=null&&v(t,["systemInstruction"],Ot(s));const o=p(e,["temperature"]);o!=null&&v(n,["temperature"],o);const l=p(e,["topP"]);l!=null&&v(n,["topP"],l);const u=p(e,["topK"]);u!=null&&v(n,["topK"],u);const d=p(e,["candidateCount"]);d!=null&&v(n,["candidateCount"],d);const f=p(e,["maxOutputTokens"]);f!=null&&v(n,["maxOutputTokens"],f);const h=p(e,["stopSequences"]);h!=null&&v(n,["stopSequences"],h);const m=p(e,["responseLogprobs"]);m!=null&&v(n,["responseLogprobs"],m);const y=p(e,["logprobs"]);y!=null&&v(n,["logprobs"],y);const S=p(e,["presencePenalty"]);S!=null&&v(n,["presencePenalty"],S);const A=p(e,["frequencyPenalty"]);A!=null&&v(n,["frequencyPenalty"],A);const _=p(e,["seed"]);_!=null&&v(n,["seed"],_);const x=p(e,["responseMimeType"]);x!=null&&v(n,["responseMimeType"],x);const C=p(e,["responseSchema"]);C!=null&&v(n,["responseSchema"],Jd(C));const b=p(e,["responseJsonSchema"]);b!=null&&v(n,["responseJsonSchema"],b);const L=p(e,["routingConfig"]);L!=null&&v(n,["routingConfig"],L);const M=p(e,["modelSelectionConfig"]);M!=null&&v(n,["modelConfig"],M);const P=p(e,["safetySettings"]);if(t!==void 0&&P!=null){let F=P;Array.isArray(F)&&(F=F.map(Q=>Q)),v(t,["safetySettings"],F)}const G=p(e,["tools"]);if(t!==void 0&&G!=null){let F=Ur(G);Array.isArray(F)&&(F=F.map(Q=>QE(kr(Q)))),v(t,["tools"],F)}const N=p(e,["toolConfig"]);t!==void 0&&N!=null&&v(t,["toolConfig"],N);const $=p(e,["labels"]);t!==void 0&&$!=null&&v(t,["labels"],$);const U=p(e,["cachedContent"]);t!==void 0&&U!=null&&v(t,["cachedContent"],xi(i,U));const O=p(e,["responseModalities"]);O!=null&&v(n,["responseModalities"],O);const J=p(e,["mediaResolution"]);J!=null&&v(n,["mediaResolution"],J);const re=p(e,["speechConfig"]);re!=null&&v(n,["speechConfig"],Wd(re));const oe=p(e,["audioTimestamp"]);oe!=null&&v(n,["audioTimestamp"],oe);const ce=p(e,["thinkingConfig"]);ce!=null&&v(n,["thinkingConfig"],ce);const fe=p(e,["imageConfig"]);if(fe!=null&&v(n,["imageConfig"],wL(fe)),p(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function Yy(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let l=In(s);Array.isArray(l)&&(l=l.map(u=>fu(u))),v(t,["contents"],l)}const o=p(e,["config"]);return o!=null&&v(t,["generationConfig"],sL(i,o,t)),t}function Xy(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["contents"]);if(s!=null){let l=In(s);Array.isArray(l)&&(l=l.map(u=>u)),v(t,["contents"],l)}const o=p(e,["config"]);return o!=null&&v(t,["generationConfig"],rL(i,o,t)),t}function Jy(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(f=>CC(f))),v(e,["candidates"],d)}const s=p(i,["modelVersion"]);s!=null&&v(e,["modelVersion"],s);const o=p(i,["promptFeedback"]);o!=null&&v(e,["promptFeedback"],o);const l=p(i,["responseId"]);l!=null&&v(e,["responseId"],l);const u=p(i,["usageMetadata"]);return u!=null&&v(e,["usageMetadata"],u),e}function Wy(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["candidates"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>h)),v(e,["candidates"],f)}const s=p(i,["createTime"]);s!=null&&v(e,["createTime"],s);const o=p(i,["modelVersion"]);o!=null&&v(e,["modelVersion"],o);const l=p(i,["promptFeedback"]);l!=null&&v(e,["promptFeedback"],l);const u=p(i,["responseId"]);u!=null&&v(e,["responseId"],u);const d=p(i,["usageMetadata"]);return d!=null&&v(e,["usageMetadata"],d),e}function oL(i,e){const t={};if(p(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(p(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=p(i,["numberOfImages"]);e!==void 0&&n!=null&&v(e,["parameters","sampleCount"],n);const s=p(i,["aspectRatio"]);e!==void 0&&s!=null&&v(e,["parameters","aspectRatio"],s);const o=p(i,["guidanceScale"]);if(e!==void 0&&o!=null&&v(e,["parameters","guidanceScale"],o),p(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=p(i,["safetyFilterLevel"]);e!==void 0&&l!=null&&v(e,["parameters","safetySetting"],l);const u=p(i,["personGeneration"]);e!==void 0&&u!=null&&v(e,["parameters","personGeneration"],u);const d=p(i,["includeSafetyAttributes"]);e!==void 0&&d!=null&&v(e,["parameters","includeSafetyAttributes"],d);const f=p(i,["includeRaiReason"]);e!==void 0&&f!=null&&v(e,["parameters","includeRaiReason"],f);const h=p(i,["language"]);e!==void 0&&h!=null&&v(e,["parameters","language"],h);const m=p(i,["outputMimeType"]);e!==void 0&&m!=null&&v(e,["parameters","outputOptions","mimeType"],m);const y=p(i,["outputCompressionQuality"]);if(e!==void 0&&y!=null&&v(e,["parameters","outputOptions","compressionQuality"],y),p(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(p(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const S=p(i,["imageSize"]);if(e!==void 0&&S!=null&&v(e,["parameters","sampleImageSize"],S),p(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function aL(i,e){const t={},n=p(i,["outputGcsUri"]);e!==void 0&&n!=null&&v(e,["parameters","storageUri"],n);const s=p(i,["negativePrompt"]);e!==void 0&&s!=null&&v(e,["parameters","negativePrompt"],s);const o=p(i,["numberOfImages"]);e!==void 0&&o!=null&&v(e,["parameters","sampleCount"],o);const l=p(i,["aspectRatio"]);e!==void 0&&l!=null&&v(e,["parameters","aspectRatio"],l);const u=p(i,["guidanceScale"]);e!==void 0&&u!=null&&v(e,["parameters","guidanceScale"],u);const d=p(i,["seed"]);e!==void 0&&d!=null&&v(e,["parameters","seed"],d);const f=p(i,["safetyFilterLevel"]);e!==void 0&&f!=null&&v(e,["parameters","safetySetting"],f);const h=p(i,["personGeneration"]);e!==void 0&&h!=null&&v(e,["parameters","personGeneration"],h);const m=p(i,["includeSafetyAttributes"]);e!==void 0&&m!=null&&v(e,["parameters","includeSafetyAttributes"],m);const y=p(i,["includeRaiReason"]);e!==void 0&&y!=null&&v(e,["parameters","includeRaiReason"],y);const S=p(i,["language"]);e!==void 0&&S!=null&&v(e,["parameters","language"],S);const A=p(i,["outputMimeType"]);e!==void 0&&A!=null&&v(e,["parameters","outputOptions","mimeType"],A);const _=p(i,["outputCompressionQuality"]);e!==void 0&&_!=null&&v(e,["parameters","outputOptions","compressionQuality"],_);const x=p(i,["addWatermark"]);e!==void 0&&x!=null&&v(e,["parameters","addWatermark"],x);const C=p(i,["labels"]);e!==void 0&&C!=null&&v(e,["labels"],C);const b=p(i,["imageSize"]);e!==void 0&&b!=null&&v(e,["parameters","sampleImageSize"],b);const L=p(i,["enhancePrompt"]);return e!==void 0&&L!=null&&v(e,["parameters","enhancePrompt"],L),t}function lL(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["prompt"]);s!=null&&v(t,["instances[0]","prompt"],s);const o=p(e,["config"]);return o!=null&&oL(o,t),t}function uL(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["prompt"]);s!=null&&v(t,["instances[0]","prompt"],s);const o=p(e,["config"]);return o!=null&&aL(o,t),t}function cL(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>AL(l))),v(e,["generatedImages"],o)}const s=p(i,["positivePromptSafetyAttributes"]);return s!=null&&v(e,["positivePromptSafetyAttributes"],JE(s)),e}function fL(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>du(l))),v(e,["generatedImages"],o)}const s=p(i,["positivePromptSafetyAttributes"]);return s!=null&&v(e,["positivePromptSafetyAttributes"],WE(s)),e}function dL(i,e){const t={},n=p(i,["numberOfVideos"]);if(e!==void 0&&n!=null&&v(e,["parameters","sampleCount"],n),p(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(p(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=p(i,["durationSeconds"]);if(e!==void 0&&s!=null&&v(e,["parameters","durationSeconds"],s),p(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=p(i,["aspectRatio"]);e!==void 0&&o!=null&&v(e,["parameters","aspectRatio"],o);const l=p(i,["resolution"]);e!==void 0&&l!=null&&v(e,["parameters","resolution"],l);const u=p(i,["personGeneration"]);if(e!==void 0&&u!=null&&v(e,["parameters","personGeneration"],u),p(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=p(i,["negativePrompt"]);e!==void 0&&d!=null&&v(e,["parameters","negativePrompt"],d);const f=p(i,["enhancePrompt"]);if(e!==void 0&&f!=null&&v(e,["parameters","enhancePrompt"],f),p(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=p(i,["lastFrame"]);e!==void 0&&h!=null&&v(e,["instances[0]","lastFrame"],hu(h));const m=p(i,["referenceImages"]);if(e!==void 0&&m!=null){let y=m;Array.isArray(y)&&(y=y.map(S=>gb(S))),v(e,["instances[0]","referenceImages"],y)}if(p(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(p(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function hL(i,e){const t={},n=p(i,["numberOfVideos"]);e!==void 0&&n!=null&&v(e,["parameters","sampleCount"],n);const s=p(i,["outputGcsUri"]);e!==void 0&&s!=null&&v(e,["parameters","storageUri"],s);const o=p(i,["fps"]);e!==void 0&&o!=null&&v(e,["parameters","fps"],o);const l=p(i,["durationSeconds"]);e!==void 0&&l!=null&&v(e,["parameters","durationSeconds"],l);const u=p(i,["seed"]);e!==void 0&&u!=null&&v(e,["parameters","seed"],u);const d=p(i,["aspectRatio"]);e!==void 0&&d!=null&&v(e,["parameters","aspectRatio"],d);const f=p(i,["resolution"]);e!==void 0&&f!=null&&v(e,["parameters","resolution"],f);const h=p(i,["personGeneration"]);e!==void 0&&h!=null&&v(e,["parameters","personGeneration"],h);const m=p(i,["pubsubTopic"]);e!==void 0&&m!=null&&v(e,["parameters","pubsubTopic"],m);const y=p(i,["negativePrompt"]);e!==void 0&&y!=null&&v(e,["parameters","negativePrompt"],y);const S=p(i,["enhancePrompt"]);e!==void 0&&S!=null&&v(e,["parameters","enhancePrompt"],S);const A=p(i,["generateAudio"]);e!==void 0&&A!=null&&v(e,["parameters","generateAudio"],A);const _=p(i,["lastFrame"]);e!==void 0&&_!=null&&v(e,["instances[0]","lastFrame"],Bn(_));const x=p(i,["referenceImages"]);if(e!==void 0&&x!=null){let L=x;Array.isArray(L)&&(L=L.map(M=>mb(M))),v(e,["instances[0]","referenceImages"],L)}const C=p(i,["mask"]);e!==void 0&&C!=null&&v(e,["instances[0]","mask"],hb(C));const b=p(i,["compressionQuality"]);return e!==void 0&&b!=null&&v(e,["parameters","compressionQuality"],b),t}function gL(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response","generateVideoResponse"]);return l!=null&&v(e,["response"],vL(l)),e}function mL(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response"]);return l!=null&&v(e,["response"],EL(l)),e}function pL(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["prompt"]);s!=null&&v(t,["instances[0]","prompt"],s);const o=p(e,["image"]);o!=null&&v(t,["instances[0]","image"],hu(o));const l=p(e,["video"]);l!=null&&v(t,["instances[0]","video"],ZE(l));const u=p(e,["source"]);u!=null&&TL(u,t);const d=p(e,["config"]);return d!=null&&dL(d,t),t}function yL(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["prompt"]);s!=null&&v(t,["instances[0]","prompt"],s);const o=p(e,["image"]);o!=null&&v(t,["instances[0]","image"],Bn(o));const l=p(e,["video"]);l!=null&&v(t,["instances[0]","video"],jE(l));const u=p(e,["source"]);u!=null&&SL(u,t);const d=p(e,["config"]);return d!=null&&hL(d,t),t}function vL(i){const e={},t=p(i,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>xL(l))),v(e,["generatedVideos"],o)}const n=p(i,["raiMediaFilteredCount"]);n!=null&&v(e,["raiMediaFilteredCount"],n);const s=p(i,["raiMediaFilteredReasons"]);return s!=null&&v(e,["raiMediaFilteredReasons"],s),e}function EL(i){const e={},t=p(i,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>RL(l))),v(e,["generatedVideos"],o)}const n=p(i,["raiMediaFilteredCount"]);n!=null&&v(e,["raiMediaFilteredCount"],n);const s=p(i,["raiMediaFilteredReasons"]);return s!=null&&v(e,["raiMediaFilteredReasons"],s),e}function TL(i,e){const t={},n=p(i,["prompt"]);e!==void 0&&n!=null&&v(e,["instances[0]","prompt"],n);const s=p(i,["image"]);e!==void 0&&s!=null&&v(e,["instances[0]","image"],hu(s));const o=p(i,["video"]);return e!==void 0&&o!=null&&v(e,["instances[0]","video"],ZE(o)),t}function SL(i,e){const t={},n=p(i,["prompt"]);e!==void 0&&n!=null&&v(e,["instances[0]","prompt"],n);const s=p(i,["image"]);e!==void 0&&s!=null&&v(e,["instances[0]","image"],Bn(s));const o=p(i,["video"]);return e!==void 0&&o!=null&&v(e,["instances[0]","video"],jE(o)),t}function AL(i){const e={},t=p(i,["_self"]);t!=null&&v(e,["image"],NL(t));const n=p(i,["raiFilteredReason"]);n!=null&&v(e,["raiFilteredReason"],n);const s=p(i,["_self"]);return s!=null&&v(e,["safetyAttributes"],JE(s)),e}function du(i){const e={},t=p(i,["_self"]);t!=null&&v(e,["image"],XE(t));const n=p(i,["raiFilteredReason"]);n!=null&&v(e,["raiFilteredReason"],n);const s=p(i,["_self"]);s!=null&&v(e,["safetyAttributes"],WE(s));const o=p(i,["prompt"]);return o!=null&&v(e,["enhancedPrompt"],o),e}function _L(i){const e={},t=p(i,["_self"]);t!=null&&v(e,["mask"],XE(t));const n=p(i,["labels"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>o)),v(e,["labels"],s)}return e}function xL(i){const e={},t=p(i,["video"]);return t!=null&&v(e,["video"],fb(t)),e}function RL(i){const e={},t=p(i,["_self"]);return t!=null&&v(e,["video"],db(t)),e}function IL(i){const e={},t=p(i,["modelSelectionConfig"]);t!=null&&v(e,["modelConfig"],t);const n=p(i,["responseJsonSchema"]);n!=null&&v(e,["responseJsonSchema"],n);const s=p(i,["audioTimestamp"]);s!=null&&v(e,["audioTimestamp"],s);const o=p(i,["candidateCount"]);o!=null&&v(e,["candidateCount"],o);const l=p(i,["enableAffectiveDialog"]);l!=null&&v(e,["enableAffectiveDialog"],l);const u=p(i,["frequencyPenalty"]);u!=null&&v(e,["frequencyPenalty"],u);const d=p(i,["logprobs"]);d!=null&&v(e,["logprobs"],d);const f=p(i,["maxOutputTokens"]);f!=null&&v(e,["maxOutputTokens"],f);const h=p(i,["mediaResolution"]);h!=null&&v(e,["mediaResolution"],h);const m=p(i,["presencePenalty"]);m!=null&&v(e,["presencePenalty"],m);const y=p(i,["responseLogprobs"]);y!=null&&v(e,["responseLogprobs"],y);const S=p(i,["responseMimeType"]);S!=null&&v(e,["responseMimeType"],S);const A=p(i,["responseModalities"]);A!=null&&v(e,["responseModalities"],A);const _=p(i,["responseSchema"]);_!=null&&v(e,["responseSchema"],_);const x=p(i,["routingConfig"]);x!=null&&v(e,["routingConfig"],x);const C=p(i,["seed"]);C!=null&&v(e,["seed"],C);const b=p(i,["speechConfig"]);b!=null&&v(e,["speechConfig"],b);const L=p(i,["stopSequences"]);L!=null&&v(e,["stopSequences"],L);const M=p(i,["temperature"]);M!=null&&v(e,["temperature"],M);const P=p(i,["thinkingConfig"]);P!=null&&v(e,["thinkingConfig"],P);const G=p(i,["topK"]);G!=null&&v(e,["topK"],G);const N=p(i,["topP"]);if(N!=null&&v(e,["topP"],N),p(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function CL(i,e){const t={},n=p(e,["model"]);return n!=null&&v(t,["_url","name"],$e(i,n)),t}function LL(i,e){const t={},n=p(e,["model"]);return n!=null&&v(t,["_url","name"],$e(i,n)),t}function bL(i){const e={};if(p(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=p(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function DL(i){const e={};if(p(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=p(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function ML(i){const e={},t=p(i,["aspectRatio"]);t!=null&&v(e,["aspectRatio"],t);const n=p(i,["imageSize"]);if(n!=null&&v(e,["imageSize"],n),p(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(p(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function wL(i){const e={},t=p(i,["aspectRatio"]);t!=null&&v(e,["aspectRatio"],t);const n=p(i,["imageSize"]);n!=null&&v(e,["imageSize"],n);const s=p(i,["outputMimeType"]);s!=null&&v(e,["imageOutputOptions","mimeType"],s);const o=p(i,["outputCompressionQuality"]);return o!=null&&v(e,["imageOutputOptions","compressionQuality"],o),e}function NL(i){const e={},t=p(i,["bytesBase64Encoded"]);t!=null&&v(e,["imageBytes"],ss(t));const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function XE(i){const e={},t=p(i,["gcsUri"]);t!=null&&v(e,["gcsUri"],t);const n=p(i,["bytesBase64Encoded"]);n!=null&&v(e,["imageBytes"],ss(n));const s=p(i,["mimeType"]);return s!=null&&v(e,["mimeType"],s),e}function hu(i){const e={};if(p(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=p(i,["imageBytes"]);t!=null&&v(e,["bytesBase64Encoded"],ss(t));const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function Bn(i){const e={},t=p(i,["gcsUri"]);t!=null&&v(e,["gcsUri"],t);const n=p(i,["imageBytes"]);n!=null&&v(e,["bytesBase64Encoded"],ss(n));const s=p(i,["mimeType"]);return s!=null&&v(e,["mimeType"],s),e}function PL(i,e,t){const n={},s=p(e,["pageSize"]);t!==void 0&&s!=null&&v(t,["_query","pageSize"],s);const o=p(e,["pageToken"]);t!==void 0&&o!=null&&v(t,["_query","pageToken"],o);const l=p(e,["filter"]);t!==void 0&&l!=null&&v(t,["_query","filter"],l);const u=p(e,["queryBase"]);return t!==void 0&&u!=null&&v(t,["_url","models_url"],$E(i,u)),n}function kL(i,e,t){const n={},s=p(e,["pageSize"]);t!==void 0&&s!=null&&v(t,["_query","pageSize"],s);const o=p(e,["pageToken"]);t!==void 0&&o!=null&&v(t,["_query","pageToken"],o);const l=p(e,["filter"]);t!==void 0&&l!=null&&v(t,["_query","filter"],l);const u=p(e,["queryBase"]);return t!==void 0&&u!=null&&v(t,["_url","models_url"],$E(i,u)),n}function UL(i,e){const t={},n=p(e,["config"]);return n!=null&&PL(i,n,t),t}function OL(i,e){const t={},n=p(e,["config"]);return n!=null&&kL(i,n,t),t}function FL(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["_self"]);if(s!=null){let o=VE(s);Array.isArray(o)&&(o=o.map(l=>pd(l))),v(e,["models"],o)}return e}function BL(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["_self"]);if(s!=null){let o=VE(s);Array.isArray(o)&&(o=o.map(l=>yd(l))),v(e,["models"],o)}return e}function GL(i){const e={},t=p(i,["maskMode"]);t!=null&&v(e,["maskMode"],t);const n=p(i,["segmentationClasses"]);n!=null&&v(e,["maskClasses"],n);const s=p(i,["maskDilation"]);return s!=null&&v(e,["dilation"],s),e}function pd(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["displayName"]);n!=null&&v(e,["displayName"],n);const s=p(i,["description"]);s!=null&&v(e,["description"],s);const o=p(i,["version"]);o!=null&&v(e,["version"],o);const l=p(i,["_self"]);l!=null&&v(e,["tunedModelInfo"],nb(l));const u=p(i,["inputTokenLimit"]);u!=null&&v(e,["inputTokenLimit"],u);const d=p(i,["outputTokenLimit"]);d!=null&&v(e,["outputTokenLimit"],d);const f=p(i,["supportedGenerationMethods"]);f!=null&&v(e,["supportedActions"],f);const h=p(i,["temperature"]);h!=null&&v(e,["temperature"],h);const m=p(i,["maxTemperature"]);m!=null&&v(e,["maxTemperature"],m);const y=p(i,["topP"]);y!=null&&v(e,["topP"],y);const S=p(i,["topK"]);S!=null&&v(e,["topK"],S);const A=p(i,["thinking"]);return A!=null&&v(e,["thinking"],A),e}function yd(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["displayName"]);n!=null&&v(e,["displayName"],n);const s=p(i,["description"]);s!=null&&v(e,["description"],s);const o=p(i,["versionId"]);o!=null&&v(e,["version"],o);const l=p(i,["deployedModels"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(y=>jC(y))),v(e,["endpoints"],m)}const u=p(i,["labels"]);u!=null&&v(e,["labels"],u);const d=p(i,["_self"]);d!=null&&v(e,["tunedModelInfo"],ib(d));const f=p(i,["defaultCheckpointId"]);f!=null&&v(e,["defaultCheckpointId"],f);const h=p(i,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>y)),v(e,["checkpoints"],m)}return e}function $L(i){const e={},t=p(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=p(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=p(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=p(i,["fileData"]);o!=null&&v(e,["fileData"],eL(o));const l=p(i,["functionCall"]);l!=null&&v(e,["functionCall"],tL(l));const u=p(i,["functionResponse"]);u!=null&&v(e,["functionResponse"],u);const d=p(i,["inlineData"]);d!=null&&v(e,["inlineData"],IC(d));const f=p(i,["text"]);f!=null&&v(e,["text"],f);const h=p(i,["thought"]);h!=null&&v(e,["thought"],h);const m=p(i,["thoughtSignature"]);m!=null&&v(e,["thoughtSignature"],m);const y=p(i,["videoMetadata"]);return y!=null&&v(e,["videoMetadata"],y),e}function VL(i){const e={},t=p(i,["productImage"]);return t!=null&&v(e,["image"],Bn(t)),e}function HL(i,e){const t={},n=p(i,["numberOfImages"]);e!==void 0&&n!=null&&v(e,["parameters","sampleCount"],n);const s=p(i,["baseSteps"]);e!==void 0&&s!=null&&v(e,["parameters","baseSteps"],s);const o=p(i,["outputGcsUri"]);e!==void 0&&o!=null&&v(e,["parameters","storageUri"],o);const l=p(i,["seed"]);e!==void 0&&l!=null&&v(e,["parameters","seed"],l);const u=p(i,["safetyFilterLevel"]);e!==void 0&&u!=null&&v(e,["parameters","safetySetting"],u);const d=p(i,["personGeneration"]);e!==void 0&&d!=null&&v(e,["parameters","personGeneration"],d);const f=p(i,["addWatermark"]);e!==void 0&&f!=null&&v(e,["parameters","addWatermark"],f);const h=p(i,["outputMimeType"]);e!==void 0&&h!=null&&v(e,["parameters","outputOptions","mimeType"],h);const m=p(i,["outputCompressionQuality"]);e!==void 0&&m!=null&&v(e,["parameters","outputOptions","compressionQuality"],m);const y=p(i,["enhancePrompt"]);e!==void 0&&y!=null&&v(e,["parameters","enhancePrompt"],y);const S=p(i,["labels"]);return e!==void 0&&S!=null&&v(e,["labels"],S),t}function qL(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["source"]);s!=null&&zL(s,t);const o=p(e,["config"]);return o!=null&&HL(o,t),t}function KL(i){const e={},t=p(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>du(s))),v(e,["generatedImages"],n)}return e}function zL(i,e){const t={},n=p(i,["prompt"]);e!==void 0&&n!=null&&v(e,["instances[0]","prompt"],n);const s=p(i,["personImage"]);e!==void 0&&s!=null&&v(e,["instances[0]","personImage","image"],Bn(s));const o=p(i,["productImages"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>VL(u))),v(e,["instances[0]","productImages"],l)}return t}function YL(i){const e={},t=p(i,["referenceImage"]);t!=null&&v(e,["referenceImage"],Bn(t));const n=p(i,["referenceId"]);n!=null&&v(e,["referenceId"],n);const s=p(i,["referenceType"]);s!=null&&v(e,["referenceType"],s);const o=p(i,["maskImageConfig"]);o!=null&&v(e,["maskImageConfig"],GL(o));const l=p(i,["controlImageConfig"]);l!=null&&v(e,["controlImageConfig"],NC(l));const u=p(i,["styleImageConfig"]);u!=null&&v(e,["styleImageConfig"],u);const d=p(i,["subjectImageConfig"]);return d!=null&&v(e,["subjectImageConfig"],d),e}function JE(i){const e={},t=p(i,["safetyAttributes","categories"]);t!=null&&v(e,["categories"],t);const n=p(i,["safetyAttributes","scores"]);n!=null&&v(e,["scores"],n);const s=p(i,["contentType"]);return s!=null&&v(e,["contentType"],s),e}function WE(i){const e={},t=p(i,["safetyAttributes","categories"]);t!=null&&v(e,["categories"],t);const n=p(i,["safetyAttributes","scores"]);n!=null&&v(e,["scores"],n);const s=p(i,["contentType"]);return s!=null&&v(e,["contentType"],s),e}function XL(i){const e={},t=p(i,["category"]);if(t!=null&&v(e,["category"],t),p(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=p(i,["threshold"]);return n!=null&&v(e,["threshold"],n),e}function JL(i){const e={},t=p(i,["image"]);return t!=null&&v(e,["image"],Bn(t)),e}function WL(i,e){const t={},n=p(i,["mode"]);e!==void 0&&n!=null&&v(e,["parameters","mode"],n);const s=p(i,["maxPredictions"]);e!==void 0&&s!=null&&v(e,["parameters","maxPredictions"],s);const o=p(i,["confidenceThreshold"]);e!==void 0&&o!=null&&v(e,["parameters","confidenceThreshold"],o);const l=p(i,["maskDilation"]);e!==void 0&&l!=null&&v(e,["parameters","maskDilation"],l);const u=p(i,["binaryColorThreshold"]);e!==void 0&&u!=null&&v(e,["parameters","binaryColorThreshold"],u);const d=p(i,["labels"]);return e!==void 0&&d!=null&&v(e,["labels"],d),t}function QL(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["source"]);s!=null&&jL(s,t);const o=p(e,["config"]);return o!=null&&WL(o,t),t}function ZL(i){const e={},t=p(i,["predictions"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>_L(s))),v(e,["generatedMasks"],n)}return e}function jL(i,e){const t={},n=p(i,["prompt"]);e!==void 0&&n!=null&&v(e,["instances[0]","prompt"],n);const s=p(i,["image"]);e!==void 0&&s!=null&&v(e,["instances[0]","image"],Bn(s));const o=p(i,["scribbleImage"]);return e!==void 0&&o!=null&&v(e,["instances[0]","scribble"],JL(o)),t}function eb(i){const e={},t=p(i,["functionCallingConfig"]);t!=null&&v(e,["functionCallingConfig"],nL(t));const n=p(i,["retrievalConfig"]);return n!=null&&v(e,["retrievalConfig"],n),e}function tb(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),v(e,["functionDeclarations"],h)}if(p(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=p(i,["googleSearchRetrieval"]);n!=null&&v(e,["googleSearchRetrieval"],n);const s=p(i,["computerUse"]);s!=null&&v(e,["computerUse"],s);const o=p(i,["fileSearch"]);o!=null&&v(e,["fileSearch"],o);const l=p(i,["codeExecution"]);if(l!=null&&v(e,["codeExecution"],l),p(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=p(i,["googleMaps"]);u!=null&&v(e,["googleMaps"],bL(u));const d=p(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],DL(d));const f=p(i,["urlContext"]);return f!=null&&v(e,["urlContext"],f),e}function QE(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(y=>iL(y))),v(e,["functionDeclarations"],m)}const n=p(i,["retrieval"]);n!=null&&v(e,["retrieval"],n);const s=p(i,["googleSearchRetrieval"]);s!=null&&v(e,["googleSearchRetrieval"],s);const o=p(i,["computerUse"]);if(o!=null&&v(e,["computerUse"],o),p(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=p(i,["codeExecution"]);l!=null&&v(e,["codeExecution"],l);const u=p(i,["enterpriseWebSearch"]);u!=null&&v(e,["enterpriseWebSearch"],u);const d=p(i,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=p(i,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=p(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function nb(i){const e={},t=p(i,["baseModel"]);t!=null&&v(e,["baseModel"],t);const n=p(i,["createTime"]);n!=null&&v(e,["createTime"],n);const s=p(i,["updateTime"]);return s!=null&&v(e,["updateTime"],s),e}function ib(i){const e={},t=p(i,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&v(e,["baseModel"],t);const n=p(i,["createTime"]);n!=null&&v(e,["createTime"],n);const s=p(i,["updateTime"]);return s!=null&&v(e,["updateTime"],s),e}function sb(i,e){const t={},n=p(i,["displayName"]);e!==void 0&&n!=null&&v(e,["displayName"],n);const s=p(i,["description"]);e!==void 0&&s!=null&&v(e,["description"],s);const o=p(i,["defaultCheckpointId"]);return e!==void 0&&o!=null&&v(e,["defaultCheckpointId"],o),t}function rb(i,e){const t={},n=p(i,["displayName"]);e!==void 0&&n!=null&&v(e,["displayName"],n);const s=p(i,["description"]);e!==void 0&&s!=null&&v(e,["description"],s);const o=p(i,["defaultCheckpointId"]);return e!==void 0&&o!=null&&v(e,["defaultCheckpointId"],o),t}function ob(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","name"],$e(i,n));const s=p(e,["config"]);return s!=null&&sb(s,t),t}function ab(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["config"]);return s!=null&&rb(s,t),t}function lb(i,e){const t={},n=p(i,["outputGcsUri"]);e!==void 0&&n!=null&&v(e,["parameters","storageUri"],n);const s=p(i,["safetyFilterLevel"]);e!==void 0&&s!=null&&v(e,["parameters","safetySetting"],s);const o=p(i,["personGeneration"]);e!==void 0&&o!=null&&v(e,["parameters","personGeneration"],o);const l=p(i,["includeRaiReason"]);e!==void 0&&l!=null&&v(e,["parameters","includeRaiReason"],l);const u=p(i,["outputMimeType"]);e!==void 0&&u!=null&&v(e,["parameters","outputOptions","mimeType"],u);const d=p(i,["outputCompressionQuality"]);e!==void 0&&d!=null&&v(e,["parameters","outputOptions","compressionQuality"],d);const f=p(i,["enhanceInputImage"]);e!==void 0&&f!=null&&v(e,["parameters","upscaleConfig","enhanceInputImage"],f);const h=p(i,["imagePreservationFactor"]);e!==void 0&&h!=null&&v(e,["parameters","upscaleConfig","imagePreservationFactor"],h);const m=p(i,["labels"]);e!==void 0&&m!=null&&v(e,["labels"],m);const y=p(i,["numberOfImages"]);e!==void 0&&y!=null&&v(e,["parameters","sampleCount"],y);const S=p(i,["mode"]);return e!==void 0&&S!=null&&v(e,["parameters","mode"],S),t}function ub(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["_url","model"],$e(i,n));const s=p(e,["image"]);s!=null&&v(t,["instances[0]","image"],Bn(s));const o=p(e,["upscaleFactor"]);o!=null&&v(t,["parameters","upscaleConfig","upscaleFactor"],o);const l=p(e,["config"]);return l!=null&&lb(l,t),t}function cb(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>du(o))),v(e,["generatedImages"],s)}return e}function fb(i){const e={},t=p(i,["uri"]);t!=null&&v(e,["uri"],t);const n=p(i,["encodedVideo"]);n!=null&&v(e,["videoBytes"],ss(n));const s=p(i,["encoding"]);return s!=null&&v(e,["mimeType"],s),e}function db(i){const e={},t=p(i,["gcsUri"]);t!=null&&v(e,["uri"],t);const n=p(i,["bytesBase64Encoded"]);n!=null&&v(e,["videoBytes"],ss(n));const s=p(i,["mimeType"]);return s!=null&&v(e,["mimeType"],s),e}function hb(i){const e={},t=p(i,["image"]);t!=null&&v(e,["_self"],Bn(t));const n=p(i,["maskMode"]);return n!=null&&v(e,["maskMode"],n),e}function gb(i){const e={},t=p(i,["image"]);t!=null&&v(e,["image"],hu(t));const n=p(i,["referenceType"]);return n!=null&&v(e,["referenceType"],n),e}function mb(i){const e={},t=p(i,["image"]);t!=null&&v(e,["image"],Bn(t));const n=p(i,["referenceType"]);return n!=null&&v(e,["referenceType"],n),e}function ZE(i){const e={},t=p(i,["uri"]);t!=null&&v(e,["uri"],t);const n=p(i,["videoBytes"]);n!=null&&v(e,["encodedVideo"],ss(n));const s=p(i,["mimeType"]);return s!=null&&v(e,["encoding"],s),e}function jE(i){const e={},t=p(i,["uri"]);t!=null&&v(e,["gcsUri"],t);const n=p(i,["videoBytes"]);n!=null&&v(e,["bytesBase64Encoded"],ss(n));const s=p(i,["mimeType"]);return s!=null&&v(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pb(i,e){const t={},n=p(i,["displayName"]);return e!==void 0&&n!=null&&v(e,["displayName"],n),t}function yb(i){const e={},t=p(i,["config"]);return t!=null&&pb(t,e),e}function vb(i,e){const t={},n=p(i,["force"]);return e!==void 0&&n!=null&&v(e,["_query","force"],n),t}function Eb(i){const e={},t=p(i,["name"]);t!=null&&v(e,["_url","name"],t);const n=p(i,["config"]);return n!=null&&vb(n,e),e}function Tb(i){const e={},t=p(i,["name"]);return t!=null&&v(e,["_url","name"],t),e}function Sb(i,e){const t={},n=p(i,["customMetadata"]);if(e!==void 0&&n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["customMetadata"],o)}const s=p(i,["chunkingConfig"]);return e!==void 0&&s!=null&&v(e,["chunkingConfig"],s),t}function Ab(i){const e={},t=p(i,["name"]);t!=null&&v(e,["name"],t);const n=p(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=p(i,["done"]);s!=null&&v(e,["done"],s);const o=p(i,["error"]);o!=null&&v(e,["error"],o);const l=p(i,["response"]);return l!=null&&v(e,["response"],xb(l)),e}function _b(i){const e={},t=p(i,["fileSearchStoreName"]);t!=null&&v(e,["_url","file_search_store_name"],t);const n=p(i,["fileName"]);n!=null&&v(e,["fileName"],n);const s=p(i,["config"]);return s!=null&&Sb(s,e),e}function xb(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["parent"]);n!=null&&v(e,["parent"],n);const s=p(i,["documentName"]);return s!=null&&v(e,["documentName"],s),e}function Rb(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function Ib(i){const e={},t=p(i,["config"]);return t!=null&&Rb(t,e),e}function Cb(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["fileSearchStores"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["fileSearchStores"],o)}return e}function eT(i,e){const t={},n=p(i,["mimeType"]);e!==void 0&&n!=null&&v(e,["mimeType"],n);const s=p(i,["displayName"]);e!==void 0&&s!=null&&v(e,["displayName"],s);const o=p(i,["customMetadata"]);if(e!==void 0&&o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>d)),v(e,["customMetadata"],u)}const l=p(i,["chunkingConfig"]);return e!==void 0&&l!=null&&v(e,["chunkingConfig"],l),t}function Lb(i){const e={},t=p(i,["fileSearchStoreName"]);t!=null&&v(e,["_url","file_search_store_name"],t);const n=p(i,["config"]);return n!=null&&eT(n,e),e}function bb(i){const e={},t=p(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Db="Content-Type",Mb="X-Server-Timeout",wb="User-Agent",vd="x-goog-api-client",Nb="1.34.0",Pb=`google-genai-sdk/${Nb}`,kb="v1beta1",Ub="v1beta";class Ob{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:kb,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Ub,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){const s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[l,u]of Object.entries(e.queryParams))s.searchParams.append(l,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,s.toString(),e.abortSignal),this.unaryApiCall(s,o,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[s,o]of Object.entries(t))typeof o=="object"?n[s]=Object.assign(Object.assign({},n[s]),o):o!==void 0&&(n[s]=o);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,s.toString(),e.abortSignal),this.streamApiCall(s,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){const o=new AbortController,l=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const u=setTimeout(()=>o.abort(),t.timeout);u&&typeof u.unref=="function"&&u.unref()}s&&s.addEventListener("abort",()=>{o.abort()}),e.signal=l}return t&&t.extraBody!==null&&Fb(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await Qy(s),new hd(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await Qy(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return On(this,arguments,function*(){var n;const s=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let l="";const u="data:",d=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:f,value:h}=yield xe(s.read());if(f){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=o.decode(h,{stream:!0});try{const A=JSON.parse(m);if("error"in A){const _=JSON.parse(JSON.stringify(A.error)),x=_.status,C=_.code,b=`got status: ${x}. ${JSON.stringify(A)}`;if(C>=400&&C<600)throw new cu({message:b,status:C})}}catch(A){if(A.name==="ApiError")throw A}l+=m;let y=-1,S=0;for(;;){y=-1,S=0;for(const x of d){const C=l.indexOf(x);C!==-1&&(y===-1||C<y)&&(y=C,S=x.length)}if(y===-1)break;const A=l.substring(0,y);l=l.substring(y+S);const _=A.trim();if(_.startsWith(u)){const x=_.substring(u.length).trim();try{const C=new Response(x,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield xe(new hd(C))}catch(C){throw new Error(`exception parsing stream chunk ${x}. ${C}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const e={},t=Pb+" "+this.clientOptions.userAgentExtra;return e[wb]=t,e[vd]=t,e[Db]="application/json",e}async getHeadersInternal(e,t){const n=new Headers;if(e&&e.headers){for(const[s,o]of Object.entries(e.headers))n.append(s,o);e.timeout&&e.timeout>0&&n.append(Mb,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const o=this.clientOptions.uploader,l=await o.stat(e);s.sizeBytes=String(l.size);const u=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=u;const d={file:s},f=this.getFileName(e),h=me("upload/v1beta/files",d._url),m=await this.fetchUploadUrl(h,s.sizeBytes,s.mimeType,f,d,t==null?void 0:t.httpOptions);return o.upload(e,m,this)}async uploadFileToFileSearchStore(e,t,n){var s;const o=this.clientOptions.uploader,l=await o.stat(t),u=String(l.size),d=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:l.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const f=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(t),m={};n!=null&&eT(n,m);const y=await this.fetchUploadUrl(f,u,d,h,m,n==null?void 0:n.httpOptions);return o.uploadToFileSearchStore(t,y,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,o,l){var u;let d={};l?d=l:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};const f=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:d});if(!f||!(f!=null&&f.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(u=f==null?void 0:f.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Qy(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){const t=i.status;let n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};const s=JSON.stringify(n);throw t>=400&&t<600?new cu({message:s,status:t}):new Error(s)}}function Fb(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{const o=JSON.parse(i.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(o,l){const u=Object.assign({},o);for(const d in l)if(Object.prototype.hasOwnProperty.call(l,d)){const f=l[d],h=u[d];f&&typeof f=="object"&&!Array.isArray(f)&&h&&typeof h=="object"&&!Array.isArray(h)?u[d]=n(h,f):(h&&f&&typeof h!=typeof f&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof h}, New type: ${typeof f}. Overwriting.`),u[d]=f)}return u}const s=n(t,e);i.body=JSON.stringify(s)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bb="mcp_used/unknown";let Gb=!1;function tT(i){for(const e of i)if($b(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Gb}function nT(i){var e;const t=(e=i[vd])!==null&&e!==void 0?e:"";i[vd]=(t+` ${Bb}`).trimStart()}function $b(i){return i!==null&&typeof i=="object"&&i instanceof Zd}function Vb(i){return On(this,arguments,function*(t,n=100){let s,o=0;for(;o<n;){const l=yield xe(t.listTools({cursor:s}));for(const u of l.tools)yield yield xe(u),o++;if(!l.nextCursor)break;s=l.nextCursor}})}class Zd{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Zd(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;const o={},l=[];for(const h of this.mcpClients)try{for(var u=!0,d=(t=void 0,Fn(Vb(h))),f;f=await d.next(),e=f.done,!e;u=!0){s=f.value,u=!1;const m=s;l.push(m);const y=m.name;if(o[y])throw new Error(`Duplicate function name ${y} found in MCP tools. Please ensure function names are unique.`);o[y]=h}}catch(m){t={error:m}}finally{try{!u&&!e&&(n=d.return)&&await n.call(d)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),TR(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const n of e)if(n.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[n.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const l=await s.callTool({name:n.name,arguments:n.args},void 0,o);t.push({functionResponse:{name:n.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Hb(i,e,t){const n=new dR;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}class qb{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),l=Yb(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${s}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${u}`;let f=()=>{};const h=new Promise(L=>{f=L}),m=e.callbacks,y=function(){f({})},S=this.apiClient,A={onopen:y,onmessage:L=>{Hb(S,m.onmessage,L)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function(L){},onclose:(n=m==null?void 0:m.onclose)!==null&&n!==void 0?n:function(L){}},_=this.webSocketFactory.create(d,zb(l),A);_.connect(),await h;const b={setup:{model:$e(this.apiClient,e.model)}};return _.send(JSON.stringify(b)),new Kb(_,this.apiClient)}}class Kb{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=yC(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=pC(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(xr.PLAY)}pause(){this.sendPlaybackControl(xr.PAUSE)}stop(){this.sendPlaybackControl(xr.STOP)}resetContext(){this.sendPlaybackControl(xr.RESET_CONTEXT)}close(){this.conn.close()}}function zb(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function Yb(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Xb="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Jb(i,e,t){const n=new fR;let s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;const o=JSON.parse(s);if(i.isVertexAI()){const l=TC(o);Object.assign(n,l)}else Object.assign(n,o);e(n)}class Wb{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new qb(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,o,l,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const d=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion();let h;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&tT(e.config.tools)&&nT(m);const y=eD(m);if(this.apiClient.isVertexAI())h=`${d}/ws/google.cloud.aiplatform.${f}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(y,h);else{const U=this.apiClient.getApiKey();let O="BidiGenerateContent",J="key";U!=null&&U.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),f!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),O="BidiGenerateContentConstrained",J="access_token"),h=`${d}/ws/google.ai.generativelanguage.${f}.GenerativeService.${O}?${J}=${U}`}let S=()=>{};const A=new Promise(U=>{S=U}),_=e.callbacks,x=function(){var U;(U=_==null?void 0:_.onopen)===null||U===void 0||U.call(_),S({})},C=this.apiClient,b={onopen:x,onmessage:U=>{Jb(C,_.onmessage,U)},onerror:(t=_==null?void 0:_.onerror)!==null&&t!==void 0?t:function(U){},onclose:(n=_==null?void 0:_.onclose)!==null&&n!==void 0?n:function(U){}},L=this.webSocketFactory.create(h,jb(y),b);L.connect(),await A;let M=$e(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&M.startsWith("publishers/")){const U=this.apiClient.getProject(),O=this.apiClient.getLocation();M=`projects/${U}/locations/${O}/`+M}let P={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Yl.AUDIO]}:e.config.responseModalities=[Yl.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const G=(u=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[],N=[];for(const U of G)if(this.isCallableTool(U)){const O=U;N.push(await O.tool())}else N.push(U);N.length>0&&(e.config.tools=N);const $={model:M,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?P=mC(this.apiClient,$):P=gC(this.apiClient,$),delete P.config,L.send(JSON.stringify(P)),new Zb(L,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const Qb={turnComplete:!0};class Zb{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=In(t.turns),e.isVertexAI()||(n=n.map(s=>fu(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(Xb)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Qb),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:EC(e)}:t={realtimeInput:vC(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function jb(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function eD(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zy=10;function jy(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const l of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(Lr(l)){s=!0;break}if(!s)return!0;const o=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Lr(i){return"callTool"in i&&typeof i.callTool=="function"}function tD(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>Lr(s)))!==null&&n!==void 0?n:!1}function ev(i){var e;const t=[];return!((e=i==null?void 0:i.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(Lr(n))return;const o=n;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(s)}),t}function tv(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nD extends _i{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,o,l,u;const d=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!tD(t)||jy(t.config))return await this.generateContentInternal(d);const f=ev(t);if(f.length>0){const _=f.map(x=>`tools[${x}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${_}.`)}let h,m;const y=In(d.contents),S=(o=(s=(n=d.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:Zy;let A=0;for(;A<S&&(h=await this.generateContentInternal(d),!(!h.functionCalls||h.functionCalls.length===0));){const _=h.candidates[0].content,x=[];for(const C of(u=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[])if(Lr(C)){const L=await C.callTool(h.functionCalls);x.push(...L)}A++,m={role:"user",parts:x},d.contents=In(d.contents),d.contents.push(_),d.contents.push(m),tv(d.config)&&(y.push(_),y.push(m))}return tv(d.config)&&(h.automaticFunctionCallingHistory=y),h},this.generateContentStream=async t=>{var n,s,o,l,u;if(this.maybeMoveToResponseJsonSchem(t),jy(t.config)){const m=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(m)}const d=ev(t);if(d.length>0){const m=d.map(y=>`tools[${y}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const f=(o=(s=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,h=(u=(l=t==null?void 0:t.config)===null||l===void 0?void 0:l.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(f&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let o;const l=[];if(n!=null&&n.generatedImages)for(const d of n.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((s=d==null?void 0:d.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?o=d==null?void 0:d.safetyAttributes:l.push(d);let u;return o?u={generatedImages:l,positivePromptSafetyAttributes:o,sdkHttpResponse:n.sdkHttpResponse}:u={generatedImages:l,sdkHttpResponse:n.sdkHttpResponse},u}),this.list=async t=>{var n;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((n=l.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Ds(Ai.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(l),l)},this.editImage=async t=>{const n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,o,l,u,d;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((l=(o=t.source)===null||o===void 0?void 0:o.video)===null||l===void 0)&&l.uri&&(!((d=(u=t.source)===null||u===void 0?void 0:u.video)===null||d===void 0)&&d.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;const o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;const l=await Promise.all(o.map(async d=>Lr(d)?await d.tool():d)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(u.config.tools=l,e.config&&e.config.tools&&tT(e.config.tools)){const d=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{};let f=Object.assign({},d);Object.keys(f).length===0&&(f=this.apiClient.getDefaultHeaders()),nT(f),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:f})}return u}async initAfcToolsMap(e){var t,n,s;const o=new Map;for(const l of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(Lr(l)){const u=l,d=await u.tool();for(const f of(s=d.functionDeclarations)!==null&&s!==void 0?s:[]){if(!f.name)throw new Error("Function declaration name is required.");if(o.has(f.name))throw new Error(`Duplicate tool declaration name: ${f.name}`);o.set(f.name,u)}}return o}async processAfcStream(e){var t,n,s;const o=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:Zy;let l=!1,u=0;const d=await this.initAfcToolsMap(e);return(function(f,h,m){return On(this,arguments,function*(){for(var y,S,A,_,x,C;u<o;){l&&(u++,l=!1);const P=yield xe(f.processParamsMaybeAddMcpUsage(m)),G=yield xe(f.generateContentStreamInternal(P)),N=[],$=[];try{for(var b=!0,L=(S=void 0,Fn(G)),M;M=yield xe(L.next()),y=M.done,!y;b=!0){_=M.value,b=!1;const U=_;if(yield yield xe(U),U.candidates&&(!((x=U.candidates[0])===null||x===void 0)&&x.content)){$.push(U.candidates[0].content);for(const O of(C=U.candidates[0].content.parts)!==null&&C!==void 0?C:[])if(u<o&&O.functionCall){if(!O.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(O.functionCall.name)){const J=yield xe(h.get(O.functionCall.name).callTool([O.functionCall]));N.push(...J)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${O.functionCall.name}`)}}}}catch(U){S={error:U}}finally{try{!b&&!y&&(A=L.return)&&(yield xe(A.call(L)))}finally{if(S)throw S.error}}if(N.length>0){l=!0;const U=new Uo;U.candidates=[{content:{role:"user",parts:N}}],yield yield xe(U);const O=[];O.push(...$),O.push({role:"user",parts:N});const J=In(m.contents).concat(O);m.contents=J}else break}})})(this,d,e)}async generateContentInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=Xy(this.apiClient,e);return u=me("{model}:generateContent",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=Wy(h),y=new Uo;return Object.assign(y,m),y})}else{const f=Yy(this.apiClient,e);return u=me("{model}:generateContent",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=Jy(h),y=new Uo;return Object.assign(y,m),y})}}async generateContentStreamInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=Xy(this.apiClient,e);return u=me("{model}:streamGenerateContent?alt=sse",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),l.then(function(m){return On(this,arguments,function*(){var y,S,A,_;try{for(var x=!0,C=Fn(m),b;b=yield xe(C.next()),y=b.done,!y;x=!0){_=b.value,x=!1;const L=_,M=Wy(yield xe(L.json()));M.sdkHttpResponse={headers:L.headers};const P=new Uo;Object.assign(P,M),yield yield xe(P)}}catch(L){S={error:L}}finally{try{!x&&!y&&(A=C.return)&&(yield xe(A.call(C)))}finally{if(S)throw S.error}}})})}else{const f=Yy(this.apiClient,e);return u=me("{model}:streamGenerateContent?alt=sse",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(m){return On(this,arguments,function*(){var y,S,A,_;try{for(var x=!0,C=Fn(m),b;b=yield xe(C.next()),y=b.done,!y;x=!0){_=b.value,x=!1;const L=_,M=Jy(yield xe(L.json()));M.sdkHttpResponse={headers:L.headers};const P=new Uo;Object.assign(P,M),yield yield xe(P)}}catch(L){S={error:L}}finally{try{!x&&!y&&(A=C.return)&&(yield xe(A.call(C)))}finally{if(S)throw S.error}}})})}}async embedContent(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=WC(this.apiClient,e);return u=me("{model}:predict",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=ZC(h),y=new Dy;return Object.assign(y,m),y})}else{const f=JC(this.apiClient,e);return u=me("{model}:batchEmbedContents",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=QC(h),y=new Dy;return Object.assign(y,m),y})}}async generateImagesInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=uL(this.apiClient,e);return u=me("{model}:predict",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=fL(h),y=new My;return Object.assign(y,m),y})}else{const f=lL(this.apiClient,e);return u=me("{model}:predict",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=cL(h),y=new My;return Object.assign(y,m),y})}}async editImageInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=KC(this.apiClient,e);return o=me("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>{const f=zC(d),h=new eR;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=ub(this.apiClient,e);return o=me("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>{const f=cb(d),h=new tR;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=qL(this.apiClient,e);return o=me("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=KL(d),h=new nR;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=QL(this.apiClient,e);return o=me("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=ZL(d),h=new iR;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=LL(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>yd(h))}else{const f=CL(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>pd(h))}}async listInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=OL(this.apiClient,e);return u=me("{models_url}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=BL(h),y=new wy;return Object.assign(y,m),y})}else{const f=UL(this.apiClient,e);return u=me("{models_url}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=FL(h),y=new wy;return Object.assign(y,m),y})}}async update(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=ab(this.apiClient,e);return u=me("{model}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>yd(h))}else{const f=ob(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>pd(h))}}async delete(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=$C(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=HC(h),y=new Ny;return Object.assign(y,m),y})}else{const f=GC(this.apiClient,e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=VC(h),y=new Ny;return Object.assign(y,m),y})}}async countTokens(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=OC(this.apiClient,e);return u=me("{model}:countTokens",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=BC(h),y=new Py;return Object.assign(y,m),y})}else{const f=UC(this.apiClient,e);return u=me("{model}:countTokens",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=FC(h),y=new Py;return Object.assign(y,m),y})}}async computeTokens(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=bC(this.apiClient,e);return o=me("{model}:computeTokens",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>{const f=DC(d),h=new sR;return Object.assign(h,f),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=yL(this.apiClient,e);return u=me("{model}:predictLongRunning",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l.then(h=>{const m=mL(h),y=new Xl;return Object.assign(y,m),y})}else{const f=pL(this.apiClient,e);return u=me("{model}:predictLongRunning",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l.then(h=>{const m=gL(h),y=new Xl;return Object.assign(y,m),y})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class iD extends _i{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;n&&"httpOptions"in n&&(o=n.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;n&&"httpOptions"in n&&(o=n.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=Xx(e);return u=me("{operationName}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),l}else{const f=Yx(e);return u=me("{operationName}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),l}}async fetchPredictVideosOperationInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=Gx(e);return o=me("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sD(i){const e={},t=p(i,["data"]);if(t!=null&&v(e,["data"],t),p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function rD(i){const e={},t=p(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>gD(o))),v(e,["parts"],s)}const n=p(i,["role"]);return n!=null&&v(e,["role"],n),e}function oD(i,e,t){const n={},s=p(e,["expireTime"]);t!==void 0&&s!=null&&v(t,["expireTime"],s);const o=p(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&v(t,["newSessionExpireTime"],o);const l=p(e,["uses"]);t!==void 0&&l!=null&&v(t,["uses"],l);const u=p(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&v(t,["bidiGenerateContentSetup"],hD(i,u));const d=p(e,["lockAdditionalFields"]);return t!==void 0&&d!=null&&v(t,["fieldMask"],d),n}function aD(i,e){const t={},n=p(e,["config"]);return n!=null&&v(t,["config"],oD(i,n,t)),t}function lD(i){const e={};if(p(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=p(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=p(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function uD(i){const e={},t=p(i,["id"]);t!=null&&v(e,["id"],t);const n=p(i,["args"]);n!=null&&v(e,["args"],n);const s=p(i,["name"]);if(s!=null&&v(e,["name"],s),p(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(p(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function cD(i){const e={};if(p(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=p(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function fD(i){const e={};if(p(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=p(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function dD(i,e){const t={},n=p(i,["generationConfig"]);e!==void 0&&n!=null&&v(e,["setup","generationConfig"],n);const s=p(i,["responseModalities"]);e!==void 0&&s!=null&&v(e,["setup","generationConfig","responseModalities"],s);const o=p(i,["temperature"]);e!==void 0&&o!=null&&v(e,["setup","generationConfig","temperature"],o);const l=p(i,["topP"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","topP"],l);const u=p(i,["topK"]);e!==void 0&&u!=null&&v(e,["setup","generationConfig","topK"],u);const d=p(i,["maxOutputTokens"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","maxOutputTokens"],d);const f=p(i,["mediaResolution"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","mediaResolution"],f);const h=p(i,["seed"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","seed"],h);const m=p(i,["speechConfig"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","speechConfig"],Qd(m));const y=p(i,["thinkingConfig"]);e!==void 0&&y!=null&&v(e,["setup","generationConfig","thinkingConfig"],y);const S=p(i,["enableAffectiveDialog"]);e!==void 0&&S!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],S);const A=p(i,["systemInstruction"]);e!==void 0&&A!=null&&v(e,["setup","systemInstruction"],rD(Ot(A)));const _=p(i,["tools"]);if(e!==void 0&&_!=null){let G=Ur(_);Array.isArray(G)&&(G=G.map(N=>pD(kr(N)))),v(e,["setup","tools"],G)}const x=p(i,["sessionResumption"]);e!==void 0&&x!=null&&v(e,["setup","sessionResumption"],mD(x));const C=p(i,["inputAudioTranscription"]);e!==void 0&&C!=null&&v(e,["setup","inputAudioTranscription"],C);const b=p(i,["outputAudioTranscription"]);e!==void 0&&b!=null&&v(e,["setup","outputAudioTranscription"],b);const L=p(i,["realtimeInputConfig"]);e!==void 0&&L!=null&&v(e,["setup","realtimeInputConfig"],L);const M=p(i,["contextWindowCompression"]);e!==void 0&&M!=null&&v(e,["setup","contextWindowCompression"],M);const P=p(i,["proactivity"]);if(e!==void 0&&P!=null&&v(e,["setup","proactivity"],P),p(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function hD(i,e){const t={},n=p(e,["model"]);n!=null&&v(t,["setup","model"],$e(i,n));const s=p(e,["config"]);return s!=null&&v(t,["config"],dD(s,t)),t}function gD(i){const e={},t=p(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=p(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=p(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=p(i,["fileData"]);o!=null&&v(e,["fileData"],lD(o));const l=p(i,["functionCall"]);l!=null&&v(e,["functionCall"],uD(l));const u=p(i,["functionResponse"]);u!=null&&v(e,["functionResponse"],u);const d=p(i,["inlineData"]);d!=null&&v(e,["inlineData"],sD(d));const f=p(i,["text"]);f!=null&&v(e,["text"],f);const h=p(i,["thought"]);h!=null&&v(e,["thought"],h);const m=p(i,["thoughtSignature"]);m!=null&&v(e,["thoughtSignature"],m);const y=p(i,["videoMetadata"]);return y!=null&&v(e,["videoMetadata"],y),e}function mD(i){const e={},t=p(i,["handle"]);if(t!=null&&v(e,["handle"],t),p(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function pD(i){const e={},t=p(i,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),v(e,["functionDeclarations"],h)}if(p(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=p(i,["googleSearchRetrieval"]);n!=null&&v(e,["googleSearchRetrieval"],n);const s=p(i,["computerUse"]);s!=null&&v(e,["computerUse"],s);const o=p(i,["fileSearch"]);o!=null&&v(e,["fileSearch"],o);const l=p(i,["codeExecution"]);if(l!=null&&v(e,["codeExecution"],l),p(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=p(i,["googleMaps"]);u!=null&&v(e,["googleMaps"],cD(u));const d=p(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],fD(d));const f=p(i,["urlContext"]);return f!=null&&v(e,["urlContext"],f),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yD(i){const e=[];for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){const s=Object.keys(n).map(o=>`${t}.${o}`);e.push(...s)}else e.push(t)}return e.join(",")}function vD(i,e){let t=null;const n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){const o=n.setup;typeof o=="object"&&o!==null?(i.bidiGenerateContentSetup=o,t=o):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;const s=i.fieldMask;if(t){const o=yD(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?i.fieldMask=o:delete i.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];s.length>0&&(u=s.map(f=>l.includes(f)?`generationConfig.${f}`:f));const d=[];o&&d.push(o),u.length>0&&d.push(...u),d.length>0?i.fieldMask=d.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}class ED extends _i{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=aD(this.apiClient,e);o=me("auth_tokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query;const d=vD(u,e.config);return s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),s.then(f=>f)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TD(i,e){const t={},n=p(i,["force"]);return e!==void 0&&n!=null&&v(e,["_query","force"],n),t}function SD(i){const e={},t=p(i,["name"]);t!=null&&v(e,["_url","name"],t);const n=p(i,["config"]);return n!=null&&TD(n,e),e}function AD(i){const e={},t=p(i,["name"]);return t!=null&&v(e,["_url","name"],t),e}function _D(i,e){const t={},n=p(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=p(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function xD(i){const e={},t=p(i,["parent"]);t!=null&&v(e,["_url","parent"],t);const n=p(i,["config"]);return n!=null&&_D(n,e),e}function RD(i){const e={},t=p(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=p(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=p(i,["documents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ID extends _i{constructor(e){super(),this.apiClient=e,this.list=async t=>new Ds(Ai.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=AD(e);return o=me("{name}",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async delete(e){var t,n;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=SD(e);s=me("{name}",l._url),o=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=xD(e);return o=me("{parent}/documents",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=RD(d),h=new rR;return Object.assign(h,f),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CD extends _i{constructor(e,t=new ID(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new Ds(Ai.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=yb(e);return o=me("fileSearchStores",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async get(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Tb(e);return o=me("{name}",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async delete(e){var t,n;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Eb(e);s=me("{name}",l._url),o=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Ib(e);return o=me("fileSearchStores",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=Cb(d),h=new oR;return Object.assign(h,f),h})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Lb(e);return o=me("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=bb(d),h=new aR;return Object.assign(h,f),h})}}async importFile(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=_b(e);return o=me("{file_search_store_name}:importFile",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const f=Ab(d),h=new zd;return Object.assign(h,f),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let iT=function(){const{crypto:i}=globalThis;if(i!=null&&i.randomUUID)return iT=i.randomUUID.bind(i),i.randomUUID();const e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};const LD=()=>iT();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ed(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}const Td=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){const e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Cn extends Error{}class Ht extends Cn{constructor(e,t,n,s){super(`${Ht.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new gu({message:n,cause:Td(t)});const o=t;return e===400?new rT(e,o,n,s):e===401?new oT(e,o,n,s):e===403?new aT(e,o,n,s):e===404?new lT(e,o,n,s):e===409?new uT(e,o,n,s):e===422?new cT(e,o,n,s):e===429?new fT(e,o,n,s):e>=500?new dT(e,o,n,s):new Ht(e,o,n,s)}}class Sd extends Ht{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class gu extends Ht{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class sT extends gu{constructor({message:e}={}){super({message:e??"Request timed out."})}}class rT extends Ht{}class oT extends Ht{}class aT extends Ht{}class lT extends Ht{}class uT extends Ht{}class cT extends Ht{}class fT extends Ht{}class dT extends Ht{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bD=/^[a-z][a-z0-9+.-]*:/i,DD=i=>bD.test(i);let Ad=i=>(Ad=Array.isArray,Ad(i));const MD=Ad;let wD=MD;const nv=wD;function ND(i){if(!i)return!0;for(const e in i)return!1;return!0}function PD(i,e){return Object.prototype.hasOwnProperty.call(i,e)}const kD=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Cn(`${i} must be an integer`);if(e<0)throw new Cn(`${i} must be a positive integer`);return e},UD=i=>{try{return JSON.parse(i)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const OD=i=>new Promise(e=>setTimeout(e,i));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ar="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function FD(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const BD=()=>{var i,e,t,n,s;const o=FD();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":sv(Deno.build.os),"X-Stainless-Arch":iv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":sv((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":iv((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};const l=GD();return l?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${l.browser}`,"X-Stainless-Runtime-Version":l.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function GD(){if(typeof navigator>"u"||!navigator)return null;const i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of i){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,o=n[2]||0,l=n[3]||0;return{browser:e,version:`${s}.${o}.${l}`}}}return null}const iv=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",sv=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown");let yl;const $D=()=>yl??(yl=BD());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function VD(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function hT(...i){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function HD(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return hT({start(){},async pull(t){const{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function gT(i){if(i[Symbol.asyncIterator])return i;const e=i.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function qD(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const n=i.getReader(),s=n.cancel();n.releaseLock(),await s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const KD=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mT=()=>{var i;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((i=e==null?void 0:e.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Bf(i,e,t){return mT(),new File(i,e??"unknown_file",t)}function zD(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}const YD=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pT=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",XD=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&pT(i),JD=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function WD(i,e,t){if(mT(),i=await i,XD(i))return i instanceof File?i:Bf([await i.arrayBuffer()],i.name);if(JD(i)){const s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),Bf(await _d(s),e,t)}const n=await _d(i);if(e||(e=zD(i)),!(t!=null&&t.type)){const s=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return Bf(n,e,t)}async function _d(i){var e,t,n,s,o;let l=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)l.push(i);else if(pT(i))l.push(i instanceof Blob?i:await i.arrayBuffer());else if(YD(i))try{for(var u=!0,d=Fn(i),f;f=await d.next(),e=f.done,!e;u=!0){s=f.value,u=!1;const h=s;l.push(...await _d(h))}}catch(h){t={error:h}}finally{try{!u&&!e&&(n=d.return)&&await n.call(d)}finally{if(t)throw t.error}}else{const h=(o=i==null?void 0:i.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof i}${h?`; constructor: ${h}`:""}${QD(i)}`)}return l}function QD(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yT{constructor(e){this._client=e}}yT._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vT(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const rv=Object.freeze(Object.create(null)),ZD=(i=vT)=>(function(t,...n){if(t.length===1)return t[0];let s=!1;const o=[],l=t.reduce((h,m,y)=>{var S,A,_;/[?#]/.test(m)&&(s=!0);const x=n[y];let C=(s?encodeURIComponent:i)(""+x);return y!==n.length&&(x==null||typeof x=="object"&&x.toString===((_=Object.getPrototypeOf((A=Object.getPrototypeOf((S=x.hasOwnProperty)!==null&&S!==void 0?S:rv))!==null&&A!==void 0?A:rv))===null||_===void 0?void 0:_.toString))&&(C=x+"",o.push({start:h.length+m.length,length:C.length,error:`Value of type ${Object.prototype.toString.call(x).slice(8,-1)} is not a valid path parameter`})),h+m+(y===n.length?"":C)},""),u=l.split(/[?#]/,1)[0],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let f;for(;(f=d.exec(u))!==null;)o.push({start:f.index,length:f[0].length,error:`Value "${f[0]}" can't be safely passed as a path parameter`});if(o.sort((h,m)=>h.start-m.start),o.length>0){let h=0;const m=o.reduce((y,S)=>{const A=" ".repeat(S.start-h),_="^".repeat(S.length);return h=S.start+S.length,y+A+_},"");throw new Cn(`Path parameters result in path with invalid segments:
${o.map(y=>y.error).join(`
`)}
${l}
${m}`)}return l}),vl=ZD(vT);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ET extends yT{create(e,t){var n;const{api_version:s=this._client.apiVersion}=e,o=Wl(e,["api_version"]);if("model"in o&&"agent_config"in o)throw new Cn("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new Cn("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(vl`/${s}/interactions`,Object.assign(Object.assign({body:o},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){const{api_version:s=this._client.apiVersion}=t??{};return this._client.delete(vl`/${s}/interactions/${e}`,n)}cancel(e,t={},n){const{api_version:s=this._client.apiVersion}=t??{};return this._client.post(vl`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;const o=t??{},{api_version:l=this._client.apiVersion}=o,u=Wl(o,["api_version"]);return this._client.get(vl`/${l}/interactions/${e}`,Object.assign(Object.assign({query:u},n),{stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1}))}}ET._key=Object.freeze(["interactions"]);class TT extends ET{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jD(i){let e=0;for(const s of i)e+=s.length;const t=new Uint8Array(e);let n=0;for(const s of i)t.set(s,n),n+=s.length;return t}let El;function jd(i){let e;return(El??(e=new globalThis.TextEncoder,El=e.encode.bind(e)))(i)}let Tl;function ov(i){let e;return(Tl??(e=new globalThis.TextDecoder,Tl=e.decode.bind(e)))(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mu{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?jd(e):e;this.buffer=jD([this.buffer,t]);const n=[];let s;for(;(s=e1(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(ov(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const o=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,l=ov(this.buffer.subarray(0,o));n.push(l),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}}mu.NEWLINE_CHARS=new Set([`
`,"\r"]);mu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function e1(i,e){for(let s=e??0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function t1(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ql={off:0,error:200,warn:300,info:400,debug:500},av=(i,e,t)=>{if(i){if(PD(Ql,i))return i;$t(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Ql))}`)}};function Bo(){}function Sl(i,e,t){return!e||Ql[i]>Ql[t]?Bo:e[i].bind(e)}const n1={error:Bo,warn:Bo,info:Bo,debug:Bo};let lv=new WeakMap;function $t(i){var e;const t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return n1;const s=lv.get(t);if(s&&s[0]===n)return s[1];const o={error:Sl("error",t,n),warn:Sl("warn",t,n),info:Sl("info",t,n),debug:Sl("debug",t,n)};return lv.set(t,[n,o]),o}const Is=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rr{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1;const o=n?$t(n):console;function l(){return On(this,arguments,function*(){var d,f,h,m;if(s)throw new Cn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let y=!1;try{try{for(var S=!0,A=Fn(i1(e,t)),_;_=yield xe(A.next()),d=_.done,!d;S=!0){m=_.value,S=!1;const x=m;if(!y)if(x.data.startsWith("[DONE]")){y=!0;continue}else try{yield yield xe(JSON.parse(x.data))}catch(C){throw o.error("Could not parse message into JSON:",x.data),o.error("From chunk:",x.raw),C}}}catch(x){f={error:x}}finally{try{!S&&!d&&(h=A.return)&&(yield xe(h.call(A)))}finally{if(f)throw f.error}}y=!0}catch(x){if(Ed(x))return yield xe(void 0);throw x}finally{y||t.abort()}})}return new Rr(l,t,n)}static fromReadableStream(e,t,n){let s=!1;function o(){return On(this,arguments,function*(){var d,f,h,m;const y=new mu,S=gT(e);try{for(var A=!0,_=Fn(S),x;x=yield xe(_.next()),d=x.done,!d;A=!0){m=x.value,A=!1;const C=m;for(const b of y.decode(C))yield yield xe(b)}}catch(C){f={error:C}}finally{try{!A&&!d&&(h=_.return)&&(yield xe(h.call(_)))}finally{if(f)throw f.error}}for(const C of y.flush())yield yield xe(C)})}function l(){return On(this,arguments,function*(){var d,f,h,m;if(s)throw new Cn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let y=!1;try{try{for(var S=!0,A=Fn(o()),_;_=yield xe(A.next()),d=_.done,!d;S=!0){m=_.value,S=!1;const x=m;y||x&&(yield yield xe(JSON.parse(x)))}}catch(x){f={error:x}}finally{try{!S&&!d&&(h=A.return)&&(yield xe(h.call(A)))}finally{if(f)throw f.error}}y=!0}catch(x){if(Ed(x))return yield xe(void 0);throw x}finally{y||t.abort()}})}return new Rr(l,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=o=>({next:()=>{if(o.length===0){const l=n.next();e.push(l),t.push(l)}return o.shift()}});return[new Rr(()=>s(e),this.controller,this.client),new Rr(()=>s(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return hT({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:s,done:o}=await t.next();if(o)return n.close();const l=jd(JSON.stringify(s)+`
`);n.enqueue(l)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}}function i1(i,e){return On(this,arguments,function*(){var n,s,o,l;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Cn("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Cn("Attempted to iterate over a response with no body");const u=new r1,d=new mu,f=gT(i.body);try{for(var h=!0,m=Fn(s1(f)),y;y=yield xe(m.next()),n=y.done,!n;h=!0){l=y.value,h=!1;const S=l;for(const A of d.decode(S)){const _=u.decode(A);_&&(yield yield xe(_))}}}catch(S){s={error:S}}finally{try{!h&&!n&&(o=m.return)&&(yield xe(o.call(m)))}finally{if(s)throw s.error}}for(const S of d.flush()){const A=u.decode(S);A&&(yield yield xe(A))}})}function s1(i){return On(this,arguments,function*(){var t,n,s,o;let l=new Uint8Array;try{for(var u=!0,d=Fn(i),f;f=yield xe(d.next()),t=f.done,!t;u=!0){o=f.value,u=!1;const h=o;if(h==null)continue;const m=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?jd(h):h;let y=new Uint8Array(l.length+m.length);y.set(l),y.set(m,l.length),l=y;let S;for(;(S=t1(l))!==-1;)yield yield xe(l.slice(0,S)),l=l.slice(S)}}catch(h){n={error:h}}finally{try{!u&&!t&&(s=d.return)&&(yield xe(s.call(d)))}finally{if(n)throw n.error}}l.length>0&&(yield yield xe(l))})}class r1{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=o1(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function o1(i,e){const t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function a1(i,e){const{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:o}=e,l=await(async()=>{var u;if(e.options.stream)return $t(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):Rr.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type"),f=(u=d==null?void 0:d.split(";")[0])===null||u===void 0?void 0:u.trim();return(f==null?void 0:f.includes("application/json"))||(f==null?void 0:f.endsWith("+json"))?await t.json():await t.text()})();return $t(i).debug(`[${n}] response parsed`,Is({retryOfRequestLogID:s,url:t.url,status:t.status,body:l,durationMs:Date.now()-o})),l}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class eh extends Promise{constructor(e,t,n=a1){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new eh(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ST=Symbol("brand.privateNullableHeaders");function*l1(i){if(!i)return;if(ST in i){const{values:n,nulls:s}=i;yield*n.entries();for(const o of s)yield[o,null];return}let e=!1,t;i instanceof Headers?t=i.entries():nv(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){const s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const o=nv(n[1])?n[1]:[n[1]];let l=!1;for(const u of o)u!==void 0&&(e&&!l&&(l=!0,yield[s,null]),yield[s,u])}}const Oo=i=>{const e=new Headers,t=new Set;for(const n of i){const s=new Set;for(const[o,l]of l1(n)){const u=o.toLowerCase();s.has(u)||(e.delete(o),s.add(u)),l===null?(e.delete(o),t.add(u)):(e.append(o,l),t.delete(u))}}return{[ST]:!0,values:e,nulls:t}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Gf=i=>{var e,t,n,s,o,l;if(typeof globalThis.process<"u")return(n=(t=(e=Px)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(l=(o=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||o===void 0?void 0:o.call(s,i))===null||l===void 0?void 0:l.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var AT;class pu{constructor(e){var t,n,s,o,l,u,d,{baseURL:f=Gf("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(t=Gf("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:m="v1beta"}=e,y=Wl(e,["baseURL","apiKey","apiVersion"]);const S=Object.assign(Object.assign({apiKey:h,apiVersion:m},y),{baseURL:f||"https://generativelanguage.googleapis.com"});this.baseURL=S.baseURL,this.timeout=(n=S.timeout)!==null&&n!==void 0?n:pu.DEFAULT_TIMEOUT,this.logger=(s=S.logger)!==null&&s!==void 0?s:console;const A="warn";this.logLevel=A,this.logLevel=(l=(o=av(S.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:av(Gf("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&l!==void 0?l:A,this.fetchOptions=S.fetchOptions,this.maxRetries=(u=S.maxRetries)!==null&&u!==void 0?u:2,this.fetch=(d=S.fetch)!==null&&d!==void 0?d:VD(),this.encoder=KD,this._options=S,this.apiKey=h,this.apiVersion=m,this.clientAdapter=S.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=Oo([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return Oo([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Oo([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new Cn(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Ar}`}defaultIdempotencyKey(){return`stainless-node-retry-${LD()}`}makeStatusError(e,t,n,s){return Ht.generate(e,t,n,s)}buildURL(e,t,n){const s=!this.baseURLOverridden()&&n||this.baseURL,o=DD(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),l=this.defaultQuery();return ND(l)||(t=Object.assign(Object.assign({},l),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new eh(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,o,l;const u=await e,d=(s=u.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=d),await this.prepareOptions(u);const{req:f,url:h,timeout:m}=await this.buildRequest(u,{retryCount:d-t});await this.prepareRequest(f,{url:h,options:u});const y="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),S=n===void 0?"":`, retryOf: ${n}`,A=Date.now();if($t(this).debug(`[${y}] sending request`,Is({retryOfRequestLogID:n,method:u.method,url:h,options:u,headers:f.headers})),!((o=u.signal)===null||o===void 0)&&o.aborted)throw new Sd;const _=new AbortController,x=await this.fetchWithTimeout(h,f,m,_).catch(Td),C=Date.now();if(x instanceof globalThis.Error){const L=`retrying, ${t} attempts remaining`;if(!((l=u.signal)===null||l===void 0)&&l.aborted)throw new Sd;const M=Ed(x)||/timed? ?out/i.test(String(x)+("cause"in x?String(x.cause):""));if(t)return $t(this).info(`[${y}] connection ${M?"timed out":"failed"} - ${L}`),$t(this).debug(`[${y}] connection ${M?"timed out":"failed"} (${L})`,Is({retryOfRequestLogID:n,url:h,durationMs:C-A,message:x.message})),this.retryRequest(u,t,n??y);throw $t(this).info(`[${y}] connection ${M?"timed out":"failed"} - error; no more retries left`),$t(this).debug(`[${y}] connection ${M?"timed out":"failed"} (error; no more retries left)`,Is({retryOfRequestLogID:n,url:h,durationMs:C-A,message:x.message})),M?new sT:new gu({cause:x})}const b=`[${y}${S}] ${f.method} ${h} ${x.ok?"succeeded":"failed"} with status ${x.status} in ${C-A}ms`;if(!x.ok){const L=await this.shouldRetry(x);if(t&&L){const U=`retrying, ${t} attempts remaining`;return await qD(x.body),$t(this).info(`${b} - ${U}`),$t(this).debug(`[${y}] response error (${U})`,Is({retryOfRequestLogID:n,url:x.url,status:x.status,headers:x.headers,durationMs:C-A})),this.retryRequest(u,t,n??y,x.headers)}const M=L?"error; no more retries left":"error; not retryable";$t(this).info(`${b} - ${M}`);const P=await x.text().catch(U=>Td(U).message),G=UD(P),N=G?void 0:P;throw $t(this).debug(`[${y}] response error (${M})`,Is({retryOfRequestLogID:n,url:x.url,status:x.status,headers:x.headers,message:N,durationMs:Date.now()-A})),this.makeStatusError(x.status,G,N,x.headers)}return $t(this).info(b),$t(this).debug(`[${y}] response start`,Is({retryOfRequestLogID:n,url:x.url,status:x.status,headers:x.headers,durationMs:C-A})),{response:x,options:u,controller:_,requestLogID:y,retryOfRequestLogID:n,startTime:A}}async fetchWithTimeout(e,t,n,s){const o=t||{},{signal:l,method:u}=o,d=Wl(o,["signal","method"]);l&&l.addEventListener("abort",()=>s.abort());const f=setTimeout(()=>s.abort(),n),h=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,m=Object.assign(Object.assign(Object.assign({signal:s.signal},h?{duplex:"half"}:{}),{method:"GET"}),d);u&&(m.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(f)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var o;let l;const u=s==null?void 0:s.get("retry-after-ms");if(u){const f=parseFloat(u);Number.isNaN(f)||(l=f)}const d=s==null?void 0:s.get("retry-after");if(d&&!l){const f=parseFloat(d);Number.isNaN(f)?l=Date.parse(d)-Date.now():l=f*1e3}if(!(l&&0<=l&&l<60*1e3)){const f=(o=e.maxRetries)!==null&&o!==void 0?o:this.maxRetries;l=this.calculateDefaultRetryTimeoutMillis(t,f)}return await OD(l),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const o=t-e,l=Math.min(.5*Math.pow(2,o),8),u=1-Math.random()*.25;return l*u*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,o;const l=Object.assign({},e),{method:u,path:d,query:f,defaultBaseURL:h}=l,m=this.buildURL(d,f,h);"timeout"in l&&kD("timeout",l.timeout),l.timeout=(n=l.timeout)!==null&&n!==void 0?n:this.timeout;const{bodyHeaders:y,body:S}=this.buildBody({options:l}),A=await this.buildHeaders({options:e,method:u,bodyHeaders:y,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:u,headers:A},l.signal&&{signal:l.signal}),globalThis.ReadableStream&&S instanceof globalThis.ReadableStream&&{duplex:"half"}),S&&{body:S}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(o=l.fetchOptions)!==null&&o!==void 0?o:{}),url:m,timeout:l.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let o={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const l=await this.authHeaders(e);let u=Oo([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),$D()),this._options.defaultHeaders,n,e.headers,l]);return this.validateHeaders(u),u.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=Oo([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:HD(e)}:this.encoder({body:e,headers:n})}}pu.DEFAULT_TIMEOUT=6e4;class Rt extends pu{constructor(){super(...arguments),this.interactions=new TT(this)}}AT=Rt;Rt.GeminiNextGenAPIClient=AT;Rt.GeminiNextGenAPIClientError=Cn;Rt.APIError=Ht;Rt.APIConnectionError=gu;Rt.APIConnectionTimeoutError=sT;Rt.APIUserAbortError=Sd;Rt.NotFoundError=lT;Rt.ConflictError=uT;Rt.RateLimitError=fT;Rt.BadRequestError=rT;Rt.AuthenticationError=oT;Rt.InternalServerError=dT;Rt.PermissionDeniedError=aT;Rt.UnprocessableEntityError=cT;Rt.toFile=WD;Rt.Interactions=TT;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function u1(i,e){const t={},n=p(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function c1(i,e){const t={},n=p(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function f1(i,e){const t={},n=p(i,["sdkHttpResponse"]);return n!=null&&v(t,["sdkHttpResponse"],n),t}function d1(i,e){const t={},n=p(i,["sdkHttpResponse"]);return n!=null&&v(t,["sdkHttpResponse"],n),t}function h1(i,e,t){const n={};if(p(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=p(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&v(e,["displayName"],s),p(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=p(i,["epochCount"]);e!==void 0&&o!=null&&v(e,["tuningTask","hyperparameters","epochCount"],o);const l=p(i,["learningRateMultiplier"]);if(l!=null&&v(n,["tuningTask","hyperparameters","learningRateMultiplier"],l),p(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(p(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(p(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=p(i,["batchSize"]);e!==void 0&&u!=null&&v(e,["tuningTask","hyperparameters","batchSize"],u);const d=p(i,["learningRate"]);if(e!==void 0&&d!=null&&v(e,["tuningTask","hyperparameters","learningRate"],d),p(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(p(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function g1(i,e,t){const n={};let s=p(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const S=p(i,["validationDataset"]);e!==void 0&&S!=null&&v(e,["supervisedTuningSpec"],uv(S))}else if(s==="PREFERENCE_TUNING"){const S=p(i,["validationDataset"]);e!==void 0&&S!=null&&v(e,["preferenceOptimizationSpec"],uv(S))}const o=p(i,["tunedModelDisplayName"]);e!==void 0&&o!=null&&v(e,["tunedModelDisplayName"],o);const l=p(i,["description"]);e!==void 0&&l!=null&&v(e,["description"],l);let u=p(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const S=p(i,["epochCount"]);e!==void 0&&S!=null&&v(e,["supervisedTuningSpec","hyperParameters","epochCount"],S)}else if(u==="PREFERENCE_TUNING"){const S=p(i,["epochCount"]);e!==void 0&&S!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],S)}let d=p(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const S=p(i,["learningRateMultiplier"]);e!==void 0&&S!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],S)}else if(d==="PREFERENCE_TUNING"){const S=p(i,["learningRateMultiplier"]);e!==void 0&&S!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],S)}let f=p(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const S=p(i,["exportLastCheckpointOnly"]);e!==void 0&&S!=null&&v(e,["supervisedTuningSpec","exportLastCheckpointOnly"],S)}else if(f==="PREFERENCE_TUNING"){const S=p(i,["exportLastCheckpointOnly"]);e!==void 0&&S!=null&&v(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],S)}let h=p(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const S=p(i,["adapterSize"]);e!==void 0&&S!=null&&v(e,["supervisedTuningSpec","hyperParameters","adapterSize"],S)}else if(h==="PREFERENCE_TUNING"){const S=p(i,["adapterSize"]);e!==void 0&&S!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],S)}if(p(i,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(p(i,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=p(i,["labels"]);e!==void 0&&m!=null&&v(e,["labels"],m);const y=p(i,["beta"]);return e!==void 0&&y!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","beta"],y),n}function m1(i,e){const t={},n=p(i,["baseModel"]);n!=null&&v(t,["baseModel"],n);const s=p(i,["preTunedModel"]);s!=null&&v(t,["preTunedModel"],s);const o=p(i,["trainingDataset"]);o!=null&&I1(o);const l=p(i,["config"]);return l!=null&&h1(l,t),t}function p1(i,e){const t={},n=p(i,["baseModel"]);n!=null&&v(t,["baseModel"],n);const s=p(i,["preTunedModel"]);s!=null&&v(t,["preTunedModel"],s);const o=p(i,["trainingDataset"]);o!=null&&C1(o,t,e);const l=p(i,["config"]);return l!=null&&g1(l,t,e),t}function y1(i,e){const t={},n=p(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function v1(i,e){const t={},n=p(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function E1(i,e,t){const n={},s=p(i,["pageSize"]);e!==void 0&&s!=null&&v(e,["_query","pageSize"],s);const o=p(i,["pageToken"]);e!==void 0&&o!=null&&v(e,["_query","pageToken"],o);const l=p(i,["filter"]);return e!==void 0&&l!=null&&v(e,["_query","filter"],l),n}function T1(i,e,t){const n={},s=p(i,["pageSize"]);e!==void 0&&s!=null&&v(e,["_query","pageSize"],s);const o=p(i,["pageToken"]);e!==void 0&&o!=null&&v(e,["_query","pageToken"],o);const l=p(i,["filter"]);return e!==void 0&&l!=null&&v(e,["_query","filter"],l),n}function S1(i,e){const t={},n=p(i,["config"]);return n!=null&&E1(n,t),t}function A1(i,e){const t={},n=p(i,["config"]);return n!=null&&T1(n,t),t}function _1(i,e){const t={},n=p(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=p(i,["nextPageToken"]);s!=null&&v(t,["nextPageToken"],s);const o=p(i,["tunedModels"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>_T(u))),v(t,["tuningJobs"],l)}return t}function x1(i,e){const t={},n=p(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=p(i,["nextPageToken"]);s!=null&&v(t,["nextPageToken"],s);const o=p(i,["tuningJobs"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>xd(u))),v(t,["tuningJobs"],l)}return t}function R1(i,e){const t={},n=p(i,["name"]);n!=null&&v(t,["model"],n);const s=p(i,["name"]);return s!=null&&v(t,["endpoint"],s),t}function I1(i,e){const t={};if(p(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(p(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=p(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>o)),v(t,["examples","examples"],s)}return t}function C1(i,e,t){const n={};let s=p(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const l=p(i,["gcsUri"]);e!==void 0&&l!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(s==="PREFERENCE_TUNING"){const l=p(i,["gcsUri"]);e!==void 0&&l!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}let o=p(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const l=p(i,["vertexDatasetResource"]);e!==void 0&&l!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(o==="PREFERENCE_TUNING"){const l=p(i,["vertexDatasetResource"]);e!==void 0&&l!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}if(p(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function _T(i,e){const t={},n=p(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=p(i,["name"]);s!=null&&v(t,["name"],s);const o=p(i,["state"]);o!=null&&v(t,["state"],BE(o));const l=p(i,["createTime"]);l!=null&&v(t,["createTime"],l);const u=p(i,["tuningTask","startTime"]);u!=null&&v(t,["startTime"],u);const d=p(i,["tuningTask","completeTime"]);d!=null&&v(t,["endTime"],d);const f=p(i,["updateTime"]);f!=null&&v(t,["updateTime"],f);const h=p(i,["description"]);h!=null&&v(t,["description"],h);const m=p(i,["baseModel"]);m!=null&&v(t,["baseModel"],m);const y=p(i,["_self"]);return y!=null&&v(t,["tunedModel"],R1(y)),t}function xd(i,e){const t={},n=p(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=p(i,["name"]);s!=null&&v(t,["name"],s);const o=p(i,["state"]);o!=null&&v(t,["state"],BE(o));const l=p(i,["createTime"]);l!=null&&v(t,["createTime"],l);const u=p(i,["startTime"]);u!=null&&v(t,["startTime"],u);const d=p(i,["endTime"]);d!=null&&v(t,["endTime"],d);const f=p(i,["updateTime"]);f!=null&&v(t,["updateTime"],f);const h=p(i,["error"]);h!=null&&v(t,["error"],h);const m=p(i,["description"]);m!=null&&v(t,["description"],m);const y=p(i,["baseModel"]);y!=null&&v(t,["baseModel"],y);const S=p(i,["tunedModel"]);S!=null&&v(t,["tunedModel"],S);const A=p(i,["preTunedModel"]);A!=null&&v(t,["preTunedModel"],A);const _=p(i,["supervisedTuningSpec"]);_!=null&&v(t,["supervisedTuningSpec"],_);const x=p(i,["preferenceOptimizationSpec"]);x!=null&&v(t,["preferenceOptimizationSpec"],x);const C=p(i,["tuningDataStats"]);C!=null&&v(t,["tuningDataStats"],C);const b=p(i,["encryptionSpec"]);b!=null&&v(t,["encryptionSpec"],b);const L=p(i,["partnerModelTuningSpec"]);L!=null&&v(t,["partnerModelTuningSpec"],L);const M=p(i,["customBaseModel"]);M!=null&&v(t,["customBaseModel"],M);const P=p(i,["experiment"]);P!=null&&v(t,["experiment"],P);const G=p(i,["labels"]);G!=null&&v(t,["labels"],G);const N=p(i,["outputUri"]);N!=null&&v(t,["outputUri"],N);const $=p(i,["pipelineJob"]);$!=null&&v(t,["pipelineJob"],$);const U=p(i,["serviceAccount"]);U!=null&&v(t,["serviceAccount"],U);const O=p(i,["tunedModelDisplayName"]);O!=null&&v(t,["tunedModelDisplayName"],O);const J=p(i,["veoTuningSpec"]);return J!=null&&v(t,["veoTuningSpec"],J),t}function L1(i,e){const t={},n=p(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=p(i,["name"]);s!=null&&v(t,["name"],s);const o=p(i,["metadata"]);o!=null&&v(t,["metadata"],o);const l=p(i,["done"]);l!=null&&v(t,["done"],l);const u=p(i,["error"]);return u!=null&&v(t,["error"],u),t}function uv(i,e){const t={},n=p(i,["gcsUri"]);n!=null&&v(t,["validationDatasetUri"],n);const s=p(i,["vertexDatasetResource"]);return s!=null&&v(t,["validationDatasetUri"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class b1 extends _i{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ds(Ai.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},t),{preTunedModel:s});return o.baseModel=void 0,await this.tuneInternal(o)}else{const s=Object.assign({},t);return await this.tuneInternal(s)}else{const s=Object.assign({},t),o=await this.tuneMldevInternal(s);let l="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?l=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(l=o.name.split("/operations/")[0]),{name:l,state:dd.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=v1(e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>xd(h))}else{const f=y1(e);return u=me("{name}",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>_T(h))}}async listInternal(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=A1(e);return u=me("tuningJobs",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=x1(h),y=new ky;return Object.assign(y,m),y})}else{const f=S1(e);return u=me("tunedModels",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=_1(h),y=new ky;return Object.assign(y,m),y})}}async cancel(e){var t,n,s,o;let l,u="",d={};if(this.apiClient.isVertexAI()){const f=c1(e);return u=me("{name}:cancel",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=d1(h),y=new Uy;return Object.assign(y,m),y})}else{const f=u1(e);return u=me("{name}:cancel",f._url),d=f._query,delete f._url,delete f._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{const y=m;return y.sdkHttpResponse={headers:h.headers},y})),l.then(h=>{const m=f1(h),y=new Uy;return Object.assign(y,m),y})}}async tuneInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const u=p1(e,e);return o=me("tuningJobs",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>xd(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=m1(e);return o=me("tunedModels",u._url),l=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(f=>{const h=f;return h.sdkHttpResponse={headers:d.headers},h})),s.then(d=>L1(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class D1{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const M1=1024*1024*8,w1=3,N1=1e3,P1=2,Zl="x-goog-upload-status";async function k1(i,e,t){var n;const s=await xT(i,e,t),o=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Zl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function U1(i,e,t){var n;const s=await xT(i,e,t),o=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Zl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const l=NE(o),u=new Yd;return Object.assign(u,l),u}async function xT(i,e,t){var n,s;let o=0,l=0,u=new hd(new Response),d="upload";for(o=i.size;l<o;){const f=Math.min(M1,o-l),h=i.slice(l,l+f);l+f>=o&&(d+=", finalize");let m=0,y=N1;for(;m<w1&&(u=await t.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(l),"Content-Length":String(f)}}}),!(!((n=u==null?void 0:u.headers)===null||n===void 0)&&n[Zl]));)m++,await F1(y),y=y*P1;if(l+=f,((s=u==null?void 0:u.headers)===null||s===void 0?void 0:s[Zl])!=="active")break;if(o<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function O1(i){return{size:i.size,type:i.type}}function F1(i){return new Promise(e=>setTimeout(e,i))}class B1{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await k1(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await U1(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await O1(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class G1{create(e,t,n){return new $1(e,t,n)}}class $1{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cv="x-goog-api-key";class V1{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(cv)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(cv,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const H1="gl-node/";class q1{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new Rt({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const n=Fx(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const s=new V1(this.apiKey);this.apiClient=new Ob({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:H1+"web",uploader:new B1,downloader:new D1}),this.models=new nD(this.apiClient),this.live=new Wb(this.apiClient,s,new G1),this.batches=new hI(this.apiClient),this.chats=new XI(this.models,this.apiClient),this.caches=new KI(this.apiClient),this.files=new sC(this.apiClient),this.operations=new iD(this.apiClient),this.authTokens=new ED(this.apiClient),this.tunings=new b1(this.apiClient),this.fileSearchStores=new CD(this.apiClient)}}const th=new q1({apiKey:"AIzaSyApobm57QJQ0D6Nn1RaIeiX3mBhWnoP3PA"}),K1=async()=>{try{const i=await th.models.generateContent({model:"gemini-3-flash-preview",contents:`Find real-time live and upcoming top-tier football matches happening today (${new Date().toLocaleDateString()}). 
      Focus on major leagues (Premier League, La Liga, Champions League, etc.). 
      Return the data in a structured format.`,config:{tools:[{googleSearch:{}}],responseMimeType:"application/json",responseSchema:{type:vt.ARRAY,items:{type:vt.OBJECT,properties:{id:{type:vt.STRING},homeTeam:{type:vt.STRING},awayTeam:{type:vt.STRING},league:{type:vt.STRING},startTime:{type:vt.STRING},status:{type:vt.STRING},score:{type:vt.OBJECT,properties:{home:{type:vt.NUMBER},away:{type:vt.NUMBER}}}},required:["id","homeTeam","awayTeam","league","startTime","status"]}}}});return JSON.parse(i.text||"[]")}catch(i){return console.error("Error fetching matches:",i),[]}},z1=async(i,e)=>{var t,n,s,o,l;try{const u=await th.models.generateContent({model:"gemini-3-flash-preview",contents:`Find official live streaming and broadcast sources for the football match: ${i} vs ${e} on ${new Date().toLocaleDateString()}. 
      Include links to official platforms (e.g., NBC Sports, Sky Sports, DAZN, ESPN+). 
      Provide a brief summary of how to watch and any free options if they exist legally.`,config:{tools:[{googleSearch:{}}]}}),d=((l=(o=(s=(n=(t=u.candidates)==null?void 0:t[0])==null?void 0:n.groundingMetadata)==null?void 0:s.groundingChunks)==null?void 0:o.filter(f=>f.web))==null?void 0:l.map(f=>({title:f.web.title,uri:f.web.uri})))||[];return{summary:u.text||"No streaming info found.",sources:d}}catch(u){return console.error("Error fetching streaming info:",u),{summary:"Failed to load streaming info.",sources:[]}}},Y1=async(i,e)=>{var t,n,s,o,l;try{const u=await th.models.generateContent({model:"gemini-3-pro-preview",contents:`Perform a deep tactical analysis and prediction for ${i} vs ${e}. 
      Use recent form, head-to-head records, and injury news.`,config:{tools:[{googleSearch:{}}]}}),d=((l=(o=(s=(n=(t=u.candidates)==null?void 0:t[0])==null?void 0:n.groundingMetadata)==null?void 0:s.groundingChunks)==null?void 0:o.filter(f=>f.web))==null?void 0:l.map(f=>({title:f.web.title,uri:f.web.uri})))||[];return{summary:u.text||"Analysis unavailable.",sources:d}}catch(u){return console.error("Error fetching analysis:",u),{summary:"Failed to load analysis.",sources:[]}}},X1=`
#EXTINF:-1,beIN SPORTS 
https://fl1.moveonjoy.com/BEIN_SPORTS/index.m3u8
#EXTINF:-1,DAZN COMBAT HD US
https://dazn-combat-rakuten.amagi.tv/hls/amagi_hls_data_rakutenAA-dazn-combat-rakuten/CDN/master.m3u8
#EXTINF:-1,ABU DUBI 1 FHD
https://admn-live-cdn-lb.starzplayarabia.com/out/v1/admn_tv_enc/abudhabi_sports_1/abudhabi_sports_1_hls_nd/index.m3u8
`,J1=i=>{const e=i.split(`
`),t=[];let n="";for(const s of e){const o=s.trim();if(o.startsWith("#EXTINF:")){const l=o.lastIndexOf(",");l!==-1&&(n=o.substring(l+1).trim())}else o.startsWith("https")&&n&&(n.includes("---")||t.push({name:n,url:o}),n="")}return t};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W1=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Q1=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),fv=i=>{const e=Q1(i);return e.charAt(0).toUpperCase()+e.slice(1)},RT=(...i)=>i.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),Z1=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var j1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=lt.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:o,iconNode:l,...u},d)=>lt.createElement("svg",{ref:d,...j1,width:e,height:e,stroke:i,strokeWidth:n?Number(t)*24/Number(e):t,className:RT("lucide",s),...!o&&!Z1(u)&&{"aria-hidden":"true"},...u},[...l.map(([f,h])=>lt.createElement(f,h)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=(i,e)=>{const t=lt.forwardRef(({className:n,...s},o)=>lt.createElement(eM,{ref:o,iconNode:e,className:RT(`lucide-${W1(fv(i))}`,`lucide-${i}`,n),...s}));return t.displayName=fv(i),t};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tM=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],nM=Pt("activity",tM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],sM=Pt("calendar",iM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],IT=Pt("circle-alert",rM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oM=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],dv=Pt("external-link",oM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],lM=Pt("globe",aM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],cM=Pt("info",uM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],dM=Pt("play",fM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],gM=Pt("radio",hM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mM=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],pM=Pt("refresh-ccw",mM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],vM=Pt("refresh-cw",yM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],hv=Pt("search",EM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],SM=Pt("shield-alert",TM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],_M=Pt("shield-check",AM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],RM=Pt("trending-up",xM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IM=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],CM=Pt("trophy",IM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LM=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],bM=Pt("tv",LM);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],gv=Pt("zap",DM),MM=({match:i,onSelect:e,isSelected:t})=>{const n=i.status==="LIVE";return W.jsxs("div",{onClick:()=>e(i),className:`relative group cursor-pointer transition-all duration-300 rounded-xl p-5 border-2 ${t?"border-green-500 bg-green-500/10":"border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20"}`,children:[W.jsxs("div",{className:"flex justify-between items-start mb-4",children:[W.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded bg-white/10 text-xs font-semibold uppercase tracking-wider text-slate-400",children:[W.jsx(CM,{size:12}),i.league]}),n&&W.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold animate-pulse",children:[W.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"LIVE"]})]}),W.jsxs("div",{className:"flex items-center justify-between gap-4",children:[W.jsxs("div",{className:"flex-1 text-center",children:[W.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-2 font-bold text-lg",children:i.homeTeam.charAt(0)}),W.jsx("h3",{className:"font-bold text-sm md:text-base line-clamp-1",children:i.homeTeam})]}),W.jsx("div",{className:"flex flex-col items-center justify-center min-w-[60px]",children:n&&i.score?W.jsxs("div",{className:"text-2xl font-black text-white",children:[i.score.home," - ",i.score.away]}):W.jsxs("div",{className:"flex flex-col items-center",children:[W.jsx("span",{className:"text-xs text-slate-500 uppercase",children:"VS"}),W.jsx("span",{className:"text-sm font-semibold mt-1",children:i.startTime})]})}),W.jsxs("div",{className:"flex-1 text-center",children:[W.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-2 font-bold text-lg",children:i.awayTeam.charAt(0)}),W.jsx("h3",{className:"font-bold text-sm md:text-base line-clamp-1",children:i.awayTeam})]})]}),W.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex items-center justify-between",children:[W.jsxs("button",{className:"text-xs font-bold flex items-center gap-1 text-green-400 group-hover:text-green-300 transition-colors",children:[W.jsx(dM,{size:14,fill:"currentColor"}),"WATCH OPTIONS"]}),W.jsxs("button",{className:"text-xs font-bold flex items-center gap-1 text-blue-400",children:[W.jsx(sM,{size:14}),"DETAILS"]})]})]})},wM=({streamingInfo:i,analysisInfo:e,isLoading:t})=>t?W.jsxs("div",{className:"flex flex-col gap-6 animate-pulse",children:[W.jsx("div",{className:"h-48 glass rounded-2xl"}),W.jsx("div",{className:"h-64 glass rounded-2xl"})]}):W.jsxs("div",{className:"flex flex-col gap-6",children:[W.jsxs("section",{className:"glass rounded-2xl overflow-hidden border border-green-500/20",children:[W.jsxs("div",{className:"bg-green-500/10 px-6 py-4 flex items-center gap-2 border-b border-green-500/20",children:[W.jsx(gM,{size:18,className:"text-green-400"}),W.jsx("h2",{className:"font-bold text-green-400",children:"OFFICIAL STREAMING SOURCES"})]}),W.jsxs("div",{className:"p-6",children:[W.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-4 whitespace-pre-wrap",children:(i==null?void 0:i.summary)||"Select a match to see official streaming guides."}),(i==null?void 0:i.sources)&&i.sources.length>0&&W.jsx("div",{className:"grid grid-cols-1 gap-2",children:i.sources.map((n,s)=>W.jsxs("a",{href:n.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors border border-white/10",children:[W.jsx("span",{className:"text-xs font-medium text-slate-200 line-clamp-1",children:n.title}),W.jsx(dv,{size:14,className:"text-slate-400"})]},s))})]})]}),W.jsxs("section",{className:"glass rounded-2xl overflow-hidden border border-blue-500/20",children:[W.jsxs("div",{className:"bg-blue-500/10 px-6 py-4 flex items-center gap-2 border-b border-blue-500/20",children:[W.jsx(RM,{size:18,className:"text-blue-400"}),W.jsx("h2",{className:"font-bold text-blue-400",children:"AI MATCH ANALYSIS & ODDS"})]}),W.jsxs("div",{className:"p-6",children:[W.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-4 whitespace-pre-wrap",children:(e==null?void 0:e.summary)||"Our AI will analyze team form and tactics once a match is selected."}),(e==null?void 0:e.sources)&&e.sources.length>0&&W.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.sources.map((n,s)=>W.jsxs("a",{href:n.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors border border-white/10",children:[W.jsx("span",{className:"text-xs font-medium text-slate-200 line-clamp-1",children:n.title}),W.jsx(dv,{size:14,className:"text-slate-400"})]},s))})]})]}),W.jsxs("div",{className:"flex items-center gap-2 p-4 rounded-xl bg-orange-500/10 border border-orange-500/20 text-orange-400 text-xs",children:[W.jsx(IT,{size:14}),W.jsx("span",{children:"Always use official broadcasters. Avoid clicking suspicious unofficial links."})]})]}),he=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},NM=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=PM},PM=Number.MAX_SAFE_INTEGER||9007199254740991;let Ee=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),K=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),I=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var De={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},pe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class yr{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class kM{constructor(e,t,n,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new yr(e),this.fast_=new yr(t),this.defaultTTFB_=s,this.ttfb_=new yr(e)}update(e,t){const{slow_:n,fast_:s,ttfb_:o}=this;n.halfLife!==e&&(this.slow_=new yr(e,n.getEstimate(),n.getTotalWeight())),s.halfLife!==t&&(this.fast_=new yr(t,s.getEstimate(),s.getTotalWeight())),o.halfLife!==e&&(this.ttfb_=new yr(e,o.getEstimate(),o.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,s=e/1e3,o=n/s;this.fast_.sample(s,o),this.slow_.sample(s,o)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function UM(i,e,t){return(e=FM(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function We(){return We=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},We.apply(null,arguments)}function mv(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function Ke(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mv(Object(t),!0).forEach(function(n){UM(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):mv(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function OM(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function FM(i){var e=OM(i,"string");return typeof e=="symbol"?e:e+""}class bn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=ji,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const ji=function(){},BM={trace:ji,debug:ji,log:ji,warn:ji,info:ji,error:ji};function Rd(){return We({},BM)}function GM(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):ji}function pv(i,e,t){return e[i]?e[i].bind(e):GM(i,t)}const Id=Rd();function $M(i,e,t){const n=Rd();if(typeof console=="object"&&i===!0||typeof i=="object"){const s=["debug","log","info","warn","error"];s.forEach(o=>{n[o]=pv(o,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Rd()}s.forEach(o=>{Id[o]=pv(o,i)})}else We(Id,n);return n}const ze=Id;function ns(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function VM(i){return typeof self<"u"&&i===self.ManagedMediaSource}function CT(i,e){const t=Object.keys(i),n=Object.keys(e),s=t.length,o=n.length;return!s||!o||s===o&&!t.some(l=>n.indexOf(l)===-1)}function gn(i,e=!1){if(typeof TextDecoder<"u"){const f=new TextDecoder("utf-8").decode(i);if(e){const h=f.indexOf("\0");return h!==-1?f.substring(0,h):f}return f.replace(/\0/g,"")}const t=i.length;let n,s,o,l="",u=0;for(;u<t;){if(n=i[u++],n===0&&e)return l;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:s=i[u++],l+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=i[u++],o=i[u++],l+=String.fromCharCode((n&15)<<12|(s&63)<<6|(o&63)<<0);break}}return l}function wt(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function LT(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function HM(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var $f={exports:{}},yv;function qM(){return yv||(yv=1,(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(d,f,h){if(h=h||{},d=d.trim(),f=f.trim(),!f){if(!h.alwaysNormalize)return d;var m=u.parseURL(d);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var y=u.parseURL(f);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return h.alwaysNormalize?(y.path=u.normalizePath(y.path),u.buildURLFromParts(y)):f;var S=u.parseURL(d);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var A=s.exec(S.path);S.netLoc=A[1],S.path=A[2]}S.netLoc&&!S.path&&(S.path="/");var _={scheme:S.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(_.netLoc=S.netLoc,y.path[0]!=="/"))if(!y.path)_.path=S.path,y.params||(_.params=S.params,y.query||(_.query=S.query));else{var x=S.path,C=x.substring(0,x.lastIndexOf("/")+1)+y.path;_.path=u.normalizePath(C)}return _.path===null&&(_.path=h.alwaysNormalize?u.normalizePath(y.path):y.path),u.buildURLFromParts(_)},parseURL:function(d){var f=n.exec(d);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(o,"");d.length!==(d=d.replace(l,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};i.exports=u})()})($f)),$f.exports}var nh=qM();class ih{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ze={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class bT{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,zM(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let s;n.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(n[1]),this._byteRange=[s,parseInt(n[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ze.AUDIO]:null,[Ze.VIDEO]:null,[Ze.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new ih),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=nh.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ze.AUDIO]=null,e[Ze.VIDEO]=null,e[Ze.AUDIOVIDEO]=null}}function ft(i){return i.sn!=="initSegment"}class Vf extends bT{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(he(e)&&he(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const s=this._decryptdata=t[n[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=he(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),s=n.length;if(s>1||s===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!he(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return ft(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const s=t[e];s&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,s,o,l=!1){const{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:n,startDTS:s,endDTS:o,partial:l};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,n),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,o)}}class KM extends bT{constructor(e,t,n,s,o){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,o),o&&(this.fragOffset=o.fragOffset+o.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function DT(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||DT(t,e)}}function zM(i,e){const t=DT(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const vv=Math.pow(2,32)-1,YM=[].push,MT={video:1,audio:2,id3:3,text:4};function yt(i){return String.fromCharCode.apply(null,i)}function wT(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function _e(i,e){const t=NT(i,e);return t<0?4294967296+t:t}function Ev(i,e){let t=_e(i,e);return t*=Math.pow(2,32),t+=_e(i,e+4),t}function NT(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function XM(i){const e=i.byteLength;for(let t=0;t<e;){const n=_e(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function be(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let s=0;s<n;){const o=_e(i,s),l=yt(i.subarray(s+4,s+8)),u=o>1?s+o:n;if(l===e[0])if(e.length===1)t.push(i.subarray(s+8,u));else{const d=be(i.subarray(s+8,u),e.slice(1));d.length&&YM.apply(t,d)}s=u}return t}function JM(i){const e=[],t=i[0];let n=8;const s=_e(i,n);n+=4;let o=0,l=0;t===0?(o=_e(i,n),l=_e(i,n+4),n+=8):(o=Ev(i,n),l=Ev(i,n+8),n+=16),n+=2;let u=i.length+l;const d=wT(i,n);n+=2;for(let f=0;f<d;f++){let h=n;const m=_e(i,h);h+=4;const y=m&2147483647;if((m&2147483648)>>>31===1)return ze.warn("SIDX has hierarchical references (not supported)"),null;const A=_e(i,h);h+=4,e.push({referenceSize:y,subsegmentDuration:A,info:{duration:A/s,start:u,end:u+y-1}}),u+=y,h+=4,n=h}return{earliestPresentationTime:o,timescale:s,version:t,referencesCount:d,references:e}}function PT(i){const e=[],t=be(i,["moov","trak"]);for(let s=0;s<t.length;s++){const o=t[s],l=be(o,["tkhd"])[0];if(l){let u=l[0];const d=_e(l,u===0?12:20),f=be(o,["mdia","mdhd"])[0];if(f){u=f[0];const h=_e(f,u===0?12:20),m=be(o,["mdia","hdlr"])[0];if(m){const y=yt(m.subarray(8,12)),S={soun:Ze.AUDIO,vide:Ze.VIDEO}[y],A=be(o,["mdia","minf","stbl","stsd"])[0],_=WM(A);S?(e[d]={timescale:h,type:S,stsd:_},e[S]=Ke({timescale:h,id:d},_)):e[d]={timescale:h,type:y,stsd:_}}}}}return be(i,["moov","mvex","trex"]).forEach(s=>{const o=_e(s,4),l=e[o];l&&(l.default={duration:_e(s,12),flags:_e(s,20)})}),e}function WM(i){const e=i.subarray(8),t=e.subarray(86),n=yt(e.subarray(4,8));let s=n,o;const l=n==="enca"||n==="encv";if(l){const f=be(e,[n])[0].subarray(n==="enca"?28:78);be(f,["sinf"]).forEach(m=>{const y=be(m,["schm"])[0];if(y){const S=yt(y.subarray(4,8));if(S==="cbcs"||S==="cenc"){const A=be(m,["frma"])[0];A&&(s=yt(A))}}})}const u=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const d=be(t,["avcC"])[0];d&&d.length>3&&(s+="."+_l(d[1])+_l(d[2])+_l(d[3]),o=Al(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=be(e,[n])[0],f=be(d.subarray(28),["esds"])[0];if(f&&f.length>7){let h=4;if(f[h++]!==3)break;h=Hf(f,h),h+=2;const m=f[h++];if(m&128&&(h+=2),m&64&&(h+=f[h++]),f[h++]!==4)break;h=Hf(f,h);const y=f[h++];if(y===64)s+="."+_l(y);else break;if(h+=12,f[h++]!==5)break;h=Hf(f,h);const S=f[h++];let A=(S&248)>>3;A===31&&(A+=1+((S&7)<<3)+((f[h]&224)>>5)),s+="."+A}break}case"hvc1":case"hev1":{const d=be(t,["hvcC"])[0];if(d&&d.length>12){const f=d[1],h=["","A","B","C"][f>>6],m=f&31,y=_e(d,2),S=(f&32)>>5?"H":"L",A=d[12],_=d.subarray(6,12);s+="."+h+m,s+="."+QM(y).toString(16).toUpperCase(),s+="."+S+A;let x="";for(let C=_.length;C--;){const b=_[C];(b||x)&&(x="."+b.toString(16).toUpperCase()+x)}s+=x}o=Al(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Al(s,t)||s;break}case"vp09":{const d=be(t,["vpcC"])[0];if(d&&d.length>6){const f=d[4],h=d[5],m=d[6]>>4&15;s+="."+Yn(f)+"."+Yn(h)+"."+Yn(m)}break}case"av01":{const d=be(t,["av1C"])[0];if(d&&d.length>2){const f=d[1]>>>5,h=d[1]&31,m=d[2]>>>7?"H":"M",y=(d[2]&64)>>6,S=(d[2]&32)>>5,A=f===2&&y?S?12:10:y?10:8,_=(d[2]&16)>>4,x=(d[2]&8)>>3,C=(d[2]&4)>>2,b=d[2]&3;s+="."+f+"."+Yn(h)+m+"."+Yn(A)+"."+_+"."+x+C+b+"."+Yn(1)+"."+Yn(1)+"."+Yn(1)+"."+0,o=Al("dav1",t)}break}}return{codec:s,encrypted:l,supplemental:o}}function Al(i,e){const t=be(e,["dvvC"]),n=t.length?t[0]:be(e,["dvcC"])[0];if(n){const s=n[2]>>1&127,o=n[2]<<5&32|n[3]>>3&31;return i+"."+Yn(s)+"."+Yn(o)}}function QM(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Hf(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function _l(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function Yn(i){return(i<10?"0":"")+i}function ZM(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&kT(i,(n,s)=>{const o=n.subarray(8,24);o.some(l=>l!==0)||(ze.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${wt(o)} -> ${wt(t)}`),n.set(t,8))})}function jM(i){const e=[];return kT(i,t=>e.push(t.subarray(8,24))),e}function kT(i,e){be(i,["moov","trak"]).forEach(n=>{const s=be(n,["mdia","minf","stbl","stsd"])[0];if(!s)return;const o=s.subarray(8);let l=be(o,["enca"]);const u=l.length>0;u||(l=be(o,["encv"])),l.forEach(d=>{const f=u?d.subarray(28):d.subarray(78);be(f,["sinf"]).forEach(m=>{const y=UT(m);y&&e(y,u)})})})}function UT(i){const e=be(i,["schm"])[0];if(e){const t=yt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=be(i,["schi","tenc"])[0];if(n)return n}}}function ew(i,e,t){const n={},s=be(i,["moof","traf"]);for(let o=0;o<s.length;o++){const l=s[o],u=be(l,["tfhd"])[0],d=_e(u,4),f=e[d];if(!f)continue;n[d]||(n[d]={start:NaN,duration:0,sampleCount:0,timescale:f.timescale,type:f.type});const h=n[d],m=be(l,["tfdt"])[0];if(m){const L=m[0];let M=_e(m,4);L===1&&(M===vv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(M*=vv+1,M+=_e(m,8))),he(M)&&(!he(h.start)||M<h.start)&&(h.start=M)}const y=f.default,S=_e(u,0)|(y==null?void 0:y.flags);let A=(y==null?void 0:y.duration)||0;S&8&&(S&2?A=_e(u,12):A=_e(u,8));const _=be(l,["trun"]);let x=h.start||0,C=0,b=A;for(let L=0;L<_.length;L++){const M=_[L],P=_e(M,4),G=h.sampleCount;h.sampleCount+=P;const N=M[3]&1,$=M[3]&4,U=M[2]&1,O=M[2]&2,J=M[2]&4,re=M[2]&8;let oe=8,ce=P;for(N&&(oe+=4),$&&P&&(!(M[oe+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=G),oe+=4,U?(b=_e(M,oe),oe+=4):b=A,O&&(oe+=4),re&&(oe+=4),x+=b,C+=b,ce--);ce--;)U?(b=_e(M,oe),oe+=4):b=A,O&&(oe+=4),J&&(M[oe+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(ce+1),h.keyFrameStart=x),oe+=4),re&&(oe+=4),x+=b,C+=b;!C&&A&&(C+=A*P)}h.duration+=C}if(!Object.keys(n).some(o=>n[o].duration)){let o=1/0,l=0;const u=be(i,["sidx"]);for(let d=0;d<u.length;d++){const f=JM(u[d]);if(f!=null&&f.references){o=Math.min(o,f.earliestPresentationTime/f.timescale);const h=f.references.reduce((m,y)=>m+y.info.duration||0,0);l=Math.max(l,h+f.earliestPresentationTime/f.timescale)}}l&&he(l)&&Object.keys(n).forEach(d=>{n[d].duration||(n[d].duration=l*n[d].timescale-n[d].start)})}return n}function tw(i){const e={valid:null,remainder:null},t=be(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function Ln(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function Tv(i,e){const t=[],n=e.samples,s=e.timescale,o=e.id;let l=!1;return be(n,["moof"]).map(d=>{const f=d.byteOffset-8;be(d,["traf"]).map(m=>{const y=be(m,["tfdt"]).map(S=>{const A=S[0];let _=_e(S,4);return A===1&&(_*=Math.pow(2,32),_+=_e(S,8)),_/s})[0];return y!==void 0&&(i=y),be(m,["tfhd"]).map(S=>{const A=_e(S,4),_=_e(S,0)&16777215,x=(_&1)!==0,C=(_&2)!==0,b=(_&8)!==0;let L=0;const M=(_&16)!==0;let P=0;const G=(_&32)!==0;let N=8;A===o&&(x&&(N+=8),C&&(N+=4),b&&(L=_e(S,N),N+=4),M&&(P=_e(S,N),N+=4),G&&(N+=4),e.type==="video"&&(l=yu(e.codec)),be(m,["trun"]).map($=>{const U=$[0],O=_e($,0)&16777215,J=(O&1)!==0;let re=0;const oe=(O&4)!==0,ce=(O&256)!==0;let fe=0;const F=(O&512)!==0;let Q=0;const ee=(O&1024)!==0,le=(O&2048)!==0;let de=0;const w=_e($,4);let V=8;J&&(re=_e($,V),V+=4),oe&&(V+=4);let se=re+f;for(let ae=0;ae<w;ae++){if(ce?(fe=_e($,V),V+=4):fe=L,F?(Q=_e($,V),V+=4):Q=P,ee&&(V+=4),le&&(U===0?de=_e($,V):de=NT($,V),V+=4),e.type===Ze.VIDEO){let ue=0;for(;ue<Q;){const ge=_e(n,se);if(se+=4,nw(l,n[se])){const Ae=n.subarray(se,se+ge);sh(Ae,l?2:1,i+de/s,t)}se+=ge,ue+=ge+4}}i+=fe/s}}))})})}),t}function yu(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function nw(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function sh(i,e,t,n){const s=OT(i);let o=0;o+=e;let l=0,u=0,d=0;for(;o<s.length;){l=0;do{if(o>=s.length)break;d=s[o++],l+=d}while(d===255);u=0;do{if(o>=s.length)break;d=s[o++],u+=d}while(d===255);const f=s.length-o;let h=o;if(u<f)o+=u;else if(u>f){ze.error(`Malformed SEI payload. ${u} is too small, only ${f} bytes left to parse.`);break}if(l===4){if(s[h++]===181){const y=wT(s,h);if(h+=2,y===49){const S=_e(s,h);if(h+=4,S===1195456820){const A=s[h++];if(A===3){const _=s[h++],x=31&_,C=64&_,b=C?2+x*3:0,L=new Uint8Array(b);if(C){L[0]=_;for(let M=1;M<b;M++)L[M]=s[h++]}n.push({type:A,payloadType:l,pts:t,bytes:L})}}}}}else if(l===5&&u>16){const m=[];for(let A=0;A<16;A++){const _=s[h++].toString(16);m.push(_.length==1?"0"+_:_),(A===3||A===5||A===7||A===9)&&m.push("-")}const y=u-16,S=new Uint8Array(y);for(let A=0;A<y;A++)S[A]=s[h++];n.push({payloadType:l,pts:t,uuid:m.join(""),userData:gn(S),userDataBytes:S})}}}function OT(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const s=e-t.length,o=new Uint8Array(s);let l=0;for(n=0;n<s;l++,n++)l===t[0]&&(l++,t.shift()),o[n]=i[l];return o}function iw(i){const e=i[0];let t="",n="",s=0,o=0,l=0,u=0,d=0,f=0;if(e===0){for(;yt(i.subarray(f,f+1))!=="\0";)t+=yt(i.subarray(f,f+1)),f+=1;for(t+=yt(i.subarray(f,f+1)),f+=1;yt(i.subarray(f,f+1))!=="\0";)n+=yt(i.subarray(f,f+1)),f+=1;n+=yt(i.subarray(f,f+1)),f+=1,s=_e(i,12),o=_e(i,16),u=_e(i,20),d=_e(i,24),f=28}else if(e===1){f+=4,s=_e(i,f),f+=4;const m=_e(i,f);f+=4;const y=_e(i,f);for(f+=4,l=2**32*m+y,NM(l)||(l=Number.MAX_SAFE_INTEGER,ze.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=_e(i,f),f+=4,d=_e(i,f),f+=4;yt(i.subarray(f,f+1))!=="\0";)t+=yt(i.subarray(f,f+1)),f+=1;for(t+=yt(i.subarray(f,f+1)),f+=1;yt(i.subarray(f,f+1))!=="\0";)n+=yt(i.subarray(f,f+1)),f+=1;n+=yt(i.subarray(f,f+1)),f+=1}const h=i.subarray(f,i.byteLength);return{schemeIdUri:t,value:n,timeScale:s,presentationTime:l,presentationTimeDelta:o,eventDuration:u,id:d,payload:h}}function sw(i,...e){const t=e.length;let n=8,s=t;for(;s--;)n+=e[s].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(i,4),s=0,n=8;s<t;s++)o.set(e[s],n),n+=e[s].byteLength;return o}function rw(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,s;n=0,s=new Uint8Array;let o;n>0?(o=new Uint8Array(4),e.length>0&&new DataView(o.buffer).setUint32(0,e.length,!1)):o=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),sw([112,115,115,104],new Uint8Array([n,0,0,0]),i,o,s,l,t)}function ow(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const s=new DataView(i,n),o=aw(s);e.push(o),n+=o.size}}return e}function aw(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const o=i.getUint32(8)>>>24;if(o!==0&&o!==1)return{offset:t,size:e};const l=i.buffer,u=wt(new Uint8Array(l,t+12,16));let d=null,f=null,h=0;if(o===0)h=28;else{const y=i.getUint32(28);if(!y||n<32+y*16)return{offset:t,size:e};d=[];for(let S=0;S<y;S++)d.push(new Uint8Array(l,t+32+S*16,16));h=32+y*16}if(!h)return{offset:t,size:e};const m=i.getUint32(h);return e-32<m?{offset:t,size:e}:(f=new Uint8Array(l,t+h+4,m),{version:o,systemId:u,kids:d,data:f,offset:t,size:e})}const FT=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Nr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function rh(i,e){const t=Nr[e];return!!t&&!!t[i.slice(0,4)]}function qo(i,e,t=!0){return!i.split(",").some(n=>!oh(n,e,t))}function oh(i,e,t=!0){var n;const s=ns(t);return(n=s==null?void 0:s.isTypeSupported(Ko(i,e)))!=null?n:!1}function Ko(i,e){return`${e}/mp4;codecs=${i}`}function Sv(i){if(i){const e=i.substring(0,4);return Nr.video[e]}return 2}function jl(i){const e=FT();return i.split(",").reduce((t,n)=>{const o=e&&yu(n)?9:Nr.video[n];return o?(o*2+t)/(t?3:2):(Nr.audio[n]+t)/(t?2:1)},0)}const qf={};function lw(i,e=!0){if(qf[i])return qf[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let s=0;s<t.length;s++){var n;if(oh(t[s],"audio",e))return qf[i]=t[s],t[s];if(t[s]==="mp3"&&(n=ns(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const uw=/flac|opus|mp4a\.40\.34/i;function eu(i,e=!0){return i.replace(uw,t=>lw(t.toLowerCase(),e))}function cw(i,e){const t=[];if(i){const n=i.split(",");for(let s=0;s<n.length;s++)rh(n[s],"video")||t.push(n[s])}return e&&t.push(e),t.join(",")}function Bl(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Av(i,"audio")||Av(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function Av(i,e){return rh(i,e)&&oh(i,e)}function fw(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function dw(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function _v(i){const e=ns(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Cd(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const hw={supported:!0,powerEfficient:!0,smooth:!0},gw={supported:!1,smooth:!1,powerEfficient:!1},BT={supported:!0,configurations:[],decodingInfoResults:[hw]};function GT(i,e){return{supported:!1,configurations:e,decodingInfoResults:[gw],error:i}}function mw(i,e,t,n,s,o){const l=i.videoCodec,u=i.audioCodec?i.audioGroups:null,d=o==null?void 0:o.audioCodec,f=o==null?void 0:o.channels,h=f?parseInt(f):d?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((y,S)=>{if(S){const A=e.groups[S];if(!A)throw new Error(`Audio track group ${S} not found`);Object.keys(A.channels).forEach(_=>{y[_]=(y[_]||0)+A.channels[_]})}return y},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(y=>yu(y))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(s,8e6))||!!m&&he(h)&&Object.keys(m).some(y=>parseInt(y)>h)}function $T(i,e,t,n={}){const s=i.videoCodec;if(!s&&!i.audioCodec||!t)return Promise.resolve(BT);const o=[],l=pw(i),u=l.length,d=yw(i,e,u>0),f=d.length;for(let h=u||1*f||1;h--;){const m={type:"media-source"};if(u&&(m.video=l[h%u]),f){m.audio=d[h%f];const y=m.audio.bitrate;m.video&&y&&(m.video.bitrate-=y)}o.push(m)}if(s){const h=navigator.userAgent;if(s.split(",").some(m=>yu(m))&&FT())return Promise.resolve(GT(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),o))}return Promise.all(o.map(h=>{const m=Ew(h);return n[m]||(n[m]=t.decodingInfo(h))})).then(h=>({supported:!h.some(m=>!m.supported),configurations:o,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:o,decodingInfoResults:[],error:h}))}function pw(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=VT(i),s=i.width||640,o=i.height||480,l=i.frameRate||30,u=i.videoRange.toLowerCase();return t?t.map(d=>{const f={contentType:Ko(dw(d),"video"),width:s,height:o,bitrate:n,framerate:l};return u!=="sdr"&&(f.transferFunction=u),f}):[]}function yw(i,e,t){var n;const s=(n=i.audioCodec)==null?void 0:n.split(","),o=VT(i);return s&&i.audioGroups?i.audioGroups.reduce((l,u)=>{var d;const f=u?(d=e.groups[u])==null?void 0:d.tracks:null;return f?f.reduce((h,m)=>{if(m.groupId===u){const y=parseFloat(m.channels||"");s.forEach(S=>{const A={contentType:Ko(S,"audio"),bitrate:t?vw(S,o):o};y&&(A.channels=""+y),h.push(A)})}return h},l):l},[]):[]}function vw(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function VT(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function Ew(i){let e="";const{audio:t,video:n}=i;if(n){const s=Cd(n.contentType);e+=`${s}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const s=Cd(t.contentType);e+=`${n?"_":""}${s}_c${t.channels}`}return e}const Ld=["NONE","TYPE-0","TYPE-1",null];function Tw(i){return Ld.indexOf(i)>-1}const tu=["SDR","PQ","HLG"];function Sw(i){return!!i&&tu.indexOf(i)>-1}var Gl={No:"",Yes:"YES",v2:"v2"};function xv(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,s=n<e/2;return e&&s?t?Gl.v2:Gl.Yes:Gl.No}class Rv{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class zo{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Iv(this._audioGroups,e)}hasSubtitleGroup(e){return Iv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Iv(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function Aw(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function _w(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||tu.slice(0);const s=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&Aw(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const xw=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},je=(i,e)=>JSON.stringify(i,xw(e));function Rw(i,e,t,n,s){const o=Object.keys(i),l=n==null?void 0:n.channels,u=n==null?void 0:n.audioCodec,d=s==null?void 0:s.videoCodec,f=l&&parseInt(l)===2;let h=!1,m=!1,y=1/0,S=1/0,A=1/0,_=1/0,x=0,C=[];const{preferHDR:b,allowedVideoRanges:L}=_w(e,s);for(let $=o.length;$--;){const U=i[o[$]];h||(h=U.channels[2]>0),y=Math.min(y,U.minHeight),S=Math.min(S,U.minFramerate),A=Math.min(A,U.minBitrate),L.filter(J=>U.videoRanges[J]>0).length>0&&(m=!0)}y=he(y)?y:0,S=he(S)?S:0;const M=Math.max(1080,y),P=Math.max(30,S);A=he(A)?A:t,t=Math.max(A,t),m||(e=void 0);const G=o.length>1;return{codecSet:o.reduce(($,U)=>{const O=i[U];if(U===$)return $;if(C=m?L.filter(J=>O.videoRanges[J]>0):[],G){if(O.minBitrate>t)return Kn(U,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),$;if(!O.hasDefaultAudio)return Kn(U,"no renditions with default or auto-select sound found"),$;if(u&&U.indexOf(u.substring(0,4))%5!==0)return Kn(U,`audio codec preference "${u}" not found`),$;if(l&&!f){if(!O.channels[l])return Kn(U,`no renditions with ${l} channel sound found (channels options: ${Object.keys(O.channels)})`),$}else if((!u||f)&&h&&O.channels[2]===0)return Kn(U,"no renditions with stereo sound found"),$;if(O.minHeight>M)return Kn(U,`min resolution of ${O.minHeight} > maximum of ${M}`),$;if(O.minFramerate>P)return Kn(U,`min framerate of ${O.minFramerate} > maximum of ${P}`),$;if(!C.some(J=>O.videoRanges[J]>0))return Kn(U,`no variants with VIDEO-RANGE of ${je(C)} found`),$;if(d&&U.indexOf(d.substring(0,4))%5!==0)return Kn(U,`video codec preference "${d}" not found`),$;if(O.maxScore<x)return Kn(U,`max score of ${O.maxScore} < selected max of ${x}`),$}return $&&(jl(U)>=jl($)||O.fragmentError>i[$].fragmentError)?$:(_=O.minIndex,x=O.maxScore,U)},void 0),videoRanges:C,preferHDR:b,minFramerate:S,minBitrate:A,minIndex:_}}function Kn(i,e){ze.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function HT(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const s=t.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Iw(i,e,t,n){return i.slice(t,n+1).reduce((s,o,l)=>{if(!o.codecSet)return s;const u=o.audioGroups;let d=s[o.codecSet];d||(s[o.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,o.bitrate);const f=Math.min(o.height,o.width);return d.minHeight=Math.min(d.minHeight,f),d.minFramerate=Math.min(d.minFramerate,o.frameRate),d.minIndex=Math.min(d.minIndex,l),d.maxScore=Math.max(d.maxScore,o.score),d.fragmentError+=o.fragmentError,d.videoRanges[o.videoRange]=(d.videoRanges[o.videoRange]||0)+1,u&&u.forEach(h=>{if(!h)return;const m=e.groups[h];m&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(y=>{d.channels[y]=(d.channels[y]||0)+m.channels[y]}))}),s},{})}function Cv(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:o}=i;return{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:o}}function Jn(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const s=e[n];if(Ls(i,s,t))return n}return-1}function Ls(i,e,t){const{groupId:n,name:s,lang:o,assocLang:l,default:u}=i,d=i.forced;return(n===void 0||e.groupId===n)&&(s===void 0||e.name===s)&&(o===void 0||Cw(o,e.lang))&&(o===void 0||e.assocLang===l)&&(u===void 0||e.default===u)&&(d===void 0||e.forced===d)&&(!("characteristics"in i)||Lw(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function Cw(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function Lw(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(s=>n.indexOf(s)===-1)}function Cs(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function bw(i,e,t,n,s){const o=e[n],u=e.reduce((y,S,A)=>{const _=S.uri;return(y[_]||(y[_]=[])).push(A),y},{})[o.uri];u.length>1&&(n=Math.max.apply(Math,u));const d=o.videoRange,f=o.frameRate,h=o.codecSet.substring(0,4),m=Lv(e,n,y=>{if(y.videoRange!==d||y.frameRate!==f||y.codecSet.substring(0,4)!==h)return!1;const S=y.audioGroups,A=t.filter(_=>!S||S.indexOf(_.groupId)!==-1);return Jn(i,A,s)>-1});return m>-1?m:Lv(e,n,y=>{const S=y.audioGroups,A=t.filter(_=>!S||S.indexOf(_.groupId)!==-1);return Jn(i,A,s)>-1})}function Lv(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function nu(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class Dw extends bn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:s,partCurrent:o,hls:l}=this,{autoLevelEnabled:u,media:d}=l;if(!s||!d)return;const f=performance.now(),h=o?o.stats:s.stats,m=o?o.duration:s.duration,y=f-h.loading.start,S=l.minAutoLevel,A=s.level,_=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||A<=S){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const x=_>-1&&_!==A,C=!!t||x;if(!C&&(d.paused||!d.playbackRate||!d.readyState))return;const b=l.mainForwardBufferInfo;if(!C&&b===null)return;const L=this.bwEstimator.getEstimateTTFB(),M=Math.abs(d.playbackRate);if(y<=Math.max(L,1e3*(m/(M*2))))return;const P=b?b.len/M:0,G=h.loading.first?h.loading.first-h.loading.start:-1,N=h.loaded&&G>-1,$=this.getBwEstimate(),U=l.levels,O=U[A],J=Math.max(h.loaded,Math.round(m*(s.bitrate||O.averageBitrate)/8));let re=N?y-G:y;re<1&&N&&(re=Math.min(y,h.loaded*8/$));const oe=N?h.loaded*1e3/re:0,ce=L/1e3,fe=oe?(J-h.loaded)/oe:J*8/$+ce;if(fe<=P)return;const F=oe?oe*8:$,Q=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,ee=this.hls.config.abrBandWidthUpFactor;let le=Number.POSITIVE_INFINITY,de;for(de=A-1;de>S;de--){const ae=U[de].maxBitrate,ue=!U[de].details||Q;if(le=this.getTimeToLoadFrag(ce,F,m*ae,ue),le<Math.min(P,m+ce))break}if(le>=fe||le>m*10)return;N?this.bwEstimator.sample(y-Math.min(L,G),h.loaded):this.bwEstimator.sampleTTFB(y);const w=U[de].maxBitrate;this.getBwEstimate()*ee>w&&this.resetEstimator(w);const V=this.findBestLevel(w,S,de,0,P,1,1);V>-1&&(de=V),this.warn(`Fragment ${s.sn}${o?" part "+o.index:""} of level ${A} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${P.toFixed(3)} s
      Estimated load time for current fragment: ${fe.toFixed(3)} s
      Estimated load time for down switch fragment: ${le.toFixed(3)} s
      TTFB estimate: ${G|0} ms
      Current BW estimate: ${he($)?$|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${de} @ ${w|0} bps`),l.nextLoadLevel=l.nextAutoLevel=de,this.clearTimer();const se=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===de&&de>0){const ae=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${de>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ae.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,de>S){let ue=this.findBestLevel(this.hls.levels[S].bitrate,S,de,0,ae,1,1);ue===-1&&(ue=S),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ue,this.resetEstimator(this.hls.levels[ue].bitrate)}}};x||fe>le*2?se():this.timer=self.setInterval(se,le*1e3),l.trigger(I.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:o,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new kM(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(I.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var s;this.fragCurrent=n,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case K.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:s,partCurrent:o}=this;if(n&&s&&n.sn===s.sn&&n.level===s.level){const l=performance.now(),u=o?o.stats:n.stats,d=l-u.loading.start,f=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&f>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(m,f),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,n,s){const o=e+n/t,l=s?e+this.lastLevelLoadSec:0;return o+l}onLevelLoaded(e,t){const n=this.hls.config,{loading:s}=t.stats,o=s.end-s.first;he(o)&&(this.lastLevelLoadSec=o/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const s=n?n.stats:t.stats;if(t.type===pe.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const o=n?n.duration:t.duration,l=this.hls.levels[t.level],u=(l.loaded?l.loaded.bytes:0)+s.loaded,d=(l.loaded?l.loaded.duration:0)+o;l.loaded={bytes:u,duration:d},l.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){const o={stats:s,frag:t,part:n,id:t.type};this.onFragBuffered(I.FRAG_BUFFERED,o),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:s}=t,o=s!=null&&s.stats.loaded?s.stats:n.stats;if(o.aborted||this.ignoreFragment(n))return;const l=o.parsing.end-o.loading.start-Math.min(o.loading.first-o.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,o.loaded),o.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==pe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,o=this.findBestLevel(n,t,e,0,s,1,1);if(o>-1)return o;const l=this.hls.firstLevel,u=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const o=n&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,o)&&l[e].loadError<=l[o].loadError)return e}return this._nextAutoLevel=o,this.nextAutoLevelKey=this.getAutoLevelKey(),o}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:s,config:o,minAutoLevel:l}=n,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),f=this.getStarvationDelay();let h=o.abrBandWidthFactor,m=o.abrBandWidthUpFactor;if(f){const x=this.findBestLevel(d,l,s,f,0,h,m);if(x>=0)return this.rebufferNotice=-1,x}let y=u?Math.min(u,o.maxStarvationDelay):o.maxStarvationDelay;if(!f){const x=this.bitrateTestDelay;x&&(y=(u?Math.min(u,o.maxLoadingDelay):o.maxLoadingDelay)-x,this.info(`bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),h=m=1)}const S=this.findBestLevel(d,l,s,f,y,h,m);if(this.rebufferNotice!==S&&(this.rebufferNotice=S,this.info(`${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${S}`)),S>-1)return S;const A=n.levels[l],_=n.loadLevelObj;return _&&(A==null?void 0:A.bitrate)<_.bitrate?l:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,s,o,l,u){var d;const f=s+o,h=this.lastLoadedFragLevel,m=h===-1?this.hls.firstLevel:h,{fragCurrent:y,partCurrent:S}=this,{levels:A,allAudioTracks:_,loadLevel:x,config:C}=this.hls;if(A.length===1)return 0;const b=A[m],L=!!((d=this.hls.latestLevelDetails)!=null&&d.live),M=x===-1||h===-1;let P,G="SDR",N=(b==null?void 0:b.frameRate)||0;const{audioPreference:$,videoPreference:U}=C,O=this.audioTracksByGroup||(this.audioTracksByGroup=HT(_));let J=-1;if(M){if(this.firstSelection!==-1)return this.firstSelection;const F=this.codecTiers||(this.codecTiers=Iw(A,O,t,n)),Q=Rw(F,G,e,$,U),{codecSet:ee,videoRanges:le,minFramerate:de,minBitrate:w,minIndex:V,preferHDR:se}=Q;J=V,P=ee,G=se?le[le.length-1]:le[0],N=de,e=Math.max(e,w),this.log(`picked start tier ${je(Q)}`)}else P=b==null?void 0:b.codecSet,G=b==null?void 0:b.videoRange;const re=S?S.duration:y?y.duration:0,oe=this.bwEstimator.getEstimateTTFB()/1e3,ce=[];for(let F=n;F>=t;F--){var fe;const Q=A[F],ee=F>m;if(!Q)continue;if(C.useMediaCapabilities&&!Q.supportedResult&&!Q.supportedPromise){const ue=navigator.mediaCapabilities;typeof(ue==null?void 0:ue.decodingInfo)=="function"&&mw(Q,O,G,N,e,$)?(Q.supportedPromise=$T(Q,O,ue,this.supportedCache),Q.supportedPromise.then(ge=>{if(!this.hls)return;Q.supportedResult=ge;const Ae=this.hls.levels,Fe=Ae.indexOf(Q);ge.error?this.warn(`MediaCapabilities decodingInfo error: "${ge.error}" for level ${Fe} ${je(ge)}`):ge.supported?ge.decodingInfoResults.some(Oe=>Oe.smooth===!1||Oe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Fe} not smooth or powerEfficient: ${je(ge)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Fe} ${je(ge)}`),Fe>-1&&Ae.length>1&&(this.log(`Removing unsupported level ${Fe}`),this.hls.removeLevel(Fe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ge=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ge}`)})):Q.supportedResult=BT}if((P&&Q.codecSet!==P||G&&Q.videoRange!==G||ee&&N>Q.frameRate||!ee&&N>0&&N<Q.frameRate||(fe=Q.supportedResult)!=null&&(fe=fe.decodingInfoResults)!=null&&fe.some(ue=>ue.smooth===!1))&&(!M||F!==J)){ce.push(F);continue}const le=Q.details,de=(S?le==null?void 0:le.partTarget:le==null?void 0:le.averagetargetduration)||re;let w;ee?w=u*e:w=l*e;const V=re&&s>=re*2&&o===0?Q.averageBitrate:Q.maxBitrate,se=this.getTimeToLoadFrag(oe,w,V*de,le===void 0);if(w>=V&&(F===h||Q.loadError===0&&Q.fragmentError===0)&&(se<=oe||!he(se)||L&&!this.bitrateTestDelay||se<f)){const ue=this.forcedAutoLevel;return F!==x&&(ue===-1||ue!==x)&&(ce.length&&this.trace(`Skipped level(s) ${ce.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${A[ce[0]].codecs}" ${A[ce[0]].videoRange}; not compatible with "${P}" ${G}`),this.info(`switch candidate:${m}->${F} adjustedbw(${Math.round(w)})-bitrate=${Math.round(w-V)} ttfb:${oe.toFixed(1)} avgDuration:${de.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${se.toFixed(1)} firstSelection:${M} codecSet:${Q.codecSet} videoRange:${Q.videoRange} hls.loadLevel:${x}`)),M&&(this.firstSelection=F),F}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const qT={search:function(i,e){let t=0,n=i.length-1,s=null,o=null;for(;t<=n;){s=(t+n)/2|0,o=i[s];const l=e(o);if(l>0)t=s+1;else if(l<0)n=s-1;else return o}return null}};function Mw(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!he(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const s=i[i.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let o=0;o<i.length;++o){const l=i[o];if(Nw(e,t,l))return l}return null}function bs(i,e,t=0,n=0,s=.005){let o=null;if(i){o=e[1+i.sn-e[0].sn]||null;const u=i.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),o&&i.level!==o.level&&o.end<=i.end&&(o=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(o=e[0]);if(o&&((!i||i.level===o.level)&&bv(t,n,o)===0||ww(o,i,Math.min(s,n))))return o;const l=qT.search(e,bv.bind(null,t,n));return l&&(l!==i||!o)?l:o}function ww(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((s,o)=>(o[0]==="INF"&&(s+=parseFloat(o[1])),s),t);return i.start<=n}return!1}function bv(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function Nw(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function KT(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:s}=i;s&&(n=n.concat(s));let o;return qT.search(n,l=>l.cc<e?1:l.cc>e?-1:(o=l,l.end<=t?1:l.start>t?-1:0)),o||null}return null}function iu(i){switch(i.details){case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_TIMEOUT:case K.LEVEL_LOAD_TIMEOUT:case K.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function zT(i){return i.details.startsWith("key")}function YT(i){return zT(i)&&!!i.frag&&!i.frag.decryptdata}function Dv(i,e){const t=iu(e);return i.default[`${t?"timeout":"error"}Retry`]}function ah(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function Mv(i){return Ke(Ke({},i),{errorRetry:null,timeoutRetry:null})}function su(i,e,t,n){if(!i)return!1;const s=n==null?void 0:n.code,o=e<i.maxNumRetry&&(Pw(s)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,o):o}function Pw(i){return bd(i)||!!i&&(i<400||i>499)}function bd(i){return i===0&&navigator.onLine===!1}var Mt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},cn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class kw extends bn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.ERROR,this.onError,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.ERROR,this.onError,this),e.off(I.ERROR,this.onErrorOut,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===pe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(l=>s.indexOf(l.groupId)>=0).some(l=>{var u;return(u=l.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const s=this.hls,o=t.context;switch(t.details){case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case K.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=br();return}case K.FRAG_GAP:case K.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Mt.SendAlternateToPenaltyBox;return}case K.LEVEL_EMPTY_ERROR:case K.LEVEL_PARSING_ERROR:{var l;const d=t.parent===pe.MAIN?t.level:s.loadLevel;t.details===K.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:typeof(o==null?void 0:o.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.SUBTITLE_LOAD_ERROR:case K.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const d=s.loadLevelObj;if(d&&(o.type===De.AUDIO_TRACK&&d.hasAudioGroup(o.groupId)||o.type===De.SUBTITLE_TRACK&&d.hasSubtitleGroup(o.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Mt.SendAlternateToPenaltyBox,t.errorAction.flags=cn.MoveAllAlternatesMatchingHost;return}}return;case K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Mt.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingHDCP};return;case K.KEY_SYSTEM_SESSION_UPDATE_FAILED:case K.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case K.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Mt.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingKey};return;case K.BUFFER_ADD_CODEC_ERROR:case K.REMUX_ALLOC_ERROR:case K.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:s.loadLevel)}return;case K.INTERNAL_EXCEPTION:case K.BUFFER_APPENDING_ERROR:case K.BUFFER_FULL_ERROR:case K.LEVEL_SWITCH_ERROR:case K.BUFFER_STALLED_ERROR:case K.BUFFER_SEEK_OVER_HOLE:case K.BUFFER_NUDGE_ON_STALL:t.errorAction=br();return}t.type===Ee.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=br())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,s=Dv(n.config.playlistLoadPolicy,e),o=this.playlistError++;if(su(s,o,iu(e),e.response))return{action:Mt.RetryRequest,flags:cn.None,retryConfig:s,retryCount:o};const u=this.getLevelSwitchAction(e,t);return s&&(u.retryConfig=s,u.retryCount=o),u}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),s=t.levels[n],{fragLoadPolicy:o,keyLoadPolicy:l}=t.config,u=Dv(zT(e)?l:o,e),d=t.levels.reduce((h,m)=>h+m.fragmentError,0);if(s&&(e.details!==K.FRAG_GAP&&s.fragmentError++,!YT(e)&&su(u,d,iu(e),e.response)))return{action:Mt.RetryRequest,flags:cn.None,retryConfig:u,retryCount:d};const f=this.getLevelSwitchAction(e,n);return u&&(f.retryConfig=u,f.retryCount=d),f}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const s=this.hls.levels[t];if(s){var o,l;const f=e.details;s.loadError++,f===K.BUFFER_APPEND_ERROR&&s.fragmentError++;let h=-1;const{levels:m,loadLevel:y,minAutoLevel:S,maxAutoLevel:A}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const _=(o=e.frag)==null?void 0:o.type,C=(_===pe.AUDIO&&f===K.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:G})=>s.audioCodec!==G),L=e.sourceBufferName==="video"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR)&&m.some(({codecSet:G,audioCodec:N})=>s.codecSet!==G&&s.audioCodec===N),{type:M,groupId:P}=(l=e.context)!=null?l:{};for(let G=m.length;G--;){const N=(G+y)%m.length;if(N!==y&&N>=S&&N<=A&&m[N].loadError===0){var u,d;const $=m[N];if(f===K.FRAG_GAP&&_===pe.MAIN&&e.frag){const U=m[N].details;if(U){const O=bs(e.frag,U.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(M===De.AUDIO_TRACK&&$.hasAudioGroup(P)||M===De.SUBTITLE_TRACK&&$.hasSubtitleGroup(P))continue;if(_===pe.AUDIO&&(u=s.audioGroups)!=null&&u.some(U=>$.hasAudioGroup(U))||_===pe.SUBTITLE&&(d=s.subtitleGroups)!=null&&d.some(U=>$.hasSubtitleGroup(U))||C&&s.audioCodec===$.audioCodec||L&&s.codecSet===$.codecSet||!C&&s.codecSet!==$.codecSet)continue}h=N;break}}if(h>-1&&n.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:Mt.SendAlternateToPenaltyBox,flags:cn.None,nextAutoLevel:h}}return{action:Mt.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Mt.DoNothing:break;case Mt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==K.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:s}=n,o=n.nextAutoLevel;switch(s){case cn.None:this.switchLevel(e,o);break;case cn.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(e.frag),f=t.levels[d],h=f==null?void 0:f.attrs["HDCP-LEVEL"];if(n.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=Ld[Ld.indexOf(h)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case cn.MoveAllAlternatesMatchingKey:{const d=e.decryptdata;if(d){const f=this.hls.levels,h=f.length;for(let y=h;y--;)if(this.variantHasKey(f[y],d)){var l,u;this.log(`Banned key found in level ${y} (${f[y].bitrate}bps) or audio group "${(l=f[y].audioGroups)==null?void 0:l.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${wt(d.keyId||[])}`),f[y].fragmentError++,f[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const m=e.frag;if(this.hls.levels.length<h)n.resolved=!0;else if(m&&m.type!==pe.MAIN){const y=m.decryptdata;y&&!d.matches(y)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===K.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Cd(e.mimeType),s=this.hls.levels;for(let o=s.length;o--;)s[o][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${o} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(o))}}}function br(i){const e={action:Mt.DoNothing,flags:cn.None};return i&&(e.resolved=!0),e}var Et={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Uw{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let s=n.length;s--;){const o=n[s];if(!o)break;if(o.start<=e&&e<=o.end&&o.loaded)return o}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:s}=this,o=Object.keys(s);for(let l=o.length;l--;){const u=s[o[l]];if((u==null?void 0:u.body.type)===t&&(!n||u.buffered)){const d=u.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,n,s,o){this.timeRanges&&(this.timeRanges[e]=t);const l=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const d=this.fragments[u];if(!d||l>=d.body.sn)return;if(!d.buffered&&(!d.loaded||o)){d.body.type===n&&this.removeFragment(d.body);return}const f=d.range[e];if(f){if(f.time.length===0){this.removeFragment(d.body);return}f.time.some(h=>{const m=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return m&&this.removeFragment(d.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,s=vr(n),o=this.fragments[s];if(!o||o.buffered&&n.gap)return;const l=!n.relurl;Object.keys(t).forEach(u=>{const d=n.elementaryStreams[u];if(!d)return;const f=t[u],h=l||d.partial===!0;o.range[u]=this.getBufferedTimes(n,e.part,h,f)}),o.loaded=null,Object.keys(o.range).length?(this.bufferedEnd(o,n),xl(o)||this.removeParts(n.sn-1,n.type)):this.removeFragment(o.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=wv(n,s=>s.fragment.sn>=e))}fragBuffered(e,t){const n=vr(e);let s=this.fragments[n];!s&&t&&(s=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,n,s){const o={time:[],partial:n},l=e.start,u=e.end,d=e.minEndPTS||u,f=e.maxStartPTS||l;for(let h=0;h<s.length;h++){const m=s.start(h)-this.bufferPadding,y=s.end(h)+this.bufferPadding;if(f>=m&&d<=y){o.time.push({startPTS:Math.max(l,s.start(h)),endPTS:Math.min(u,s.end(h))});break}else if(l<y&&u>m){const S=Math.max(l,s.start(h)),A=Math.min(u,s.end(h));A>S&&(o.partial=!0,o.time.push({startPTS:S,endPTS:A}))}else if(u<=m)break}return o}getPartialFragment(e){let t=null,n,s,o,l=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(f=>{const h=d[f];h&&xl(h)&&(s=h.body.start-u,o=h.body.end+u,e>=s&&e<=o&&(n=Math.min(e-s,o-e),l<=n&&(t=h.body,l=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||xl(t))}getState(e){const t=vr(e),n=this.fragments[t];return n?n.buffered?xl(n)?Et.PARTIAL:Et.OK:Et.APPENDING:Et.NOT_LOADED}isTimeBuffered(e,t,n){let s,o;for(let l=0;l<n.length;l++){if(s=n.start(l)-this.bufferPadding,o=n.end(l)+this.bufferPadding,e>=s&&t<=o)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,s=t.part?null:t,o=vr(n);this.fragments[o]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:s,timeRanges:o,type:l}=t;if(n.sn==="initSegment")return;const u=n.type;if(s){let f=this.activePartLists[u];f||(this.activePartLists[u]=f=[]),f.push(s)}this.timeRanges=o;const d=o[l];this.detectEvictedFragments(l,d,u,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=vr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let s=n.length;s--;){const o=t[n[s]];if((o==null?void 0:o.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,s,o){s&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const u=this.fragments[l];if(!u)return;const d=u.body;d.type!==n||s&&!d.gap||d.start<t&&d.end>e&&(u.buffered||o)&&this.removeFragment(d)})}removeFragment(e){const t=vr(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const s=e.sn;this.activePartLists[e.type]=wv(n,o=>o.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function xl(i){var e,t,n;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(n=i.range.audiovideo)!=null&&n.partial)}function vr(i){return`${i.type}_${i.level}_${i.sn}`}function wv(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var is={cbc:0,ctr:1};class Ow{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case is.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case is.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Fw(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class Bw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let s=0;s<4;s++)n[s]=t.getUint32(s*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,s=n[0],o=n[1],l=n[2],u=n[3],d=this.invSubMix,f=d[0],h=d[1],m=d[2],y=d[3],S=new Uint32Array(256);let A=0,_=0,x=0;for(x=0;x<256;x++)x<128?S[x]=x<<1:S[x]=x<<1^283;for(x=0;x<256;x++){let C=_^_<<1^_<<2^_<<3^_<<4;C=C>>>8^C&255^99,e[A]=C,t[C]=A;const b=S[A],L=S[b],M=S[L];let P=S[C]*257^C*16843008;s[A]=P<<24|P>>>8,o[A]=P<<16|P>>>16,l[A]=P<<8|P>>>24,u[A]=P,P=M*16843009^L*65537^b*257^A*16843008,f[C]=P<<24|P>>>8,h[C]=P<<16|P>>>16,m[C]=P<<8|P>>>24,y[C]=P,A?(A=b^S[S[S[M^b]]],_^=S[S[_]]):A=_=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,s=0;for(;s<t.length&&n;)n=t[s]===this.key[s],s++;if(n)return;this.key=t;const o=this.keySize=t.length;if(o!==4&&o!==6&&o!==8)throw new Error("Invalid aes key size="+o);const l=this.ksRows=(o+6+1)*4;let u,d;const f=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),m=this.sBox,y=this.rcon,S=this.invSubMix,A=S[0],_=S[1],x=S[2],C=S[3];let b,L;for(u=0;u<l;u++){if(u<o){b=f[u]=t[u];continue}L=b,u%o===0?(L=L<<8|L>>>24,L=m[L>>>24]<<24|m[L>>>16&255]<<16|m[L>>>8&255]<<8|m[L&255],L^=y[u/o|0]<<24):o>6&&u%o===4&&(L=m[L>>>24]<<24|m[L>>>16&255]<<16|m[L>>>8&255]<<8|m[L&255]),f[u]=b=(f[u-o]^L)>>>0}for(d=0;d<l;d++)u=l-d,d&3?L=f[u]:L=f[u-4],d<4||u<=4?h[d]=L:h[d]=A[m[L>>>24]]^_[m[L>>>16&255]]^x[m[L>>>8&255]]^C[m[L&255]],h[d]=h[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const s=this.keySize+6,o=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,d=u[0],f=u[1],h=u[2],m=u[3],y=this.uint8ArrayToUint32Array_(n);let S=y[0],A=y[1],_=y[2],x=y[3];const C=new Int32Array(e),b=new Int32Array(C.length);let L,M,P,G,N,$,U,O,J,re,oe,ce,fe,F;const Q=this.networkToHostOrderSwap;for(;t<C.length;){for(J=Q(C[t]),re=Q(C[t+1]),oe=Q(C[t+2]),ce=Q(C[t+3]),N=J^o[0],$=ce^o[1],U=oe^o[2],O=re^o[3],fe=4,F=1;F<s;F++)L=d[N>>>24]^f[$>>16&255]^h[U>>8&255]^m[O&255]^o[fe],M=d[$>>>24]^f[U>>16&255]^h[O>>8&255]^m[N&255]^o[fe+1],P=d[U>>>24]^f[O>>16&255]^h[N>>8&255]^m[$&255]^o[fe+2],G=d[O>>>24]^f[N>>16&255]^h[$>>8&255]^m[U&255]^o[fe+3],N=L,$=M,U=P,O=G,fe=fe+4;L=l[N>>>24]<<24^l[$>>16&255]<<16^l[U>>8&255]<<8^l[O&255]^o[fe],M=l[$>>>24]<<24^l[U>>16&255]<<16^l[O>>8&255]<<8^l[N&255]^o[fe+1],P=l[U>>>24]<<24^l[O>>16&255]<<16^l[N>>8&255]<<8^l[$&255]^o[fe+2],G=l[O>>>24]<<24^l[N>>16&255]<<16^l[$>>8&255]<<8^l[U&255]^o[fe+3],b[t]=Q(L^S),b[t+1]=Q(G^A),b[t+2]=Q(P^_),b[t+3]=Q(M^x),S=J,A=re,_=oe,x=ce,t=t+4}return b.buffer}}class Gw{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=$w(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function $w(i){switch(i){case is.cbc:return"AES-CBC";case is.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const Vw=16;class lh{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Fw(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,s){return this.useSoftware?new Promise((o,l)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,n,s);const d=this.flush();d?o(d.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,s)}softwareDecrypt(e,t,n,s){const{currentIV:o,currentResult:l,remainderData:u}=this;if(s!==is.cbc||t.byteLength!==16)return ze.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=Ln(u,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;o&&(n=o);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new Bw),f.expandKey(t);const h=l;return this.currentResult=f.decrypt(d.buffer,0,n),this.currentIV=d.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,n,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,s));this.key=t,this.fastAesKey=new Gw(this.subtle,t,s)}return this.fastAesKey.expandKey().then(o=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Ow(this.subtle,new Uint8Array(n),s).decrypt(e.buffer,o)):Promise.reject(new Error("web crypto not initialized"))).catch(o=>(ze.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${o.name}: ${o.message}`),this.onWebCryptoError(e,t,n,s)))}onWebCryptoError(e,t,n,s){const o=this.enableSoftwareAES;if(o){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,s);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(o?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%Vw;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(ze.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Nv=Math.pow(2,17);class Hw{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ti({type:Ee.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,o=s.fLoader,l=s.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(A=>A[0]==="GAP")){d(kv(e));return}else e.gap=!1;const f=this.loader=o?new o(s):new l(s),h=Pv(e);e.loader=f;const m=Mv(s.fragLoadPolicy.default),y={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Nv};e.stats=f.stats;const S={onSuccess:(A,_,x,C)=>{this.resetLoader(e,f);let b=A.data;x.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(b.slice(0,16)),b=b.slice(16)),u({frag:e,part:null,payload:b,networkDetails:C})},onError:(A,_,x,C)=>{this.resetLoader(e,f),d(new Ti({type:Ee.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ke({url:n,data:void 0},A),error:new Error(`HTTP Error ${A.code} ${A.text}`),networkDetails:x,stats:C}))},onAbort:(A,_,x)=>{this.resetLoader(e,f),d(new Ti({type:Ee.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:x,stats:A}))},onTimeout:(A,_,x)=>{this.resetLoader(e,f),d(new Ti({type:Ee.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:x,stats:A}))}};t&&(S.onProgress=(A,_,x,C)=>t({frag:e,part:null,payload:x,networkDetails:C})),f.load(h,y,S)})}loadPart(e,t,n){this.abort();const s=this.config,o=s.fLoader,l=s.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(kv(e,t));return}const f=this.loader=o?new o(s):new l(s),h=Pv(e,t);e.loader=f;const m=Mv(s.fragLoadPolicy.default),y={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Nv};t.stats=f.stats,f.load(h,y,{onSuccess:(S,A,_,x)=>{this.resetLoader(e,f),this.updateStatsFromPart(e,t);const C={frag:e,part:t,payload:S.data,networkDetails:x};n(C),u(C)},onError:(S,A,_,x)=>{this.resetLoader(e,f),d(new Ti({type:Ee.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ke({url:h.url,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:_,stats:x}))},onAbort:(S,A,_)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,f),d(new Ti({type:Ee.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:_,stats:S}))},onTimeout:(S,A,_)=>{this.resetLoader(e,f),d(new Ti({type:Ee.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:_,stats:S}))}})})}updateStatsFromPart(e,t){const n=e.stats,s=t.stats,o=s.total;if(n.loaded+=s.loaded,o){const d=Math.round(e.duration/t.duration),f=Math.min(Math.round(n.loaded/o),d),m=(d-f)*Math.round(n.loaded/f);n.total=n.loaded+m}else n.total=Math.max(n.loaded,n.total);const l=n.loading,u=s.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Pv(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,o=t.byteRangeEndOffset;if(he(s)&&he(o)){var l;let u=s,d=o;if(i.sn==="initSegment"&&qw((l=i.decryptdata)==null?void 0:l.method)){const f=o-s;f%16&&(d=o+(16-f%16)),s!==0&&(n.resetIV=!0,u=s-16)}n.rangeStart=u,n.rangeEnd=d}return n}function kv(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:Ee.MEDIA_ERROR,details:K.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new Ti(n)}function qw(i){return i==="AES-128"||i==="AES-256"}class Ti extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class XT extends bn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class uh{constructor(e,t,n,s=0,o=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Rl(),this.buffering={audio:Rl(),video:Rl(),audiovideo:Rl()},this.level=e,this.sn=t,this.id=n,this.size=s,this.part=o,this.partial=l}}function Rl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Uv={length:0,start:()=>0,end:()=>0};class Re{static isBuffered(e,t){if(e){const n=Re.getBuffered(e);for(let s=n.length;s--;)if(t>=n.start(s)&&t<=n.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Re.getBuffered(e);return Re.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const s=Re.bufferedRanges(e);if(s.length)return Re.bufferedInfo(s,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((h,m)=>h.start-m.start||m.end-h.end);let s=-1,o=[];if(n)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(s=h);const m=o.length;if(m){const y=o[m-1].end;e[h].start-y<n?e[h].end>y&&(o[m-1].end=e[h].end):o.push(e[h])}else o.push(e[h])}else o=e;let l=0,u,d=t,f=t;for(let h=0;h<o.length;h++){const m=o[h].start,y=o[h].end;if(s===-1&&t>=m&&t<=y&&(s=h),t+n>=m&&t<y)d=m,f=y,l=f-t;else if(t+n<m){u=m;break}}return{len:l,start:d||0,end:f||0,nextStart:u,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Uv}catch(t){return ze.log("failed to get media.buffered",t),Uv}}}const JT=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ov(i){return JT.test(i)}function Dd(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(JT,n=>{const s=n.substring(2,n.length-1),o=t==null?void 0:t[s];return o===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),n):o})}return e}function Fv(i,e,t){let n=i.variableList;n||(i.variableList=n={});let s,o;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(s))o=l.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(l){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else s=e.NAME,o=e.VALUE;s in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=o||""}function Kw(i,e,t){const n=e.IMPORT;if(t&&n in t){let s=i.variableList;s||(i.variableList=s={}),s[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const zw=/^(\d+)x(\d+)$/,Bv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class it{constructor(e,t){typeof e=="string"&&(e=it.parseAttrList(e,t)),We(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)n[s]=parseInt(t.slice(s*2,s*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((s,o)=>(s[o.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=zw.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const s={};for(Bv.lastIndex=0;(n=Bv.exec(e))!==null;){const l=n[1].trim();let u=n[2];const d=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let f=!1;if(d)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":f=!0}if(t&&(d||f))u=Dd(t,u);else if(!f&&!d)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ze.warn(`${e}: attribute ${l} is missing quotes`)}s[l]=u}return s}}const Yw="com.apple.hls.interstitial";function Xw(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function Jw(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class WT{constructor(e,t,n=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:n,t){const o=t.attr;for(const l in o)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==o[l]){ze.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=We(new it({}),o,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const o=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);he(o.getTime())&&(this._endDate=o)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(ze.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(he(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Yw}get isValid(){return!!this.id&&!this._badValueForSameId&&he(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Ww=10;class Qw{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?he(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Ww}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ru(i,e){return i.length===e.length?!i.some((t,n)=>t!==e[n]):!1}function Gv(i,e){return!i&&!e?!0:!i||!e?!1:ru(i,e)}function Dr(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function ch(i){switch(i){case"AES-128":case"AES-256":return is.cbc;case"AES-256-CTR":return is.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function fh(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Md(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function Zw(i){const e=Md(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function QT(i){const e=function(n,s,o){const l=n[s];n[s]=n[o],n[o]=l};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function ZT(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){const o=s[0]==="base64",l=s[1];o?(n.splice(-1,1),t=fh(l)):t=Zw(l)}}return t}const ou=typeof self<"u"?self:void 0;var st={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Nt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function $l(i){switch(i){case Nt.FAIRPLAY:return st.FAIRPLAY;case Nt.PLAYREADY:return st.PLAYREADY;case Nt.WIDEVINE:return st.WIDEVINE;case Nt.CLEARKEY:return st.CLEARKEY}}function Kf(i){switch(i){case st.FAIRPLAY:return Nt.FAIRPLAY;case st.PLAYREADY:return Nt.PLAYREADY;case st.WIDEVINE:return Nt.WIDEVINE;case st.CLEARKEY:return Nt.CLEARKEY}}function Go(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[st.FAIRPLAY,st.WIDEVINE,st.PLAYREADY,st.CLEARKEY].filter(s=>!!e[s]):[];return!n[st.WIDEVINE]&&t&&n.push(st.WIDEVINE),n}const jT=(function(i){return ou!=null&&(i=ou.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function jw(i,e,t,n){let s;switch(i){case st.FAIRPLAY:s=["cenc","sinf"];break;case st.WIDEVINE:case st.PLAYREADY:s=["cenc"];break;case st.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return eN(s,e,t,n)}function eN(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(o=>({contentType:`audio/mp4; codecs=${o}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(o=>({contentType:`video/mp4; codecs=${o}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function tN(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function eS(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(l){const u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){const d=fh(u).subarray(0,16);return QT(d),d}}return null}let Er={};class ts{static clearKeyUriToKeyIdMap(){Er={}}static setKeyIdForUri(e,t){Er[e]=t}static addKeyIdForUri(e){const t=Object.keys(Er).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),Er[e]=n,n}constructor(e,t,n,s=[1],o=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=s,this.iv=o,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Dr(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(LT(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&ru(e.keyFormatVersions,this.keyFormatVersions)&&Gv(e.iv,this.iv)&&Gv(e.keyId,this.keyId)}isSupported(){if(this.method){if(Dr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Nt.FAIRPLAY:case Nt.WIDEVINE:case Nt.PLAYREADY:case Nt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Dr(this.method)){let o=this.iv;return o||(typeof e!="number"&&(ze.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),o=iN(e)),new ts(this.method,this.uri,"identity",this.keyFormatVersions,o)}if(this.keyId){const o=Er[this.uri];if(o&&!ru(this.keyId,o)&&ts.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=ZT(this.uri);if(n)switch(this.keyFormat){case Nt.WIDEVINE:if(this.pssh=n,!this.keyId){const o=ow(n.buffer);if(o.length){var s;const l=o[0];this.keyId=(s=l.kids)!=null&&s.length?l.kids[0]:null}}this.keyId||(this.keyId=$v(t));break;case Nt.PLAYREADY:{const o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=rw(o,null,n),this.keyId=eS(n);break}default:{let o=n.subarray(0,16);if(o.length!==16){const l=new Uint8Array(16);l.set(o,16-o.length),o=l}this.keyId=o;break}}if(!this.keyId||this.keyId.byteLength!==16){let o;o=nN(t),o||(o=$v(t),o||(o=Er[this.uri])),o&&(this.keyId=o,ts.setKeyIdForUri(this.uri,o))}return this}}function nN(i){const e=i==null?void 0:i[Nt.WIDEVINE];return e?e.keyId:null}function $v(i){const e=i==null?void 0:i[Nt.PLAYREADY];if(e){const t=ZT(e.uri);if(t)return eS(t)}return null}function iN(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const Vv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Hv=/#EXT-X-MEDIA:(.*)/g,sN=/^#EXT(?:INF|-X-TARGETDURATION):/m,zf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),rN=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Wn{static findGroup(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(s.id===t)return s}}static resolve(e,t){return nh.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return sN.test(e)}static parseMasterPlaylist(e,t){const n=Ov(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},o=[];if(Vv.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let l;for(;(l=Vv.exec(e))!=null;)if(l[1]){var u;const f=new it(l[1],s),h=Dd(s,l[2]),m={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:Wn.resolve(h,t)},y=f.decimalResolution("RESOLUTION");y&&(m.width=y.width,m.height=y.height),zv(f.CODECS,m);const S=f["SUPPLEMENTAL-CODECS"];S&&(m.supplemental={},zv(S,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||o.push(m),s.levels.push(m)}else if(l[3]){const f=l[3],h=l[4];switch(f){case"SESSION-DATA":{const m=new it(h,s),y=m["DATA-ID"];y&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[y]=m);break}case"SESSION-KEY":{const m=qv(h,t,s);m.encrypted&&m.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(m)):ze.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const m=new it(h,s);Fv(s,m,t)}break}case"CONTENT-STEERING":{const m=new it(h,s);s.contentSteering={uri:Wn.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Kv(h);break}}}const d=o.length>0&&o.length<s.levels.length;return s.levels=d?o:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,n){let s;const o={},l=n.levels,u={AUDIO:l.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:l.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(Hv.lastIndex=0;(s=Hv.exec(e))!==null;){const f=new it(s[1],n),h=f.TYPE;if(h){const m=u[h],y=o[h]||[];o[h]=y;const S=f.LANGUAGE,A=f["ASSOC-LANGUAGE"],_=f.CHANNELS,x=f.CHARACTERISTICS,C=f["INSTREAM-ID"],b={attrs:f,bitrate:0,id:d++,groupId:f["GROUP-ID"]||"",name:f.NAME||S||"",type:h,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:S,url:f.URI?Wn.resolve(f.URI,t):""};if(A&&(b.assocLang=A),_&&(b.channels=_),x&&(b.characteristics=x),C&&(b.instreamId=C),m!=null&&m.length){const L=Wn.findGroup(m,b.groupId)||m[0];Yv(b,L,"audioCodec"),Yv(b,L,"textCodec")}y.push(b)}}return o}static parseLevelPlaylist(e,t,n,s,o,l){var u;const d={url:t},f=new Qw(t),h=f.fragments,m=[];let y=null,S=0,A=0,_=0,x=0,C=0,b=null,L=new Vf(s,d),M,P,G,N=-1,$=!1,U=null,O;if(zf.lastIndex=0,f.m3u8=e,f.hasVariableRefs=Ov(e),((u=zf.exec(e))==null?void 0:u[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(M=zf.exec(e))!==null;){$&&($=!1,L=new Vf(s,d),L.playlistOffset=_,L.setStart(_),L.sn=S,L.cc=x,C&&(L.bitrate=C),L.level=n,y&&(L.initSegment=y,y.rawProgramDateTime&&(L.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),U&&(L.setByteRange(U),U=null)));const ce=M[1];if(ce){L.duration=parseFloat(ce);const fe=(" "+M[2]).slice(1);L.title=fe||null,L.tagList.push(fe?["INF",ce,fe]:["INF",ce])}else if(M[3]){if(he(L.duration)){L.playlistOffset=_,L.setStart(_),G&&Jv(L,G,f),L.sn=S,L.level=n,L.cc=x,h.push(L);const fe=(" "+M[3]).slice(1);L.relurl=Dd(f,fe),wd(L,b,m),b=L,_+=L.duration,S++,A=0,$=!0}}else{if(M=M[0].match(rN),!M){ze.warn("No matches on slow regex match for level playlist!");continue}for(P=1;P<M.length&&M[P]===void 0;P++);const fe=(" "+M[P]).slice(1),F=(" "+M[P+1]).slice(1),Q=M[P+2]?(" "+M[P+2]).slice(1):null;switch(fe){case"BYTERANGE":b?L.setByteRange(F,b):L.setByteRange(F);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=F,L.tagList.push(["PROGRAM-DATE-TIME",F]),N===-1&&(N=h.length);break;case"PLAYLIST-TYPE":f.type&&vi(f,fe,M),f.type=F.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?vi(f,fe,M):h.length>0&&Wv(f,fe,M),S=f.startSN=parseInt(F);break;case"SKIP":{f.skippedSegments&&vi(f,fe,M);const ee=new it(F,f),le=ee.decimalInteger("SKIPPED-SEGMENTS");if(he(le)){f.skippedSegments+=le;for(let w=le;w--;)h.push(null);S+=le}const de=ee.enumeratedString("RECENTLY-REMOVED-DATERANGES");de&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(de.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&vi(f,fe,M),f.targetduration=Math.max(parseInt(F),1);break;case"VERSION":f.version!==null&&vi(f,fe,M),f.version=parseInt(F);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||vi(f,fe,M),f.live=!1;break;case"#":(F||Q)&&L.tagList.push(Q?[F,Q]:[F]);break;case"DISCONTINUITY":x++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([fe]);break;case"BITRATE":L.tagList.push([fe,F]),C=parseInt(F)*1e3,he(C)?L.bitrate=C:C=0;break;case"DATERANGE":{const ee=new it(F,f),le=new WT(ee,f.dateRanges[ee.ID],f.dateRangeTagCount);f.dateRangeTagCount++,le.isValid||f.skippedSegments?f.dateRanges[le.id]=le:ze.warn(`Ignoring invalid DATERANGE tag: "${F}"`),L.tagList.push(["EXT-X-DATERANGE",F]);break}case"DEFINE":{{const ee=new it(F,f);"IMPORT"in ee?Kw(f,ee,l):Fv(f,ee,t)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?vi(f,fe,M):h.length>0&&Wv(f,fe,M),f.startCC=x=parseInt(F);break;case"KEY":{const ee=qv(F,t,f);if(ee.isSupported()){if(ee.method==="NONE"){G=void 0;break}G||(G={});const le=G[ee.keyFormat];le!=null&&le.matches(ee)||(le&&(G=We({},G)),G[ee.keyFormat]=ee)}else ze.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${F}"`);break}case"START":f.startTimeOffset=Kv(F);break;case"MAP":{const ee=new it(F,f);if(L.duration){const le=new Vf(s,d);Xv(le,ee,n,G),y=le,L.initSegment=y,y.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=y.rawProgramDateTime)}else{const le=L.byteRangeEndOffset;if(le){const de=L.byteRangeStartOffset;U=`${le-de}@${de}`}else U=null;Xv(L,ee,n,G),y=L,$=!0}y.cc=x;break}case"SERVER-CONTROL":{O&&vi(f,fe,M),O=new it(F),f.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),f.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&vi(f,fe,M);const ee=new it(F);f.partTarget=ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ee=f.partList;ee||(ee=f.partList=[]);const le=A>0?ee[ee.length-1]:void 0,de=A++,w=new it(F,f),V=new KM(w,L,d,de,le);ee.push(V),L.duration+=V.duration;break}case"PRELOAD-HINT":{const ee=new it(F,f);f.preloadHint=ee;break}case"RENDITION-REPORT":{const ee=new it(F,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(ee);break}default:ze.warn(`line parsed but not handled: ${M}`);break}}}b&&!b.relurl?(h.pop(),_-=b.duration,f.partList&&(f.fragmentHint=b)):f.partList&&(wd(L,b,m),L.cc=x,f.fragmentHint=L,G&&Jv(L,G,f)),f.targetduration||(f.playlistParsingError=new Error("Missing Target Duration"));const J=h.length,re=h[0],oe=h[J-1];if(_+=f.skippedSegments*f.targetduration,_>0&&J&&oe){f.averagetargetduration=_/J;const ce=oe.sn;f.endSN=ce!=="initSegment"?ce:0,f.live||(oe.endList=!0),N>0&&(aN(h,N),re&&m.unshift(re))}return f.fragmentHint&&(_+=f.fragmentHint.duration),f.totalduration=_,m.length&&f.dateRangeTagCount&&re&&tS(m,f),f.endCC=x,f}}function tS(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];i.push(u),t++}else return;const n=i[t-1],s=e.live?1/0:e.totalduration,o=Object.keys(e.dateRanges);for(let u=o.length;u--;){const d=e.dateRanges[o[u]],f=d.startDate.getTime();d.tagAnchor=n.ref;for(let h=t;h--;){var l;if(((l=i[h])==null?void 0:l.sn)<e.startSN)break;const m=oN(e,f,i,h,s);if(m!==-1){d.tagAnchor=e.fragments[m].ref;break}}}}function oN(i,e,t,n,s){const o=t[n];if(o){const u=o.programDateTime;if(e>=u||n===0){var l;const d=(((l=t[n+1])==null?void 0:l.start)||s)-o.start;if(e<=u+d*1e3){const f=t[n].sn-i.startSN;if(f<0)return-1;const h=i.fragments;if(h.length>t.length){const y=(t[n+1]||h[h.length-1]).sn-i.startSN;for(let S=y;S>f;S--){const A=h[S].programDateTime;if(e>=A&&e<A+h[S].duration*1e3)return S}}return f}}}return-1}function qv(i,e,t){var n,s;const o=new it(i,t),l=(n=o.METHOD)!=null?n:"",u=o.URI,d=o.hexadecimalInteger("IV"),f=o.KEYFORMATVERSIONS,h=(s=o.KEYFORMAT)!=null?s:"identity";u&&o.IV&&!d&&ze.error(`Invalid IV: ${o.IV}`);const m=u?Wn.resolve(u,e):"",y=(f||"1").split("/").map(Number).filter(Number.isFinite);return new ts(l,m,h,y,d,o.KEYID)}function Kv(i){const t=new it(i).decimalFloatingPoint("TIME-OFFSET");return he(t)?t:null}function zv(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const s=t.filter(o=>rh(o,n));s.length&&(e[`${n}Codec`]=s.map(o=>o.split("/")[0]).join(","),t=t.filter(o=>s.indexOf(o)===-1))}),e.unknownCodecs=t}function Yv(i,e,t){const n=e[t];n&&(i[t]=n)}function aN(i,e){let t=i[e];for(let n=e;n--;){const s=i[n];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function wd(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Xv(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function Jv(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&n.push(i)}function vi(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Wv(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Yf(i,e){const t=e.startPTS;if(he(t)){let n=0,s;e.sn>i.sn?(n=t-i.start,s=i):(n=i.start-t,s=e),s.duration!==n&&s.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function nS(i,e,t,n,s,o,l){n-t<=0&&(l.warn("Fragment should have a positive duration",e),n=t+e.duration,o=s+e.duration);let d=t,f=n;const h=e.startPTS,m=e.endPTS;if(he(h)){const C=Math.abs(h-t);i&&C>i.totalduration?l.warn(`media timestamps and playlist times differ by ${C}s for level ${e.level} ${i.url}`):he(e.deltaPTS)?e.deltaPTS=Math.max(C,e.deltaPTS):e.deltaPTS=C,d=Math.max(t,h),t=Math.min(t,h),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,f=Math.min(n,m),n=Math.max(n,m),o=e.endDTS!==void 0?Math.max(o,e.endDTS):o}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=s,e.endPTS=n,e.minEndPTS=f,e.endDTS=o;const S=e.sn;if(!i||S<i.startSN||S>i.endSN)return 0;let A;const _=S-i.startSN,x=i.fragments;for(x[_]=e,A=_;A>0;A--)Yf(x[A],x[A-1]);for(A=_;A<x.length-1;A++)Yf(x[A],x[A+1]);return i.fragmentHint&&Yf(x[x.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,y}function lN(i,e,t){if(i===e)return;let n=null;const s=i.fragments;for(let h=s.length-1;h>=0;h--){const m=s[h].initSegment;if(m){n=m;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let o;fN(i,e,(h,m,y,S)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==h.cc){const A=h.cc-m.cc;for(let _=y;_<S.length;_++)S[_].cc+=A;e.endCC=S[S.length-1].cc}he(h.startPTS)&&he(h.endPTS)&&(m.setStart(m.startPTS=h.startPTS),m.startDTS=h.startDTS,m.maxStartPTS=h.maxStartPTS,m.endPTS=h.endPTS,m.endDTS=h.endDTS,m.minEndPTS=h.minEndPTS,m.setDuration(h.endPTS-h.startPTS),m.duration&&(o=m),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(m.elementaryStreams=h.elementaryStreams),m.loader=h.loader,h.hasStats&&(m.stats=h.stats),h.initSegment&&(m.initSegment=h.initSegment,n=h.initSegment)});const l=e.fragments,u=e.fragmentHint?l.concat(e.fragmentHint):l;if(n&&u.forEach(h=>{var m;h&&(!h.initSegment||h.initSegment.relurl===((m=n)==null?void 0:m.relurl))&&(h.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=uN(i.dateRanges,e,t));const h=i.fragments.filter(m=>m.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<u.length;m++)u[m].programDateTime===null&&wd(u[m],u[m-1],h);tS(h,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var d;const h=rS(i,e.startSN-1);e.startCC=(d=h==null?void 0:h.cc)!=null?d:l[0].cc}cN(i.partList,e.partList,(h,m)=>{m.elementaryStreams=h.elementaryStreams,m.stats=h.stats}),o?nS(e,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS,t):iS(i,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const f=e.advancedDateTime;if(e.advanced&&f){const h=e.edge;e.driftStart||(e.driftStartTime=f,e.driftStart=h),e.driftEndTime=f,e.driftEnd=h}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function uN(i,e,t){const{dateRanges:n,recentlyRemovedDateranges:s}=e,o=We({},i);s&&s.forEach(d=>{delete o[d]});const u=Object.keys(o).length;return u?(Object.keys(n).forEach(d=>{const f=o[d],h=new WT(n[d].attr,f);h.isValid?(o[d]=h,f||(h.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${je(n[d].attr)}"`)}),o):n}function cN(i,e,t){if(i&&e){let n=0;for(let s=0,o=i.length;s<=o;s++){const l=i[s],u=e[s+n];l&&u&&l.index===u.index&&l.fragment.sn===u.fragment.sn?t(l,u):n--}}}function fN(i,e,t){const n=e.skippedSegments,s=Math.max(i.startSN,e.startSN)-e.startSN,o=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,l=e.startSN-i.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let f=s;f<=o;f++){const h=d[l+f];let m=u[f];if(n&&!m&&h&&(m=e.fragments[f]=h),h&&m){t(h,m,f,u);const y=h.relurl,S=m.relurl;if(y&&dN(y,S)){e.playlistParsingError=Qv(`media sequence mismatch ${m.sn}:`,i,e,h,m);return}else if(h.cc!==m.cc){e.playlistParsingError=Qv(`discontinuity sequence mismatch (${h.cc}!=${m.cc})`,i,e,h,m);return}}}}function Qv(i,e,t,n,s){return new Error(`${i} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function iS(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,s=i.fragments,o=n>=0;let l=0;if(o&&n<s.length)l=s[n].start;else if(o&&e.startSN===i.endSN+1)l=i.fragmentEnd;else if(o&&t)l=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=i.fragmentStart;else return;Nd(e,l)}function Nd(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function sS(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const o=n[n.length-1].duration*1e3;o<t&&(t=o)}}else t/=2;return Math.round(t)}function rS(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function Zv(i,e,t){return i?oS(i.partList,e,t):null}function oS(i,e,t){if(i)for(let n=i.length;n--;){const s=i[n];if(s.index===t&&s.fragment.sn===e)return s}return null}function aS(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function dN(i,e){return i!==e&&e?jv(i)!==jv(e):!1}function jv(i){return i.replace(/\?[^?]*$/,"")}function $o(i,e){for(let n=0,s=i.length;n<s;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function hN(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function eE(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function lS(i,e){const t=e.fragments;for(let n=0,s=t.length;n<s;n++)eE(t[n],i);e.fragmentHint&&eE(e.fragmentHint,i),e.alignedSliding=!0}function gN(i,e){i&&(uS(e,i),e.alignedSliding||au(e,i),!e.alignedSliding&&!e.skippedSegments&&iS(i,e,!1))}function uS(i,e){if(!hN(e,i))return;const t=Math.min(e.endCC,i.endCC),n=$o(e.fragments,t),s=$o(i.fragments,t);if(!n||!s)return;ze.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const o=n.start-s.start;lS(o,i)}function au(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let s,o;const l=Math.min(e.endCC,i.endCC);e.startCC<l&&i.startCC<l&&(s=$o(n,l),o=$o(t,l)),(!s||!o)&&(s=n[Math.floor(n.length/2)],o=$o(t,s.cc)||t[Math.floor(t.length/2)]);const u=s.programDateTime,d=o.programDateTime;if(!u||!d)return;const f=(d-u)/1e3-(o.start-s.start);lS(f,i)}function Vt(i,e,t){Zt(i,e,t),i.addEventListener(e,t)}function Zt(i,e,t){i.removeEventListener(e,t)}const mN={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},te={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class dh extends XT{constructor(e,t,n,s,o){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=te.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:u,media:d,mediaBuffer:f,state:h}=this,m=d?d.currentTime:0,y=Re.bufferInfo(f||d,m,l.maxBufferHole),S=!y.len;if(this.log(`Media seeking to ${he(m)?m.toFixed(3):m}, state: ${h}, ${S?"out of":"in"} buffer`),this.state===te.ENDED)this.resetLoadingState();else if(u){const A=l.maxFragLookUpTolerance,_=u.start-A,x=u.start+u.duration+A;if(S||x<y.start||_>y.end){const C=m>x;(m<_||C)&&(C&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const A=this.lastCurrentTime;if(m>A&&(this.lastCurrentTime=m),!this.loadingParts){const _=Math.max(y.end,m),x=this.shouldLoadParts(this.getLevelDetails(),_);x&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${_.toFixed(2)}`),this.loadingParts=x)}}this.hls.hasEnoughToStart||(this.log(`Setting ${S?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,S&&(this.startPosition=m)),S&&this.state===te.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=o,this.hls=e,this.fragmentLoader=new Hw(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new lh(e.config)}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===te.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=te.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,s=this.config.timelineOffset||0;if(n<=s)return!1;const o=e.buffered;this.config.maxBufferHole&&o&&o.length>1&&(e=Re.bufferedInfo(o,e.start,0));const l=e.nextStart;if(l&&l>s&&l<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const h=d[d.length-1];return Re.isBuffered(this.media,h.start+h.duration/2)}const f=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(f)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Vt(n,"seeking",this.onMediaSeeking),Vt(n,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===te.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Zt(s,"seeking",this.onMediaSeeking),Zt(s,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=te.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const s=o=>{const l=o.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${o.part?" part: "+o.part.index:""} of ${this.fragInfo(l,!1,o.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(o)};this._doFragLoad(e,t,n,s).then(o=>{if(!o)return;const l=this.state,u=o.frag;if(this.fragContextChanged(u)){(l===te.FRAG_LOADING||!this.fragCurrent&&l===te.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=te.IDLE);return}"payload"in o&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(I.FRAG_LOADED,o)),this._handleFragmentLoadComplete(o)}).catch(o=>{this.state===te.STOPPED||this.state===te.ERROR||(this.warn(`Frag error: ${(o==null?void 0:o.message)||o}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Et.APPENDING){const o=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,o),u=Math.max(e.duration,l?l.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Et.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:n};this.hls.trigger(I.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:s}=this,{frag:o,payload:l}=n,u=o.decryptdata;if(l&&l.byteLength>0&&u!=null&&u.key&&u.iv&&Dr(u.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),u.key.buffer,u.iv.buffer,ch(u.method)).catch(f=>{throw s.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:o}),f}).then(f=>{const h=self.performance.now();return s.trigger(I.FRAG_DECRYPTED,{frag:o,payload:f,stats:{tstart:d,tdecrypt:h}}),n.payload=f,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===te.STOPPED||this.state===te.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==te.STOPPED&&(this.state=te.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,s;const o=e.tracks;if(o&&!t.encrypted&&((n=o.audio)!=null&&n.encrypted||(s=o.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(u.message),!l||l.mediaKeys?!1:(this.hls.trigger(I.ERROR,{type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?mN.toString(Re.getBuffered(n)):"(detached)"})`),ft(e)){var s;if(e.type!==pe.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(u=>!!l[u])){this.state=te.IDLE;return}}const o=(s=this.levels)==null?void 0:s[e.level];o!=null&&o.fragmentError&&(this.log(`Resetting level fragment error count of ${o.fragmentError} on frag buffered`),o.fragmentError=0)}this.state=te.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:s,partsLoaded:o}=e,l=!o||o.length===0||o.some(d=>!d),u=new uh(n.level,n.sn,n.stats.chunkCount+1,0,s?s.index:-1,!l);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,s){var o;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let u=null;if(e.encrypted&&!((o=e.decryptdata)!=null&&o.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=te.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(I.KEY_LOADED,y),this.state===te.KEY_LOADING&&(this.state=te.IDLE),y}),this.hls.trigger(I.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(ft(e)&&(!d||e.sn!==d.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${d==null?void 0:d.sn}->${e.sn}`),this.loadingParts=y)}if(n=Math.max(e.start,n||0),this.loadingParts&&ft(e)){const y=l.partList;if(y&&s){n>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const S=this.getNextPart(y,e,n);if(S>-1){const A=y[S];e=this.fragCurrent=A.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${A.index} (${S}/${y.length-1}) of ${this.fragInfo(e,!1,A)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=A.start+A.duration,this.state=te.FRAG_LOADING;let _;return u?_=u.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,A,t,s)).catch(x=>this.handleFragLoadError(x)):_=this.doFragPartsLoad(e,A,t,s).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(I.FRAG_LOADING,{frag:e,part:A,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):_}else if(!e.url||this.loadedEndOfParts(y,n))return Promise.resolve(null)}}if(ft(e)&&this.loadingParts){var f;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(f=l.partList)==null?void 0:f.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),he(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=te.FRAG_LOADING;const h=this.config.progressive&&e.type!==pe.SUBTITLE;let m;return h&&u?m=u.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,s)).catch(y=>this.handleFragLoadError(y)):m=Promise.all([this.fragmentLoader.load(e,h?s:void 0),u]).then(([y])=>(!h&&s&&s(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(I.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,n,s){return new Promise((o,l)=>{var u;const d=[],f=(u=n.details)==null?void 0:u.partList,h=m=>{this.fragmentLoader.loadPart(e,m,s).then(y=>{d[m.index]=y;const S=y.part;this.hls.trigger(I.FRAG_LOADED,y);const A=Zv(n.details,e.sn,m.index+1)||oS(f,e.sn,m.index+1);if(A)h(A);else return o({frag:e,part:S,partsLoaded:d})}).catch(l)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===K.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ee.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(I.ERROR,t)}else this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==te.PARSING){!this.fragCurrent&&this.state!==te.STOPPED&&this.state!==te.ERROR&&(this.state=te.IDLE);return}const{frag:n,part:s,level:o}=t,l=self.performance.now();n.stats.parsing.end=l,s&&(s.stats.parsing.end=l);const u=this.getLevelDetails(),f=u&&n.sn>u.endSN||this.shouldLoadParts(u,n.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=f),this.updateLevelTiming(n,s,o,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const o=e.partList[0];if(o.fragment.type===pe.SUBTITLE)return!1;const l=o.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=l){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>o.start-o.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:s,sn:o,part:l}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${o} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const u=t[s],d=u.details,f=l>-1?Zv(d,o,l):null,h=f?f.fragment:rS(d,o,n);return h?(n&&n!==h&&(h.stats=n.stats),{frag:h,part:f,level:u}):null}bufferFragmentData(e,t,n,s,o){if(this.state!==te.PARSING)return;const{data1:l,data2:u}=e;let d=l;if(u&&(d=Ln(l,u)),!d.length)return;const f=this.initPTS[t.cc],h=f?-f.baseTime/f.timescale:void 0,m={type:e.type,frag:t,part:n,chunkMeta:s,offset:h,parent:t.type,data:d};if(this.hls.trigger(I.BUFFER_APPENDING,m),e.dropped&&e.independent&&!n){if(o)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Re.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,s=Re.bufferInfo(t,n,0),o=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,o*.25),u=Math.max(Math.min(e.start-l,s.end-l),n+l);e.start-u>l&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var n;const s=this.getLoadPosition();if(!he(s))return null;const l=this.lastCurrentTime>s||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,l)}getFwdBufferInfoAtPos(e,t,n,s){const o=Re.bufferInfo(e,t,s);if(o.len===0&&o.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,n);if(l&&(o.nextStart<=l.end||l.gap)){const u=Math.max(Math.min(o.nextStart,l.end)-t,s);return Re.bufferInfo(e,t,u)}}return o}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,s=Math.max(Math.min(e-t,n.maxBufferLength),t),o=Math.max(e-t*3,n.maxMaxBufferLength/2,s);return o>=s?(n.maxMaxBufferLength=o,this.warn(`Reduce max buffer length to ${o}s`),!0):!1}getAppendedFrag(e,t=pe.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,s=n.length;if(!s)return null;const{config:o}=this,l=n[0].start,u=o.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const m=o.initialLiveManifestSize;if(s<m)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var f;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const y=this.hls.startPosition,S=this.hls.liveSyncPosition,A=d?(y!==-1&&y>=l?y:S)||d.start:e;this.log(`Setting startPosition to ${A} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${S} frag.start: ${(f=d)==null?void 0:f.start}`),this.startPosition=this.nextLoadPosition=A}}else e<=l&&(d=n[0]);if(!d){const m=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,m,t)}let h=this.filterReplacedPrimary(d,t);if(!h&&d){const m=d.sn-t.startSN;h=this.filterReplacedPrimary(n[m+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Et.OK||n===Et.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,s,o){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&n.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,s,0);if(u!==null&&n.len+u.len>=o){const d=l.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(tE(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(tE(this.config)&&e.type!==pe.SUBTITLE){const n=this.hls.interstitialsManager,s=n==null?void 0:n.bufferingItem;if(s){const l=s.event;if(l){if(l.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const o=n==null?void 0:n.playerQueue;if(o)for(let l=o.length;l--;){const u=o[l].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let s=-1,o=!1,l=!0;for(let u=0,d=e.length;u<d;u++){const f=e[u];if(l=l&&!f.independent,s>-1&&n<f.start)break;const h=f.loaded;h?s=-1:(o||(f.independent||l)&&f.fragment===t)&&(f.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${f.start}`),s=u),o=h}return s}loadedEndOfParts(e,t){let n;for(let s=e.length;s--;){if(n=e[s],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let s=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),s=Mw(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const o=n.sn+1;if(o>=e.startSN&&o<=e.endSN){const l=t[o-e.startSN];n.cc===l.cc&&(s=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=KT(e,n.cc,n.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const o=this.hls.liveSyncPosition;o!==null&&(s=this.getFragmentAtPosition(o,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,n){const{config:s}=this;let{fragPrevious:o}=this,{fragments:l,endSN:u}=n;const{fragmentHint:d}=n,{maxFragLookUpTolerance:f}=s,h=n.partList,m=!!(this.loadingParts&&h!=null&&h.length&&d);m&&!this.bitrateTest&&h[h.length-1].fragment.sn===d.sn&&(l=l.concat(d),u=d.sn);let y;if(e<t){var S;const _=e<this.lastCurrentTime||e>t-f||(S=this.media)!=null&&S.paused||!this.startFragRequested?0:f;y=bs(o,l,e,_)}else y=l[l.length-1];if(y){const A=y.sn-n.startSN,_=this.fragmentTracker.getState(y);if((_===Et.OK||_===Et.PARTIAL&&y.gap)&&(o=y),o&&y.sn===o.sn&&(!m||h[0].fragment.sn>y.sn||!n.live)&&y.level===o.level){const C=l[A+1];y.sn<u&&this.fragmentTracker.getState(C)!==Et.OK?y=C:y=null}}return y}alignPlaylists(e,t,n){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const o=e.fragmentStart,l=!t,u=e.alignedSliding&&he(o);if(l||!u&&!o){gN(n,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),d}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const s=this.timelineOffset;if(n===-1){const o=this.startTimeOffset!==null,l=o?this.startTimeOffset:e.startTimeOffset;l!==null&&he(l)?(n=t+l,l<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${l} found in ${o?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+s}this.nextLoadPosition=n+s}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&ft(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==te.FRAG_LOADING_WAITING_RETRY)&&(this.state=te.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const C=this.getCurrentContext(t.chunkMeta);C&&(t.frag=C.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var o;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(o=this.fragCurrent)==null?void 0:o.url}`);return}const l=t.details===K.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(s,!0);const u=t.errorAction;if(!u){this.state=te.ERROR;return}const{action:d,flags:f,retryCount:h=0,retryConfig:m}=u,y=!!m,S=y&&d===Mt.RetryRequest,A=y&&!u.resolved&&f===cn.MoveAllAlternatesMatchingHost,_=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!S&&A&&ft(s)&&!s.endList&&_&&!YT(t))this.resetFragmentErrors(e),this.treatAsGap(s),u.resolved=!0;else if((S||A)&&h<m.maxNumRetry){var x;const C=bd((x=t.response)==null?void 0:x.code),b=ah(m,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+b,this.state=te.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,C){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${h+1}/${m.maxNumRetry} in ${b}ms`)}else if(m)if(this.resetFragmentErrors(e),h<m.maxNumRetry)!l&&d!==Mt.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else d===Mt.SendAlternateToPenaltyBox?this.state=te.WAITING_LEVEL:this.state=te.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!bd(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=te.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===te.PARSING||this.state===te.PARSED){const t=e.frag,n=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,n),o=s&&s.len>.5;o&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const l=!o;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===pe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==te.STOPPED&&(this.state=te.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const s=Re.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,n),this.state===te.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==te.STOPPED&&(this.state=te.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,s){const o=n.details;if(!o){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,f)=>{const h=e.elementaryStreams[f];if(h){const m=h.endPTS-h.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${f} duration reliably (${m})`),d||!1;const y=s?0:nS(o,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(I.LEVEL_PTS_UPDATED,{details:o,level:n,drift:y,type:f,frag:e,start:h.startPTS,end:h.endPTS}),!0}return d},!1)){var u;const d=((u=this.transmuxer)==null?void 0:u.error)===null;if((n.fragmentError===0||d&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),d){const f=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=te.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(I.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===pe.MAIN?"level":"track"}fragInfo(e,t=!0,n){var s,o;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((s=t&&!n?e.startPTS:(n||e).start)!=null?s:NaN).toFixed(3)}-${((o=t&&!n?e.endPTS:(n||e).end)!=null?o:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function tE(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class cS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=pN(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function pN(i,e){const t=new Uint8Array(e);let n=0;for(let s=0;s<i.length;s++){const o=i[s];t.set(o,n),n+=o.length}return t}var Xf={exports:{}},nE;function yN(){return nE||(nE=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(d,f,h){this.fn=d,this.context=f,this.once=h||!1}function o(d,f,h,m,y){if(typeof h!="function")throw new TypeError("The listener must be a function");var S=new s(h,m||d,y),A=t?t+f:f;return d._events[A]?d._events[A].fn?d._events[A]=[d._events[A],S]:d._events[A].push(S):(d._events[A]=S,d._eventsCount++),d}function l(d,f){--d._eventsCount===0?d._events=new n:delete d._events[f]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var f=[],h,m;if(this._eventsCount===0)return f;for(m in h=this._events)e.call(h,m)&&f.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(h)):f},u.prototype.listeners=function(f){var h=t?t+f:f,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var y=0,S=m.length,A=new Array(S);y<S;y++)A[y]=m[y].fn;return A},u.prototype.listenerCount=function(f){var h=t?t+f:f,m=this._events[h];return m?m.fn?1:m.length:0},u.prototype.emit=function(f,h,m,y,S,A){var _=t?t+f:f;if(!this._events[_])return!1;var x=this._events[_],C=arguments.length,b,L;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),C){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,h),!0;case 3:return x.fn.call(x.context,h,m),!0;case 4:return x.fn.call(x.context,h,m,y),!0;case 5:return x.fn.call(x.context,h,m,y,S),!0;case 6:return x.fn.call(x.context,h,m,y,S,A),!0}for(L=1,b=new Array(C-1);L<C;L++)b[L-1]=arguments[L];x.fn.apply(x.context,b)}else{var M=x.length,P;for(L=0;L<M;L++)switch(x[L].once&&this.removeListener(f,x[L].fn,void 0,!0),C){case 1:x[L].fn.call(x[L].context);break;case 2:x[L].fn.call(x[L].context,h);break;case 3:x[L].fn.call(x[L].context,h,m);break;case 4:x[L].fn.call(x[L].context,h,m,y);break;default:if(!b)for(P=1,b=new Array(C-1);P<C;P++)b[P-1]=arguments[P];x[L].fn.apply(x[L].context,b)}}return!0},u.prototype.on=function(f,h,m){return o(this,f,h,m,!1)},u.prototype.once=function(f,h,m){return o(this,f,h,m,!0)},u.prototype.removeListener=function(f,h,m,y){var S=t?t+f:f;if(!this._events[S])return this;if(!h)return l(this,S),this;var A=this._events[S];if(A.fn)A.fn===h&&(!y||A.once)&&(!m||A.context===m)&&l(this,S);else{for(var _=0,x=[],C=A.length;_<C;_++)(A[_].fn!==h||y&&!A[_].once||m&&A[_].context!==m)&&x.push(A[_]);x.length?this._events[S]=x.length===1?x[0]:x:l(this,S)}return this},u.prototype.removeAllListeners=function(f){var h;return f?(h=t?t+f:f,this._events[h]&&l(this,h)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,i.exports=u})(Xf)),Xf.exports}var vN=yN(),hh=HM(vN);const Yo="1.6.15",Pr={};function EN(){return typeof __HLS_WORKER_BUNDLE__=="function"}function TN(){const i=Pr[Yo];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Pr[Yo]=s,s}function SN(i){const e=Pr[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Pr[i]=s,s}function AN(i){const e=Pr[i||Yo];if(e&&e.clientCount--===1){const{worker:n,objectURL:s}=e;delete Pr[i||Yo],s&&self.URL.revokeObjectURL(s),n.terminate()}}function fS(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function gh(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function vu(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Xo(i,e){const t=e;let n=0;for(;gh(i,e);){n+=10;const s=vu(i,e+6);n+=s,fS(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function _N(i,e,t,n){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o=e[t+2],l=o>>2&15;if(l>12){const S=new Error(`invalid ADTS sampling index:${l}`);i.emit(I.ERROR,I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!0,error:S,reason:S.message});return}const u=(o>>6&3)+1,d=e[t+3]>>6&3|(o&1)<<2,f="mp4a.40."+u,h=s[l];let m=l;(u===5||u===29)&&(m-=3);const y=[u<<3|(m&14)>>1,(m&1)<<7|d<<3];return ze.log(`manifest codec:${n}, parsed codec:${f}, channels:${d}, rate:${h} (ADTS object type:${u} sampling index:${l})`),{config:y,samplerate:h,channelCount:d,codec:f,parsedCodec:f,manifestCodec:n}}function dS(i,e){return i[e]===255&&(i[e+1]&246)===240}function hS(i,e){return i[e+1]&1?7:9}function mh(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function xN(i,e){return e+5<i.length}function lu(i,e){return e+1<i.length&&dS(i,e)}function RN(i,e){return xN(i,e)&&dS(i,e)&&mh(i,e)<=i.length-e}function IN(i,e){if(lu(i,e)){const t=hS(i,e);if(e+t>=i.length)return!1;const n=mh(i,e);if(n<=t)return!1;const s=e+n;return s===i.length||lu(i,s)}return!1}function gS(i,e,t,n,s){if(!i.samplerate){const o=_N(e,t,n,s);if(!o)return;We(i,o)}}function mS(i){return 1024*9e4/i}function CN(i,e){const t=hS(i,e);if(e+t<=i.length){const n=mh(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function pS(i,e,t,n,s){const o=mS(i.samplerate),l=n+s*o,u=CN(e,t);let d;if(u){const{frameLength:m,headerLength:y}=u,S=y+m,A=Math.max(0,t+S-e.length);A?(d=new Uint8Array(S-y),d.set(e.subarray(t+y,e.length),0)):d=e.subarray(t+y,t+S);const _={unit:d,pts:l};return A||i.samples.push(_),{sample:_,length:S,missing:A}}const f=e.length-t;return d=new Uint8Array(f),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:l},length:f,missing:-1}}function LN(i,e){return gh(i,e)&&vu(i,e+6)+10<=i.length-e}function bN(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Jf(i,e=0,t=1/0){return DN(i,e,t,Uint8Array)}function DN(i,e,t,n){const s=MN(i);let o=1;"BYTES_PER_ELEMENT"in n&&(o=n.BYTES_PER_ELEMENT);const l=wN(i)?i.byteOffset:0,u=(l+i.byteLength)/o,d=(l+e)/o,f=Math.floor(Math.max(0,Math.min(d,u))),h=Math.floor(Math.min(f+Math.max(t,0),u));return new n(s,f,h-f)}function MN(i){return i instanceof ArrayBuffer?i:i.buffer}function wN(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function NN(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const s=gn(Jf(i.data,1,n)),o=i.data[2+n],l=i.data.subarray(3+n).indexOf(0);if(l===-1)return;const u=gn(Jf(i.data,3+n,l));let d;return s==="-->"?d=gn(Jf(i.data,4+n+l)):d=bN(i.data.subarray(4+n+l)),e.mimeType=s,e.pictureType=o,e.description=u,e.data=d,e}function PN(i){if(i.size<2)return;const e=gn(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function kN(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=gn(i.data.subarray(t),!0);t+=n.length+1;const s=gn(i.data.subarray(t));return{key:i.type,info:n,data:s}}const e=gn(i.data.subarray(1));return{key:i.type,info:"",data:e}}function UN(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=gn(i.data.subarray(t),!0);t+=n.length+1;const s=gn(i.data.subarray(t));return{key:i.type,info:n,data:s}}const e=gn(i.data);return{key:i.type,info:"",data:e}}function ON(i){return i.type==="PRIV"?PN(i):i.type[0]==="W"?UN(i):i.type==="APIC"?NN(i):kN(i)}function FN(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=vu(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const Il=10,BN=10;function yS(i){let e=0;const t=[];for(;gh(i,e);){const n=vu(i,e+6);i[e+5]>>6&1&&(e+=Il),e+=Il;const s=e+n;for(;e+BN<s;){const o=FN(i.subarray(e)),l=ON(o);l&&t.push(l),e+=o.size+Il}fS(i,e)&&(e+=Il)}return t}function vS(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function GN(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function ph(i){const e=yS(i);for(let t=0;t<e.length;t++){const n=e[t];if(vS(n))return GN(n)}}let dn=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function Xn(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class yh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Ln(this.cachedData,e),this.cachedData=null);let n=Xo(e,0),s=n?n.length:0,o;const l=this._audioTrack,u=this._id3Track,d=n?ph(n):void 0,f=e.length;for((this.basePTS===null||this.frameIndex===0&&he(d))&&(this.basePTS=$N(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:dn.audioId3,duration:Number.POSITIVE_INFINITY});s<f;){if(this.canParse(e,s)){const h=this.appendFrame(l,e,s);h?(this.frameIndex++,this.lastPTS=h.sample.pts,s+=h.length,o=s):s=f}else LN(e,s)?(n=Xo(e,s),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:dn.audioId3,duration:Number.POSITIVE_INFINITY}),s+=n.length,o=s):s++;if(s===f&&o!==f){const h=e.slice(o);this.cachedData?this.cachedData=Ln(this.cachedData,h):this.cachedData=h}}return{audioTrack:l,videoTrack:Xn(),id3Track:u,textTrack:Xn()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Xn(),id3Track:this._id3Track,textTrack:Xn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const $N=(i,e,t)=>{if(he(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let Cl=null;const VN=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],HN=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],qN=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],KN=[0,1,1,4];function ES(i,e,t,n,s){if(t+24>e.length)return;const o=TS(e,t);if(o&&t+o.frameLength<=e.length){const l=o.samplesPerFrame*9e4/o.sampleRate,u=n+s*l,d={unit:e.subarray(t,t+o.frameLength),pts:u,dts:u};return i.config=[],i.channelCount=o.channelCount,i.samplerate=o.sampleRate,i.samples.push(d),{sample:d,length:o.frameLength,missing:0}}}function TS(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,s=i[e+2]>>4&15,o=i[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&o!==3){const l=i[e+2]>>1&1,u=i[e+3]>>6,d=t===3?3-n:n===3?3:4,f=VN[d*14+s-1]*1e3,m=HN[(t===3?0:t===2?1:2)*3+o],y=u===3?1:2,S=qN[t][n],A=KN[n],_=S*8*A,x=Math.floor(S*f/m+l)*A;if(Cl===null){const L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Cl=L?parseInt(L[1]):0}return!!Cl&&Cl<=87&&n===2&&f>=224e3&&u===0&&(i[e+3]=i[e+3]|128),{sampleRate:m,channelCount:y,frameLength:x,samplesPerFrame:_}}}function vh(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function SS(i,e){return e+1<i.length&&vh(i,e)}function zN(i,e){return vh(i,e)&&4<=i.length-e}function AS(i,e){if(e+1<i.length&&vh(i,e)){const n=TS(i,e);let s=4;n!=null&&n.frameLength&&(s=n.frameLength);const o=e+s;return o===i.length||SS(i,o)}return!1}class YN extends yh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Xo(e,0);let s=(n==null?void 0:n.length)||0;if(AS(e,s))return!1;for(let o=e.length;s<o;s++)if(IN(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return RN(e,t)}appendFrame(e,t,n){gS(e,this.observer,t,n,e.manifestCodec);const s=pS(e,t,n,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const _S=(i,e)=>{let t=0,n=5;e+=n;const s=new Uint32Array(1),o=new Uint32Array(1),l=new Uint8Array(1);for(;n>0;){l[0]=i[e];const u=Math.min(n,8),d=8-u;o[0]=4278190080>>>24+d<<d,s[0]=(l[0]&o[0])>>d,t=t?t<<u|s[0]:s[0],e+=1,n-=u}return t};class XN extends yh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const s=xS(e,t,n,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Xo(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&ph(t)!==void 0&&_S(e,n)<16}}function xS(i,e,t,n,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const o=e[t+4]>>6;if(o>=3)return-1;const u=[48e3,44100,32e3][o],d=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+o]*2;if(t+h>e.length)return-1;const m=e[t+6]>>5;let y=0;m===2?y+=2:(m&1&&m!==1&&(y+=2),m&4&&(y+=2));const S=(e[t+6]<<8|e[t+7])>>12-y&1,_=[2,1,2,3,3,4,4,5][m]+S,x=e[t+5]>>3,C=e[t+5]&7,b=new Uint8Array([o<<6|x<<1|C>>2,(C&3)<<6|m<<3|S<<2|d>>4,d<<4&224]),L=1536/u*9e4,M=n+s*L,P=e.subarray(t,t+h);return i.config=b,i.channelCount=_,i.samplerate=u,i.samples.push({unit:P,pts:M}),h}class JN extends yh{resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Xo(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&ph(t)!==void 0&&_S(e,n)<=16)return!1;for(let s=e.length;n<s;n++)if(AS(e,n))return ze.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return zN(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return ES(e,t,n,this.basePTS,this.frameIndex)}}const WN=/\/emsg[-/]ID3/i;class QN{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,s){const o=this.videoTrack=Xn("video",1),l=this.audioTrack=Xn("audio",1),u=this.txtTrack=Xn("text",1);if(this.id3Track=Xn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=PT(e);if(d.video){const{id:f,timescale:h,codec:m,supplemental:y}=d.video;o.id=f,o.timescale=u.timescale=h,o.codec=m,o.supplemental=y}if(d.audio){const{id:f,timescale:h,codec:m}=d.audio;l.id=f,l.timescale=h,l.codec=m}u.id=MT.text,o.sampleDuration=0,o.duration=l.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return XM(e)}demux(e,t){this.timeOffset=t;let n=e;const s=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Ln(this.remainderData,e));const u=tw(n);this.remainderData=u.remainder,s.samples=u.valid||new Uint8Array}else s.samples=n;const l=this.extractID3Track(s,t);return o.samples=Tv(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return n.samples=Tv(e,t),{videoTrack:t,audioTrack:Xn(),id3Track:s,textTrack:Xn()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const s=be(e.samples,["emsg"]);s&&s.forEach(o=>{const l=iw(o);if(WN.test(l.schemeIdUri)){const u=iE(l,t);let d=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const f=l.payload;n.samples.push({data:f,len:f.byteLength,dts:u,pts:u,type:dn.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=iE(l,t);n.samples.push({data:l.payload,len:l.payload.byteLength,dts:u,pts:u,type:dn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function iE(i,e){return he(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class ZN{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new lh(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,is.cbc)}decryptAacSample(e,t,n){const s=e[t].unit;if(s.length<=16)return;const o=s.subarray(16,s.length-s.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then(u=>{const d=new Uint8Array(u);s.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let s=0;for(let o=32;o<e.length-16;o+=160,s+=16)n.set(e.subarray(o,o+16),s);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let s=0;for(let o=32;o<e.length-16;o+=160,s+=16)e.set(n.subarray(s,s+16),o);return e}decryptAvcSample(e,t,n,s,o){const l=OT(o.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(d=>{o.data=this.getAvcDecryptedUnit(l,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,s)}).catch(s)}decryptAvcSamples(e,t,n,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){s();return}const o=e[t].units;for(;!(n>=o.length);n++){const l=o[n];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,n,s,l),!this.decrypter.isSync()))return}}}}class RS{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,s;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const o=n.units;s=o[o.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,s=n.length;if(s){const o=n[s-1];e.pts=o.pts,e.dts=o.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const s=t.byteLength;let o=e.naluState||0;const l=o,u=[];let d=0,f,h,m,y=-1,S=0;for(o===-1&&(y=0,S=this.getNALuType(t,0),o=0,d=1);d<s;){if(f=t[d++],!o){o=f?0:1;continue}if(o===1){o=f?0:2;continue}if(!f)o=3;else if(f===1){if(h=d-o-1,y>=0){const A={data:t.subarray(y,h),type:S};u.push(A)}else{const A=this.getLastNalUnit(e.samples);A&&(l&&d<=4-l&&A.state&&(A.data=A.data.subarray(0,A.data.byteLength-l)),h>0&&(A.data=Ln(A.data,t.subarray(0,h)),A.state=0))}d<s?(m=this.getNALuType(t,d),y=d,S=m,o=0):o=-1}else o=0}if(y>=0&&o>=0){const A={data:t.subarray(y,s),type:S,state:o};u.push(A)}if(u.length===0){const A=this.getLastNalUnit(e.samples);A&&(A.data=Ln(A.data,t))}return e.naluState=o,u}}class Vo{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,s=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");s.set(e.subarray(n,n+o)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=o*8,this.bytesAvailable-=o}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&ze.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class jN extends RS{parsePES(e,t,n,s){const o=this.parseNALu(e,n.data,s);let l=this.VideoSample,u,d=!1;n.data=null,l&&o.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.forEach(f=>{var h,m;switch(f.type){case 1:{let _=!1;u=!0;const x=f.data;if(d&&x.length>4){const C=this.readSliceType(x);(C===2||C===4||C===7||C===9)&&(_=!0)}if(_){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.frame=!0,l.key=_;break}case 5:u=!0,(h=l)!=null&&h.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 6:{u=!0,sh(f.data,1,n.pts,t.samples);break}case 7:{var S,A;u=!0,d=!0;const _=f.data,x=this.readSPS(_);if(!e.sps||e.width!==x.width||e.height!==x.height||((S=e.pixelRatio)==null?void 0:S[0])!==x.pixelRatio[0]||((A=e.pixelRatio)==null?void 0:A[1])!==x.pixelRatio[1]){e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.sps=[_];const C=_.subarray(1,4);let b="avc1.";for(let L=0;L<3;L++){let M=C[L].toString(16);M.length<2&&(M="0"+M),b+=M}e.codec=b}break}case 8:u=!0,e.pps=[f.data];break;case 9:u=!0,e.audFound=!0,(m=l)!=null&&m.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:u=!0;break;default:u=!1;break}l&&u&&l.units.push(f)}),s&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Vo(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,s=8,o;for(let l=0;l<e;l++)s!==0&&(o=t.readEG(),s=(n+o+256)%256),n=s===0?n:s}readSPS(e){const t=new Vo(e);let n=0,s=0,o=0,l=0,u,d,f;const h=t.readUByte.bind(t),m=t.readBits.bind(t),y=t.readUEG.bind(t),S=t.readBoolean.bind(t),A=t.skipBits.bind(t),_=t.skipEG.bind(t),x=t.skipUEG.bind(t),C=this.skipScalingList.bind(this);h();const b=h();if(m(5),A(3),h(),x(),b===100||b===110||b===122||b===244||b===44||b===83||b===86||b===118||b===128){const $=y();if($===3&&A(1),x(),x(),A(1),S())for(d=$!==3?8:12,f=0;f<d;f++)S()&&(f<6?C(16,t):C(64,t))}x();const L=y();if(L===0)y();else if(L===1)for(A(1),_(),_(),u=y(),f=0;f<u;f++)_();x(),A(1);const M=y(),P=y(),G=m(1);G===0&&A(1),A(1),S()&&(n=y(),s=y(),o=y(),l=y());let N=[1,1];if(S()&&S())switch(h()){case 1:N=[1,1];break;case 2:N=[12,11];break;case 3:N=[10,11];break;case 4:N=[16,11];break;case 5:N=[40,33];break;case 6:N=[24,11];break;case 7:N=[20,11];break;case 8:N=[32,11];break;case 9:N=[80,33];break;case 10:N=[18,11];break;case 11:N=[15,11];break;case 12:N=[64,33];break;case 13:N=[160,99];break;case 14:N=[4,3];break;case 15:N=[3,2];break;case 16:N=[2,1];break;case 255:{N=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((M+1)*16-n*2-s*2),height:(2-G)*(P+1)*16-(G?2:4)*(o+l),pixelRatio:N}}}class eP extends RS{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,s){const o=this.parseNALu(e,n.data,s);let l=this.VideoSample,u,d=!1;n.data=null,l&&o.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.forEach(f=>{var h,m;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),l.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,d){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:u=!0,(h=l)!=null&&h.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 39:u=!0,sh(f.data,2,n.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=We(e.params,this.readVPS(f.data)),this.initVPS=f.data),e.vps=[f.data];break;case 33:if(u=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],f.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const S=this.readSPS(f.data);e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.codec=S.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const A in S.params)e.params[A]=S.params[A]}this.pushParameterSet(e.sps,f.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const S=this.readPPS(f.data);for(const A in S)e.params[A]=S[A]}this.pushParameterSet(e.pps,f.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=l)!=null&&m.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:u=!1;break}l&&u&&l.units.push(f)}),s&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[n]=e[s],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Vo(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:s}}readSPS(e){const t=new Vo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const s=t.readBits(2),o=t.readBoolean(),l=t.readBits(5),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),m=t.readUByte(),y=t.readUByte(),S=t.readUByte(),A=t.readUByte(),_=t.readUByte(),x=t.readUByte(),C=t.readUByte(),b=[],L=[];for(let Ne=0;Ne<n;Ne++)b.push(t.readBoolean()),L.push(t.readBoolean());if(n>0)for(let Ne=n;Ne<8;Ne++)t.readBits(2);for(let Ne=0;Ne<n;Ne++)b[Ne]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),L[Ne]&&t.readUByte();t.readUEG();const M=t.readUEG();M==3&&t.skipBits(1);const P=t.readUEG(),G=t.readUEG(),N=t.readBoolean();let $=0,U=0,O=0,J=0;N&&($+=t.readUEG(),U+=t.readUEG(),O+=t.readUEG(),J+=t.readUEG());const re=t.readUEG(),oe=t.readUEG(),ce=t.readUEG(),fe=t.readBoolean();for(let Ne=fe?0:n;Ne<=n;Ne++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Tt=0;Tt<4;Tt++)for(let Ft=0;Ft<(Tt===3?2:6);Ft++)if(!t.readBoolean())t.readUEG();else{const Bt=Math.min(64,1<<4+(Tt<<1));Tt>1&&t.readEG();for(let Gn=0;Gn<Bt;Gn++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const ee=t.readUEG();let le=0;for(let Ne=0;Ne<ee;Ne++){let Tt=!1;if(Ne!==0&&(Tt=t.readBoolean()),Tt){Ne===ee&&t.readUEG(),t.readBoolean(),t.readUEG();let Ft=0;for(let Mn=0;Mn<=le;Mn++){const Bt=t.readBoolean();let Gn=!1;Bt||(Gn=t.readBoolean()),(Bt||Gn)&&Ft++}le=Ft}else{const Ft=t.readUEG(),Mn=t.readUEG();le=Ft+Mn;for(let Bt=0;Bt<Ft;Bt++)t.readUEG(),t.readBoolean();for(let Bt=0;Bt<Mn;Bt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ne=t.readUEG();for(let Tt=0;Tt<Ne;Tt++){for(let Ft=0;Ft<ce+4;Ft++)t.readBits(1);t.readBits(1)}}let w=0,V=1,se=1,ae=!0,ue=1,ge=0;t.readBoolean(),t.readBoolean();let Ae=!1;if(t.readBoolean()){if(t.readBoolean()){const jn=t.readUByte(),Zo=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],St=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];jn>0&&jn<16?(V=Zo[jn-1],se=St[jn-1]):jn===255&&(V=t.readBits(16),se=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ae=t.readBoolean(),Ae&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ue=t.readBits(32),ge=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const St=t.readBoolean(),jo=t.readBoolean();let Ri=!1;(St||jo)&&(Ri=t.readBoolean(),Ri&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ri&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Br=0;Br<=n;Br++){ae=t.readBoolean();const ws=ae||t.readBoolean();let ea=!1;ws?t.readEG():ea=t.readBoolean();const Gr=ea?1:t.readUEG()+1;if(St)for(let rs=0;rs<Gr;rs++)t.readUEG(),t.readUEG(),Ri&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(jo)for(let rs=0;rs<Gr;rs++)t.readUEG(),t.readUEG(),Ri&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),w=t.readUEG())}let Oe=P,kt=G;if(N){let Ne=1,Tt=1;M===1?Ne=Tt=2:M==2&&(Ne=2),Oe=P-Ne*U-Ne*$,kt=G-Tt*J-Tt*O}const mn=s?["A","B","C"][s]:"",Fr=u<<24|d<<16|f<<8|h;let Ms=0;for(let Ne=0;Ne<32;Ne++)Ms=(Ms|(Fr>>Ne&1)<<31-Ne)>>>0;let Dn=Ms.toString(16);return l===1&&Dn==="2"&&(Dn="6"),{codecString:`hvc1.${mn}${l}.${Dn}.${o?"H":"L"}${C}.B0`,params:{general_tier_flag:o,general_profile_idc:l,general_profile_space:s,general_profile_compatibility_flags:[u,d,f,h],general_constraint_indicator_flags:[m,y,S,A,_,x],general_level_idc:C,bit_depth:re+8,bit_depth_luma_minus8:re,bit_depth_chroma_minus8:oe,min_spatial_segmentation_idc:w,chroma_format_idc:M,frame_rate:{fixed:ae,fps:ge/ue}},width:Oe,height:kt,pixelRatio:[V,se]}}readPPS(e){const t=new Vo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),o=t.readBoolean();let l=1;return o&&s?l=0:o?l=3:s&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const xt=188;class es{constructor(e,t,n,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=s,this.videoParser=null}static probe(e,t){const n=es.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(xt*5,t-xt)+1,s=0;for(;s<n;){let o=!1,l=-1,u=0;for(let d=s;d<t;d+=xt)if(e[d]===71&&(t-d===xt||e[d+xt]===71)){if(u++,l===-1&&(l=d,l!==0&&(n=Math.min(l+xt*99,e.length-xt)+1)),o||(o=Pd(e,d)===0),o&&u>1&&(l===0&&u>2||d+xt>n))return l}else{if(u)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:MT[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=es.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=es.createTrack("audio",s),this._id3Track=es.createTrack("id3"),this._txtTrack=es.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,s=!1){n||(this.sampleAes=null);let o;const l=this._videoTrack,u=this._audioTrack,d=this._id3Track,f=this._txtTrack;let h=l.pid,m=l.pesData,y=u.pid,S=d.pid,A=u.pesData,_=d.pesData,x=null,C=this.pmtParsed,b=this._pmtId,L=e.length;if(this.remainderData&&(e=Ln(this.remainderData,e),L=e.length,this.remainderData=null),L<xt&&!s)return this.remainderData=e,{audioTrack:u,videoTrack:l,id3Track:d,textTrack:f};const M=Math.max(0,es.syncOffset(e));L-=(L-M)%xt,L<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,L,e.buffer.byteLength-L));let P=0;for(let N=M;N<L;N+=xt)if(e[N]===71){const $=!!(e[N+1]&64),U=Pd(e,N),O=(e[N+3]&48)>>4;let J;if(O>1){if(J=N+5+e[N+4],J===N+xt)continue}else J=N+4;switch(U){case h:$&&(m&&(o=Tr(m,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,f,o,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(J,N+xt)),m.size+=N+xt-J);break;case y:if($){if(A&&(o=Tr(A,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,o);break;case"mp3":this.parseMPEGPES(u,o);break;case"ac3":this.parseAC3PES(u,o);break}A={data:[],size:0}}A&&(A.data.push(e.subarray(J,N+xt)),A.size+=N+xt-J);break;case S:$&&(_&&(o=Tr(_,this.logger))&&this.parseID3PES(d,o),_={data:[],size:0}),_&&(_.data.push(e.subarray(J,N+xt)),_.size+=N+xt-J);break;case 0:$&&(J+=e[J]+1),b=this._pmtId=tP(e,J);break;case b:{$&&(J+=e[J]+1);const re=nP(e,J,this.typeSupported,n,this.observer,this.logger);h=re.videoPid,h>0&&(l.pid=h,l.segmentCodec=re.segmentVideoCodec),y=re.audioPid,y>0&&(u.pid=y,u.segmentCodec=re.segmentAudioCodec),S=re.id3Pid,S>0&&(d.pid=S),x!==null&&!C&&(this.logger.warn(`MPEG-TS PMT found at ${N} after unknown PID '${x}'. Backtracking to sync byte @${M} to parse all TS packets.`),x=null,N=M-188),C=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=U;break}}else P++;P>0&&kd(this.observer,new Error(`Found ${P} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=m,u.pesData=A,d.pesData=_;const G={audioTrack:u,videoTrack:l,id3Track:d,textTrack:f};return s&&this.extractRemainingSamples(G),G}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:s,textTrack:o}=e,l=n.pesData,u=t.pesData,d=s.pesData;let f;if(l&&(f=Tr(l,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,o,f,!0),n.pesData=null)):n.pesData=l,u&&(f=Tr(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,f);break;case"mp3":this.parseMPEGPES(t,f);break;case"ac3":this.parseAC3PES(t,f);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(f=Tr(d,this.logger))?(this.parseID3PES(s,f),s.pesData=null):s.pesData=d}demuxSampleAes(e,t,n){const s=this.demux(e,n,!0,!this.config.progressive),o=this.sampleAes=new ZN(this.observer,this.config,t);return this.decrypt(s,o)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new jN:e==="hevc"&&(this.videoParser=new eP))}decrypt(e,t){return new Promise(n=>{const{audioTrack:s,videoTrack:o}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{o.samples?t.decryptAvcSamples(o.samples,0,0,()=>{n(e)}):n(e)}):o.samples&&t.decryptAvcSamples(o.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const s=this.aacOverFlow;let o=t.data;if(s){this.aacOverFlow=null;const m=s.missing,y=s.sample.unit.byteLength;if(m===-1)o=Ln(s.sample.unit,o);else{const S=y-m;s.sample.unit.set(o.subarray(0,m),S),e.samples.push(s.sample),n=s.missing}}let l,u;for(l=n,u=o.length;l<u-1&&!lu(o,l);l++);if(l!==n){let m;const y=l<u-1;if(y?m=`AAC PES did not start with ADTS header,offset:${l}`:m="No ADTS header found in AAC PES",kd(this.observer,new Error(m),y,this.logger),!y)return}gS(e,this.observer,o,l,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(s){const m=mS(e.samplerate);d=s.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,h;for(;l<u;)if(h=pS(e,o,l,d,f),l+=h.length,h.missing){this.aacOverFlow=h;break}else for(f++;l<u-1&&!lu(o,l);l++);}parseMPEGPES(e,t){const n=t.data,s=n.length;let o=0,l=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<s;)if(SS(n,l)){const d=ES(e,n,l,u,o);if(d)l+=d.length,o++;else break}else l++}parseAC3PES(e,t){{const n=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const o=n.length;let l=0,u=0,d;for(;u<o&&(d=xS(e,n,u,s,l++))>0;)u+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=We({},t,{type:this._videoTrack?dn.emsg:dn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Pd(i,e){return((i[e+1]&31)<<8)+i[e+2]}function tP(i,e){return(i[e+10]&31)<<8|i[e+11]}function nP(i,e,t,n,s,o){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(i[e+1]&15)<<8|i[e+2],d=e+3+u-4,f=(i[e+10]&15)<<8|i[e+11];for(e+=12+f;e<d;){const h=Pd(i,e),m=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){Wf("ADTS AAC",o);break}case 15:l.audioPid===-1&&(l.audioPid=h);break;case 21:l.id3Pid===-1&&(l.id3Pid=h);break;case 219:if(!n){Wf("H.264",o);break}case 27:l.videoPid===-1&&(l.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?o.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=h,l.segmentAudioCodec="mp3");break;case 193:if(!n){Wf("AC-3",o);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=h,l.segmentAudioCodec="ac3"):o.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&m>0){let y=e+5,S=m;for(;S>2;){switch(i[y]){case 106:t.ac3!==!0?o.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=h,l.segmentAudioCodec="ac3");break}const _=i[y+1]+2;y+=_,S-=_}}break;case 194:case 135:return kd(s,new Error("Unsupported EC-3 in M2TS found"),void 0,o),l;case 36:l.videoPid===-1&&(l.videoPid=h,l.segmentVideoCodec="hevc",o.log("HEVC in M2TS found"));break}e+=m+5}return l}function kd(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(I.ERROR,I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Wf(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Tr(i,e){let t=0,n,s,o,l,u;const d=i.data;if(!i||i.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=Ln(d[0],d[1]),d.splice(1,1);if(n=d[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(s=(n[4]<<8)+n[5],s&&s>i.size-6)return null;const h=n[7];h&192&&(l=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,h&64?(u=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,l-u>60*9e4&&(e.warn(`${Math.round((l-u)/9e4)}s delta between PTS and DTS, align them`),l=u)):u=l),o=n[8];let m=o+9;if(i.size<=m)return null;i.size-=m;const y=new Uint8Array(i.size);for(let S=0,A=d.length;S<A;S++){n=d[S];let _=n.byteLength;if(m)if(m>_){m-=_;continue}else n=n.subarray(m),_-=m,m=0;y.set(n,t),t+=_}return s&&(s-=o+3),{data:y,pts:l,dts:u,len:s}}return null}class iP{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Qi=Math.pow(2,32)-1;class q{static init(){q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in q.types)q.types.hasOwnProperty(e)&&(q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);q.HDLR_TYPES={video:t,audio:n};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);q.STTS=q.STSC=q.STCO=o,q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);q.FTYP=q.box(q.types.ftyp,l,d,l,u),q.DINF=q.box(q.types.dinf,q.box(q.types.dref,s))}static box(e,...t){let n=8,s=t.length;const o=s;for(;s--;)n+=t[s].byteLength;const l=new Uint8Array(n);for(l[0]=n>>24&255,l[1]=n>>16&255,l[2]=n>>8&255,l[3]=n&255,l.set(e,4),s=0,n=8;s<o;s++)l.set(t[s],n),n+=t[s].byteLength;return l}static hdlr(e){return q.box(q.types.hdlr,q.HDLR_TYPES[e])}static mdat(e){return q.box(q.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Qi+1)),s=Math.floor(t%(Qi+1));return q.box(q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return q.box(q.types.mdia,q.mdhd(e.timescale||0,e.duration||0),q.hdlr(e.type),q.minf(e))}static mfhd(e){return q.box(q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?q.box(q.types.minf,q.box(q.types.smhd,q.SMHD),q.DINF,q.stbl(e)):q.box(q.types.minf,q.box(q.types.vmhd,q.VMHD),q.DINF,q.stbl(e))}static moof(e,t,n){return q.box(q.types.moof,q.mfhd(e),q.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=q.trak(e[t]);return q.box.apply(null,[q.types.moov,q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(q.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=q.trex(e[t]);return q.box.apply(null,[q.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Qi+1)),s=Math.floor(t%(Qi+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return q.box(q.types.mvhd,o)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let s,o;for(s=0;s<t.length;s++)o=t[s].flags,n[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return q.box(q.types.sdtp,n)}static stbl(e){return q.box(q.types.stbl,q.stsd(e),q.box(q.types.stts,q.STTS),q.box(q.types.stsc,q.STSC),q.box(q.types.stsz,q.STSZ),q.box(q.types.stco,q.STCO))}static avc1(e){let t=[],n=[],s,o,l;for(s=0;s<e.sps.length;s++)o=e.sps[s],l=o.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(o));for(s=0;s<e.pps.length;s++)o=e.pps[s],l=o.byteLength,n.push(l>>>8&255),n.push(l&255),n=n.concat(Array.prototype.slice.call(o));const u=q.box(q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),d=e.width,f=e.height,h=e.pixelRatio[0],m=e.pixelRatio[1];return q.box(q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return q.box(q.types.mp4a,q.audioStsd(e),q.box(q.types.esds,q.esds(e)))}static mp3(e){return q.box(q.types[".mp3"],q.audioStsd(e))}static ac3(e){return q.box(q.types["ac-3"],q.audioStsd(e),q.box(q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return q.box(q.types.stsd,q.STSD,q.mp4a(e));if(t==="ac3"&&e.config)return q.box(q.types.stsd,q.STSD,q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return q.box(q.types.stsd,q.STSD,q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return q.box(q.types.stsd,q.STSD,q.avc1(e));if(t==="hevc"&&e.vps)return q.box(q.types.stsd,q.STSD,q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),s=e.width||0,o=e.height||0,l=Math.floor(n/(Qi+1)),u=Math.floor(n%(Qi+1));return q.box(q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,o>>8&255,o&255,0,0]))}static traf(e,t){const n=q.sdtp(e),s=e.id,o=Math.floor(t/(Qi+1)),l=Math.floor(t%(Qi+1));return q.box(q.types.traf,q.box(q.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),q.box(q.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255])),q.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,q.box(q.types.trak,q.tkhd(e),q.mdia(e))}static trex(e){const t=e.id;return q.box(q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],s=n.length,o=12+16*s,l=new Uint8Array(o);let u,d,f,h,m,y;for(t+=8+o,l.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<s;u++)d=n[u],f=d.duration,h=d.size,m=d.flags,y=d.cts,l.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*u);return q.box(q.types.trun,l)}static initSegment(e){q.types||q.init();const t=q.moov(e);return Ln(q.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],s=4,o=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let l=o.length;for(let A=0;A<n.length;A+=1){l+=3;for(let _=0;_<n[A].length;_+=1)l+=2+n[A][_].length}const u=new Uint8Array(l);u.set(o,0),l=o.length;const d=n.length-1;for(let A=0;A<n.length;A+=1){u.set(new Uint8Array([32+A|(A===d?128:0),0,n[A].length]),l),l+=3;for(let _=0;_<n[A].length;_+=1)u.set(new Uint8Array([n[A][_].length>>8,n[A][_].length&255]),l),l+=2,u.set(n[A][_],l),l+=n[A][_].length}const f=q.box(q.types.hvcC,u),h=e.width,m=e.height,y=e.pixelRatio[0],S=e.pixelRatio[1];return q.box(q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,S>>24,S>>16&255,S>>8&255,S&255])))}}q.types=void 0;q.HDLR_TYPES=void 0;q.STTS=void 0;q.STSC=void 0;q.STCO=void 0;q.STSZ=void 0;q.VMHD=void 0;q.SMHD=void 0;q.STSD=void 0;q.FTYP=void 0;q.DINF=void 0;const IS=9e4;function Eh(i,e,t=1,n=!1){const s=i*e*t;return n?Math.round(s):s}function sP(i,e,t=1,n=!1){return Eh(i,e,1/t,n)}function Fo(i,e=!1){return Eh(i,1e3,1/IS,e)}function rP(i,e=1){return Eh(i,IS,1/e)}function sE(i){const{baseTime:e,timescale:t,trackId:n}=i;return`${e/t} (${e}/${t}) trackId: ${n}`}const oP=10*1e3,aP=1024,lP=1152,uP=1536;let Sr=null,Qf=null;function rE(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class Vl extends bn{constructor(e,t,n,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Sr===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Sr=l?parseInt(l[1]):0}if(Qf===null){const o=navigator.userAgent.match(/Safari\/(\d+)/i);Qf=o?parseInt(o[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&sE(t)} > ${e&&sE(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,s=e.reduce((o,l)=>{let u=l.pts,d=u-o;return d<-4294967296&&(t=!0,u=fn(u,n),d=u-o),d>0?o:u},n);return t&&this.debug("PTS rollover detected"),s}remux(e,t,n,s,o,l,u,d){let f,h,m,y,S,A,_=o,x=o;const C=e.pid>-1,b=t.pid>-1,L=t.samples.length,M=e.samples.length>0,P=u&&L>0||L>1;if((!C||M)&&(!b||P)||this.ISGenerated||u){if(this.ISGenerated){var N,$,U,O;const ce=this.videoTrackConfig;(ce&&(t.width!==ce.width||t.height!==ce.height||((N=t.pixelRatio)==null?void 0:N[0])!==(($=ce.pixelRatio)==null?void 0:$[0])||((U=t.pixelRatio)==null?void 0:U[1])!==((O=ce.pixelRatio)==null?void 0:O[1]))||!ce&&P||this.nextAudioTs===null&&M)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,o,l));const J=this.isVideoContiguous;let re=-1,oe;if(P&&(re=cP(t.samples),!J&&this.config.forceKeyFrameOnDiscontinuity))if(A=!0,re>0){this.warn(`Dropped ${re} out of ${L} video samples due to a missing keyframe`);const ce=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(re),t.dropped+=re,x+=(t.samples[0].pts-ce)/t.inputTimeScale,oe=x}else re===-1&&(this.warn(`No keyframe found out of ${L} video samples`),A=!1);if(this.ISGenerated){if(M&&P){const ce=this.getVideoStartPts(t.samples),F=(fn(e.samples[0].pts,ce)-ce)/t.inputTimeScale;_+=Math.max(0,F),x+=Math.max(0,-F)}if(M){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,o,l)),h=this.remuxAudio(e,_,this.isAudioContiguous,l,b||P||d===pe.AUDIO?x:void 0),P){const ce=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,o,l)),f=this.remuxVideo(t,x,J,ce)}}else P&&(f=this.remuxVideo(t,x,J,0));f&&(f.firstKeyFrame=re,f.independent=re!==-1,f.firstKeyFramePTS=oe)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(S=CS(n,o,this._initPTS,this._initDTS)),s.samples.length&&(y=LS(s,o,this._initPTS))),{audio:h,video:f,initSegment:m,independent:A,text:y,id3:S}}computeInitPts(e,t,n,s){const o=Math.round(n*t);let l=fn(e,o);if(l<o+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(o-l)/t} ${s}`);l<o+t;)l+=8589934592;return l-o}generateIS(e,t,n,s){const o=e.samples,l=t.samples,u=this.typeSupported,d={},f=this._initPTS;let h=!f||s,m="audio/mp4",y,S,A,_=-1;if(h&&(y=S=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):q.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(_=e.id,A=e.inputTimeScale,!f||A!==f.timescale?y=S=this.computeInitPts(o[0].pts,A,n,"audio"):h=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:q.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(_=t.id,A=t.inputTimeScale,!f||A!==f.timescale){const x=this.getVideoStartPts(l),C=fn(l[0].dts,x),b=this.computeInitPts(C,A,n,"video"),L=this.computeInitPts(x,A,n,"video");S=Math.min(S,b),y=Math.min(y,L)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,h?(f&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${n} ${y/A} != initPTS: ${f.baseTime/f.timescale} (${f.baseTime}/${f.timescale}) trackId: ${f.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${y/A} (${y}/${A}) trackId: ${_}`),this._initPTS={baseTime:y,timescale:A,trackId:_},this._initDTS={baseTime:S,timescale:A,trackId:_}):y=A=void 0,{tracks:d,initPTS:y,timescale:A,trackId:_}}remuxVideo(e,t,n,s){const o=e.inputTimeScale,l=e.samples,u=[],d=l.length,f=this._initPTS,h=f.baseTime*o/f.timescale;let m=this.nextVideoTs,y=8,S=this.videoSampleDuration,A,_,x=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,b=!1;if(!n||m===null){const w=h+t*o,V=l[0].pts-fn(l[0].dts,l[0].pts);Sr&&m!==null&&Math.abs(w-V-(m+h))<15e3?n=!0:m=w-V-h}const L=m+h;for(let w=0;w<d;w++){const V=l[w];V.pts=fn(V.pts,L),V.dts=fn(V.dts,L),V.dts<l[w>0?w-1:w].dts&&(b=!0)}b&&l.sort(function(w,V){const se=w.dts-V.dts,ae=w.pts-V.pts;return se||ae}),A=l[0].dts,_=l[l.length-1].dts;const M=_-A,P=M?Math.round(M/(d-1)):S||e.inputTimeScale/30;if(n){const w=A-L,V=w>P,se=w<-1;if((V||se)&&(V?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Fo(w,!0)} ms (${w}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Fo(-w,!0)} ms (${w}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!se||L>=l[0].pts||Sr)){A=L;const ae=l[0].pts-w;if(V)l[0].dts=A,l[0].pts=ae;else{let ue=!0;for(let ge=0;ge<l.length&&!(l[ge].dts>ae&&ue);ge++){const Ae=l[ge].pts;if(l[ge].dts-=w,l[ge].pts-=w,ge<l.length-1){const Fe=l[ge+1].pts,Oe=l[ge].pts,kt=Fe<=Oe,mn=Fe<=Ae;ue=kt==mn}}}this.log(`Video: Initial PTS/DTS adjusted: ${Fo(ae,!0)}/${Fo(A,!0)}, delta: ${Fo(w,!0)} ms`)}}A=Math.max(0,A);let G=0,N=0,$=A;for(let w=0;w<d;w++){const V=l[w],se=V.units,ae=se.length;let ue=0;for(let ge=0;ge<ae;ge++)ue+=se[ge].data.length;N+=ue,G+=ae,V.length=ue,V.dts<$?(V.dts=$,$+=P/4|0||1):$=V.dts,x=Math.min(V.pts,x),C=Math.max(V.pts,C)}_=l[d-1].dts;const U=N+4*G+8;let O;try{O=new Uint8Array(U)}catch(w){this.observer.emit(I.ERROR,I.ERROR,{type:Ee.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:w,bytes:U,reason:`fail allocating video mdat ${U}`});return}const J=new DataView(O.buffer);J.setUint32(0,U),O.set(q.types.mdat,4);let re=!1,oe=Number.POSITIVE_INFINITY,ce=Number.POSITIVE_INFINITY,fe=Number.NEGATIVE_INFINITY,F=Number.NEGATIVE_INFINITY;for(let w=0;w<d;w++){const V=l[w],se=V.units;let ae=0;for(let Ae=0,Fe=se.length;Ae<Fe;Ae++){const Oe=se[Ae],kt=Oe.data,mn=Oe.data.byteLength;J.setUint32(y,mn),y+=4,O.set(kt,y),y+=mn,ae+=4+mn}let ue;if(w<d-1)S=l[w+1].dts-V.dts,ue=l[w+1].pts-V.pts;else{const Ae=this.config,Fe=w>0?V.dts-l[w-1].dts:P;if(ue=w>0?V.pts-l[w-1].pts:P,Ae.stretchShortVideoTrack&&this.nextAudioTs!==null){const Oe=Math.floor(Ae.maxBufferHole*o),kt=(s?x+s*o:this.nextAudioTs+h)-V.pts;kt>Oe?(S=kt-Fe,S<0?S=Fe:re=!0,this.log(`It is approximately ${kt/90} ms to the next segment; using duration ${S/90} ms for the last video frame.`)):S=Fe}else S=Fe}const ge=Math.round(V.pts-V.dts);oe=Math.min(oe,S),fe=Math.max(fe,S),ce=Math.min(ce,ue),F=Math.max(F,ue),u.push(rE(V.key,S,ae,ge))}if(u.length){if(Sr){if(Sr<70){const w=u[0].flags;w.dependsOn=2,w.isNonSync=0}}else if(Qf&&F-ce<fe-oe&&P/fe<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let w=A;for(let V=0,se=u.length;V<se;V++){const ae=w+u[V].duration,ue=w+u[V].cts;if(V<se-1){const ge=ae+u[V+1].cts;u[V].duration=ge-ue}else u[V].duration=V?u[V-1].duration:P;u[V].cts=0,w=ae}}}S=re||!S?P:S;const Q=_+S;this.nextVideoTs=m=Q-h,this.videoSampleDuration=S,this.isVideoContiguous=!0;const de={data1:q.moof(e.sequenceNumber++,A,We(e,{samples:u})),data2:O,startPTS:(x-h)/o,endPTS:(C+S-h)/o,startDTS:(A-h)/o,endDTS:m/o,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,de}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return lP;case"ac3":return uP;default:return aP}}remuxAudio(e,t,n,s,o){const l=e.inputTimeScale,u=e.samplerate?e.samplerate:l,d=l/u,f=this.getSamplesPerFrame(e),h=f*d,m=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,S=[],A=o!==void 0;let _=e.samples,x=y?0:8,C=this.nextAudioTs||-1;const b=m.baseTime*l/m.timescale,L=b+t*l;if(this.isAudioContiguous=n=n||_.length&&C>0&&(s&&Math.abs(L-(C+b))<9e3||Math.abs(fn(_[0].pts,L)-(C+b))<20*h),_.forEach(function(F){F.pts=fn(F.pts,L)}),!n||C<0){const F=_.length;if(_=_.filter(Q=>Q.pts>=0),F!==_.length&&this.warn(`Removed ${_.length-F} of ${F} samples (initPTS ${b} / ${l})`),!_.length)return;o===0?C=0:s&&!A?C=Math.max(0,L-b):C=_[0].pts-b}if(e.segmentCodec==="aac"){const F=this.config.maxAudioFramesDrift;for(let Q=0,ee=C+b;Q<_.length;Q++){const le=_[Q],de=le.pts,w=de-ee,V=Math.abs(1e3*w/l);if(w<=-F*h&&A)Q===0&&(this.warn(`Audio frame @ ${(de/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*w/l)} ms.`),this.nextAudioTs=C=de-b,ee=de);else if(w>=F*h&&V<oP&&A){let se=Math.round(w/h);for(ee=de-se*h;ee<0&&se&&h;)se--,ee+=h;Q===0&&(this.nextAudioTs=C=ee-b),this.warn(`Injecting ${se} audio frames @ ${((ee-b)/l).toFixed(3)}s due to ${Math.round(1e3*w/l)} ms gap.`);for(let ae=0;ae<se;ae++){let ue=iP.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=le.unit.subarray()),_.splice(Q,0,{unit:ue,pts:ee}),ee+=h,Q++}}le.pts=ee,ee+=h}}let M=null,P=null,G,N=0,$=_.length;for(;$--;)N+=_[$].unit.byteLength;for(let F=0,Q=_.length;F<Q;F++){const ee=_[F],le=ee.unit;let de=ee.pts;if(P!==null){const V=S[F-1];V.duration=Math.round((de-P)/d)}else if(n&&e.segmentCodec==="aac"&&(de=C+b),M=de,N>0){N+=x;try{G=new Uint8Array(N)}catch(V){this.observer.emit(I.ERROR,I.ERROR,{type:Ee.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:N,reason:`fail allocating audio mdat ${N}`});return}y||(new DataView(G.buffer).setUint32(0,N),G.set(q.types.mdat,4))}else return;G.set(le,x);const w=le.byteLength;x+=w,S.push(rE(!0,f,w,0)),P=de}const U=S.length;if(!U)return;const O=S[S.length-1];C=P-b,this.nextAudioTs=C+d*O.duration;const J=y?new Uint8Array(0):q.moof(e.sequenceNumber++,M/d,We({},e,{samples:S}));e.samples=[];const re=(M-b)/l,oe=this.nextAudioTs/l,fe={data1:J,data2:G,startPTS:re,endPTS:oe,startDTS:re,endDTS:oe,type:"audio",hasAudio:!0,hasVideo:!1,nb:U};return this.isAudioContiguous=!0,fe}}function fn(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function cP(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function CS(i,e,t,n){const s=i.samples.length;if(!s)return;const o=i.inputTimeScale;for(let u=0;u<s;u++){const d=i.samples[u];d.pts=fn(d.pts-t.baseTime*o/t.timescale,e*o)/o,d.dts=fn(d.dts-n.baseTime*o/n.timescale,e*o)/o}const l=i.samples;return i.samples=[],{samples:l}}function LS(i,e,t){const n=i.samples.length;if(!n)return;const s=i.inputTimeScale;for(let l=0;l<n;l++){const u=i.samples[l];u.pts=fn(u.pts-t.baseTime*s/t.timescale,e*s)/s}i.samples.sort((l,u)=>l.pts-u.pts);const o=i.samples;return i.samples=[],{samples:o}}class fP extends bn{constructor(e,t,n,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,s){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:o,video:l}=this.initData=PT(e);if(t)ZM(e,t);else{const d=o||l;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}o&&(n=oE(o,Ze.AUDIO,this)),l&&(s=oE(l,Ze.VIDEO,this));const u={};o&&l?u.audiovideo={container:"video/mp4",codec:n+","+s,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:o?u.audio={container:"audio/mp4",codec:n,encrypted:o.encrypted,initSegment:e,id:"audio"}:l?u.video={container:"video/mp4",codec:s,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,n,s,o,l){var u,d;let{initPTS:f,lastEndTime:h}=this;const m={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};he(h)||(h=this.lastEndTime=o||0);const y=t.samples;if(!y.length)return m;const S={initPTS:void 0,timescale:void 0,trackId:void 0};let A=this.initData;if((u=A)!=null&&u.length||(this.generateInitSegment(y),A=this.initData),!((d=A)!=null&&d.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(S.tracks=this.initTracks,this.emitInitSegment=!1);const _=ew(y,A,this),x=A.audio?_[A.audio.id]:null,C=A.video?_[A.video.id]:null,b=Ll(C,1/0),L=Ll(x,1/0),M=Ll(C,0,!0),P=Ll(x,0,!0);let G=o,N=0;const $=x&&(!C||!f&&L<b||f&&f.trackId===A.audio.id),U=$?x:C;if(U){const ee=U.timescale,le=U.start-o*ee,de=$?A.audio.id:A.video.id;G=U.start/ee,N=$?P-L:M-b,(l||!f)&&(dP(f,G,o,N)||ee!==f.timescale)&&(f&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${o} ${le/ee} != initPTS: ${f.baseTime/f.timescale} (${f.baseTime}/${f.timescale}) trackId: ${f.trackId}`),this.log(`Found initPTS at playlist time: ${o} offset: ${G-o} (${le}/${ee}) trackId: ${de}`),f=null,S.initPTS=le,S.timescale=ee,S.trackId=de)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${o}`);f?(S.initPTS=f.baseTime,S.timescale=f.timescale,S.trackId=f.trackId):((!S.timescale||S.trackId===void 0||S.initPTS===void 0)&&(this.warn("Could not set initPTS"),S.initPTS=G,S.timescale=1,S.trackId=-1),this.initPTS=f={baseTime:S.initPTS,timescale:S.timescale,trackId:S.trackId});const O=G-f.baseTime/f.timescale,J=O+N;N>0?this.lastEndTime=J:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const re=!!A.audio,oe=!!A.video;let ce="";re&&(ce+="audio"),oe&&(ce+="video");const fe=(A.audio?A.audio.encrypted:!1)||(A.video?A.video.encrypted:!1),F={data1:y,startPTS:O,startDTS:O,endPTS:J,endDTS:J,type:ce,hasAudio:re,hasVideo:oe,nb:1,dropped:0,encrypted:fe};m.audio=re&&!oe?F:void 0,m.video=oe?F:void 0;const Q=C==null?void 0:C.sampleCount;if(Q){const ee=C.keyFrameIndex,le=ee!==-1;F.nb=Q,F.dropped=ee===0||this.isVideoContiguous?0:le?ee:Q,F.independent=le,F.firstKeyFrame=ee,le&&C.keyFrameStart&&(F.firstKeyFramePTS=(C.keyFrameStart-f.baseTime)/f.timescale),this.isVideoContiguous||(m.independent=le),this.isVideoContiguous||(this.isVideoContiguous=le),F.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${ee}/${Q} dropped: ${F.dropped} start: ${F.firstKeyFramePTS||"NA"}`)}return m.initSegment=S,m.id3=CS(n,o,f,f),s.samples.length&&(m.text=LS(s,o,f)),m}}function Ll(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function dP(i,e,t,n){if(i===null)return!0;const s=Math.max(n,1),o=e-i.baseTime/i.timescale;return Math.abs(o-t)>s}function oE(i,e,t){const n=i.codec;return n&&n.length>4?n:e===Ze.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?eu(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Si;try{Si=self.performance.now.bind(self.performance)}catch{Si=Date.now}const Hl=[{demux:QN,remux:fP},{demux:es,remux:Vl},{demux:YN,remux:Vl},{demux:JN,remux:Vl}];Hl.splice(2,0,{demux:XN,remux:Vl});class aE{constructor(e,t,n,s,o,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=o,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,s){const o=n.transmuxing;o.executeStart=Si();let l=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;s&&(this.currentTransmuxState=s);const{contiguous:f,discontinuity:h,trackSwitch:m,accurateTimeOffset:y,timeOffset:S,initSegmentChange:A}=s||u,{audioCodec:_,videoCodec:x,defaultInitPts:C,duration:b,initSegmentData:L}=d,M=hP(l,t);if(M&&Dr(M.method)){const $=this.getDecrypter(),U=ch(M.method);if($.isSync()){let O=$.softwareDecrypt(l,M.key.buffer,M.iv.buffer,U);if(n.part>-1){const re=$.flush();O=re&&re.buffer}if(!O)return o.executeEnd=Si(),Zf(n);l=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=$.webCryptoDecrypt(l,M.key.buffer,M.iv.buffer,U).then(O=>{const J=this.push(O,null,n);return this.decryptionPromise=null,J}),this.decryptionPromise}const P=this.needsProbing(h,m);if(P){const $=this.configureTransmuxer(l);if($)return this.logger.warn(`[transmuxer] ${$.message}`),this.observer.emit(I.ERROR,I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:$,reason:$.message}),o.executeEnd=Si(),Zf(n)}(h||m||A||P)&&this.resetInitSegment(L,_,x,b,t),(h||A||P)&&this.resetInitialTimestamp(C),f||this.resetContiguity();const G=this.transmux(l,M,S,y,n);this.asyncResult=Jo(G);const N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,o.executeEnd=Si(),G}flush(e){const t=e.transmuxing;t.executeStart=Si();const{decrypter:n,currentTransmuxState:s,decryptionPromise:o}=this;if(o)return this.asyncResult=!0,o.then(()=>this.flush(e));const l=[],{timeOffset:u}=s;if(n){const m=n.flush();m&&l.push(this.push(m.buffer,null,e))}const{demuxer:d,remuxer:f}=this;if(!d||!f){t.executeEnd=Si();const m=[Zf(e)];return this.asyncResult?Promise.resolve(m):m}const h=d.flush(u);return Jo(h)?(this.asyncResult=!0,h.then(m=>(this.flushRemux(l,m,e),l))):(this.flushRemux(l,h,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,n){const{audioTrack:s,videoTrack:o,id3Track:l,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:f}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===pe.MAIN?"level":"track"} ${n.level}`);const h=this.remuxer.remux(s,o,l,u,f,d,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=Si()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,s,o){const{demuxer:l,remuxer:u}=this;!l||!u||(l.resetInitSegment(e,t,n,s),u.resetInitSegment(e,t,n,o))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,s,o){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,n,s,o):l=this.transmuxUnencrypted(e,n,s,o),l}transmuxUnencrypted(e,t,n,s){const{audioTrack:o,videoTrack:l,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(o,l,u,d,t,n,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,n,s,o){return this.demuxer.demuxSampleAes(e,t,n).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,n,s,!1,this.id),chunkMeta:o}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:s}=this;let o;for(let m=0,y=Hl.length;m<y;m++){var l;if((l=Hl[m].demux)!=null&&l.probe(e,this.logger)){o=Hl[m];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,f=o.remux,h=o.demux;(!d||!(d instanceof f))&&(this.remuxer=new f(n,t,s,this.logger)),(!u||!(u instanceof h))&&(this.demuxer=new h(n,t,s,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new lh(this.config)),e}}function hP(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Zf=i=>({remuxResult:{},chunkMeta:i});function Jo(i){return"then"in i&&i.then instanceof Function}class gP{constructor(e,t,n,s,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=s,this.defaultInitPts=o||null}}class mP{constructor(e,t,n,s,o,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=o,this.initSegmentChange=l}}let lE=0;class bS{constructor(e,t,n,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=lE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const f=d.data,h=this.hls;if(!(!h||!(f!=null&&f.event)||f.instanceNo!==this.instanceNo))switch(f.event){case"init":{var m;const y=(m=this.workerContext)==null?void 0:m.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":{h.logger[f.data.logType]&&h.logger[f.data.logType](f.data.message);break}default:{f.data=f.data||{},f.data.frag=this.frag,f.data.part=this.part,f.data.id=this.id,h.trigger(f.event,f.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})};const o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=n,this.onFlush=s;const l=(d,f)=>{f=f||{},f.frag=this.frag||void 0,d===I.ERROR&&(f=f,f.parent=this.id,f.part=this.part,this.error=f.error),this.hls.trigger(d,f)};this.observer=new hh,this.observer.on(I.FRAG_DECRYPTED,l),this.observer.on(I.ERROR,l);const u=_v(o.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(o.workerPath||EN()){try{o.workerPath?(d.log(`loading Web Worker ${o.workerPath} for "${t}"`),this.workerContext=SN(o.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=TN());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:je(o)})}catch(h){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new aE(this.observer,u,o,"",t,e.logger)}return}}this.transmuxer=new aE(this.observer,u,o,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=lE++;const t=this.hls.config,n=_v(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:je(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),AN(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,s,o,l,u,d,f,h){var m,y;f.transmuxing.start=self.performance.now();const{instanceNo:S,transmuxer:A}=this,_=l?l.start:o.start,x=o.decryptdata,C=this.frag,b=!(C&&o.cc===C.cc),L=!(C&&f.level===C.level),M=C?f.sn-C.sn:-1,P=this.part?f.part-this.part.index:-1,G=M===0&&f.id>1&&f.id===(C==null?void 0:C.stats.chunkCount),N=!L&&(M===1||M===0&&(P===1||G&&P<=0)),$=self.performance.now();(L||M||o.stats.parsing.start===0)&&(o.stats.parsing.start=$),l&&(P||!N)&&(l.stats.parsing.start=$);const U=!(C&&((m=o.initSegment)==null?void 0:m.url)===((y=C.initSegment)==null?void 0:y.url)),O=new mP(b,N,d,L,_,U);if(!N||b||U){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${o.type} sn: ${f.sn}${f.part>-1?" part: "+f.part:""} ${this.id===pe.MAIN?"level":"track"}: ${f.level} id: ${f.id}
        discontinuity: ${b}
        trackSwitch: ${L}
        contiguous: ${N}
        accurateTimeOffset: ${d}
        timeOffset: ${_}
        initSegmentChange: ${U}`);const J=new gP(n,s,t,u,h);this.configureTransmuxer(J)}if(this.frag=o,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:S,cmd:"demux",data:e,decryptdata:x,chunkMeta:f,state:O},e instanceof ArrayBuffer?[e]:[]);else if(A){const J=A.push(e,x,f,O);Jo(J)?J.then(re=>{this.handleTransmuxComplete(re)}).catch(re=>{this.transmuxerError(re,f,"transmuxer-interface push error")}):this.handleTransmuxComplete(J)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const s=n.flush(e);Jo(s)?s.then(o=>{this.handleFlushResult(o,e)}).catch(o=>{this.transmuxerError(o,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const uE=100;class pP extends dh{constructor(e,t,n){super(e,t,n,"audio-stream-controller",pe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:o,trackId:l}){if(n===pe.MAIN){const u=t.cc,d=this.fragCurrent;if(this.initPTS[u]={baseTime:s,timescale:o,trackId:l},this.log(`InitPTS for cc: ${u} found from main: ${s/o} (${s}/${o}) trackId: ${l}`),this.mainAnchor=t,this.state===te.WAITING_INIT_PTS){const f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==u)&&this.syncWithAnchor(t,f==null?void 0:f.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==u?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===te.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const s=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const o=(s||e).cc,l=this.getLevelDetails(),u=this.getLoadPosition(),d=KT(l,o,u);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===te.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=te.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(uE),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=te.IDLE):this.state=te.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case te.IDLE:this.doTickIdle();break;case te.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(s))break;this.state=te.WAITING_INIT_PTS}break}case te.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case te.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:s,complete:o}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=te.FRAG_LOADING;const u=s.flush().buffer,d={frag:t,part:n,payload:u,networkDetails:null};this._handleFragmentLoadProgress(d),o&&super._handleFragmentLoadComplete(d)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=te.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:s,trackId:o}=this,l=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(n!=null&&n[o]))return;const u=n[o],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d)){this.state=te.WAITING_TRACK,this.startFragRequested=!1;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,Ze.AUDIO,pe.AUDIO));const h=this.getFwdBufferInfo(f,pe.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,d)){t.trigger(I.BUFFER_EOS,{type:"audio"}),this.state=te.ENDED;return}const m=h.len,y=t.maxBufferLength,S=d.fragments,A=S[0].start,_=this.getLoadPosition(),x=this.flushing?_:h.end;if(this.switchingTrack&&s){const L=_;d.PTSKnown&&L<A&&(h.end>A||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=A+.05)}if(m>=y&&!this.switchingTrack&&x<S[S.length-1].start)return;let C=this.getNextFragment(x,d);if(C&&this.isLoopLoading(C,x)&&(C=this.getNextFragmentLoopLoading(C,d,h,pe.MAIN,y)),!C){this.bufferFlushed=!0;return}let b=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&b&&ft(C)&&!C.endList&&(!d.live||!this.loadingParts&&x<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(b)===Et.OK&&(this.mainFragLoading=b=null),b&&ft(b))){if(C.start>b.end){const M=this.fragmentTracker.getFragAtPos(x,pe.MAIN);M&&M.end>b.end&&(b=M,this.mainFragLoading={frag:M,targetBufferTime:null})}if(C.start>b.end)return}this.loadFragment(C,u,x)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new zo(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==te.STOPPED&&(this.setInterval(uE),this.state=te.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(I.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:s}=this,{details:o,id:l,groupId:u,track:d}=t;if(!s){this.warn(`Audio tracks reset while loading track ${l} "${d.name}" of "${u}"`);return}const f=this.mainDetails;if(!f||o.endCC>f.endCC||f.expired){this.cachedTrackLoadedData=t,this.state!==te.STOPPED&&(this.state=te.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${d.name}" of "${u}" loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`);const h=s[l];let m=0;if(o.live||(n=h.details)!=null&&n.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;if(h.details){var y;m=this.alignPlaylists(o,h.details,(y=this.levelLastLoaded)==null?void 0:y.details)}o.alignedSliding||(uS(o,f),o.alignedSliding||au(o,f),m=o.fragmentStart)}h.details=o,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(f,m),this.hls.trigger(I.AUDIO_TRACK_UPDATED,{details:o,id:l,groupId:t.groupId}),this.state===te.WAITING_TRACK&&!this.waitForCdnTuneIn(o)&&(this.state=te.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:o}=e,{config:l,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const f=d[u];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const h=f.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const m=l.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new bS(this.hls,pe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const S=this.initPTS[n.cc],A=(t=n.initSegment)==null?void 0:t.data;if(S!==void 0){const x=s?s.index:-1,C=x!==-1,b=new uh(n.level,n.sn,n.stats.chunkCount,o.byteLength,x,C);y.push(o,A,m,"",n,s,h.totalduration,!1,b,S)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${u}`);const{cache:_}=this.waitingData=this.waitingData||{frag:n,part:s,cache:new cS,complete:!1};_.push(new Uint8Array(o)),this.state!==te.STOPPED&&(this.state=te.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===pe.MAIN&&ft(t.frag)&&(this.mainFragLoading=t,this.state===te.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:s}=t;if(n.type!==pe.AUDIO){!this.audioOnly&&n.type===pe.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ft(n)){this.fragPrevious=n;const o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(I.AUDIO_TRACK_SWITCHED,Ke({},o)))}this.fragBufferedComplete(n,s),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=te.ERROR;return}switch(t.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pe.AUDIO,t);break;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===te.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===De.AUDIO_TRACK&&(this.state=te.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ze.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ze.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===te.ENDED&&(this.state=te.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,pe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:s}=this,{remuxResult:o,chunkMeta:l}=e,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}const{frag:d,part:f,level:h}=u,{details:m}=h,{audio:y,text:S,id3:A,initSegment:_}=o;if(this.fragContextChanged(d)||!m){this.fragmentTracker.removeFragment(d);return}if(this.state=te.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),_!=null&&_.tracks){const x=d.initSegment||d;if(this.unhandledEncryptionError(_,d))return;this._bufferInitSegment(h,_.tracks,x,l),s.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:n,tracks:_.tracks})}if(y){const{startPTS:x,endPTS:C,startDTS:b,endDTS:L}=y;f&&(f.elementaryStreams[Ze.AUDIO]={startPTS:x,endPTS:C,startDTS:b,endDTS:L}),d.setElementaryStreamInfo(Ze.AUDIO,x,C,b,L),this.bufferFragmentData(y,d,f,l)}if(A!=null&&(t=A.samples)!=null&&t.length){const x=We({id:n,frag:d,details:m},A);s.trigger(I.FRAG_PARSING_METADATA,x)}if(S){const x=We({id:n,frag:d,details:m},S);s.trigger(I.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(e,t,n,s){if(this.state!==te.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const o=t.audio;o.id=pe.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${o.container}, codecs[level/parsed]=[${l}/${o.codec}]`),l&&l.split(",").length===1&&(o.levelCodec=l),this.hls.trigger(I.BUFFER_CODECS,t);const u=o.initSegment;if(u!=null&&u.byteLength){const d={type:"audio",frag:n,part:null,chunkMeta:s,parent:n.type,data:u};this.hls.trigger(I.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Et.NOT_LOADED||s===Et.PARTIAL){var o;if(!ft(e))this._loadInitSegment(e,t);else if((o=t.details)!=null&&o.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=te.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&au(t.details,l)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:s,characteristics:o,audioCodec:l,channels:u}=this.bufferedTrack;Ls({name:t,lang:n,assocLang:s,characteristics:o,audioCodec:l,channels:u},e,Cs)||(nu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(I.AUDIO_TRACK_SWITCHED,Ke({},e))}}class Th extends bn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const s=t==null?void 0:t.renditionReports;if(s){let o=-1;for(let l=0;l<s.length;l++){const u=s[l];let d;try{d=new self.URL(u.URI,t.url).href}catch(f){this.warn(`Could not construct new URL for Rendition Report: ${f}`),d=u.URI||""}if(d===e){o=l;break}else d===e.substring(0,d.length)&&(o=l)}if(o!==-1){const l=s[o],u=parseInt(l["LAST-MSN"])||t.lastPartSn;let d=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&h>t.partTarget&&(d+=1)}const f=n&&xv(n);return new Rv(u,d>=0?d:void 0,f)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:s,stats:o}=t,l=self.performance.now(),u=o.loading.first?Math.max(0,l-o.loading.first):0;s.advancedDateTime=Date.now()-u;const d=this.hls.config.timelineOffset;if(d!==s.appliedTimelineOffset){const h=Math.max(d||0,0);s.appliedTimelineOffset=h,s.fragments.forEach(m=>{m.setStart(m.playlistOffset+h)})}if(s.live||n!=null&&n.live){const h="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(n),n&&s.fragments.length>0){lN(n,s,this);const b=s.playlistParsingError;if(b){this.warn(b);const L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var f;const{networkDetails:M}=t;L.trigger(I.ERROR,{type:Ee.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:b,reason:b.message,level:t.level||void 0,parent:(f=s.fragments[0])==null?void 0:f.type,networkDetails:M,stats:o});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=o.loading.start);const m=this.hls.mainForwardBufferInfo,y=m?m.end-m.len:0,S=(s.edge-y)*1e3,A=sS(s,S);if(s.requestScheduled+A<l?s.requestScheduled=l:s.requestScheduled+=A,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let _,x,C;if(s.canBlockReload&&s.endSN&&s.advanced){const b=this.hls.config.lowLatencyMode,L=s.lastPartSn,M=s.endSN,P=s.lastPartIndex,G=P!==-1,N=L===M;G?N?(x=M+1,C=b?0:P):(x=L,C=b?P+1:s.maxPartIndex):x=M+1;const $=s.age,U=$+s.ageHeader;let O=Math.min(U-s.partTarget,s.targetduration*1.5);if(O>0){if(U>s.targetduration*3)this.log(`Playlist last advanced ${$.toFixed(2)}s ago. Omitting segment and part directives.`),x=void 0,C=void 0;else if(n!=null&&n.tuneInGoal&&U-s.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${s.age}`),O=0;else{const J=Math.floor(O/s.targetduration);if(x+=J,C!==void 0){const re=Math.round(O%s.targetduration/s.partTarget);C+=re}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${$.toFixed(2)}s goal: ${O} skip sn ${J} to part ${C}`)}s.tuneInGoal=O}if(_=this.getDeliveryDirectives(s,t.deliveryDirectives,x,C),b||!N){s.requestScheduled=l,this.loadingPlaylist(h,_);return}}else(s.canBlockReload||s.canSkipUntil)&&(_=this.getDeliveryDirectives(s,t.deliveryDirectives,x,C));_&&x!==void 0&&s.canBlockReload&&(s.requestScheduled=o.loading.first+Math.max(A-u*2,A/2)),this.scheduleLoading(h,_,s)}else this.clearTimer()}scheduleLoading(e,t,n){const s=n||e.details;if(!s){this.loadingPlaylist(e,t);return}const o=self.performance.now(),l=s.requestScheduled;if(o>=l){this.loadingPlaylist(e,t);return}const u=l-o;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,n,s){let o=xv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,s=t.part,o=Gl.No),new Rv(n,s,o)}checkRetry(e){const t=e.details,n=iu(e),s=e.errorAction,{action:o,retryCount:l=0,retryConfig:u}=s||{},d=!!s&&!!u&&(o===Mt.RetryRequest||!s.resolved&&o===Mt.SendAlternateToPenaltyBox);if(d){var f;if(l>=u.maxNumRetry)return!1;if(n&&(f=e.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=ah(u,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,s.resolved=!0}return d}}function DS(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Wo(i[t].attrs,e[t].attrs))return!1;return!0}function Wo(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>i[s]!==e[s])}function Ud(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class yP extends Th{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:s,details:o}=t,l=this.tracksInGroup[n];if(!l||l.groupId!==s){this.warn(`Audio track with id:${n} and group:${s} not found in active group ${l==null?void 0:l.groupId}`);return}const u=l.details;l.details=t.details,this.log(`Audio track ${n} "${l.name}" lang:${l.lang} group:${s} loaded [${o.startSN}-${o.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,s=this.groupIds;let o=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(u=>(s==null?void 0:s.indexOf(u))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(y=>!n||n.indexOf(y.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(y=>y.default)&&(this.selectDefaultTrack=!1),u.forEach((y,S)=>{y.id=S});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const d=this.hls.config.audioPreference;if(!o&&d){const y=Jn(d,u,Cs);if(y>-1)o=u[y];else{const S=Jn(d,this.tracks);o=this.tracks[S]}}let f=this.findTrackId(o);f===-1&&o&&(f=this.findTrackId(null));const h={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(I.AUDIO_TRACKS_UPDATED,h);const m=this.trackId;if(f!==-1&&m===-1)this.setAudioTrack(f);else if(u.length&&m===-1){var l;const y=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${u.length}`);this.warn(y.message),this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===De.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const s=this.currentTrack;if(s&&Ls(e,s,Cs))return s;const o=Jn(e,this.tracksInGroup,Cs);if(o>-1){const l=this.tracksInGroup[o];return this.setAudioTrack(o),l}else if(s){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const u=bw(e,t.levels,n,l,Cs);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const l=Jn(e,n);if(l>-1)return n[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e],o=s.details&&!s.details.live;if(e===this.trackId&&s===n&&o||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(I.AUDIO_TRACK_SWITCHING,Ke({},s)),o))return;const l=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Ls(e,s,Cs)))return n}if(e){const{name:n,lang:s,assocLang:o,characteristics:l,audioCodec:u,channels:d}=e;for(let f=0;f<t.length;f++){const h=t[f];if(Ls({name:n,lang:s,assocLang:o,characteristics:l,audioCodec:u,channels:d},h,Cs))return f}for(let f=0;f<t.length;f++){const h=t[f];if(Wo(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<t.length;f++){const h=t[f];if(Wo(e.attrs,h.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&nu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,o=this.getUrlWithDirectives(e.url,t),l=e.details,u=l==null?void 0:l.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${o}`),this.hls.trigger(I.AUDIO_TRACK_LOADING,{url:o,id:n,groupId:s,deliveryDirectives:t||null,track:e})}}class vP{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(o){var n;if(s.onError(o),this.queues===null||this.tracks===null)return;const l=(n=this.tracks[e])==null?void 0:n.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],s=n==null?void 0:n.buffer;return s?`SourceBuffer${s.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const cE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,MS="HlsJsTrackRemovedError";class EP extends Error{constructor(e){super(e),this.name=MS}}class TP extends bn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:s,mediaSource:o}=this;n&&this.log("Media source opened"),!(!s||!o)&&(o.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(I.MEDIA_ATTACHED,{media:s,mediaSource:o}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:s}=this;n!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=VM(ns(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_APPENDING,this.onBufferAppending,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.BUFFER_EOS,this.onBufferEos,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.FRAG_PARSED,this.onFragParsed,this),e.on(I.FRAG_CHANGED,this.onFragChanged,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_APPENDING,this.onBufferAppending,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_EOS,this.onBufferEos,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.FRAG_PARSED,this.onFragParsed,this),e.off(I.FRAG_CHANGED,this.onFragChanged,this),e.off(I.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const o=this.isUpdating();o||this.operationQueue.removeBlockers();const l=this.isQueued();(o||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${o?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?We(n,s.tracks):this.sourceBuffers.forEach(o=>{const[l]=o;l&&(n[l]=We({},this.tracks[l]),this.removeBuffer(l)),o[0]=o[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const s=ns(this.appendSource);if(s){const o=!!t.mediaSource;(o||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(l),o)this._objectUrl=n.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{n.removeAttribute("src");const d=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||d&&l instanceof d,fE(n),SP(n,u),n.load()}catch{n.src=u}else n.src=u}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,s=t.tracks,o=s?Object.keys(s):null,l=o?o.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&o&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${je(n,(d,f)=>d==="initSegment"?void 0:f)};
transfer tracks: ${je(s,(d,f)=>d==="initSegment"?void 0:f)}}`),!CT(s,n)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,f=this.details,h=Math.max(d,(f==null?void 0:f.fragments[0].start)||0);if(h-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(n)}") start time: ${h} currentTime: ${d}`),this.onMediaDetaching(I.MEDIA_DETACHING,{}),this.onMediaAttaching(I.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,o.forEach(d=>{const f=d,h=s[f];if(h){const m=h.buffer;if(m){const y=this.fragmentTracker,S=h.id;if(y.hasFragments(S)||y.hasParts(S)){const x=Re.getBuffered(m);y.detectEvictedFragments(f,x,S,null,!0)}const A=jf(f),_=[f,m];this.sourceBuffers[A]=_,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(f),this.trackSourceBuffer(f,h)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:o,_objectUrl:l}=this;if(o){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=o.readyState==="open";try{const d=o.sourceBuffers;for(let f=d.length;f--;)u&&d[f].abort(),o.removeSourceBuffer(d[f]);u&&o.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}o.removeEventListener("sourceopen",this._onMediaSourceOpen),o.removeEventListener("sourceended",this._onMediaSourceEnded),o.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.removeEventListener("startstreaming",this._onStartStreaming),o.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),n||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(s.removeAttribute("src"),this.appendSource&&fE(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(I.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(o){this.warn(`onBufferReset ${e}`,o)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[jf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new vP(this.tracks)}onBufferCodecs(e,t){var n;const s=this.tracks,o=Object.keys(t);this.log(`BUFFER_CODECS: "${o}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),u=!l&&this.sourceBufferCount&&this.media&&o.some(d=>!s[d]);if(l||u){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${o}" SourceBuffers`);return}o.forEach(d=>{var f,h;const m=t[d],{id:y,codec:S,levelCodec:A,container:_,metadata:x,supplemental:C}=m;let b=s[d];const L=(f=this.transferData)==null||(f=f.tracks)==null?void 0:f[d],M=L!=null&&L.buffer?L:b,P=(M==null?void 0:M.pendingCodec)||(M==null?void 0:M.codec),G=M==null?void 0:M.levelCodec;b||(b=s[d]={buffer:void 0,listeners:[],codec:S,supplemental:C,container:_,levelCodec:A,metadata:x,id:y});const N=Bl(P,G),$=N==null?void 0:N.replace(cE,"$1");let U=Bl(S,A);const O=(h=U)==null?void 0:h.replace(cE,"$1");U&&N&&$!==O&&(d.slice(0,5)==="audio"&&(U=eu(U,this.appendSource)),this.log(`switching codec ${P} to ${U}`),U!==(b.pendingCodec||b.codec)&&(b.pendingCodec=U),b.container=_,this.appendChangeType(d,_,U))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const s=`${t};codecs=${n}`,o={label:`change-type=${s}`,execute:()=>{const l=this.tracks[e];if(l){const u=l.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),u.changeType(s),l.codec=n,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(o,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,s=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,pe.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var u;const d=this.tracks.video;(this.lastVideoAppendEnd>s||d!=null&&d.buffer&&Re.isBuffered(d.buffer,s)||((u=this.fragmentTracker.getAppendedFrag(s,pe.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:s,type:o,parent:l,frag:u,part:d,chunkMeta:f,offset:h}=t,m=f.buffering[o],{sn:y,cc:S}=u,A=self.performance.now();m.start=A;const _=u.stats.buffering,x=d?d.stats.buffering:null;_.start===0&&(_.start=A),x&&x.start===0&&(x.start=A);const C=n.audio;let b=!1;o==="audio"&&(C==null?void 0:C.container)==="audio/mpeg"&&(b=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const L=n.video,M=L==null?void 0:L.buffer;if(M&&y!=="initSegment"){const N=d||u,$=this.blockedAudioAppend;if(o==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(L.ending||L.ended)){const O=N.start+N.duration*.05,J=M.buffered,re=this.currentOp("video");!J.length&&!re?this.blockAudio(N):!re&&!Re.isBuffered(M,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(N)}else if(o==="video"){const U=N.end;if($){const O=$.frag.start;(U>O||U<this.lastVideoAppendEnd||Re.isBuffered(M,O))&&this.unblockAudio()}this.lastVideoAppendEnd=U}}const P=(d||u).start,G={label:`append-${o}`,execute:()=>{var N;m.executeStart=self.performance.now();const $=(N=this.tracks[o])==null?void 0:N.buffer;$&&(b?this.updateTimestampOffset($,P,.1,o,y,S):h!==void 0&&he(h)&&this.updateTimestampOffset($,h,1e-6,o,y,S)),this.appendExecutor(s,o)},onStart:()=>{},onComplete:()=>{const N=self.performance.now();m.executeEnd=m.end=N,_.first===0&&(_.first=N),x&&x.first===0&&(x.first=N);const $={};this.sourceBuffers.forEach(([U,O])=>{U&&($[U]=Re.getBuffered(O))}),this.appendErrors[o]=0,o==="audio"||o==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(I.BUFFER_APPENDED,{type:o,frag:u,part:d,chunkMeta:f,parent:u.type,timeRanges:$})},onError:N=>{var $;const U={type:Ee.MEDIA_ERROR,parent:u.type,details:K.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:u,part:d,chunkMeta:f,error:N,err:N,fatal:!1},O=($=this.media)==null?void 0:$.error;if(N.code===DOMException.QUOTA_EXCEEDED_ERR||N.name=="QuotaExceededError"||"quota"in N)U.details=K.BUFFER_FULL_ERROR;else if(N.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)U.errorAction=br(!0);else if(N.name===MS&&this.sourceBufferCount===0)U.errorAction=br(!0);else{const J=++this.appendErrors[o];this.warn(`Failed ${J}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${o}" sourceBuffer (${O||"no media error"})`),(J>=this.hls.config.appendErrorMaxRetry||O)&&(U.fatal=!0)}this.hls.trigger(I.ERROR,U)}};this.log(`queuing "${o}" append sn: ${y}${d?" p: "+d.index:""} of ${u.type===pe.MAIN?"level":"track"} ${u.level} cc: ${S}`),this.append(G,o,this.isPending(this.tracks[o]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(I.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:n,startOffset:s,endOffset:o}=t;n?this.append(this.getFlushOp(n,s,o),n):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,s,o),l)})}onFragParsed(e,t){const{frag:n,part:s}=t,o=[],l=s?s.elementaryStreams:n.elementaryStreams;l[Ze.AUDIOVIDEO]?o.push("audiovideo"):(l[Ze.AUDIO]&&o.push("audio"),l[Ze.VIDEO]&&o.push("video"));const u=()=>{const d=self.performance.now();n.stats.buffering.end=d,s&&(s.stats.buffering.end=d);const f=s?s.stats:n.stats;this.hls.trigger(I.FRAG_BUFFERED,{frag:n,part:s,stats:f,id:n.type})};o.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(u,o).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([l])=>{if(l){const u=this.tracks[l];(!t.type||t.type===l)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${l} buffer reached EOS`)))}});const s=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var u;return l&&!((u=this.tracks[l])!=null&&u.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(I.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(I.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===K.BUFFER_APPEND_ERROR&&t.frag){var n;const s=(n=t.errorAction)==null?void 0:n.nextAutoLevel;he(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const s=e.config,o=n.currentTime,l=t.levelTargetDuration,u=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(he(u)&&u>=0){const f=Math.max(u,l),h=Math.floor(o/l)*l-f;this.flushBackBuffer(o,l,h)}const d=s.frontBufferFlushThreshold;if(he(d)&&d>0){const f=Math.max(s.maxBufferLength,d),h=Math.max(f,l),m=Math.floor(o/l)*l+h;this.flushFrontBuffer(o,l,m)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([s,o])=>{if(o){const u=Re.getBuffered(o);if(u.length>0&&n>u.start(0)){var l;this.hls.trigger(I.BACK_BUFFER_REACHED,{bufferEnd:n});const d=this.tracks[s];if((l=this.details)!=null&&l.live)this.hls.trigger(I.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(d!=null&&d.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([s,o])=>{if(o){const l=Re.getBuffered(o),u=l.length;if(u<2)return;const d=l.start(u-1),f=l.end(u-1);if(n>d||e>=d&&e<=f)return;this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const f=Math.max(0,t.fragmentStart),h=Math.max(f,s);return{duration:1/0,start:f,end:h}}return{duration:1/0}}const o=(e=this.overrides)==null?void 0:e.duration;if(o)return he(o)?{duration:o}:null;const l=this.media.duration,u=he(n.duration)?n.duration:0;return s>u&&s>l||!he(l)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:n}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(he(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${n}.`),s.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${je(n)}`),this.tracksReady){var s;const o=(s=this.transferData)==null?void 0:s.tracks;o&&Object.keys(o).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const s=this.tracks[t];e[t]={buffer:n,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(I.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const o in e){const l=o,u=e[l];if(this.isPending(u)){const d=this.getTrackCodec(u,l),f=`${u.container};codecs=${d}`;u.codec=d,this.log(`creating sourceBuffer(${f})${this.currentOp(l)?" Queued":""} ${je(u)}`);try{const h=n.addSourceBuffer(f),m=jf(l),y=[l,h];t[m]=y,u.buffer=h}catch(h){var s;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(l),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[l],this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:l,mimeType:f,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let s=e.codec;n&&(t==="video"||t==="audiovideo")&&qo(n,"video")&&(s=cw(s,n));const o=Bl(s,e.levelCodec);return o?t.slice(0,5)==="audio"?eu(o,this.appendSource):o:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(o,l)=>{const u=l.removedRanges;u!=null&&u.length&&this.hls.trigger(I.BUFFER_FLUSHED,{type:o})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${s}`,t),this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const o=this.currentOp(e);o&&o.onError(s)}updateTimestampOffset(e,t,n,s,o,l){const u=t-e.timestampOffset;Math.abs(u)>=n&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${o} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:s,mediaSource:o}=this,l=this.tracks[e],u=l==null?void 0:l.buffer;if(!s||!o||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=he(s.duration)?s.duration:1/0,f=he(o.duration)?o.duration:1/0,h=Math.max(0,t),m=Math.min(n,d,f);m>h&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${h},${m}] from the ${e} SourceBuffer`),u.remove(h,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],s=n==null?void 0:n.buffer;if(!s)throw new EP(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,s=t.map(l=>this.appendBlocker(l));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(l=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const s=(n=this.tracks[t])==null?void 0:n.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const s=this.tracks[e];if(!s)return;const o=s.buffer;if(!o)return;const l=n.bind(this,e);s.listeners.push({event:t,listener:l}),o.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(s=>{n.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function fE(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function SP(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function jf(i){return i==="audio"?1:0}class Sh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&he(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((s,o)=>this.isLevelAllowed(s)&&o<=e);return this.clientRect=null,Sh.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const s=(u,d)=>d?u.width!==d.width||u.height!==d.height:!0;let o=e.length-1;const l=Math.max(t,n);for(let u=0;u<e.length;u+=1){const d=e[u];if((d.width>=l||d.height>=l)&&s(d,e[u+1])){o=u;break}}return o}}const AP={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Qt=AP,_P={HLS:"h"},xP=_P;class Qn{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Qn?n:new Qn(n))),this.value=e,this.params=t}}const RP="Dict";function IP(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function CP(i,e,t,n){return new Error(`failed to ${i} "${IP(e)}" as ${t}`,{cause:n})}function Zn(i,e,t){return CP("serialize",i,e,t)}class wS{constructor(e){this.description=e}}const dE="Bare Item",LP="Boolean";function bP(i){if(typeof i!="boolean")throw Zn(i,LP);return i?"?1":"?0"}function DP(i){return btoa(String.fromCharCode(...i))}const MP="Byte Sequence";function wP(i){if(ArrayBuffer.isView(i)===!1)throw Zn(i,MP);return`:${DP(i)}:`}const NP="Integer";function PP(i){return i<-999999999999999||999999999999999<i}function NS(i){if(PP(i))throw Zn(i,NP);return i.toString()}function kP(i){return`@${NS(i.getTime()/1e3)}`}function PS(i,e){if(i<0)return-PS(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const s=Math.floor(i*t);return(s%2===0?s:s+1)/t}else return Math.round(i*t)/t}const UP="Decimal";function OP(i){const e=PS(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Zn(i,UP);const t=e.toString();return t.includes(".")?t:`${t}.0`}const FP="String",BP=/[\x00-\x1f\x7f]+/;function GP(i){if(BP.test(i))throw Zn(i,FP);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function $P(i){return i.description||i.toString().slice(7,-1)}const VP="Token";function hE(i){const e=$P(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Zn(e,VP);return e}function Od(i){switch(typeof i){case"number":if(!he(i))throw Zn(i,dE);return Number.isInteger(i)?NS(i):OP(i);case"string":return GP(i);case"symbol":return hE(i);case"boolean":return bP(i);case"object":if(i instanceof Date)return kP(i);if(i instanceof Uint8Array)return wP(i);if(i instanceof wS)return hE(i);default:throw Zn(i,dE)}}const HP="Key";function Fd(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Zn(i,HP);return i}function Ah(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Fd(e)}`:`;${Fd(e)}=${Od(t)}`).join("")}function kS(i){return i instanceof Qn?`${Od(i.value)}${Ah(i.params)}`:Od(i)}function qP(i){return`(${i.value.map(kS).join(" ")})${Ah(i.params)}`}function KP(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Zn(i,RP);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,o])=>{o instanceof Qn||(o=new Qn(o));let l=Fd(s);return o.value===!0?l+=Ah(o.params):(l+="=",Array.isArray(o.value)?l+=qP(o):l+=kS(o)),l}).join(`,${n}`)}function US(i,e){return KP(i,e)}const zn="CMCD-Object",at="CMCD-Request",xs="CMCD-Session",Zi="CMCD-Status",zP={br:zn,ab:zn,d:zn,ot:zn,tb:zn,tpb:zn,lb:zn,tab:zn,lab:zn,url:zn,pb:at,bl:at,tbl:at,dl:at,ltc:at,mtp:at,nor:at,nrr:at,rc:at,sn:at,sta:at,su:at,ttfb:at,ttfbb:at,ttlb:at,cmsdd:at,cmsds:at,smrt:at,df:at,cs:at,ts:at,cid:xs,pr:xs,sf:xs,sid:xs,st:xs,v:xs,msd:xs,bs:Zi,bsd:Zi,cdn:Zi,rtp:Zi,bg:Zi,pt:Zi,ec:Zi,e:Zi},YP={REQUEST:at};function XP(i){return Object.keys(i).reduce((e,t)=>{var n;return(n=i[t])===null||n===void 0||n.forEach(s=>e[s]=t),e},{})}function JP(i,e){const t={};if(!i)return t;const n=Object.keys(i),s=e?XP(e):{};return n.reduce((o,l)=>{var u;const d=zP[l]||s[l]||YP.REQUEST,f=(u=o[d])!==null&&u!==void 0?u:o[d]={};return f[l]=i[l],o},t)}function WP(i){return["ot","sf","st","e","sta"].includes(i)}function QP(i){return typeof i=="number"?he(i):i!=null&&i!==""&&i!==!1}const OS="event";function ZP(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const s=t.pathname.split("/").slice(1),o=n.pathname.split("/").slice(1,-1);for(;s[0]===o[0];)s.shift(),o.shift();for(;o.length;)o.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const ql=i=>Math.round(i),Bd=(i,e)=>Array.isArray(i)?i.map(t=>Bd(t,e)):i instanceof Qn&&typeof i.value=="string"?new Qn(Bd(i.value,e),i.params):(e.baseUrl&&(i=ZP(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),bl=i=>ql(i/100)*100,jP=(i,e)=>{let t=i;return e.version>=2&&(i instanceof Qn&&typeof i.value=="string"?t=new Qn([i]):typeof i=="string"&&(t=[i])),Bd(t,e)},ek={br:ql,d:ql,bl,dl:bl,mtp:bl,nor:jP,rtp:bl,tb:ql},FS="request",BS="response",_h=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],tk=["e"],nk=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Eu(i){return nk.test(i)}function ik(i){return _h.includes(i)||tk.includes(i)||Eu(i)}const GS=["d","dl","nor","ot","rtp","su"];function sk(i){return _h.includes(i)||GS.includes(i)||Eu(i)}const rk=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function ok(i){return _h.includes(i)||GS.includes(i)||rk.includes(i)||Eu(i)}const ak=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function lk(i){return ak.includes(i)||Eu(i)}const uk={[BS]:ok,[OS]:ik,[FS]:sk};function $S(i,e={}){const t={};if(i==null||typeof i!="object")return t;const n=e.version||i.v||1,s=e.reportingMode||FS,o=n===1?lk:uk[s];let l=Object.keys(i).filter(o);const u=e.filter;typeof u=="function"&&(l=l.filter(u));const d=s===BS||s===OS;d&&!l.includes("ts")&&l.push("ts"),n>1&&!l.includes("v")&&l.push("v");const f=We({},ek,e.formatters),h={version:n,reportingMode:s,baseUrl:e.baseUrl};return l.sort().forEach(m=>{let y=i[m];const S=f[m];if(typeof S=="function"&&(y=S(y,h)),m==="v"){if(n===1)return;y=n}m=="pr"&&y===1||(d&&m==="ts"&&!he(y)&&(y=Date.now()),QP(y)&&(WP(m)&&typeof y=="string"&&(y=new wS(y)),t[m]=y))}),t}function ck(i,e={}){const t={};if(!i)return t;const n=$S(i,e),s=JP(n,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((o,[l,u])=>{const d=US(u,{whitespace:!1});return d&&(o[l]=d),o},t)}function fk(i,e,t){return We(i,ck(e,t))}const dk="CMCD";function hk(i,e={}){return i?US($S(i,e),{whitespace:!1}):""}function gk(i,e={}){if(!i)return"";const t=hk(i,e);return encodeURIComponent(t)}function mk(i,e={}){if(!i)return"";const t=gk(i,e);return`${dk}=${t}`}const gE=/CMCD=[^&#]+/;function pk(i,e,t){const n=mk(e,t);if(!n)return i;if(gE.test(i))return i.replace(gE,n);const s=i.includes("?")?"&":"?";return`${i}${s}${n}`}class yk{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Qt.MANIFEST,su:!this.initialized})}catch(o){this.hls.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=s=>{try{const{frag:o,part:l}=s,u=this.hls.levels[o.level],d=this.getObjectType(o),f={d:(l||o).duration*1e3,ot:d};(d===Qt.VIDEO||d===Qt.AUDIO||d==Qt.MUXED)&&(f.br=u.bitrate/1e3,f.tb=this.getTopBandwidth(d)/1e3,f.bl=this.getBufferLength(d));const h=l?this.getNextPart(l):this.getNextFrag(o);h!=null&&h.url&&h.url!==o.url&&(f.nor=h.url),this.apply(s,f)}catch(o){this.hls.logger.warn("Could not generate segment CMCD data.",o)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHED,this.onMediaDetached,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHED,this.onMediaDetached,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,s;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:xP.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){We(t,this.createData());const n=t.ot===Qt.INIT||t.ot===Qt.VIDEO||t.ot===Qt.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((l,u)=>(s.includes(u)&&(l[u]=t[u]),l),{}));const o={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),fk(e.headers,t,o)):e.url=pk(e.url,t,o)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const s=e.sn-n.startSN;return n.fragments[s+1]}}getNextPart(e){var t;const{index:n,fragment:s}=e,o=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(o){const{sn:l}=s;for(let u=o.length-1;u>=0;u--){const d=o[u];if(d.index===n&&d.fragment.sn===l)return o[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Qt.TIMED_TEXT;if(e.sn==="initSegment")return Qt.INIT;if(t==="audio")return Qt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Qt.VIDEO:Qt.MUXED}getTopBandwidth(e){let t=0,n;const s=this.hls;if(e===Qt.AUDIO)n=s.audioTracks;else{const o=s.maxAutoLevel,l=o>-1?o+1:s.levels.length;n=s.levels.slice(0,l)}return n.forEach(o=>{o.bitrate>t&&(t=o.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Qt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Re.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new n(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,l,u){t(o),this.loader.load(o,l,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new n(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,l,u){t(o),this.loader.load(o,l,u)}}}}const vk=3e5;class Ek extends bn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Mt.SendAlternateToPenaltyBox&&n.flags===cn.MoveAllAlternatesMatchingHost){const s=this.levels;let o=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:u,pathwayId:d,type:f}=t.context;u&&s?l=this.getPathwayForGroupId(u,f,l):d&&(l=d)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!o&&s&&(o=this.pathways()),o&&o.length>1&&(this.updatePathwayPriority(o),n.resolved=this.pathwayId!==l),t.details===K.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${s&&s.length} priorities: ${je(o)} penalized: ${je(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,s=performance.now();Object.keys(n).forEach(o=>{s-n[o]>vk&&delete n[o]});for(let o=0;o<e.length;o++){const l=e[o];if(l in n)continue;if(l===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,aS(t),this.hls.trigger(I.LEVELS_UPDATED,{levels:t});const f=this.hls.levels[u];d&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,n){const s=this.getLevelsForPathway(n).concat(this.levels||[]);for(let o=0;o<s.length;o++)if(t===De.AUDIO_TRACK&&s[o].hasAudioGroup(e)||t===De.SUBTITLE_TRACK&&s[o].hasSubtitleGroup(e))return s[o].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},s={};e.forEach(o=>{const{ID:l,"BASE-ID":u,"URI-REPLACEMENT":d}=o;if(t.some(h=>h.pathwayId===l))return;const f=this.getLevelsForPathway(u).map(h=>{const m=new it(h.attrs);m["PATHWAY-ID"]=l;const y=m.AUDIO&&`${m.AUDIO}_clone_${l}`,S=m.SUBTITLES&&`${m.SUBTITLES}_clone_${l}`;y&&(n[m.AUDIO]=y,m.AUDIO=y),S&&(s[m.SUBTITLES]=S,m.SUBTITLES=S);const A=VS(h.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),_=new zo({attrs:m,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:A,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let x=1;x<h.audioGroups.length;x++)_.addGroupId("audio",`${h.audioGroups[x]}_clone_${l}`);if(h.subtitleGroups)for(let x=1;x<h.subtitleGroups.length;x++)_.addGroupId("text",`${h.subtitleGroups[x]}_clone_${l}`);return _});t.push(...f),mE(this.audioTracks,n,d,l),mE(this.subtitleTracks,s,d,l)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+h)}const o={responseType:"json",url:s.href},l=t.steeringManifestLoadPolicy.default,u=l.errorRetry||l.timeoutRetry||{},d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},f={onSuccess:(h,m,y,S)=>{this.log(`Loaded steering manifest: "${s}"`);const A=h.data;if((A==null?void 0:A.VERSION)!==1){this.log(`Steering VERSION ${A.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=A.TTL;const{"RELOAD-URI":_,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":C}=A;if(_)try{this.uri=new self.URL(_,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${_}`);return}this.scheduleRefresh(this.uri||y.url),x&&this.clonePathways(x);const b={steeringManifest:A,url:s.toString()};this.hls.trigger(I.STEERING_MANIFEST_LOADED,b),C&&this.updatePathwayPriority(C)},onError:(h,m,y,S)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${m.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let A=this.timeToLoad*1e3;if(h.code===429){const _=this.loader;if(typeof(_==null?void 0:_.getResponseHeader)=="function"){const x=_.getResponseHeader("Retry-After");x&&(A=parseFloat(x)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,A)},onTimeout:(h,m,y)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(o,d,f)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const s=(n=this.hls)==null?void 0:n.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function mE(i,e,t,n){i&&Object.keys(e).forEach(s=>{const o=i.filter(l=>l.groupId===s).map(l=>{const u=We({},l);return u.details=void 0,u.attrs=new it(u.attrs),u.url=u.attrs.URI=VS(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[s],u.attrs["PATHWAY-ID"]=n,u});i.push(...o)})}function VS(i,e,t,n){const{HOST:s,PARAMS:o,[t]:l}=n;let u;e&&(u=l==null?void 0:l[e],u&&(i=u));const d=new self.URL(i);return s&&!u&&(d.host=s),o&&Object.keys(o).sort().forEach(f=>{f&&d.searchParams.set(f,o[f])}),d.href}class Mr extends bn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Mr.CDMCleanupPromise?[Mr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:s}=t,o=`"${t.type}" event: init data type: "${n}"`;if(this.debug(o),s!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=Go(this.config));const u=l.map(Kf).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(l=>{const u=$l(l);if(n!=="sinf"||u!==st.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${u}`);return}let d;try{const S=yt(new Uint8Array(s)),A=fh(JSON.parse(S).sinf),_=UT(A);if(!_)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(_.subarray(8,24))}catch(S){this.warn(`${o} Failed to parse sinf: ${S}`);return}const f=wt(d),{keyIdToKeySessionPromise:h,mediaKeySessions:m}=this;let y=h[f];for(let S=0;S<m.length;S++){const A=m[S],_=A.decryptdata;if(!_.keyId)continue;const x=wt(_.keyId);if(ru(d,_.keyId)||_.uri.replace(/-/g,"").indexOf(f)!==-1){if(y=h[x],!y)continue;if(_.pssh)break;delete h[x],_.pssh=new Uint8Array(s),_.keyId=d,y=h[f]=y.then(()=>this.generateRequestWithPreferredKeySession(A,n,s,"encrypted-event-key-match")),y.catch(C=>this.handleError(C));break}}y||this.handleError(new Error(`Key ID ${f} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(I.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(I.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===st.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(l,u,d)=>!!l&&d.indexOf(l)===u,s=t.map(l=>l.audioCodec).filter(n),o=t.map(l=>l.videoCodec).filter(n);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((l,u)=>{const d=f=>{const h=f.shift();this.getMediaKeysPromise(h,s,o).then(m=>l({keySystem:h,mediaKeys:m})).catch(m=>{f.length?d(f):m instanceof un?u(m):u(new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${n}`;return jT===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return n(e,t)}getMediaKeysPromise(e,t,n){var s;const o=jw(e,t,n,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],u=(s=l)==null?void 0:s.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${je(o)}`),u=this.requestMediaKeySystemAccess(e,o);const d=l=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(f=>{this.log(`Failed to obtain access to key-system "${e}": ${f}`)}),u.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=d.mediaKeys=f.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,h.then(S=>S?this.setMediaKeysServerCertificate(y,e,S):y)));return m.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),m})}return u.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${wt(e.keyId||[])} keyUri: ${e.uri}`);const s=n.createSession(),o={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),s=Dl(t),o="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(n,o,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${wt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Kf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const o=Kf(s);o?t(o):n(new Error(`Unable to find format for key-system "${s}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Go(this.config),n=e.map($l).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const s=Tk(e,t[n]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,n=Dl(t),s=this.bannedKeyIds[n];if(s||this.getKeyStatus(t)==="internal-error"){const u=pE(s||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const o=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${o}`);const l=this.keyIdToKeySessionPromise[n];if(!l){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:f})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${o}`),this.attemptSetMediaKeys(d,f).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:f,decryptdata:t}))))).then(d=>{const f="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,f,h,"playlist-key")});return u.catch(d=>this.handleError(d,e.frag)),this.keyIdToKeySessionPromise[n]=u,u}return l.catch(u=>{if(u instanceof un){const d=Ke({},u.data);this.getKeyStatus(t)==="internal-error"&&(d.decryptdata=t);const f=new un(d,u.message);this.handleError(f,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof un){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${wt(n.keyId||[])})`:""}`),this.hls.trigger(I.ERROR,e.data)}else this.error(e.message),this.hls.trigger(I.ERROR,{type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Dl(e),n=this.keyIdToKeySessionPromise[t];if(!n){const s=$l(e.keyFormat),o=s?[s]:Go(this.config);return this.attemptKeySystemAccess(o)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Go(this.config)),e.length===0)throw new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${je({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((o,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(o).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>n.indexOf(o)===-1)})}generateRequestWithPreferredKeySession(e,t,n,s){var o;const l=(o=this.config.drmSystems)==null||(o=o[e.keySystem])==null?void 0:o.generateRequest;if(l)try{const A=l.call(this.hls,t,n,e);if(!A)throw new Error("Invalid response from configured generateRequest filter");t=A.initDataType,n=A.initData?A.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(A){if(this.warn(A.message),this.hls&&this.hls.config.debug)throw A}if(n===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=Dl(e.decryptdata),d=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${u} URI: ${d} (init data type: ${t} length: ${n.byteLength})`);const f=new hh,h=e._onmessage=A=>{const _=e.mediaKeysSession;if(!_){f.emit("error",new Error("invalid state"));return}const{messageType:x,message:C}=A;this.log(`"${x}" message event for session "${_.sessionId}" message size: ${C.byteLength}`),x==="license-request"||x==="license-renewal"?this.renewLicense(e,C).catch(b=>{f.eventNames().length?f.emit("error",b):this.handleError(b)}):x==="license-release"?e.keySystem===st.FAIRPLAY&&this.updateKeySession(e,Md("acknowledged")).then(()=>this.removeSession(e)).catch(b=>this.handleError(b)):this.warn(`unhandled media key message type "${x}"`)},m=(A,_)=>{_.keyStatus=A;let x;A.startsWith("usable")?f.emit("resolved"):A==="internal-error"||A==="output-restricted"||A==="output-downscaled"?x=pE(A,_.decryptdata):A==="expired"?x=new Error(`key expired (keyId: ${u})`):A==="released"?x=new Error("key released"):A==="status-pending"||this.warn(`unhandled key status change "${A}" (keyId: ${u})`),x&&(f.eventNames().length?f.emit("error",x):this.handleError(x))},y=e._onkeystatuseschange=A=>{if(!e.mediaKeysSession){f.emit("error",new Error("invalid state"));return}const x=this.getKeyStatuses(e);if(!Object.keys(x).some(M=>x[M]!=="status-pending"))return;if(x[u]==="expired"){this.log(`Expired key ${je(x)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let b=x[u];if(b)m(b,e);else{var L;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(L=e.keyStatusTimeouts)[u]||(L[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const P=this.getKeyStatus(e.decryptdata);if(P&&P!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${P} from other session.`),m(P,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),b="internal-error",m(b,e)},1e3)),this.log(`No status for keyId ${u} (${je(x)}).`)}};Vt(e.mediaKeysSession,"message",h),Vt(e.mediaKeysSession,"keystatuseschange",y);const S=new Promise((A,_)=>{f.on("error",_),f.on("resolved",A)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${d}`)}).catch(A=>{throw new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_SESSION,error:A,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${A}`)}).then(()=>S).catch(A=>(f.removeAllListeners(),this.removeSession(e).then(()=>{throw A}))).then(()=>(f.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,s)=>{if(typeof s=="string"&&typeof n=="object"){const u=s;s=n,n=u}const o="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===st.PLAYREADY&&o.length===16){const u=wt(o);t[u]=n,QT(o)}const l=wt(o);n==="internal-error"&&(this.bannedKeyIds[l]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,s=new n(t),o=this.getServerCertificateUrl(e);return o?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,u)=>{const d={responseType:"arraybuffer",url:o},f=t.certLoadPolicy.default,h={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,S,A,_)=>{l(y.data)},onError:(y,S,A,_)=>{u(new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:A,response:Ke({url:d.url,data:void 0},y)},`"${e}" certificate request failed (${o}). Status: ${y.code} (${y.text})`))},onTimeout:(y,S,A)=>{u(new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:A,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${o})`))},onAbort:(y,S,A)=>{u(new Error("aborted"))}};s.load(d,h,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((s,o)=>{e.setServerCertificate(n).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),s(e)}).catch(l=>{o(new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(s=>{throw new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(n,"application/xml"),o=s.querySelectorAll("HttpHeader");if(o.length>0){let h;for(let m=0,y=o.length;m<y;m++){var l,u;h=o[m];const S=(l=h.querySelector("name"))==null?void 0:l.textContent,A=(u=h.querySelector("value"))==null?void 0:u.textContent;S&&A&&e.setRequestHeader(S,A)}}const d=s.querySelector("Challenge"),f=d==null?void 0:d.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return Md(atob(f))}setupLicenseXHR(e,t,n,s){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return o.call(this.hls,e,t,n,s)}).catch(l=>{if(!n.decryptdata)throw l;return e.open("POST",t,!0),o.call(this.hls,e,t,n,s)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let d=u.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const f=this.config.licenseResponseCallback;if(f)try{d=f.call(this.hls,u,l,e)}catch(h){this.error(h)}s(d)}else{const d=n.errorRetry,f=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||u.status>=400&&u.status<500)o(new un({type:Ee.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:l,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${l}). Status: ${u.status} (${u.statusText})`));else{const h=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(s,o)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,l,e,t).then(({xhr:d,licenseChallenge:f})=>{e.keySystem==st.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(d,f)),d.send(f)}).catch(o)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Vt(n,"encrypted",this.onMediaEncrypted),Vt(n,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Zt(e,"encrypted",this.onMediaEncrypted),Zt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ts.clearKeyUriToKeyIdMap();const o=s.length;Mr.CDMCleanupPromise=Promise.all(s.map(l=>this.removeSession(l)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{o&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((s,o)=>(s.indexOf(o.keyFormat)===-1&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${wt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const o=this.mediaKeySessions.indexOf(e);o>-1&&this.mediaKeySessions.splice(o,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(f=>self.clearTimeout(l[f]));const{drmSystemOptions:u}=this.config;return(tN(u)?new Promise((f,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(f).catch(h)}):Promise.resolve()).catch(f=>{this.log(`Could not remove session: ${f}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${f}`)})}).then(()=>t.close()).catch(f=>{this.log(`Could not close session: ${f}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${f}`)})})}return Promise.resolve()}}Mr.CDMCleanupPromise=void 0;function Dl(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return wt(i.keyId)}function Tk(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class un extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function pE(i,e){const t=i==="output-restricted",n=t?K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:K.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new un({type:Ee.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class Sk{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const s=performance.now();if(t){if(this.lastTime){const o=s-this.lastTime,l=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*l/o,f=this.hls;if(f.trigger(I.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:n}),d>0&&l>f.config.fpsDroppedMonitoringThreshold*u){let h=f.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=h)&&(h=h-1,f.trigger(I.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:f.currentLevel}),f.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function HS(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function qS(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){ze.debug(`[texttrack-utils]: ${n}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,i.addCue(s)}catch(s){ze.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(i.mode=t)}function Ir(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function Gd(i,e,t,n){const s=i.mode;if(s==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const o=_k(i.cues,e,t);for(let l=0;l<o.length;l++)(!n||n(o[l]))&&i.removeCue(o[l])}s==="disabled"&&(i.mode=s)}function Ak(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,s=t,o;for(;n<=s;)if(o=Math.floor((s+n)/2),e<i[o].startTime)s=o-1;else if(e>i[o].startTime&&n<t)n=o+1;else return o;return i[n].startTime-e<e-i[s].startTime?n:s}function _k(i,e,t){const n=[],s=Ak(i,e);if(s>-1)for(let o=s,l=i.length;o<l;o++){const u=i[o];if(u.startTime>=e&&u.endTime<=t)n.push(u);else if(u.startTime>t)return n}return n}function Kl(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class xk extends Th{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Kl(this.media.textTracks);for(let o=0;o<n.length;o++)if(n[o].mode==="hidden")t=n[o];else if(n[o].mode==="showing"){t=n[o];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Kl(n.textTracks).forEach(l=>{Ir(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:s,details:o}=t,l=this.tracksInGroup[n];if(!l||l.groupId!==s){this.warn(`Subtitle track with id:${n} and group:${s} not found in active group ${l==null?void 0:l.groupId}`);return}const u=l.details;l.details=t.details,this.log(`Subtitle track ${n} "${l.name}" lang:${l.lang} group:${s} loaded [${o.startSN}-${o.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,s=this.groupIds;let o=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(l=>(s==null?void 0:s.indexOf(l))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(h=>h.default)&&(this.selectDefaultTrack=!1),l.forEach((h,m)=>{h.id=m});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const u=this.hls.config.subtitlePreference;if(!o&&u){this.selectDefaultTrack=!1;const h=Jn(u,l);if(h>-1)o=l[h];else{const m=Jn(u,this.tracks);o=this.tracks[m]}}let d=this.findTrackId(o);d===-1&&o&&(d=this.findTrackId(null));const f={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(I.SUBTITLE_TRACKS_UPDATED,f),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const o=t[s];if(!(n&&!o.default||!n&&!e)&&(!e||Ls(o,e)))return s}if(e){for(let s=0;s<t.length;s++){const o=t[s];if(Wo(e.attrs,o.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const o=t[s];if(Wo(e.attrs,o.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(Ud(s,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===De.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Ls(e,n))return n;const s=Jn(e,this.tracksInGroup);if(s>-1){const o=this.tracksInGroup[s];return this.setSubtitleTrack(s),o}else{if(n)return null;{const o=Jn(e,t);if(o>-1)return t[o]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,o=this.getUrlWithDirectives(e.url,t),l=e.details,u=l==null?void 0:l.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${o}`),this.hls.trigger(I.SUBTITLE_TRACK_LOADING,{url:o,id:n,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Kl(e.textTracks),n=this.currentTrack;let s;if(n&&(s=t.filter(o=>Ud(n,o))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(o=>{o.mode!=="disabled"&&o!==s&&(o.mode="disabled")}),s){const o=this.subtitleDisplay?"showing":"hidden";s.mode!==o&&(s.mode=o)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!he(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:e});return}const o=!!s.details&&!s.details.live;if(e===this.trackId&&s===n&&o)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:l,groupId:u="",name:d,type:f,url:h}=s;this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:l,groupId:u,name:d,type:f,url:h});const m=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(m)}}function Rk(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const o=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?o:o&3|8).toString(16)})}}}function Ho(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const wr=.025;let uu=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function Ik(i,e,t){return`${i.identifier}-${t+1}-${Ho(e)}`}class Ck{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return ed(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=ed(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=he(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return ed(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<wr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?uu.Range:uu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Lk(this)}}function ed(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<wr)?e.start:e.start+e.duration}function KS(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function td(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function Lk(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function _r(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class bk{constructor(e,t,n,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(I.PLAYOUT_LIMIT_REACHED,{})};const o=this.hls=new e(t);this.interstitial=n,this.assetItem=s;const l=()=>{this.hasDetails=!0};o.once(I.LEVEL_LOADED,l),o.once(I.AUDIO_TRACK_LOADED,l),o.once(I.SUBTITLE_TRACK_LOADED,l),o.on(I.MEDIA_ATTACHING,(u,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&o.on(I.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,o.trigger(I.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=KS(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,o=Re.bufferInfo(e,s,0);return this.getAssetTime(o.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Re.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,n){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,n){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${_r(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const yE=.033;class Dk extends bn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(o=s[n])!=null&&o.event;){var o;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let s=0;s<n.length;s++){let o=n[s];if(t&&t!=="primary"&&(o=o[t]),e===o.start||e>o.start&&e<o.end)return s}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let s=e;s<=t&&n[s];s++){const o=n[s].event;if(o!=null&&o.restrictions.jump&&!o.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var n;if(((n=t[s].event)==null?void 0:n.identifier)===e)return s}return-1}findAssetIndex(e,t){const n=e.assetList,s=n.length;if(s>1)for(let o=0;o<s;o++){const l=n[o];if(!l.error){const u=l.timelineStart;if(t===u||t>u&&(t<u+(l.duration||0)||o===s-1))return o}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,s=n[n.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:s}=n,o=this.events,l=this.parseDateRanges(s,{url:n.url},t),u=Object.keys(s),d=o?o.filter(f=>!u.includes(f.identifier)):[];l.length&&l.sort((f,h)=>{const m=f.cue.pre,y=f.cue.post,S=h.cue.pre,A=h.cue.post;if(m&&!S)return-1;if(S&&!m||y&&!A)return 1;if(A&&!y)return-1;if(!m&&!S&&!y&&!A){const _=f.startTime,x=h.startTime;if(_!==x)return _-x}return f.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=l,d.forEach(f=>{this.removeEvent(f)}),this.updateSchedule(e,d)}updateSchedule(e,t=[],n=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const o=this.items,l=this.parseSchedule(s,e);(n||t.length||(o==null?void 0:o.length)!==l.length||l.some((d,f)=>Math.abs(d.playout.start-o[f].playout.start)>.005||Math.abs(d.playout.end-o[f].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,o))}}parseDateRanges(e,t,n){const s=[],o=Object.keys(e);for(let l=0;l<o.length;l++){const u=o[l],d=e[u];if(d.isInterstitial){let f=this.eventMap[u];f?f.setDateRange(d):(f=new Ck(d,t),this.eventMap[u]=f,n===!1&&(f.appendInPlace=n)),s.push(f)}}return s}parseSchedule(e,t){const n=[],s=t.main.details,o=s.live?1/0:s.edge;let l=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,f=0;if(e.forEach((h,m)=>{const y=h.cue.pre,S=h.cue.post,A=e[m-1]||null,_=h.appendInPlace,x=S?o:h.startOffset,C=h.duration,b=h.timelineOccupancy===uu.Range?C:0,L=h.resumptionOffset,M=(A==null?void 0:A.startTime)===x,P=x+h.cumulativeDuration;let G=_?P+C:x+L;if(y||!S&&x<=0){const $=f;f+=b,h.timelineStart=P;const U=l;l+=C,n.push({event:h,start:P,end:G,playout:{start:U,end:l},integrated:{start:$,end:f}})}else if(x<=o){if(!M){const O=x-d;if(O>yE){const J=d,re=f;f+=O;const oe=l;l+=O;const ce={previousEvent:e[m-1]||null,nextEvent:h,start:J,end:J+O,playout:{start:oe,end:l},integrated:{start:re,end:f}};n.push(ce)}else O>0&&A&&(A.cumulativeDuration+=O,n[n.length-1].end=x)}S&&(G=P),h.timelineStart=P;const $=f;f+=b;const U=l;l+=C,n.push({event:h,start:P,end:G,playout:{start:U,end:l},integrated:{start:$,end:f}})}else return;const N=h.resumeTime;S||N>o?d=o:d=N}),d<o){var u;const h=d,m=f,y=o-d;f+=y;const S=l;l+=y,n.push({previousEvent:((u=n[n.length-1])==null?void 0:u.event)||null,nextEvent:null,start:d,end:h+y,playout:{start:S,end:l},integrated:{start:m,end:f}})}this.setDurations(o,l,f)}else n.push({previousEvent:null,nextEvent:null,start:0,end:o,playout:{start:0,end:o},integrated:{start:0,end:o}}),this.setDurations(o,o,o);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,s=n.live?1/0:n.edge;let o=0,l=-1;e.forEach((u,d)=>{const f=u.cue.pre,h=u.cue.post,m=f?0:h?s:u.startTime;this.updateAssetDurations(u),l===m?u.cumulativeDuration=o:(o=0,l=m),!h&&u.snapOptions.in&&(u.resumeAnchor=bs(null,n.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<yE&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const S=he(u.resumeOffset)?u.resumeOffset:u.duration;o+=S})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(n-s)>wr?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(l=>{const u=t[l].details,d=u.edge;if(n>=d)return this.log(`"${e.identifier}" resumption ${n} past ${l} playlist end ${d}`),!1;const f=bs(null,u.fragments,n);if(!f)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${l} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const h=l==="audio"?.175:0;return Math.abs(f.start-n)<wr+h||Math.abs(f.end-n)<wr+h?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${l} fragment bounds (${f.start}-${f.end} sn: ${f.sn} cc: ${f.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,s=!1,o=!1;for(let l=0;l<e.assetList.length;l++){const u=e.assetList[l],d=t+n;u.startOffset=n,u.timelineStart=d,s||(s=u.duration===null),o||(o=!!u.error);const f=u.error?0:u.duration||0;n+=f}s&&!o?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function kn(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class Mk{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let s;try{s=KS(n,this.hls.sessionId,e.baseUrl)}catch(y){const S=this.assignAssetListError(e,K.ASSET_LIST_LOAD_ERROR,y,n);this.hls.trigger(I.ERROR,S);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const o=this.hls.config,l=o.loader,u=new l(o),d={responseType:"json",url:s.href},f=o.interstitialAssetListLoadPolicy.default,h={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,S,A,_)=>{const x=y.data,C=x==null?void 0:x.ASSETS;if(!Array.isArray(C)){const b=this.assignAssetListError(e,K.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),A.url,S,_);this.hls.trigger(I.ERROR,b);return}e.assetListResponse=x,this.hls.trigger(I.ASSET_LIST_LOADED,{event:e,assetListResponse:x,networkDetails:_})},onError:(y,S,A,_)=>{const x=this.assignAssetListError(e,K.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${S.url})`),S.url,_,A);this.hls.trigger(I.ERROR,x)},onTimeout:(y,S,A)=>{const _=this.assignAssetListError(e,K.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${S.url})`),S.url,y,A);this.hls.trigger(I.ERROR,_)}};return u.load(d,h,m),this.hls.trigger(I.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,n,s,o,l){return e.error=n,{type:Ee.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:n,networkDetails:l,stats:o}}}function vE(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Ml(i,e){return`[${i}] Advancing timeline position to ${e}`}class wk extends bn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const s=n-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const l=s<=-.01;this.timelinePos=n,this.bufferedPos=n;const u=this.playingItem;if(!u){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(n,n-s)&&this.updateSchedule(!0),this.checkBuffer(),l&&n<u.start||n>=u.end){var d;const S=this.findItemIndex(u);let A=this.schedule.findItemIndexAtTime(n);if(A===-1&&(A=S+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${n} (resolving from ${S} to ${A})`)),!this.isInterstitial(u)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!l&&A>S){const _=this.schedule.findJumpRestrictedIndex(S+1,A);if(_>S){this.setSchedulePosition(_);return}}this.setSchedulePosition(A);return}const f=this.playingAsset;if(!f){if(this.playingLastItem&&this.isInterstitial(u)){const S=u.event.assetList[0];S&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,S))}return}const h=f.timelineStart,m=f.duration||0;if(l&&n<h||n>=h+m){var y;(y=u.event)!=null&&y.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,f)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(n>=s.end){this.timelinePos=s.end;const u=this.findItemIndex(s);this.setSchedulePosition(u+1)}const o=this.playingAsset;if(!o)return;const l=o.timelineStart+(o.duration||0);n>=l&&this.setScheduleToAssetAtTime(n,o)},this.onScheduleUpdate=(n,s)=>{const o=this.schedule;if(!o)return;const l=this.playingItem,u=o.events||[],d=o.items||[],f=o.durations,h=n.map(_=>_.identifier),m=!!(u.length||h.length);(m||s)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${d.map(_=>kn(_))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let y=null,S=null;l&&(y=this.updateItem(l,this.timelinePos),this.itemsMatch(l,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const A=this.bufferingItem;if(A&&(S=this.updateItem(A,this.bufferedPos),this.itemsMatch(A,S)?this.bufferingItem=S:A.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(A.event,null))),n.forEach(_=>{_.assetList.forEach(x=>{this.clearAssetPlayer(x.identifier,null)})}),this.playerQueue.forEach(_=>{if(_.interstitial.appendInPlace){const x=_.assetItem.timelineStart,C=_.timelineOffset-x;if(C)try{_.timelineOffset=x}catch(b){Math.abs(C)>wr&&this.warn(`${b} ("${_.assetId}" ${_.timelineOffset}->${x})`)}}}),m||s){if(this.hls.trigger(I.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:d.slice(0),durations:f,removedIds:h}),this.isInterstitial(l)&&h.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(y,l),A&&S!==y&&this.trimInPlace(S,A),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Mk(e),this.schedule=new Dk(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(I.MEDIA_ENDED,this.onMediaEnded,this),e.on(I.ERROR,this.onError,this),e.on(I.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(I.MEDIA_ENDED,this.onMediaEnded,this),e.off(I.ERROR,this.onError,this),e.off(I.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Zt(e,"play",this.onPlay),Zt(e,"pause",this.onPause),Zt(e,"seeking",this.onSeeking),Zt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Vt(n,"seeking",this.onSeeking),Vt(n,"timeupdate",this.onTimeupdate),Vt(n,"play",this.onPlay),Vt(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!s){this.clearScheduleState();const o=this.findItemIndex(n);this.setSchedulePosition(o)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(this.media=null,!n&&(s&&this.removeMediaListeners(s),this.detachedData)){const o=this.getBufferingPlayer();o&&(this.log(`Removing schedule state for detachedData and ${o}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,o.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=m=>m&&e.getAssetPlayer(m.identifier),s=(m,y,S,A,_)=>{if(m){let x=m[y].start;const C=m.event;if(C){if(y==="playout"||C.timelineOccupancy!==uu.Point){const b=n(S);(b==null?void 0:b.interstitial)===C&&(x+=b.assetItem.startOffset+b[_])}}else{const b=A==="bufferedPos"?l():e[A];x+=b-m.start}return x}return 0},o=(m,y)=>{var S;if(m!==0&&y!=="primary"&&(S=e.schedule)!=null&&S.length){var A;const _=e.schedule.findItemIndexAtTime(m),x=(A=e.schedule.items)==null?void 0:A[_];if(x){const C=x[y].start-x.start;return m+C}}return m},l=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var y,S;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((S=e.schedule)==null?void 0:S.durations[m])||0},d=(m,y)=>{var S,A;const _=e.effectivePlayingItem;if(_!=null&&(S=_.event)!=null&&S.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${y}"`);const x=e.effectivePlayingItem,C=e.schedule.findItemIndexAtTime(m,y),b=(A=e.schedule.items)==null?void 0:A[C],L=e.getBufferingPlayer(),M=L==null?void 0:L.interstitial,P=M==null?void 0:M.appendInPlace,G=x&&e.itemsMatch(x,b);if(x&&(P||G)){const N=n(e.playingAsset),$=(N==null?void 0:N.media)||e.primaryMedia;if($){const U=y==="primary"?$.currentTime:s(x,y,e.playingAsset,"timelinePos","currentTime"),O=m-U,J=(P?U:$.currentTime)+O;if(J>=0&&(!N||P||J<=N.duration)){$.currentTime=J;return}}}if(b){let N=m;if(y!=="primary"){const U=b[y].start,O=m-U;N=b.start+O}const $=!e.isInterstitial(b);if((!e.isInterstitial(x)||x.event.appendInPlace)&&($||b.event.appendInPlace)){const U=e.media||(P?L==null?void 0:L.media:null);U&&(U.currentTime=N)}else if(x){const U=e.findItemIndex(x);if(C>U){const J=e.schedule.findJumpRestrictedIndex(U+1,C);if(J>U){e.setSchedulePosition(J);return}}let O=0;if($)e.timelinePos=N,e.checkBuffer();else{const J=b.event.assetList,re=m-(b[y]||b).start;for(let oe=J.length;oe--;){const ce=J[oe];if(ce.duration&&re>=ce.startOffset&&re<ce.startOffset+ce.duration){O=oe;break}}}e.setSchedulePosition(C,O)}}},f=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const y=t();return e.isInterstitial(y)?y:null},h={get bufferedEnd(){const m=t(),y=e.bufferingItem;if(y&&y===m){var S;return s(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((S=e.bufferingAsset)==null?void 0:S.startOffset)||0}return 0},get currentTime(){const m=f(),y=e.effectivePlayingItem;return y&&y===m?s(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(m){const y=f(),S=e.effectivePlayingItem;S&&S===y&&d(m+S.playout.start,"playout")},get duration(){const m=f();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const y=(m=f())==null?void 0:m.event.assetList;return y?y.map(S=>e.getAssetPlayer(S.identifier)):[]},get playingIndex(){var m;const y=(m=f())==null?void 0:m.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return f()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return f()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return l()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){d(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){d(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return o(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,y=m==null?void 0:m.event;if(y&&!y.restrictions.skip){const S=e.findItemIndex(m);if(y.appendInPlace){const A=m.playout.start+m.event.duration;d(A+.001,"playout")}else e.advanceAfterAssetEnded(y,S,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const o=(t=s)==null?void 0:t.currentTime;if(!(o===void 0||!he(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,s=e.media;if(n&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const o=e.transferMedia();this.log(`transfer MediaSource from ${e} ${je(o)}`),this.detachedData=o}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var n,s;if(e.media===t)return;let o=null;const l=this.hls,u=e!==l,d=u&&e.interstitial.appendInPlace,f=(n=this.detachedData)==null?void 0:n.mediaSource;let h;if(l.media)d&&(o=l.transferMedia(),this.detachedData=o),h="Primary";else if(f){const A=this.getBufferingPlayer();A?(o=A.transferMedia(),h=`${A}`):h="detached MediaSource"}else h="detached media";if(!o){if(f)o=this.detachedData,this.log(`using detachedData: MediaSource ${je(o)}`);else if(!this.detachedData||l.media===t){const A=this.playerQueue;A.length>1&&A.forEach(_=>{if(u&&_.interstitial.appendInPlace!==d){const x=_.interstitial;this.clearInterstitial(_.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${x}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=o&&"mediaSource"in o&&((s=o.mediaSource)==null?void 0:s.readyState)!=="closed",y=m&&o?o:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const S=this.schedule;if(y===o&&S){const A=u&&e.assetId===S.assetIdAtEnd;y.overrides={duration:S.duration,endOfStream:!u||A,cueRemoval:!u}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,s=this.effectivePlayingItem;if(n===-1){const o=this.hls.startPosition;if(this.log(Ml("checkStart",o)),this.timelinePos=o,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(o>=0||!this.primaryLive){const l=this.timelinePos=o>0?o:0,u=e.findItemIndexAtTime(l);this.setSchedulePosition(u)}}else if(s&&!this.playingItem){const o=e.findItemIndex(s);this.setSchedulePosition(o)}}advanceAssetBuffering(e,t){const n=e.event,s=n.findAssetIndex(t),o=td(n,s);if(!n.isAssetPastPlayoutLimit(o))this.bufferedToEvent(e,o);else if(this.schedule){var l;const u=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,n){const s=td(e,n);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const o=this.schedule.items;if(o){const l=t+1,u=o.length;if(l>=u){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.log(Ml("advanceAfterAssetEnded",d)),this.timelinePos=d,e.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const o=e.assetList[s];o&&this.advanceInPlace(o.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const s=t.parentIdentifier,o=n.getEvent(s);if(o){const l=n.findEventIndex(s),u=n.findAssetIndex(o,e);this.advanceAfterAssetEnded(o,l,u-1)}}setSchedulePosition(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(!s||this.playbackDisabled)return;const o=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${o&&kn(o)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(l)){const h=l.event,m=this.playingAsset,y=m==null?void 0:m.identifier,S=y?this.getAssetPlayer(y):null;if(S&&y&&(!this.eventItemsMatch(l,o)||t!==void 0&&y!==h.assetList[t].identifier)){var d;const A=h.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${A+1}/${h.assetList.length} ${_r(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(I.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:A,event:h,schedule:s.slice(0),scheduleIndex:e,player:S}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),A);return}this.retreiveMediaSource(y,o),S.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&S.detachMedia()}if(!this.eventItemsMatch(l,o)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${kn(l)}`),h.hasPlayed=!0,this.hls.trigger(I.INTERSTITIAL_ENDED,{event:h,schedule:s.slice(0),scheduleIndex:e}),h.cue.once)){var f;this.updateSchedule();const A=(f=this.schedule)==null?void 0:f.items;if(o&&A){const _=this.findItemIndex(o);this.advanceSchedule(_,A,t,l,u)}return}}this.advanceSchedule(e,s,t,l,u)}advanceSchedule(e,t,n,s,o){const l=this.schedule;if(!l)return;const u=t[e]||null,d=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach(h=>{const m=h.interstitial,y=l.findEventIndex(m.identifier);(y<e||y>e+1)&&this.clearInterstitial(m,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const h=u.event;if(n===void 0){n=l.findAssetIndex(h,this.timelinePos);const A=td(h,n-1);if(h.isAssetPastPlayoutLimit(A)||h.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(h,e,n);return}n=A}const m=this.waitingItem;this.assetsBuffered(u,d)||this.setBufferingItem(u);let y=this.preloadAssets(h,n);if(this.eventItemsMatch(u,m||s)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${kn(u)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(I.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const S=h.assetList[n];if(!S){this.advanceAfterAssetEnded(h,e,n||0);return}if(y||(y=this.getAssetPlayer(S.identifier)),y===null||y.destroyed){const A=h.assetList.length;this.warn(`asset ${n+1}/${A} player destroyed ${h}`),y=this.createAssetPlayer(h,S,n),y.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(S))return;this.startAssetPlayer(y,n,t,e,d),this.shouldPlay&&vE(y.media)}else u?(this.resumePrimary(u,e,s),this.shouldPlay&&vE(this.hls.media)):o&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var s,o;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${kn(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(Ml("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!n)return;const l=(o=this.schedule)==null?void 0:o.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${kn(e)}`),this.hls.trigger(I.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(n<s.fragmentStart||n>s.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Re.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const o=this.hls;o.media?this.checkBuffer():(this.transferMediaTo(o,s),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Ml("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((n=s.mainForwardBufferInfo)==null?void 0:n.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(I.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(I.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const s=Ke(Ke({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ke(Ke({},this.altSelection),{},{audio:n});return}const o=Ke(Ke({},s),{},{audio:n});this.mediaSelection=o}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ke(Ke({},this.altSelection),{},{subtitles:n});return}const o=Ke(Ke({},s),{},{subtitles:n});this.mediaSelection=o}onAudioTrackSwitching(e,t){const n=Cv(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Cv(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const o=t[s];if(o.cue.post){var n;const l=this.schedule.findEventIndex(o.identifier),u=(n=this.schedule.items)==null?void 0:n[l];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(e&&s){const o=this.findItemIndex(e,t);return s[o]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((o,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(o.identifier,null)});const n=e.end+.25,s=Re.bufferInfo(this.primaryMedia,n,0);(s.end>n||(s.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${kn(e)} (was ${kn(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const s=Re.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,n,e)}updateBufferedPos(e,t,n){const s=this.schedule,o=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],o)){this.bufferedPos=e;return}const l=this.playingItem,u=this.findItemIndex(l);let d=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var f;const h=this.findItemIndex(o),m=Math.min(h+1,t.length-1),y=t[m];if((d===-1&&o&&e>=o.end||(f=y.event)!=null&&f.appendInPlace&&e+.01>=y.start)&&(d=m),this.isInterstitial(o)){const S=o.event;if(m-u>1&&S.appendInPlace===!1||S.assetList.length===0&&S.assetListLoader)return}if(this.bufferedPos=e,d>h&&d>u)this.bufferedToItem(y);else{const S=this.primaryDetails;this.primaryLive&&S&&e>S.edge-S.targetduration&&y.start<S.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else n&&l&&!this.itemsMatch(l,o)&&(d===u?this.bufferedToItem(l):d===u+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const o=this.getAssetPlayer(s.identifier);return!(o!=null&&o.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:s,events:o}=n;if(!s||!o)return t;const l=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${kn(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const f=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,m)=>{const y=this.getAssetPlayer(h.identifier);y&&(m===f&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(f=>f.pauseBuffering());this.hls.trigger(I.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:o.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,s=n.assetList.length===0&&!n.assetListLoader,o=n.cue.once;if(s||!o){const l=this.preloadAssets(n,t);if(l!=null&&l.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(l,u)}}}preloadAssets(e,t){const n=e.assetUrl,s=e.assetList.length,o=s===0&&!e.assetListLoader,l=e.cue.once;if(o){const d=e.timelineStart;if(e.appendInPlace){var u;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(u=y.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let f,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const y=h-d;y>0&&(f=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:s} ${e}${f?` live-start: ${h} start-offset: ${f}`:""}`),n)return this.createAsset(e,0,0,d,e.duration,n);const m=this.assetListLoader.loadAssetList(e,f);m&&(e.assetListLoader=m)}else if(!l&&s){for(let f=t;f<s;f++){const h=e.assetList[f],m=this.getAssetPlayerQueueIndex(h.identifier);(m===-1||this.playerQueue[m].destroyed)&&!h.error&&this.createAssetPlayer(e,h,f)}const d=e.assetList[t];if(d){const f=this.getAssetPlayer(d.identifier);return f&&f.loadSource(),f}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,s,o,l){const u={parentIdentifier:e.identifier,identifier:Ik(e,l,t),duration:o,startOffset:n,timelineStart:s,uri:l};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,n){const s=this.hls,o=s.userConfig;let l=o.videoPreference;const u=s.loadLevelObj||s.levels[s.currentLevel];(l||u)&&(l=We({},l),u.videoCodec&&(l.videoCodec=u.videoCodec),u.videoRange&&(l.allowedVideoRanges=[u.videoRange]));const d=s.audioTracks[s.audioTrack],f=s.subtitleTracks[s.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const M=this.timelinePos-t.timelineStart;if(M>1){const P=t.duration;P&&M<P&&(h=M)}}const m=t.identifier,y=Ke(Ke({},o),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:d||o.audioPreference,subtitlePreference:f||o.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const S=y.cmcd;S!=null&&S.sessionId&&S.contentId&&(y.cmcd=We({},S,{contentId:Ho(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const A=new bk(this.HlsPlayerClass,y,e,t);this.playerQueue.push(A),e.assetList[n]=t;let _=!0;const x=M=>{if(M.live){var P;const $=new Error(`Interstitials MUST be VOD assets ${e}`),U={fatal:!0,type:Ee.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:$},O=((P=this.schedule)==null?void 0:P.findEventIndex(e.identifier))||-1;this.handleAssetItemError(U,e,O,n,$.message);return}const G=M.edge-M.fragmentStart,N=t.duration;(_||N===null||G>N)&&(_=!1,this.log(`Interstitial asset "${m}" duration change ${N} > ${G}`),t.duration=G,this.updateSchedule())};A.on(I.LEVEL_UPDATED,(M,{details:P})=>x(P)),A.on(I.LEVEL_PTS_UPDATED,(M,{details:P})=>x(P)),A.on(I.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const C=(M,P)=>{const G=this.getAssetPlayer(m);if(G&&P.tracks){G.off(I.BUFFER_CODECS,C),G.tracks=P.tracks;const N=this.primaryMedia;this.bufferingAsset===G.assetItem&&N&&!G.media&&this.bufferAssetPlayer(G,N)}};A.on(I.BUFFER_CODECS,C);const b=()=>{var M;const P=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${P}`),!P||!this.schedule)return;const G=this.schedule.findEventIndex(e.identifier),N=(M=this.schedule.items)==null?void 0:M[G];this.isInterstitial(N)&&this.advanceAssetBuffering(N,t)};A.on(I.BUFFERED_TO_END,b);const L=M=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const G=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,G,M)};return A.once(I.MEDIA_ENDED,L(n)),A.once(I.PLAYOUT_LIMIT_REACHED,L(1/0)),A.on(I.ERROR,(M,P)=>{if(!this.schedule)return;const G=this.getAssetPlayer(m);if(P.details===K.BUFFER_STALLED_ERROR){if(G!=null&&G.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${P.error} ${e}`)}),A.on(I.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const P=new Error(`Asset player destroyed unexpectedly ${m}`),G={fatal:!0,type:Ee.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:P};this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),n,P.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${_r(t)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:A}),A}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const s=this.playerQueue[n];this.log(`clear ${s} toSegment: ${t&&kn(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(n,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,s,o){const{interstitial:l,assetItem:u,assetId:d}=e,f=l.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!h||h.identifier!==d)&&(h&&(this.clearAssetPlayer(h.identifier,n[s]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${f} ${_r(u)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:l,schedule:n.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,o)}bufferAssetPlayer(e,t){var n,s;if(!this.schedule)return;const{interstitial:o,assetItem:l}=e,u=this.schedule.findEventIndex(o.identifier),d=(n=this.schedule.items)==null?void 0:n[u];if(!d)return;e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=l;const f=this.getBufferingPlayer();if(f===e)return;const h=o.appendInPlace;if(h&&(f==null?void 0:f.interstitial.appendInPlace)===!1)return;const m=(f==null?void 0:f.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(h&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!CT(m,e.tracks)){const y=new Error(`Asset ${_r(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),S={fatal:!0,type:Ee.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},A=o.findAssetIndex(l);this.handleAssetItemError(S,o,u,A,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const s=n.currentTime,o=t.findAssetIndex(e,s),l=e.assetList[o];if(l){const u=this.getAssetPlayer(l.identifier);if(u){const d=u.currentTime||s-l.timelineStart,f=u.duration-d;if(this.warn(`Stalled at ${d} of ${d+f} in ${u} ${e} (media.currentTime: ${s})`),d&&(f/n.playbackRate<.5||u.bufferedInPlaceToEnd(n))&&u.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,o)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,s,o){if(e.details===K.BUFFER_STALLED_ERROR)return;const l=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&_r(l)} ${e.error}`),!this.schedule)return;const u=(l==null?void 0:l.identifier)||"",d=this.getAssetPlayerQueueIndex(u),f=this.playerQueue[d]||null,h=this.schedule.items,m=We({},e,{fatal:!1,errorAction:br(!0),asset:l,assetListIndex:s,event:t,schedule:h,scheduleIndex:n,player:f});if(this.hls.trigger(I.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const y=this.playingAsset,S=this.bufferingAsset,A=new Error(o);if(l&&(this.clearAssetPlayer(u,null),l.error=A),!t.assetList.some(_=>!_.error))t.error=A;else for(let _=s;_<t.assetList.length;_++)this.resetAssetPlayer(t.assetList[_].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===u?this.advanceAfterAssetEnded(t,n,s):S&&S.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,S)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let s=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${kn(n)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const l=this.updateItem(n,s);this.itemsMatch(n,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}onAssetListLoaded(e,t){var n,s;const o=t.event,l=o.identifier,u=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(l)))return;const d=o.timelineStart,f=o.duration;let h=0;u.forEach((_,x)=>{const C=parseFloat(_.DURATION);this.createAsset(o,x,h,d+h,C,_.URI),h+=C}),o.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${f}) ${o}`);const m=this.waitingItem,y=(m==null?void 0:m.event.identifier)===l;this.updateSchedule();const S=(s=this.bufferingItem)==null?void 0:s.event;if(y){var A;const _=this.schedule.findEventIndex(l),x=(A=this.schedule.items)==null?void 0:A[_];if(x){if(!this.playingItem&&this.timelinePos>x.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==_){o.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${o}`),this.log(o.error.message),this.updateSchedule(!0),this.primaryFallback(o);return}this.setBufferingItem(x)}this.setSchedulePosition(_)}else if((S==null?void 0:S.identifier)===l){const _=o.assetList[0];if(_){const x=this.getAssetPlayer(_.identifier);if(S.appendInPlace){const C=this.primaryMedia;x&&C&&this.bufferAssetPlayer(x,C)}else x&&x.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case K.ASSET_LIST_PARSING_ERROR:case K.ASSET_LIST_LOAD_ERROR:case K.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case K.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const EE=500;class Nk extends dh{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",pe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=te.IDLE,this.setInterval(EE),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:s}=t;if(this.fragContextChanged(n)||(ft(n)&&(this.fragPrevious=n),this.state=te.IDLE),!s)return;const o=this.tracksBuffered[this.currentTrackId];if(!o)return;let l;const u=n.start;for(let f=0;f<o.length;f++)if(u>=o[f].start&&u<=o[f].end){l=o[f];break}const d=n.start+n.duration;l?l.end=d:(l={start:u,end:d},o.push(l)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:s}=t;if(n===0&&s!==Number.POSITIVE_INFINITY){const o=s-1;if(o<=0)return;t.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(l=>{for(let u=0;u<l.length;){if(l[u].end<=o){l.shift();continue}else if(l[u].start<o)l[u].start=o;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(n,o,pe.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===pe.SUBTITLE&&(t.details===K.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==te.STOPPED&&(this.state=te.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&DS(this.levels,t)){this.levels=t.map(n=>new zo(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const s=new zo(n);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,pe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==te.STOPPED&&this.setInterval(EE)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:s,levels:o}=this,{details:l,id:u}=t;if(!o){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const d=o[u];if(u>=o.length||!d)return;this.log(`Subtitle track ${u} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(l.live||(n=d.details)!=null&&n.live){if(l.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const y=m.fragments[0];if(!d.details)l.hasProgramDateTime&&m.hasProgramDateTime?(au(l,m),f=l.fragmentStart):y&&(f=y.start,Nd(l,f));else{var h;f=this.alignPlaylists(l,d.details,(h=this.levelLastLoaded)==null?void 0:h.details),f===0&&y&&(f=y.start,Nd(l,f))}m&&!this.startFragRequested&&this.setStartPosition(m,f)}d.details=l,this.levelLastLoaded=d,u===s&&(this.hls.trigger(I.SUBTITLE_TRACK_UPDATED,{details:l,id:u,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===te.IDLE&&(bs(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,s=t.decryptdata,o=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&s!=null&&s.key&&s.iv&&Dr(s.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer,ch(s.method)).catch(u=>{throw o.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();o.trigger(I.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:l,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=te.IDLE})}}doTick(){if(!this.media){this.state=te.IDLE;return}if(this.state===te.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:s}=this,o=this.getLoadPosition(),l=Re.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,s.maxBufferHole),{end:u,len:d}=l,f=n.details,h=this.hls.maxBufferLength+f.levelTargetDuration;if(d>h)return;const m=f.fragments,y=m.length,S=f.edge;let A=null;const _=this.fragPrevious;if(u<S){const b=s.maxFragLookUpTolerance,L=u>S-b?0:b;A=bs(_,m,Math.max(m[0].start,u),L),!A&&_&&_.start<m[0].start&&(A=m[0])}else A=m[y-1];if(A=this.filterReplacedPrimary(A,n.details),!A)return;const x=A.sn-f.startSN,C=m[x-1];if(C&&C.cc===A.cc&&this.fragmentTracker.getState(C)===Et.NOT_LOADED&&(A=C),this.fragmentTracker.getState(A)===Et.NOT_LOADED){const b=this.mapToInitFragWhenRequired(A);b&&this.loadFragment(b,n,u)}}}loadFragment(e,t,n){ft(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Pk(this.tracksBuffered[this.currentTrackId]||[])}}class Pk{constructor(e){this.buffered=void 0;const t=(n,s,o)=>{if(s=s>>>0,s>o-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${o})`);return e[s][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const kk={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},zS=i=>String.fromCharCode(kk[i]||i),Un=15,Ei=100,Uk={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ok={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Fk={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Bk={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Gk=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class $k{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;ze.log(`${this.time} [${e}] ${n}`)}}}const Rs=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class YS{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const s=t[n];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Vk{constructor(){this.uchar=" ",this.penState=new YS}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Hk{constructor(e){this.chars=[],this.pos=0,this.currPenState=new YS,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ei;t++)this.chars.push(new Vk);this.logger=e}equals(e){for(let t=0;t<Ei;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ei;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ei;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ei&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ei)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=zS(e);if(this.pos>=Ei){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ei;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Ei;n++){const s=this.chars[n].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class nd{constructor(e){this.rows=[],this.currRow=Un-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Un;t++)this.rows.push(new Hk(e));this.logger=e}reset(){for(let e=0;e<Un;e++)this.rows[e].clear();this.currRow=Un-1}equals(e){let t=!0;for(let n=0;n<Un;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Un;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Un;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+je(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<Un;u++)this.rows[u].clear();const o=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const u=l.rows[o].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(l.rows[o+f])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const o=e.indent,l=Math.max(o-1,0);n.setCursor(e.indent),e.color=n.chars[l].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+je(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",s=-1;for(let o=0;o<Un;o++){const l=this.rows[o].getTextString();l&&(s=o+1,e?t.push("Row "+s+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class TE{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new nd(n),this.nonDisplayedMemory=new nd(n),this.lastOutputScreen=new nd(n),this.currRollUpRow=this.displayedMemory.rows[Un-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Un-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[n]}this.logger.log(2,"MIDROW: "+je(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class SE{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Kk(),this.logger=void 0;const s=this.logger=new $k;this.channels=[null,new TE(e,t,s),new TE(e+1,n,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const s=t[n]&127,o=t[n+1]&127;let l=!1,u=null;if(s===0&&o===0)continue;this.logger.log(3,()=>"["+Rs([t[n],t[n+1]])+"] -> ("+Rs([s,o])+")");const d=this.cmdHistory;if(s>=16&&s<=31){if(qk(s,o,d)){wl(null,null,d),this.logger.log(3,()=>"Repeated command ("+Rs([s,o])+") is dropped");continue}wl(s,o,this.cmdHistory),l=this.parseCmd(s,o),l||(l=this.parseMidrow(s,o)),l||(l=this.parsePAC(s,o)),l||(l=this.parseBackgroundAttributes(s,o))}else wl(null,null,d);if(!l&&(u=this.parseChars(s,o),u)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Rs([s,o])+" orig: "+Rs([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(n||s))return!1;const o=e===20||e===21||e===23?1:2,l=this.channels[o];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=o,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[n];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Rs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,o=(e===16||e===24)&&t>=64&&t<=95;if(!(s||o))return!1;const l=e<=23?1:2;t>=64&&t<=95?n=l===1?Uk[e]:Fk[e]:n=l===1?Ok[e]:Bk[e];const u=this.channels[l];return u?(u.setPAC(this.interpretPAC(n,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let n;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,s.underline=(n&1)===1,n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((n-16)/2)*4,s}parseChars(e,t){let n,s=null,o=null;if(e>=25?(n=2,o=e-8):(n=1,o=e),o>=17&&o<=19){let l;o===17?l=t+80:o===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+zS(l)+"' in channel "+n),s=[l]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Rs(s).join(",")),s}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(n||s))return!1;let o;const l={};e===16||e===24?(o=Math.floor((t-32)/2),l.background=Gk[o],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}wl(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function wl(i,e,t){t.a=i,t.b=e}function qk(i,e,t){return t.a===i&&t.b===e}function Kk(){return{a:null,b:null}}var xh=(function(){if(ou!=null&&ou.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if(typeof d!="string"||!Array.isArray(u))return!1;const f=d.toLowerCase();return~u.indexOf(f)?f:!1}function n(u){return t(i,u)}function s(u){return t(e,u)}function o(u,...d){let f=1;for(;f<arguments.length;f++){const h=arguments[f];for(const m in h)u[m]=h[m]}return u}function l(u,d,f){const h=this,m={enumerable:!0};h.hasBeenReset=!1;let y="",S=!1,A=u,_=d,x=f,C=null,b="",L=!0,M="auto",P="start",G=50,N="middle",$=50,U="middle";Object.defineProperty(h,"id",o({},m,{get:function(){return y},set:function(O){y=""+O}})),Object.defineProperty(h,"pauseOnExit",o({},m,{get:function(){return S},set:function(O){S=!!O}})),Object.defineProperty(h,"startTime",o({},m,{get:function(){return A},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");A=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",o({},m,{get:function(){return _},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");_=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",o({},m,{get:function(){return x},set:function(O){x=""+O,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",o({},m,{get:function(){return C},set:function(O){C=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",o({},m,{get:function(){return b},set:function(O){const J=n(O);if(J===!1)throw new SyntaxError("An invalid or illegal string was specified.");b=J,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",o({},m,{get:function(){return L},set:function(O){L=!!O,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",o({},m,{get:function(){return M},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");M=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",o({},m,{get:function(){return P},set:function(O){const J=s(O);if(!J)throw new SyntaxError("An invalid or illegal string was specified.");P=J,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",o({},m,{get:function(){return G},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");G=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",o({},m,{get:function(){return N},set:function(O){const J=s(O);if(!J)throw new SyntaxError("An invalid or illegal string was specified.");N=J,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",o({},m,{get:function(){return $},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");$=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",o({},m,{get:function(){return U},set:function(O){const J=s(O);if(!J)throw new SyntaxError("An invalid or illegal string was specified.");U=J,this.hasBeenReset=!0}})),h.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class zk{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function XS(i){function e(n,s,o,l){return(n|0)*3600+(s|0)*60+(o|0)+parseFloat(l||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Yk{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function JS(i,e,t,n){const s=n?i.split(n):[i];for(const o in s){if(typeof s[o]!="string")continue;const l=s[o].split(t);if(l.length!==2)continue;const u=l[0],d=l[1];e(u,d)}}const $d=new xh(0,0,""),Nl=$d.align==="middle"?"middle":"center";function Xk(i,e,t){const n=i;function s(){const u=XS(i);if(u===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),u}function o(u,d){const f=new Yk;JS(u,function(y,S){let A;switch(y){case"region":for(let _=t.length-1;_>=0;_--)if(t[_].id===S){f.set(y,t[_].region);break}break;case"vertical":f.alt(y,S,["rl","lr"]);break;case"line":A=S.split(","),f.integer(y,A[0]),f.percent(y,A[0])&&f.set("snapToLines",!1),f.alt(y,A[0],["auto"]),A.length===2&&f.alt("lineAlign",A[1],["start",Nl,"end"]);break;case"position":A=S.split(","),f.percent(y,A[0]),A.length===2&&f.alt("positionAlign",A[1],["start",Nl,"end","line-left","line-right","auto"]);break;case"size":f.percent(y,S);break;case"align":f.alt(y,S,["start",Nl,"end","left","right"]);break}},/:/,/\s/),d.region=f.get("region",null),d.vertical=f.get("vertical","");let h=f.get("line","auto");h==="auto"&&$d.line===-1&&(h=-1),d.line=h,d.lineAlign=f.get("lineAlign","start"),d.snapToLines=f.get("snapToLines",!0),d.size=f.get("size",100),d.align=f.get("align",Nl);let m=f.get("position","auto");m==="auto"&&$d.position===50&&(m=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=m}function l(){i=i.replace(/^\s+/,"")}if(l(),e.startTime=s(),l(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),l(),e.endTime=s(),l(),o(i,e)}function WS(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class Jk{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new zk,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let o=t.buffer,l=0;for(o=WS(o);l<o.length&&o[l]!=="\r"&&o[l]!==`
`;)++l;const u=o.slice(0,l);return o[l]==="\r"&&++l,o[l]===`
`&&++l,t.buffer=o.slice(l),u}function s(o){JS(o,function(l,u){},/:/)}try{let o="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;o=n();const u=o.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:o=n(),t.state){case"HEADER":/:/.test(o)?s(o):o||(t.state="ID");continue;case"NOTE":o||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(o)){t.state="NOTE";break}if(!o)continue;if(t.cue=new xh(0,0,""),t.state="CUE",o.indexOf("-->")===-1){t.cue.id=o;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Xk(o,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=o.indexOf("-->")!==-1;if(!o||u&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=o}continue;case"BADCUE":o||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Wk=/\r\n|\n\r|\n|\r/g,id=function(e,t,n=0){return e.slice(n,n+t.length)===t},Qk=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),o=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!he(t)||!he(n)||!he(s)||!he(o))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*s,t+=3600*1e3*o,t};function Rh(i,e,t){return Ho(i.toString())+Ho(e.toString())+Ho(t)}const Zk=function(e,t,n){let s=e[t],o=e[s.prevCC];if(!o||!o.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(l=o)!=null&&l.new;){var l;e.ccOffset+=s.start-o.start,s.new=!1,s=o,o=e[s.prevCC]}e.presentationOffset=n};function jk(i,e,t,n,s,o,l){const u=new Jk,d=gn(new Uint8Array(i)).trim().replace(Wk,`
`).split(`
`),f=[],h=e?rP(e.baseTime,e.timescale):0;let m="00:00.000",y=0,S=0,A,_=!0;u.oncue=function(x){const C=t[n];let b=t.ccOffset;const L=(y-h)/9e4;if(C!=null&&C.new&&(S!==void 0?b=t.ccOffset=C.start:Zk(t,n,L)),L){if(!e){A=new Error("Missing initPTS for VTT MPEGTS");return}b=L-t.presentationOffset}const M=x.endTime-x.startTime,P=fn((x.startTime+b-S)*9e4,s*9e4)/9e4;x.startTime=Math.max(P,0),x.endTime=Math.max(P+M,0);const G=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(G)),x.id||(x.id=Rh(x.startTime,x.endTime,G)),x.endTime>0&&f.push(x)},u.onparsingerror=function(x){A=x},u.onflush=function(){if(A){l(A);return}o(f)},d.forEach(x=>{if(_)if(id(x,"X-TIMESTAMP-MAP=")){_=!1,x.slice(16).split(",").forEach(C=>{id(C,"LOCAL:")?m=C.slice(6):id(C,"MPEGTS:")&&(y=parseInt(C.slice(7)))});try{S=Qk(m)/1e3}catch(C){A=C}return}else x===""&&(_=!1);u.parse(x+`
`)}),u.flush()}const sd="stpp.ttml.im1t",QS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ZS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,eU={left:"start",center:"center",right:"end",start:"start",end:"end"};function AE(i,e,t,n){const s=be(new Uint8Array(i),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const o=s.map(u=>gn(u)),l=sP(e.baseTime,1,e.timescale);try{o.forEach(u=>t(tU(u,l)))}catch(u){n(u)}}function tU(i,e){const s=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(o).reduce((m,y)=>(m[y]=s.getAttribute(`ttp:${y}`)||o[y],m),{}),u=s.getAttribute("xml:space")!=="preserve",d=_E(rd(s,"styling","style")),f=_E(rd(s,"layout","region")),h=rd(s,"body","[begin]");return[].map.call(h,m=>{const y=jS(m,u);if(!y||!m.hasAttribute("begin"))return null;const S=ad(m.getAttribute("begin"),l),A=ad(m.getAttribute("dur"),l);let _=ad(m.getAttribute("end"),l);if(S===null)throw xE(m);if(_===null){if(A===null)throw xE(m);_=S+A}const x=new xh(S-e,_-e,y);x.id=Rh(x.startTime,x.endTime,x.text);const C=f[m.getAttribute("region")],b=d[m.getAttribute("style")],L=nU(C,b,d),{textAlign:M}=L;if(M){const P=eU[M];P&&(x.lineAlign=P),x.align=M}return We(x,L),x}).filter(m=>m!==null)}function rd(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function _E(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function jS(i,e){return[].slice.call(i.childNodes).reduce((t,n,s)=>{var o;return n.nodeName==="br"&&s?t+`
`:(o=n.childNodes)!=null&&o.length?jS(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function nU(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let s=null;const o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(s=t[l]),o.reduce((u,d)=>{const f=od(e,n,d)||od(i,n,d)||od(s,n,d);return f&&(u[d]=f),u},{})}function od(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function xE(i){return new Error(`Could not parse ttml timestamp ${i}`)}function ad(i,e){if(!i)return null;let t=XS(i);return t===null&&(QS.test(i)?t=iU(i,e):ZS.test(i)&&(t=sU(i,e))),t}function iU(i,e){const t=QS.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function sU(i,e){const t=ZS.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Pl{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class rU{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=IE(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Pl(this,"textTrack1"),t=new Pl(this,"textTrack2"),n=new Pl(this,"textTrack3"),s=new Pl(this,"textTrack4");this.cea608Parser1=new SE(1,e,t),this.cea608Parser2=new SE(3,n,s)}addCues(e,t,n,s,o){let l=!1;for(let u=o.length;u--;){const d=o[u],f=oU(d[0],d[1],t,n);if(f>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),l=!0,f/(n-t)>.5))return}if(l||o.push([t,n]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,n,s)}else{const u=this.Cues.newCue(null,t,n,s);this.hls.trigger(I.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:o,trackId:l}){const{unparsedVttFrags:u}=this;n===pe.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:o,trackId:l}),u.length&&(this.unparsedVttFrags=[],u.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(I.FRAG_LOADED,d):this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let s=0;s<n.textTracks.length;s++){const o=n.textTracks[s];if(RE(o,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return o}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:s}=this,{label:o,languageCode:l}=t[e],u=this.getExistingTrack(o,l);if(u)n[e]=u,Ir(n[e]),HS(n[e],s);else{const d=this.createTextTrack("captions",o,l);d&&(d[e]=!0,n[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,n){const s=this.media;if(s)return s.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:s}=this;Object.keys(s).forEach(o=>{Ir(s[o]),delete s[o]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=IE(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Ir(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],s=n.some(o=>o.textCodec===sd);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(DS(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const l=this.media,u=l?Kl(l.textTracks):null;if(this.tracks.forEach((d,f)=>{let h;if(u){let m=null;for(let y=0;y<u.length;y++)if(u[y]&&RE(u[y],d)){m=u[y],u[y]=null;break}m&&(h=m)}if(h)Ir(h);else{const m=eA(d);h=this.createTextTrack(m,d.name,d.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),u!=null&&u.length){const d=u.filter(f=>f!==null).map(f=>f.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!s)return;const o=`textTrack${s[1]}`,l=this.captionsProperties[o];l&&(l.label=n.name,n.lang&&(l.languageCode=n.lang),l.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===pe.MAIN){var n,s;const{cea608Parser1:o,cea608Parser2:l,lastSn:u}=this,{cc:d,sn:f}=t.frag,h=(n=(s=t.part)==null?void 0:s.index)!=null?n:-1;o&&l&&(f!==u+1||f===u&&h!==this.lastPartIndex+1||d!==this.lastCc)&&(o.reset(),l.reset()),this.lastCc=d,this.lastSn=f,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:n,payload:s}=t;if(n.type===pe.SUBTITLE)if(s.byteLength){const o=n.decryptdata,l="stats"in t;if(o==null||!o.encrypted||l){const u=this.tracks[n.level],d=this.vttCCs;d[n.cc]||(d[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===sd?this._parseIMSC1(n,s):this._parseVTTs(t)}}else this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;AE(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),n.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{n.logger.log(`Failed to parse IMSC1: ${s}`),n.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:n,payload:s}=e,{initPTS:o,unparsedVttFrags:l}=this,u=o.length-1;if(!o[n.cc]&&u===-1){l.push(e);return}const d=this.hls,f=(t=n.initSegment)!=null&&t.data?Ln(n.initSegment.data,new Uint8Array(s)).buffer:s;jk(f,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),d.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const m=h.message==="Missing initPTS for VTT MPEGTS";m?l.push(e):this._fallbackToIMSC1(n,s),d.logger.log(`Failed to parse VTT cue: ${h}`),!(m&&u>n.cc)&&d.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||AE(t,this.initPTS[e.cc],()=>{n.textCodec=sd,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(o=>qS(s,o))}else{const s=this.tracks[t];if(!s)return;const o=s.default?"default":"subtitles"+t;n.trigger(I.CUES_PARSED,{type:"subtitles",cues:e,track:o})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===pe.SUBTITLE&&this.onFragLoaded(I.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:s}=t;if(!(n.type===pe.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let o=0;o<s.length;o++){const l=s[o].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(l);this.cea608Parser1.addData(s[o].pts,u[0]),this.cea608Parser2.addData(s[o].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:s,type:o}){const{media:l}=this;if(!(!l||l.currentTime<n)){if(!o||o==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>Gd(u[d],t,n))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(d=>Gd(u[d],t,s))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let s=2;for(let o=0;o<n;o++){const l=e[s++],u=127&e[s++],d=127&e[s++];if(u===0&&d===0)continue;if((4&l)!==0){const h=3&l;(h===0||h===1)&&(t[h].push(u),t[h].push(d))}}return t}}function eA(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function RE(i,e){return!!i&&i.kind===eA(e)&&Ud(e,i)}function oU(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function IE(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const aU=/\s/,lU={newCue(i,e,t,n){const s=[];let o,l,u,d,f;const h=self.VTTCue||self.TextTrackCue;for(let y=0;y<n.rows.length;y++)if(o=n.rows[y],u=!0,d=0,f="",!o.isEmpty()){var m;for(let _=0;_<o.chars.length;_++)aU.test(o.chars[_].uchar)&&u?d++:(f+=o.chars[_].uchar,u=!1);o.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const S=WS(f.trim()),A=Rh(e,t,S);i!=null&&(m=i.cues)!=null&&m.getCueById(A)||(l=new h(e,t,S),l.id=A,l.line=y+1,l.align="left",l.position=10+Math.min(80,Math.floor(d*8/32)*10),s.push(l))}return i&&s.length&&(s.sort((y,S)=>y.line==="auto"||S.line==="auto"?0:y.line>8&&S.line>8?S.line-y.line:y.line-S.line),s.forEach(y=>qS(i,y))),s}};function uU(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const cU=/(\d+)-(\d+)\/(\d+)/;class CE{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||gU,this.controller=new self.AbortController,this.stats=new ih}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const o=fU(e,this.controller.signal),l=e.responseType==="arraybuffer",u=l?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=d&&he(d)?d:f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Jo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var y;this.response=this.loader=m;const S=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},f-(S-s.loading.start)),!m.ok){const{status:_,statusText:x}=m;throw new mU(x||"fetch, bad network response",_,m)}s.loading.first=S,s.total=hU(m.headers)||s.total;const A=(y=this.callbacks)==null?void 0:y.onProgress;return A&&he(t.highWaterMark)?this.loadProgressively(m,s,e,t.highWaterMark,A):l?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var y,S;const A=this.response;if(!A)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const _=m[u];_&&(s.loaded=s.total=_);const x={url:A.url,data:m,code:A.status},C=(y=this.callbacks)==null?void 0:y.onProgress;C&&!he(t.highWaterMark)&&C(s,e,m,A),(S=this.callbacks)==null||S.onSuccess(x,s,e,A)}).catch(m=>{var y;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const S=m&&m.code||0,A=m?m.message:null;(y=this.callbacks)==null||y.onError({code:S,text:A},e,m?m.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,s=0,o){const l=new cS,u=e.body.getReader(),d=()=>u.read().then(f=>{if(f.done)return l.dataLength&&o(t,n,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=f.value,m=h.length;return t.loaded+=m,m<s||l.dataLength?(l.push(h),l.dataLength>=s&&o(t,n,l.flush().buffer,e)):o(t,n,h.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function fU(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(We({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function dU(i){const e=cU.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function hU(i){const e=i.get("Content-Range");if(e){const n=dU(e);if(he(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function gU(i,e){return new self.Request(i.url,e)}class mU extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const pU=/^age:\s*[\d.]+\s*$/im;class tA{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ih,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const o=this.xhrSetup;o?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return o(n,t.url)}).catch(l=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),o(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(l=>{var u;(u=this.callbacks)==null||u.onError({code:n.status,text:l.message},t,n,s)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=n.loadPolicy;if(s)for(const u in s)e.setRequestHeader(u,s[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=o&&he(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const s=t.readyState,o=this.config;if(!n.aborted&&s>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),o.timeout!==o.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),o.timeout=o.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const f=t.status,h=t.responseType==="text"?t.responseText:null;if(f>=200&&f<300){const A=h??t.response;if(A!=null){var l,u;n.loading.end=Math.max(self.performance.now(),n.loading.first);const _=t.responseType==="arraybuffer"?A.byteLength:A.length;n.loaded=n.total=_,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const x=(l=this.callbacks)==null?void 0:l.onProgress;x&&x(n,e,A,t);const C={url:t.responseURL,data:A,code:f};(u=this.callbacks)==null||u.onSuccess(C,n,e,t);return}}const m=o.loadPolicy.errorRetry,y=n.retry,S={url:e.url,data:void 0,code:f};if(su(m,y,!1,S))this.retry(m);else{var d;ze.error(`${f} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:f,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(su(e,t,!0))this.retry(e);else{var n;ze.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=ah(e,n.retry),n.retry++,ze.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&pU.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const yU={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},vU=Ke(Ke({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:tA,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Dw,bufferController:TP,capLevelController:Sh,errorController:kw,fpsController:Sk,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:jT,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:yU},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},EU()),{},{subtitleStreamController:Nk,subtitleTrackController:xk,timelineController:rU,audioStreamController:pP,audioTrackController:yP,emeController:Mr,cmcdController:yk,contentSteeringController:Ek,interstitialsController:wk});function EU(){return{cueHandler:lU,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function TU(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Vd(i),s=["manifest","level","frag"],o=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(l=>{const u=`${l==="level"?"playlist":l}LoadPolicy`,d=e[u]===void 0,f=[];o.forEach(h=>{const m=`${l}Loading${h}`,y=e[m];if(y!==void 0&&d){f.push(m);const S=n[u].default;switch(e[u]={default:S},h){case"TimeOut":S.maxLoadTimeMs=y,S.maxTimeToFirstByteMs=y;break;case"MaxRetry":S.errorRetry.maxNumRetry=y,S.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":S.errorRetry.retryDelayMs=y,S.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":S.errorRetry.maxRetryDelayMs=y,S.timeoutRetry.maxRetryDelayMs=y;break}}}),f.length&&t.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${u}": ${je(e[u])}`)}),Ke(Ke({},n),e)}function Vd(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Vd):Object.keys(i).reduce((e,t)=>(e[t]=Vd(i[t]),e),{}):i}function SU(i,e){const t=i.loader;t!==CE&&t!==tA?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):uU()&&(i.loader=CE,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const zl=2,AU=.1,_U=.05,xU=100;class RU extends XT{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(xU),this.mediaSource=t.mediaSource;const n=this.media=t.media;Vt(n,"playing",this.onMediaPlaying),Vt(n,"waiting",this.onMediaWaiting),Vt(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Zt(n,"playing",this.onMediaPlaying),Zt(n,"waiting",this.onMediaWaiting),Zt(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,s;const o=(n=this.hls)==null?void 0:n.config;if(!o)return;const l=this.media;if(!l)return;const{seeking:u}=l,d=this.seeking&&!u,f=!this.seeking&&u,h=l.paused&&!u||l.ended||l.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,o.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(f||d){d&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1}));return}if(!Re.getBuffered(l).length){this.nudgeRetry=0;return}const m=Re.bufferInfo(l,e,0),y=m.nextStart||0,S=this.fragmentTracker;if(u&&S&&this.hls){const G=LE(this.hls.inFlightFragments,e),N=m.len>zl,$=!y||G||y-e>zl&&!S.getPartialFragment(e);if(N||$)return;this.moved=!1}const A=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&S){if(!(m.len>0)&&!y)return;const N=Math.max(y,m.start||0)-e,U=!!(A!=null&&A.live)?A.targetduration*2:zl,O=kl(e,S);if(N>0&&(N<=U||O)){l.paused||this._trySkipBufferHole(O);return}}const _=o.detectStallWithCurrentTimeMs,x=self.performance.now(),C=this.waiting;let b=this.stalled;if(b===null)if(C>0&&x-C<_)b=this.stalled=C;else{this.stalled=x;return}const L=x-b;if(!u&&(L>=_||C)&&this.hls){var M;if(((M=this.mediaSource)==null?void 0:M.readyState)==="ended"&&!(A!=null&&A.live)&&Math.abs(e-((A==null?void 0:A.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const P=Re.bufferInfo(l,e,o.maxBufferHole);this._tryFixBufferStall(P,L,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(I.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&s&&s.length>1&&e>s.end(0)){const o=Re.bufferedInfo(Re.timeRangesToArray(this.buffered.audio),e,0);if(o.len>1&&t>=o.start){const l=Re.timeRangesToArray(s),u=Re.bufferedInfo(l,t,0).bufferedIndex;if(u>-1&&u<l.length-1){const d=Re.bufferedInfo(l,e,0).bufferedIndex,f=l[u].end,h=l[u+1].start;if((d===-1||d>u)&&h-f<1&&e-f<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${f} -> ${h} buffered index: ${d}`);this.warn(m.message),this.media.currentTime+=1e-6;let y=kl(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const S=Re.bufferInfo(this.media,e,0);this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:y,buffer:S.len,bufferInfo:S})}}}}}_tryFixBufferStall(e,t,n){var s,o;const{fragmentTracker:l,media:u}=this,d=(s=this.hls)==null?void 0:s.config;if(!u||!l||!d)return;const f=(o=this.hls)==null?void 0:o.latestLevelDetails,h=kl(n,l);if((h||f!=null&&f.live&&n<f.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const m=e.buffered,y=this.adjacentTraversal(e,n);(m&&m.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-n<d.maxBufferHole||y))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,s=e.nextStart;if(n&&s){const o=n.getFragAtPos(t,pe.MAIN),l=n.getFragAtPos(s,pe.MAIN);if(o&&l)return l.sn-o.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:s,stalled:o}=this;if(!s&&o!==null&&n&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${je(e)})`);this.warn(l.message),t.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:o}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:s}=this,o=(t=this.hls)==null?void 0:t.config;if(!s||!n||!o)return 0;const l=s.currentTime,u=Re.bufferInfo(s,l,0),d=l<u.start?u.start:u.nextStart;if(d&&this.hls){const h=u.len<=o.maxBufferHole,m=u.len>0&&u.len<1&&s.readyState<3,y=d-l;if(y>0&&(h||m)){if(y>o.maxBufferHole){let A=!1;if(l===0){const _=n.getAppendedFrag(0,pe.MAIN);_&&d<_.end&&(A=!0)}if(!A&&e){var f;if(!((f=this.hls.loadLevelObj)!=null&&f.details)||LE(this.hls.inFlightFragments,d))return 0;let x=!1,C=e.end;for(;C<d;){const b=kl(C,n);if(b)C+=b.duration;else{x=!0;break}}if(x)return 0}}const S=Math.max(d+_U,l+AU);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${S}`),this.moved=!0,s.currentTime=S,!(e!=null&&e.gap)){const A=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${S}`),_={type:Ee.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:A,reason:A.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?_.part=e:_.frag=e),this.hls.trigger(I.ERROR,_)}return S}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:s}=this,o=t==null?void 0:t.config;if(!n||!o)return 0;const l=n.currentTime;if(this.nudgeRetry++,s<o.nudgeMaxRetry){const u=l+(s+1)*o.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${l} to ${u}`);this.warn(d.message),n.currentTime=u,t.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${l} after ${o.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function LE(i,e){const t=bE(i.main);if(t&&t.start<=e)return t;const n=bE(i.audio);return n&&n.start<=e?n:null}function bE(i){if(!i)return null;switch(i.state){case te.IDLE:case te.STOPPED:case te.ENDED:case te.ERROR:return null}return i.frag}function kl(i,e){return e.getAppendedFrag(i,pe.MAIN)||e.getPartialFragment(i)}const IU=.25;function Hd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function ld(i,e,t,n,s){let o=new i(e,t,"");try{o.value=n,s&&(o.type=s)}catch{o=new i(e,t,je(s?Ke({type:s},n):n))}return o}const Ul=(()=>{const i=Hd();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class CU{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(I.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ir(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return HS(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:s}=this.hls.config;if(!n&&!s)return;const{samples:o}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Hd();if(l)for(let u=0;u<o.length;u++){const d=o[u].type;if(d===dn.emsg&&!n||!s)continue;const f=yS(o[u].data),h=o[u].pts;let m=h+o[u].duration;m>Ul&&(m=Ul),m-h<=0&&(m=h+IU);for(let S=0;S<f.length;S++){const A=f[S];if(!vS(A)){this.updateId3CueEnds(h,d);const _=ld(l,h,m,A,d);_&&this.id3Track.addCue(_)}}}}updateId3CueEnds(e,t){var n;const s=(n=this.id3Track)==null?void 0:n.cues;if(s)for(let o=s.length;o--;){const l=s[o];l.type===t&&l.startTime<e&&l.endTime===Ul&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:s}){const{id3Track:o,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=l;if(o&&(u||d)){let f;s==="audio"?f=h=>h.type===dn.audioId3&&d:s==="video"?f=h=>h.type===dn.emsg&&u:f=h=>h.type===dn.audioId3&&d||h.type===dn.emsg&&u,Gd(o,t,n,f)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:s,enableDateRangeMetadataCues:o,interstitialsController:l}=this.hls.config;if(!o)return;const u=Hd();if(n&&s&&!l){const{fragmentStart:_,fragmentEnd:x}=e;let C=this.assetCue;C?(C.startTime=_,C.endTime=x):u&&(C=this.assetCue=ld(u,_,x,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),C&&(C.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(C),C.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:f}=e,h=Object.keys(f);let m=this.dateRangeCuesAppended;if(d&&t){var y;if((y=d.cues)!=null&&y.length){const _=Object.keys(m).filter(x=>!h.includes(x));for(let x=_.length;x--;){var S;const C=_[x],b=(S=m[C])==null?void 0:S.cues;delete m[C],b&&Object.keys(b).forEach(L=>{const M=b[L];if(M){M.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(M)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const A=e.fragments[e.fragments.length-1];if(!(h.length===0||!he(A==null?void 0:A.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let _=0;_<h.length;_++){const x=h[_],C=f[x],b=C.startTime,L=m[x],M=(L==null?void 0:L.cues)||{};let P=(L==null?void 0:L.durationKnown)||!1,G=Ul;const{duration:N,endDate:$}=C;if($&&N!==null)G=b+N,P=!0;else if(C.endOnNext&&!P){const O=h.reduce((J,re)=>{if(re!==C.id){const oe=f[re];if(oe.class===C.class&&oe.startDate>C.startDate&&(!J||C.startDate<J.startDate))return oe}return J},null);O&&(G=O.startTime,P=!0)}const U=Object.keys(C.attr);for(let O=0;O<U.length;O++){const J=U[O];if(!Xw(J))continue;const re=M[J];if(re)P&&!(L!=null&&L.durationKnown)?re.endTime=G:Math.abs(re.startTime-b)>.01&&(re.startTime=b,re.endTime=G);else if(u){let oe=C.attr[J];Jw(J)&&(oe=LT(oe));const fe=ld(u,b,G,{key:J,data:oe},dn.dateRange);fe&&(fe.id=x,this.id3Track.addCue(fe),M[J]=fe,l&&(J==="X-ASSET-LIST"||J==="X-ASSET-URL")&&fe.addEventListener("enter",this.onEventCueEnter))}}m[x]={cues:M,dateRange:C,durationKnown:P}}}}}class LU{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:o,maxLiveSyncPlaybackRate:l}=this.config;if(!o||l===1||!n.live)return;const u=this.targetLatency;if(u===null)return;const d=s-u,f=Math.min(this.maxLatency,u+n.targetduration);if(d<f&&d>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,l)),y=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,S=Math.min(m,Math.max(1,y));this.changeMediaPlaybackRate(t,S)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:s}=e,{liveSyncDuration:o,liveSyncDurationCount:l,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let f=u&&n||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||f===0)&&(f=o!==void 0?o:l*s);const h=s;return f+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const s=n.edge,o=e-t-this.edgeStalled,l=s-n.totalduration,u=s-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(l,o),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===K.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,s;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class bU extends Th{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,s=[],o={},l={};let u=!1,d=!1,f=!1;t.levels.forEach(h=>{const m=h.attrs;let{audioCodec:y,videoCodec:S}=h;y&&(h.audioCodec=y=eu(y,n)||void 0),S&&(S=h.videoCodec=fw(S));const{width:A,height:_,unknownCodecs:x}=h,C=(x==null?void 0:x.length)||0;if(u||(u=!!(A&&_)),d||(d=!!S),f||(f=!!y),C||y&&!this.isAudioSupported(y)||S&&!this.isVideoSupported(S)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:b,"FRAME-RATE":L,"HDCP-LEVEL":M,"PATHWAY-ID":P,RESOLUTION:G,"VIDEO-RANGE":N}=m,U=`${`${P||"."}-`}${h.bitrate}-${G}-${L}-${b}-${N}-${M}`;if(o[U])if(o[U].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const O=l[U]+=1;h.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const J=this.createLevel(h);o[U]=J,s.push(J)}else o[U].addGroupId("audio",m.AUDIO),o[U].addGroupId("text",m.SUBTITLES);else{const O=this.createLevel(h);o[U]=O,l[U]=1,s.push(O)}}),this.filterAndSortMediaOptions(s,t,u,d,f)}createLevel(e){const t=new zo(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(s.message),t.supportedResult=GT(s,[])}return t}isAudioSupported(e){return qo(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return qo(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,s,o){var l;let u=[],d=[],f=e;const h=((l=t.stats)==null?void 0:l.parsing)||{};if((n||s)&&o&&(f=f.filter(({videoCodec:b,videoRange:L,width:M,height:P})=>(!!b||!!(M&&P))&&Sw(L))),f.length===0){Promise.resolve().then(()=>{if(this.hls){let b="no level with compatible codecs found in manifest",L=b;t.levels.length&&(L=`one or more CODECS in variant not supported: ${je(t.levels.map(P=>P.attrs.CODECS).filter((P,G,N)=>N.indexOf(P)===G))}`,this.warn(L),b+=` (${L})`);const M=new Error(b);this.hls.trigger(I.ERROR,{type:Ee.MEDIA_ERROR,details:K.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:M,reason:L})}}),h.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(b=>!b.audioCodec||this.isAudioSupported(b.audioCodec)),DE(u)),t.subtitles&&(d=t.subtitles,DE(d));const m=f.slice(0);f.sort((b,L)=>{if(b.attrs["HDCP-LEVEL"]!==L.attrs["HDCP-LEVEL"])return(b.attrs["HDCP-LEVEL"]||"")>(L.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&b.height!==L.height)return b.height-L.height;if(b.frameRate!==L.frameRate)return b.frameRate-L.frameRate;if(b.videoRange!==L.videoRange)return tu.indexOf(b.videoRange)-tu.indexOf(L.videoRange);if(b.videoCodec!==L.videoCodec){const M=Sv(b.videoCodec),P=Sv(L.videoCodec);if(M!==P)return P-M}if(b.uri===L.uri&&b.codecSet!==L.codecSet){const M=jl(b.codecSet),P=jl(L.codecSet);if(M!==P)return P-M}return b.averageBitrate!==L.averageBitrate?b.averageBitrate-L.averageBitrate:0});let y=m[0];if(this.steering&&(f=this.steering.filterParsedLevels(f),f.length!==m.length)){for(let b=0;b<m.length;b++)if(m[b].pathwayId===f[0].pathwayId){y=m[b];break}}this._levels=f;for(let b=0;b<f.length;b++)if(f[b]===y){var S;this._firstLevel=b;const L=y.bitrate,M=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${f.length} level(s) found, first bitrate: ${L}`),((S=this.hls.userConfig)==null?void 0:S.abrEwmaDefaultEstimate)===void 0){const P=Math.min(L,this.hls.config.abrEwmaDefaultEstimateMax);P>M&&M===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=P)}break}const A=o&&!s,_=this.hls.config,x=!!(_.audioStreamController&&_.audioTrackController),C={levels:f,audioTracks:u,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:s,altAudio:x&&!A&&u.some(b=>!!b.url)};h.end=performance.now(),this.hls.trigger(I.MANIFEST_PARSED,C)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:h,reason:h.message}),m)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,s=this.currentLevel,o=s?s.attrs["PATHWAY-ID"]:void 0,l=t[e],u=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,n===e&&s&&o===u)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${u?" with Pathway "+u:""} from level ${n}${o?" with Pathway "+o:""}`);const d={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(I.LEVEL_SWITCHING,d);const f=l.details;if(!f||f.live){const h=this.switchParams(l.uri,s==null?void 0:s.details,f);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===De.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===pe.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(o=>!!n[o]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var n;const{level:s,details:o}=t,l=t.levelInfo;if(!l){var u;this.warn(`Invalid level index ${s}`),(u=t.deliveryDirectives)!=null&&u.skip&&(o.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let d=l.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(s,t,d)}else(n=t.deliveryDirectives)!=null&&n.skip&&(o.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,o=e.attrs["PATHWAY-ID"],l=e.details,u=l==null?void 0:l.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o?" Pathway "+o:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${n}`),this.hls.trigger(I.LEVEL_LOADING,{url:n,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((o,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(o),o===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,o.details&&o.details.fragments.forEach(u=>u.level=-1)),!1));aS(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=n.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(I.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(I.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function DE(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function nA(){return self.SourceBuffer||self.WebKitSourceBuffer}function iA(){if(!ns())return!1;const e=nA();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function DU(){if(!iA())return!1;const i=ns();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(Ko(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(Ko(e,"audio"))))}function MU(){var i;const e=nA();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const wU=100;class NU extends dh{constructor(e,t,n){super(e,t,n,"stream-controller",pe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,o=s?s.currentTime:null;if(o===null||!he(o)||(this.log(`Media seeked to ${o.toFixed(3)}`),!this.getBufferedFrag(o)))return;const l=this.getFwdBufferInfoAtPos(s,o,pe.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${o} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:s}=this;if(this.stopLoad(),this.setInterval(wU),this.level=-1,!this.startFragRequested){let o=s.startLevel;o===-1&&(s.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=s.firstAutoLevel),s.nextLoadLevel=o,this.level=s.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=te.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=te.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case te.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&(!s.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(s))break;this.state=te.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=te.IDLE;break}break}case te.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===te.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const o=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[o]))return;const l=n[o],u=this.getMainFwdBufferInfo();if(u===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){const _={};this.altAudio===2&&(_.type="video"),this.hls.trigger(I.BUFFER_EOS,_),this.state=te.ENDED;return}if(!this.buffering)return;e.loadLevel!==o&&e.manualLevel===-1&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const f=l.details;if(!f||this.state===te.WAITING_LEVEL||this.waitForLive(l)){this.level=o,this.state=te.WAITING_LEVEL,this.startFragRequested=!1;return}const h=u.len,m=this.getMaxBufferLength(l.maxBitrate);if(h>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:u.end;let S=this.getNextFragment(y,f);if(this.couldBacktrack&&!this.fragPrevious&&S&&ft(S)&&this.fragmentTracker.getState(S)!==Et.OK){var A;const x=((A=this.backtrackFragment)!=null?A:S).sn-f.startSN,C=f.fragments[x-1];C&&S.cc===C.cc&&(S=C,this.fragmentTracker.removeFragment(C))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(S&&this.isLoopLoading(S,y)){if(!S.gap){const x=this.audioOnly&&!this.altAudio?Ze.AUDIO:Ze.VIDEO,C=(x===Ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;C&&this.afterBufferFlushed(C,x,pe.MAIN)}S=this.getNextFragmentLoopLoading(S,f,u,pe.MAIN,m)}S&&(S.initSegment&&!S.initSegment.data&&!this.bitrateTest&&(S=S.initSegment),this.loadFragment(S,l,y))}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);s===Et.NOT_LOADED||s===Et.PARTIAL?ft(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,pe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const o=this.getLevelDetails();if(o!=null&&o.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<o.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,d=e[u],f=this.fragLastKbps;f&&this.fragCurrent?n=this.fragCurrent.duration*d.maxBitrate/(1e3*f)+1:n=0}else n=0;const l=this.getBufferedFrag(t.currentTime+n);if(l){const u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();const d=u.maxStartPTS?u.maxStartPTS:u.start,f=u.duration,h=Math.max(l.end,d+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case te.KEY_LOADING:case te.FRAG_LOADING:case te.FRAG_LOADING_WAITING_RETRY:case te.PARSING:case te.PARSED:this.state=te.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Vt(n,"playing",this.onMediaPlaying),Vt(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Zt(n,"playing",this.onMediaPlaying),Zt(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,s=!1;for(let o=0;o<t.levels.length;o++){const l=t.levels[o].audioCodec;l&&(n=n||l.indexOf("mp4a.40.2")!==-1,s=s||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&s&&!MU(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==te.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=te.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:s,startFragRequested:o}=this,l=t.level,u=t.details,d=u.totalduration;if(!s){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${d}`);const f=t.levelInfo,h=this.fragCurrent;h&&(this.state===te.FRAG_LOADING||this.state===te.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let m=0;if(u.live||(n=f.details)!=null&&n.live){var y;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,f.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(f.details=u,this.levelLastLoaded=f,o||this.setStartPosition(u,m),this.hls.trigger(I.LEVEL_UPDATED,{details:u,level:l}),this.state===te.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=te.IDLE}o&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const s=this.hls.liveSyncPosition,o=this.getLoadPosition(),l=e.fragmentStart,u=e.edge,d=o>=l-t.maxFragLookUpTolerance&&o<=u;if(s!==null&&n.duration>s&&(o<s||!d)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&n.readyState<4||o<u-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),n.readyState))if(this.warn(`Playback: ${o.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var f;const m=Re.bufferInfo(n,s,0);if(!((f=m.buffered)!=null&&f.length)){n.currentTime=s;return}if(m.start<=o){n.currentTime=s;return}const{nextStart:S}=Re.bufferedInfo(m.buffered,o,0);S&&(n.currentTime=S)}else n.currentTime=s}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:o}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=l[n.level];if(!u){this.warn(`Level ${n.level} not found on progress`);return}const d=u.details;if(!d){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const f=u.videoCodec,h=d.PTSKnown||!d.live,m=(t=n.initSegment)==null?void 0:t.data,y=this._getAudioCodec(u),S=this.transmuxer=this.transmuxer||new bS(this.hls,pe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),A=s?s.index:-1,_=A!==-1,x=new uh(n.level,n.sn,n.stats.chunkCount,o.byteLength,A,_),C=this.initPTS[n.cc];S.push(o,m,y,f,n,s,d.totalduration,h,x,C)}onAudioTrackSwitching(e,t){const n=this.hls,s=this.altAudio!==0;if(nu(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(I.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(I.AUDIO_TRACK_SWITCHED,t)}),n.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(I.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=nu(t.url,this.hls);if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let s,o,l=!1;for(const u in n){const d=n[u];if(d.id==="main"){if(o=u,s=d,u==="video"){const f=n[u];f&&(this.videoBuffer=f.buffer)}}else l=!0}l&&s?(this.log(`Alternate track found, use ${o}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:s}=t,o=n.type===pe.MAIN;if(o){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===te.PARSED&&(this.state=te.IDLE);return}const u=s?s.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),ft(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,s)}const l=this.media;l&&(!this._hasEnoughToStart&&Re.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),o&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=te.ERROR;return}switch(t.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pe.MAIN,t);break;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===te.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===De.LEVEL&&(this.state=te.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=te.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ze.AUDIO||!this.altAudio){const n=(t===Ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,pe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&n&&(n+=s);const o=this.getLevelDetails(),l=Re.getBuffered(e),u=l.length?l.start(0):0,d=u-n,f=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<f||this.loadingParts&&d<2*((o==null?void 0:o.partTarget)||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),n+=d,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${u}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:s}=this,o=n==null?void 0:n.frag;if(!o||this.fragContextChanged(o))return;t.fragmentError=0,this.state=te.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=o.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),s.trigger(I.FRAG_LOADED,n),o.bitrateTest=!1}).catch(n=>{this.state===te.STOPPED||this.state===te.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:s,chunkMeta:o}=e,l=this.getCurrentContext(o);if(!l){this.resetWhenMissingContext(o);return}const{frag:u,part:d,level:f}=l,{video:h,text:m,id3:y,initSegment:S}=s,{details:A}=f,_=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=te.PARSING,S){const x=S.tracks;if(x){const M=u.initSegment||u;if(this.unhandledEncryptionError(S,u))return;this._bufferInitSegment(f,x,M,o),n.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:t,tracks:x})}const C=S.initPTS,b=S.timescale,L=this.initPTS[u.cc];if(he(C)&&(!L||L.baseTime!==C||L.timescale!==b)){const M=S.trackId;this.initPTS[u.cc]={baseTime:C,timescale:b,trackId:M},n.trigger(I.INIT_PTS_FOUND,{frag:u,id:t,initPTS:C,timescale:b,trackId:M})}}if(h&&A){_&&h.type==="audiovideo"&&this.logMuxedErr(u);const x=A.fragments[u.sn-1-A.startSN],C=u.sn===A.startSN,b=!x||u.cc>x.cc;if(s.independent!==!1){const{startPTS:L,endPTS:M,startDTS:P,endDTS:G}=h;if(d)d.elementaryStreams[h.type]={startPTS:L,endPTS:M,startDTS:P,endDTS:G};else if(h.firstKeyFrame&&h.independent&&o.id===1&&!b&&(this.couldBacktrack=!0),h.dropped&&h.independent){const N=this.getMainFwdBufferInfo(),$=(N?N.end:this.getLoadPosition())+this.config.maxBufferHole,U=h.firstKeyFramePTS?h.firstKeyFramePTS:L;if(!C&&$<U-this.config.maxBufferHole&&!b){this.backtrack(u);return}else b&&(u.gap=!0);u.setElementaryStreamInfo(h.type,u.start,M,u.start,G,!0)}else C&&L-(A.appliedTimelineOffset||0)>zl&&(u.gap=!0);u.setElementaryStreamInfo(h.type,L,M,P,G),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(h,u,d,o,C||b)}else if(C||b)u.gap=!0;else{this.backtrack(u);return}}if(_){const{startPTS:x,endPTS:C,startDTS:b,endDTS:L}=_;d&&(d.elementaryStreams[Ze.AUDIO]={startPTS:x,endPTS:C,startDTS:b,endDTS:L}),u.setElementaryStreamInfo(Ze.AUDIO,x,C,b,L),this.bufferFragmentData(_,u,d,o)}if(A&&y!=null&&y.samples.length){const x={id:t,frag:u,details:A,samples:y.samples};n.trigger(I.FRAG_PARSING_METADATA,x)}if(A&&m){const x={id:t,frag:u,details:A,samples:m.samples};n.trigger(I.FRAG_PARSING_USERDATA,x)}}logMuxedErr(e){this.warn(`${ft(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,s){if(this.state!==te.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:o,video:l,audiovideo:u}=t;if(o){const f=e.audioCodec;let h=Bl(o.codec,f);h==="mp4a"&&(h="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const y=o.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&o.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),f&&f!==h&&this.log(`Swapping manifest audio codec "${f}" for "${h}"`),o.levelCodec=h,o.id=pe.MAIN,this.log(`Init audio buffer, container:${o.container}, codecs[selected/level/parsed]=[${h||""}/${f||""}/${o.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=pe.MAIN;const f=l.codec;if((f==null?void 0:f.length)===4)switch(f){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${f}]${l.codec!==f?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(I.BUFFER_CODECS,t),!this.hls)return;d.forEach(f=>{const m=t[f].initSegment;m!=null&&m.byteLength&&this.hls.trigger(I.BUFFER_APPENDING,{type:f,data:m,frag:n,part:null,chunkMeta:s,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,pe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=te.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Re.isBuffered(e,n)?t=this.getAppendedFrag(n):Re.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,o=t.level;(!s||t.sn!==s.sn||s.level!==o)&&(this.fragPlaying=t,this.hls.trigger(I.FRAG_CHANGED,{frag:t}),(!s||s.level!==o)&&this.hls.trigger(I.LEVEL_SWITCHED,{level:o}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return he(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(he(t)){const n=this.getLevelDetails(),s=this.currentFrag||(n?bs(null,n.fragments,t):null);if(s){const o=s.programDateTime;if(o!==null){const l=o+(t-s.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class PU extends bn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[n].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=K.KEY_LOAD_ERROR,n,s,o){return new Ti({type:Ee.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:o,error:n,networkDetails:s})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,o=t.length;s<o;s++){const l=t[s];if(e.cc<=l.cc&&(!ft(e)||!ft(l)||e.sn<l.sn)||!n&&s==o-1)return this.emeController.selectKeySystemFormat(l).then(u=>{if(!this.emeController)return;l.setKeyFormat(u);const d=$l(u);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const s=Go(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,s;t&&e.setKeyFormat(t);const o=e.decryptdata;if(!o){const f=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,f))}const l=o.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const u=ud(o);let d=this.keyIdToKeyInfo[u];if((n=d)!=null&&n.decryptdata.key)return o.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(this.emeController&&(s=d)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(h=>{const{keyInfo:m}=h;return o.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${o.keyId?" keyId: "+wt(o.keyId):""} URI: ${o.uri} from ${e.type} ${e.level}`),d=this.keyIdToKeyInfo[u]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return o.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${o.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const l=jM(t.initSegment.data);if(l.length){let u=l[0];u.some(d=>d!==0)?(this.log(`Using keyId found in init segment ${wt(u)}`),ts.setKeyIdForUri(e.decryptdata.uri,u)):(u=ts.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${wt(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!ft(t))return Promise.resolve(n);const o=this.emeController.loadKey(n);return(e.keyLoadPromise=o.then(l=>(e.mediaKeySessionContext=l,n))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,s=n.loader,o=new s(n);return t.keyLoader=e.loader=o,e.keyLoadPromise=new Promise((l,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},f=n.keyLoadPolicy.default,h={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,S,A,_)=>{const{frag:x,keyInfo:C}=A,b=ud(C.decryptdata);if(!x.decryptdata||C!==this.keyIdToKeyInfo[b])return u(this.createKeyLoadError(x,K.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),_));C.decryptdata.key=x.decryptdata.key=new Uint8Array(y.data),x.keyLoader=null,C.loader=null,l({frag:x,keyInfo:C})},onError:(y,S,A,_)=>{this.resetLoader(S),u(this.createKeyLoadError(t,K.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),A,Ke({url:d.url,data:void 0},y)))},onTimeout:(y,S,A)=>{this.resetLoader(S),u(this.createKeyLoadError(t,K.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),A))},onAbort:(y,S,A)=>{this.resetLoader(S),u(this.createKeyLoadError(t,K.INTERNAL_ABORTED,new Error("key loading aborted"),A))}};o.load(d,h,m)})}resetLoader(e){const{frag:t,keyInfo:n,url:s}=e,o=n.loader;t.keyLoader===o&&(t.keyLoader=null,n.loader=null);const l=ud(n.decryptdata)||s;delete this.keyIdToKeyInfo[l],o&&o.destroy()}}function ud(i){if(i.keyFormat!==Nt.FAIRPLAY){const e=i.keyId;if(e)return wt(e)}return i.uri}function ME(i){const{type:e}=i;switch(e){case De.AUDIO_TRACK:return pe.AUDIO;case De.SUBTITLE_TRACK:return pe.SUBTITLE;default:return pe.MAIN}}function cd(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class kU{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,s=t.loader,o=n||s,l=new o(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:De.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:s,pathwayId:o,url:l,deliveryDirectives:u,levelInfo:d}=t;this.load({id:n,level:s,pathwayId:o,responseType:"text",type:De.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:n,groupId:s,url:o,deliveryDirectives:l,track:u}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:De.AUDIO_TRACK,url:o,deliveryDirectives:l,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:n,groupId:s,url:o,deliveryDirectives:l,track:u}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:De.SUBTITLE_TRACK,url:o,deliveryDirectives:l,levelOrTrack:u})}onLevelsUpdated(e,t){const n=this.loaders[De.LEVEL];if(n){const s=n.context;s&&!t.levels.some(o=>o===s.levelOrTrack)&&(n.abort(),delete this.loaders[De.LEVEL])}}load(e){var t;const n=this.hls.config;let s=this.getInternalLoader(e);if(s){const f=this.hls.logger,h=s.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?f.log(`[playlist-loader]: ignore ${e.url} ongoing request`):f.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}f.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let o;if(e.type===De.MANIFEST?o=n.manifestLoadPolicy.default:o=We({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),he((t=e.deliveryDirectives)==null?void 0:t.part)){let f;if(e.type===De.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===De.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===De.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){const h=f.partTarget,m=f.targetduration;if(h&&m){const y=Math.max(h*3,m*.8)*1e3;o=We({},o,{maxTimeToFirstByteMs:Math.min(y,o.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,o.maxTimeToFirstByteMs)})}}}const l=o.errorRetry||o.timeoutRetry||{},u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},d={onSuccess:(f,h,m,y)=>{const S=this.getInternalLoader(m);this.resetInternalLoader(m.type);const A=f.data;h.parsing.start=performance.now(),Wn.isMediaPlaylist(A)||m.type!==De.MANIFEST?this.handleTrackOrLevelPlaylist(f,h,m,y||null,S):this.handleMasterPlaylist(f,h,m,y)},onError:(f,h,m,y)=>{this.handleNetworkError(h,m,!1,f,y)},onTimeout:(f,h,m)=>{this.handleNetworkError(h,m,!0,void 0,f)}};s.load(e,u,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,s){const o=this.hls,l=e.data,u=cd(e,n),d=Wn.parseMasterPlaylist(l,u);if(d.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,d.playlistParsingError,s,t);return}const{contentSteering:f,levels:h,sessionData:m,sessionKeys:y,startTimeOffset:S,variableList:A}=d;this.variableList=A,h.forEach(b=>{const{unknownCodecs:L}=b;if(L){const{preferManagedMediaSource:M}=this.hls.config;let{audioCodec:P,videoCodec:G}=b;for(let N=L.length;N--;){const $=L[N];qo($,"audio",M)?(b.audioCodec=P=P?`${P},${$}`:$,Nr.audio[P.substring(0,4)]=2,L.splice(N,1)):qo($,"video",M)&&(b.videoCodec=G=G?`${G},${$}`:$,Nr.video[G.substring(0,4)]=2,L.splice(N,1))}}});const{AUDIO:_=[],SUBTITLES:x,"CLOSED-CAPTIONS":C}=Wn.parseMasterPlaylistMedia(l,u,d);_.length&&!_.some(L=>!L.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),_.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new it({}),bitrate:0,url:""})),o.trigger(I.MANIFEST_LOADED,{levels:h,audioTracks:_,subtitles:x,captions:C,contentSteering:f,url:u,stats:t,networkDetails:s,sessionData:m,sessionKeys:y,startTimeOffset:S,variableList:A})}handleTrackOrLevelPlaylist(e,t,n,s,o){const l=this.hls,{id:u,level:d,type:f}=n,h=cd(e,n),m=he(d)?d:he(u)?u:0,y=ME(n),S=Wn.parseLevelPlaylist(e.data,h,m,y,0,this.variableList);if(f===De.MANIFEST){const A={attrs:new it({}),bitrate:0,details:S,name:"",url:h};S.requestScheduled=t.loading.start+sS(S,0),l.trigger(I.MANIFEST_LOADED,{levels:[A],audioTracks:[],url:h,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=S,this.handlePlaylistLoaded(S,e,t,n,s,o)}handleManifestParsingError(e,t,n,s,o){this.hls.trigger(I.ERROR,{type:Ee.NETWORK_ERROR,details:K.MANIFEST_PARSING_ERROR,fatal:t.type===De.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:s,stats:o})}handleNetworkError(e,t,n=!1,s,o){let l=`A network ${n?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===De.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===De.AUDIO_TRACK||e.type===De.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let d=K.UNKNOWN,f=!1;const h=this.getInternalLoader(e);switch(e.type){case De.MANIFEST:d=n?K.MANIFEST_LOAD_TIMEOUT:K.MANIFEST_LOAD_ERROR,f=!0;break;case De.LEVEL:d=n?K.LEVEL_LOAD_TIMEOUT:K.LEVEL_LOAD_ERROR,f=!1;break;case De.AUDIO_TRACK:d=n?K.AUDIO_TRACK_LOAD_TIMEOUT:K.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case De.SUBTITLE_TRACK:d=n?K.SUBTITLE_TRACK_LOAD_TIMEOUT:K.SUBTITLE_LOAD_ERROR,f=!1;break}h&&this.resetInternalLoader(e.type);const m={type:Ee.NETWORK_ERROR,details:d,fatal:f,url:e.url,loader:h,context:e,error:u,networkDetails:t,stats:o};if(s){const y=(t==null?void 0:t.url)||e.url;m.response=Ke({url:y,data:void 0},s)}this.hls.trigger(I.ERROR,m)}handlePlaylistLoaded(e,t,n,s,o,l){const u=this.hls,{type:d,level:f,levelOrTrack:h,id:m,groupId:y,deliveryDirectives:S}=s,A=cd(t,s),_=ME(s);let x=typeof s.level=="number"&&_===pe.MAIN?f:void 0;const C=e.playlistParsingError;if(C){if(this.hls.logger.warn(`${C} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(I.ERROR,{type:Ee.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:A,error:C,reason:C.message,response:t,context:s,level:x,parent:_,networkDetails:o,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const b=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(I.ERROR,{type:Ee.NETWORK_ERROR,details:K.LEVEL_EMPTY_ERROR,fatal:!1,url:A,error:b,reason:b.message,response:t,context:s,level:x,parent:_,networkDetails:o,stats:n});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case De.MANIFEST:case De.LEVEL:if(x){if(!h)x=0;else if(h!==u.levels[x]){const b=u.levels.indexOf(h);b>-1&&(x=b)}}u.trigger(I.LEVEL_LOADED,{details:e,levelInfo:h||u.levels[0],level:x||0,id:m||0,stats:n,networkDetails:o,deliveryDirectives:S,withoutMultiVariant:d===De.MANIFEST});break;case De.AUDIO_TRACK:u.trigger(I.AUDIO_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:y||"",stats:n,networkDetails:o,deliveryDirectives:S});break;case De.SUBTITLE_TRACK:u.trigger(I.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:y||"",stats:n,networkDetails:o,deliveryDirectives:S});break}}}class hn{static get version(){return Yo}static isMSESupported(){return iA()}static isSupported(){return DU()}static getMediaSource(){return ns()}static get Events(){return I}static get MetadataSchema(){return dn}static get ErrorTypes(){return Ee}static get ErrorDetails(){return K}static get DefaultConfig(){return hn.defaultConfig?hn.defaultConfig:vU}static set DefaultConfig(e){hn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new hh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=$M(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=TU(hn.DefaultConfig,e,t);this.userConfig=e,n.progressive&&SU(n,t);const{abrController:s,bufferController:o,capLevelController:l,errorController:u,fpsController:d}=n,f=new u(this),h=this.abrController=new s(this),m=new Uw(this),y=n.interstitialsController,S=y?this.interstitialsController=new y(this,hn):null,A=this.bufferController=new o(this,m),_=this.capLevelController=new l(this),x=new d(this),C=new kU(this),b=n.contentSteeringController,L=b?new b(this):null,M=this.levelController=new bU(this,L),P=new CU(this),G=new PU(this.config,this.logger),N=this.streamController=new NU(this,m,G),$=this.gapController=new RU(this,m);_.setStreamController(N),x.setStreamController(N);const U=[C,M,N];S&&U.splice(1,0,S),L&&U.splice(1,0,L),this.networkControllers=U;const O=[h,A,$,_,x,P,m];this.audioTrackController=this.createController(n.audioTrackController,U);const J=n.audioStreamController;J&&U.push(this.audioStreamController=new J(this,m,G)),this.subtitleTrackController=this.createController(n.subtitleTrackController,U);const re=n.subtitleStreamController;re&&U.push(this.subtititleStreamController=new re(this,m,G)),this.createController(n.timelineController,O),G.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(LU,O),this.coreComponents=O,U.push(f);const oe=f.onErrorOut;typeof oe=="function"&&this.on(I.ERROR,oe,f),this.on(I.MANIFEST_LOADED,C.onManifestLoaded,C)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,s){this._emitter.off(e,t,n,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const s=e===I.ERROR;this.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:s,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(I.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const o=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(I.ERROR,{type:Ee.OTHER_ERROR,details:K.ATTACH_MEDIA_ERROR,fatal:!0,error:o});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,s=t?e:{media:n};this._media=n,this.trigger(I.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(I.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(I.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,s=this._url=nh.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&n&&(n!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(I.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[pe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[pe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[pe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Rk()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Tw(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let s=0;s<n;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,n)for(let o=s;o--;){const l=e[o].attrs["HDCP-LEVEL"];if(l&&l<=n)return o}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=HT(t);return $T(e,n,navigator.mediaCapabilities)}}hn.defaultConfig=void 0;const UU=({channel:i})=>{const e=lt.useRef(null),[t,n]=lt.useState(null),[s,o]=lt.useState(!1),l=lt.useRef(0),u=2;return lt.useEffect(()=>{if(!i||!e.current){n(null),l.current=0;return}const d=e.current;let f=null;return n(null),l.current=0,(()=>{if(window.location.protocol==="https:"&&i.url.startsWith("http:")){n({message:"Security Block: Your browser is blocking an insecure (HTTP) stream on this secure (HTTPS) site. This is a browser security feature.",type:"network",details:"Mixed Content Error"});return}hn.isSupported()?(f=new hn({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,xhrSetup:(m,y)=>{m.withCredentials=!1}}),f.loadSource(i.url),f.attachMedia(d),f.on(hn.Events.MANIFEST_PARSED,()=>{n(null),l.current=0,d.play().catch(m=>{console.warn("Autoplay failed:",m)})}),f.on(hn.Events.ERROR,(m,y)=>{var S;if(y.fatal)switch(console.error(`SwagTV Player Error - Type: ${y.type}, Details: ${y.details}`,{response:y.response,error:y.error,networkDetails:y.networkDetails}),y.type){case hn.ErrorTypes.NETWORK_ERROR:if(y.details==="manifestLoadError"){const A=((S=y.response)==null?void 0:S.code)||0;let _=`Manifest Load Error (Status ${A}).`;A===0?_="CORS Policy Block: The stream provider has blocked this website from accessing the video. This is common with private IPTV links.":A===404&&(_="Stream Not Found (404): This link has expired or is temporarily offline."),n({message:_,type:"network",details:y.details}),f==null||f.destroy()}else l.current<u?(console.log(`Retrying network error (${l.current+1}/${u})...`),l.current++,f==null||f.startLoad()):n({message:`Network connection lost: ${y.details}. The server might be unreachable.`,type:"network",details:y.details});break;case hn.ErrorTypes.MEDIA_ERROR:console.log("Attempting media recovery..."),o(!0),f==null||f.recoverMediaError(),setTimeout(()=>o(!1),2e3);break;default:n({message:`Playback failed: ${y.details}`,type:"other",details:y.details}),f==null||f.destroy();break}})):d.canPlayType("application/vnd.apple.mpegurl")&&(d.src=i.url,d.addEventListener("loadedmetadata",()=>{d.play().catch(m=>console.error("Native HLS Playback failed:",m))}),d.addEventListener("error",m=>{const y=m.target.error;console.error("Native Video Error:",y),n({message:"This browser encountered a native streaming error. The link might be dead or restricted by CORS.",type:"network",details:(y==null?void 0:y.message)||"Code "+(y==null?void 0:y.code)})}))})(),()=>{f&&f.destroy()}},[i]),i?W.jsxs("div",{className:"relative aspect-video w-full rounded-xl overflow-hidden glass border border-white/10 shadow-2xl bg-black",children:[t&&!s&&W.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/95 backdrop-blur-md p-8 text-center",children:[t.message.includes("Security Block")?W.jsx(SM,{size:48,className:"text-orange-500 mb-4"}):W.jsx(IT,{size:48,className:"text-red-500 mb-4"}),W.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:t.details==="manifestLoadError"?"Connection Blocked":"Stream Unavailable"}),W.jsx("p",{className:"text-sm text-slate-400 max-w-md mb-6 leading-relaxed",children:t.message}),W.jsxs("div",{className:"flex gap-3",children:[W.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-white/10 hover:bg-white/20 rounded-full text-xs font-bold transition-all border border-white/10 text-white",children:"Refresh App"}),W.jsx("button",{onClick:()=>n(null),className:"px-6 py-2 bg-green-500 hover:bg-green-600 rounded-full text-xs font-bold transition-all text-black",children:"Try Different Channel"})]}),W.jsxs("div",{className:"mt-8 pt-6 border-t border-white/5 w-full max-w-xs",children:[W.jsx("p",{className:"text-[9px] text-slate-600 uppercase tracking-widest mb-1",children:"Technical Info"}),W.jsx("p",{className:"text-[10px] text-slate-500 font-mono truncate",children:t.details||"Unknown Error"})]})]}),s&&W.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/40 backdrop-blur-sm",children:[W.jsx(vM,{size:32,className:"text-green-400 animate-spin mb-4"}),W.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-white",children:"Re-syncing Feed..."})]}),W.jsx("video",{ref:e,controls:!0,playsInline:!0,crossOrigin:"anonymous",className:`w-full h-full transition-opacity duration-500 ${t?"opacity-10":"opacity-100"}`}),W.jsx("div",{className:"absolute top-4 left-4 pointer-events-none z-10",children:W.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/60 backdrop-blur-md border border-white/10",children:[W.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),W.jsxs("span",{className:"text-[10px] font-black text-white uppercase tracking-[0.2em]",children:["SWAGTV  ",i.name]})]})})]}):W.jsx("div",{className:"aspect-video w-full glass rounded-xl flex items-center justify-center border border-white/5 text-slate-500",children:W.jsxs("div",{className:"text-center p-6",children:[W.jsx("div",{className:"w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4",children:W.jsx(lM,{size:32,className:"opacity-20"})}),W.jsx("p",{className:"font-bold mb-2 text-slate-300",children:"SwagTV Match Center"}),W.jsx("p",{className:"text-xs max-w-xs mx-auto",children:"Select a live channel from the sidebar. Note: Some links require specific network conditions or might be region-locked."})]})})},OU=()=>{const[i,e]=lt.useState([]),[t,n]=lt.useState(null),[s,o]=lt.useState(),[l,u]=lt.useState(),[d,f]=lt.useState(!0),[h,m]=lt.useState(!1),[y,S]=lt.useState(""),A=lt.useMemo(()=>J1(X1),[]),[_,x]=lt.useState(null),C=lt.useCallback(async()=>{f(!0);const M=await K1();e(M),f(!1)},[]);lt.useEffect(()=>{C()},[C]);const b=async M=>{n(M),m(!0);const[P,G]=await Promise.all([z1(M.homeTeam,M.awayTeam),Y1(M.homeTeam,M.awayTeam)]);o(P),u(G),m(!1)},L=i.filter(M=>M.homeTeam.toLowerCase().includes(y.toLowerCase())||M.awayTeam.toLowerCase().includes(y.toLowerCase())||M.league.toLowerCase().includes(y.toLowerCase()));return W.jsxs("div",{className:"min-h-screen flex flex-col",children:[W.jsx("header",{className:"glass sticky top-0 z-50 border-b border-white/5",children:W.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 h-20 flex items-center justify-between gap-4",children:[W.jsxs("div",{className:"flex items-center gap-3",children:[W.jsx("div",{className:"bg-green-500 p-2 rounded-lg shadow-lg shadow-green-500/20",children:W.jsx(gv,{className:"text-white fill-white",size:24})}),W.jsxs("div",{children:[W.jsxs("h1",{className:"text-xl md:text-2xl font-black tracking-tighter neon-text italic",children:["SWAG",W.jsx("span",{className:"text-green-400",children:"TV"})," OFFICIAL"]}),W.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-widest text-center",children:"Live Sports Hub"})]})]}),W.jsxs("div",{className:"hidden md:flex flex-1 max-w-md relative group",children:[W.jsx(hv,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-green-400 transition-colors",size:18}),W.jsx("input",{type:"text",placeholder:"Search matches, leagues, or teams...",className:"w-full bg-white/5 border border-white/10 rounded-full py-2.5 pl-12 pr-6 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all",value:y,onChange:M=>S(M.target.value)})]}),W.jsxs("div",{className:"flex items-center gap-4",children:[W.jsx("button",{onClick:C,className:"p-2.5 rounded-full bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-all active:scale-95",title:"Refresh matches",children:W.jsx(pM,{size:20,className:d?"animate-spin":""})}),W.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-green-500/10 border border-green-500/20 rounded-full",children:[W.jsx(_M,{size:16,className:"text-green-400"}),W.jsx("span",{className:"text-xs font-bold text-green-400",children:"VERIFIED"})]})]})]})}),W.jsxs("main",{className:"flex-1 max-w-7xl mx-auto w-full px-4 md:px-8 py-8",children:[W.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8",children:[W.jsxs("div",{className:"lg:col-span-8",children:[W.jsx(UU,{channel:_}),W.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[W.jsxs("div",{children:[W.jsx("h2",{className:"text-xl font-bold",children:(_==null?void 0:_.name)||"Global Match Center"}),W.jsx("p",{className:"text-sm text-slate-400",children:"Powered by SwagTV High-Speed Infrastructure"})]}),W.jsxs("div",{className:"flex gap-2",children:[W.jsx("button",{className:"px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs font-bold transition-all",children:"Report Issue"}),W.jsx("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-black rounded-lg text-xs font-bold transition-all",children:"Support SwagTV"})]})]})]}),W.jsx("div",{className:"lg:col-span-4",children:W.jsxs("div",{className:"glass h-full rounded-2xl overflow-hidden border border-white/10 flex flex-col",children:[W.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex items-center justify-between bg-white/5",children:[W.jsxs("div",{className:"flex items-center gap-2",children:[W.jsx(bM,{size:18,className:"text-green-400"}),W.jsx("h2",{className:"font-bold text-sm tracking-wide",children:"LIVE CHANNELS"})]}),W.jsx("span",{className:"text-[10px] bg-red-500/20 text-red-400 px-2 py-0.5 rounded font-bold",children:"ONLINE"})]}),W.jsx("div",{className:"flex-1 overflow-y-auto max-h-[400px] lg:max-h-none p-4 space-y-2",children:A.map((M,P)=>W.jsxs("button",{onClick:()=>x(M),className:`w-full text-left px-4 py-3 rounded-xl border transition-all flex items-center justify-between group ${(_==null?void 0:_.url)===M.url?"bg-green-500/10 border-green-500/50 text-green-400":"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20 text-slate-300"}`,children:[W.jsx("span",{className:"text-sm font-semibold truncate",children:M.name}),W.jsx(gv,{size:14,className:`transition-opacity ${(_==null?void 0:_.url)===M.url?"opacity-100":"opacity-0 group-hover:opacity-100"}`})]},P))})]})})]}),W.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[W.jsxs("div",{className:"lg:col-span-7 xl:col-span-8 flex flex-col gap-6",children:[W.jsxs("div",{className:"flex items-center justify-between",children:[W.jsxs("h2",{className:"text-lg font-extrabold flex items-center gap-2",children:[W.jsx(nM,{size:20,className:"text-green-400"}),"FIXTURES & SCORES"]}),W.jsxs("span",{className:"text-xs font-medium text-slate-500 bg-white/5 px-2 py-1 rounded",children:[L.length," Matches Found"]})]}),d?W.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[1,2,3,4].map(M=>W.jsx("div",{className:"h-44 glass animate-pulse rounded-xl border border-white/5"},M))}):L.length>0?W.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.map(M=>W.jsx(MM,{match:M,onSelect:b,isSelected:(t==null?void 0:t.id)===M.id},M.id))}):W.jsxs("div",{className:"flex flex-col items-center justify-center h-64 glass rounded-2xl border-dashed border-white/10 text-slate-500",children:[W.jsx(hv,{size:48,className:"mb-4 opacity-20"}),W.jsx("p",{className:"font-medium",children:"No matches found matching your search."}),W.jsx("button",{onClick:()=>S(""),className:"mt-2 text-green-400 text-sm font-bold hover:underline",children:"Clear Search"})]}),W.jsxs("footer",{className:"mt-8 p-6 glass rounded-2xl border border-white/5 text-xs text-slate-500 leading-relaxed",children:[W.jsxs("div",{className:"flex items-center gap-2 text-amber-500 mb-2",children:[W.jsx(cM,{size:14}),W.jsx("span",{className:"font-bold uppercase tracking-wider",children:"Legal Disclaimer"})]}),W.jsxs("p",{className:"mb-2",children:[W.jsx("strong",{children:"SwagTV Official Policy:"})," This application is a dashboard designed for football enthusiasts. We provide access to M3U streams provided by the user and aggregate official broadcasting data via AI. SwagTV Official does not host, control, or take responsibility for the content of external M3U streams. Users are responsible for ensuring they have the legal right to access any streams they load."]}),W.jsxs("p",{children:[" ",new Date().getFullYear()," SwagTV Official. Built for Champions."]})]})]}),W.jsxs("div",{className:"lg:col-span-5 xl:col-span-4 flex flex-col gap-6",children:[W.jsxs("div",{className:"p-4 rounded-2xl bg-gradient-to-br from-blue-600/20 to-purple-600/20 border border-white/10",children:[W.jsx("h3",{className:"text-sm font-bold mb-1",children:"AI INSIGHTS"}),W.jsx("p",{className:"text-[11px] text-slate-400",children:"Select a fixture from the list to get advanced tactical analysis and official broadcast links."})]}),W.jsx(wM,{streamingInfo:s,analysisInfo:l,isLoading:h})]})]})]})]})},sA=document.getElementById("root");if(!sA)throw new Error("Could not find root element to mount to");const FU=Nx.createRoot(sA);FU.render(W.jsx(Rx.StrictMode,{children:W.jsx(OU,{})}));
