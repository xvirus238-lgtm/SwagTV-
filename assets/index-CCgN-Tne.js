(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();function Dp(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var wc={exports:{}},na={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W0;function _S(){if(W0)return na;W0=1;var u=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,r,l){var o=null;if(l!==void 0&&(o=""+l),r.key!==void 0&&(o=""+r.key),"key"in r){l={};for(var f in r)f!=="key"&&(l[f]=r[f])}else l=r;return r=l.ref,{$$typeof:u,type:s,key:o,ref:r!==void 0?r:null,props:l}}return na.Fragment=t,na.jsx=e,na.jsxs=e,na}var Z0;function DS(){return Z0||(Z0=1,wc.exports=_S()),wc.exports}var G=DS(),Nc={exports:{}},xt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J0;function IS(){if(J0)return xt;J0=1;var u=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),o=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),v=Symbol.iterator;function E(I){return I===null||typeof I!="object"?null:(I=v&&I[v]||I["@@iterator"],typeof I=="function"?I:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,b={};function L(I,P,it){this.props=I,this.context=P,this.refs=b,this.updater=it||S}L.prototype.isReactComponent={},L.prototype.setState=function(I,P){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,P,"setState")},L.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function _(){}_.prototype=L.prototype;function D(I,P,it){this.props=I,this.context=P,this.refs=b,this.updater=it||S}var C=D.prototype=new _;C.constructor=D,A(C,L.prototype),C.isPureReactComponent=!0;var k=Array.isArray;function K(){}var O={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function $(I,P,it){var nt=it.ref;return{$$typeof:u,type:I,key:P,ref:nt!==void 0?nt:null,props:it}}function U(I,P){return $(I.type,P,I.props)}function Q(I){return typeof I=="object"&&I!==null&&I.$$typeof===u}function st(I){var P={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(it){return P[it]})}var ut=/\/+/g;function ht(I,P){return typeof I=="object"&&I!==null&&I.key!=null?st(""+I.key):P.toString(36)}function lt(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(K,K):(I.status="pending",I.then(function(P){I.status==="pending"&&(I.status="fulfilled",I.value=P)},function(P){I.status==="pending"&&(I.status="rejected",I.reason=P)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function w(I,P,it,nt,at){var ft=typeof I;(ft==="undefined"||ft==="boolean")&&(I=null);var Et=!1;if(I===null)Et=!0;else switch(ft){case"bigint":case"string":case"number":Et=!0;break;case"object":switch(I.$$typeof){case u:case t:Et=!0;break;case g:return Et=I._init,w(Et(I._payload),P,it,nt,at)}}if(Et)return at=at(I),Et=nt===""?"."+ht(I,0):nt,k(at)?(it="",Et!=null&&(it=Et.replace(ut,"$&/")+"/"),w(at,P,it,"",function(De){return De})):at!=null&&(Q(at)&&(at=U(at,it+(at.key==null||I&&I.key===at.key?"":(""+at.key).replace(ut,"$&/")+"/")+Et)),P.push(at)),1;Et=0;var wt=nt===""?".":nt+":";if(k(I))for(var kt=0;kt<I.length;kt++)nt=I[kt],ft=wt+ht(nt,kt),Et+=w(nt,P,it,ft,at);else if(kt=E(I),typeof kt=="function")for(I=kt.call(I),kt=0;!(nt=I.next()).done;)nt=nt.value,ft=wt+ht(nt,kt++),Et+=w(nt,P,it,ft,at);else if(ft==="object"){if(typeof I.then=="function")return w(lt(I),P,it,nt,at);throw P=String(I),Error("Objects are not valid as a React child (found: "+(P==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":P)+"). If you meant to render a collection of children, use an array instead.")}return Et}function X(I,P,it){if(I==null)return I;var nt=[],at=0;return w(I,nt,"","",function(ft){return P.call(it,ft,at++)}),nt}function Z(I){if(I._status===-1){var P=I._result;P=P(),P.then(function(it){(I._status===0||I._status===-1)&&(I._status=1,I._result=it)},function(it){(I._status===0||I._status===-1)&&(I._status=2,I._result=it)}),I._status===-1&&(I._status=0,I._result=P)}if(I._status===1)return I._result.default;throw I._result}var rt=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var P=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(P))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},ot={map:X,forEach:function(I,P,it){X(I,function(){P.apply(this,arguments)},it)},count:function(I){var P=0;return X(I,function(){P++}),P},toArray:function(I){return X(I,function(P){return P})||[]},only:function(I){if(!Q(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return xt.Activity=p,xt.Children=ot,xt.Component=L,xt.Fragment=e,xt.Profiler=r,xt.PureComponent=D,xt.StrictMode=s,xt.Suspense=d,xt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,xt.__COMPILER_RUNTIME={__proto__:null,c:function(I){return O.H.useMemoCache(I)}},xt.cache=function(I){return function(){return I.apply(null,arguments)}},xt.cacheSignal=function(){return null},xt.cloneElement=function(I,P,it){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var nt=A({},I.props),at=I.key;if(P!=null)for(ft in P.key!==void 0&&(at=""+P.key),P)!F.call(P,ft)||ft==="key"||ft==="__self"||ft==="__source"||ft==="ref"&&P.ref===void 0||(nt[ft]=P[ft]);var ft=arguments.length-2;if(ft===1)nt.children=it;else if(1<ft){for(var Et=Array(ft),wt=0;wt<ft;wt++)Et[wt]=arguments[wt+2];nt.children=Et}return $(I.type,at,nt)},xt.createContext=function(I){return I={$$typeof:o,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:l,_context:I},I},xt.createElement=function(I,P,it){var nt,at={},ft=null;if(P!=null)for(nt in P.key!==void 0&&(ft=""+P.key),P)F.call(P,nt)&&nt!=="key"&&nt!=="__self"&&nt!=="__source"&&(at[nt]=P[nt]);var Et=arguments.length-2;if(Et===1)at.children=it;else if(1<Et){for(var wt=Array(Et),kt=0;kt<Et;kt++)wt[kt]=arguments[kt+2];at.children=wt}if(I&&I.defaultProps)for(nt in Et=I.defaultProps,Et)at[nt]===void 0&&(at[nt]=Et[nt]);return $(I,ft,at)},xt.createRef=function(){return{current:null}},xt.forwardRef=function(I){return{$$typeof:f,render:I}},xt.isValidElement=Q,xt.lazy=function(I){return{$$typeof:g,_payload:{_status:-1,_result:I},_init:Z}},xt.memo=function(I,P){return{$$typeof:h,type:I,compare:P===void 0?null:P}},xt.startTransition=function(I){var P=O.T,it={};O.T=it;try{var nt=I(),at=O.S;at!==null&&at(it,nt),typeof nt=="object"&&nt!==null&&typeof nt.then=="function"&&nt.then(K,rt)}catch(ft){rt(ft)}finally{P!==null&&it.types!==null&&(P.types=it.types),O.T=P}},xt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},xt.use=function(I){return O.H.use(I)},xt.useActionState=function(I,P,it){return O.H.useActionState(I,P,it)},xt.useCallback=function(I,P){return O.H.useCallback(I,P)},xt.useContext=function(I){return O.H.useContext(I)},xt.useDebugValue=function(){},xt.useDeferredValue=function(I,P){return O.H.useDeferredValue(I,P)},xt.useEffect=function(I,P){return O.H.useEffect(I,P)},xt.useEffectEvent=function(I){return O.H.useEffectEvent(I)},xt.useId=function(){return O.H.useId()},xt.useImperativeHandle=function(I,P,it){return O.H.useImperativeHandle(I,P,it)},xt.useInsertionEffect=function(I,P){return O.H.useInsertionEffect(I,P)},xt.useLayoutEffect=function(I,P){return O.H.useLayoutEffect(I,P)},xt.useMemo=function(I,P){return O.H.useMemo(I,P)},xt.useOptimistic=function(I,P){return O.H.useOptimistic(I,P)},xt.useReducer=function(I,P,it){return O.H.useReducer(I,P,it)},xt.useRef=function(I){return O.H.useRef(I)},xt.useState=function(I){return O.H.useState(I)},xt.useSyncExternalStore=function(I,P,it){return O.H.useSyncExternalStore(I,P,it)},xt.useTransition=function(){return O.H.useTransition()},xt.version="19.2.4",xt}var tm;function Cf(){return tm||(tm=1,Nc.exports=IS()),Nc.exports}var Jt=Cf();const CS=Dp(Jt);var Pc={exports:{}},ra={},Uc={exports:{}},Bc={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var em;function OS(){return em||(em=1,(function(u){function t(w,X){var Z=w.length;w.push(X);t:for(;0<Z;){var rt=Z-1>>>1,ot=w[rt];if(0<r(ot,X))w[rt]=X,w[Z]=ot,Z=rt;else break t}}function e(w){return w.length===0?null:w[0]}function s(w){if(w.length===0)return null;var X=w[0],Z=w.pop();if(Z!==X){w[0]=Z;t:for(var rt=0,ot=w.length,I=ot>>>1;rt<I;){var P=2*(rt+1)-1,it=w[P],nt=P+1,at=w[nt];if(0>r(it,Z))nt<ot&&0>r(at,it)?(w[rt]=at,w[nt]=Z,rt=nt):(w[rt]=it,w[P]=Z,rt=P);else if(nt<ot&&0>r(at,Z))w[rt]=at,w[nt]=Z,rt=nt;else break t}}return X}function r(w,X){var Z=w.sortIndex-X.sortIndex;return Z!==0?Z:w.id-X.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;u.unstable_now=function(){return l.now()}}else{var o=Date,f=o.now();u.unstable_now=function(){return o.now()-f}}var d=[],h=[],g=1,p=null,v=3,E=!1,S=!1,A=!1,b=!1,L=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function C(w){for(var X=e(h);X!==null;){if(X.callback===null)s(h);else if(X.startTime<=w)s(h),X.sortIndex=X.expirationTime,t(d,X);else break;X=e(h)}}function k(w){if(A=!1,C(w),!S)if(e(d)!==null)S=!0,K||(K=!0,st());else{var X=e(h);X!==null&&lt(k,X.startTime-w)}}var K=!1,O=-1,F=5,$=-1;function U(){return b?!0:!(u.unstable_now()-$<F)}function Q(){if(b=!1,K){var w=u.unstable_now();$=w;var X=!0;try{t:{S=!1,A&&(A=!1,_(O),O=-1),E=!0;var Z=v;try{e:{for(C(w),p=e(d);p!==null&&!(p.expirationTime>w&&U());){var rt=p.callback;if(typeof rt=="function"){p.callback=null,v=p.priorityLevel;var ot=rt(p.expirationTime<=w);if(w=u.unstable_now(),typeof ot=="function"){p.callback=ot,C(w),X=!0;break e}p===e(d)&&s(d),C(w)}else s(d);p=e(d)}if(p!==null)X=!0;else{var I=e(h);I!==null&&lt(k,I.startTime-w),X=!1}}break t}finally{p=null,v=Z,E=!1}X=void 0}}finally{X?st():K=!1}}}var st;if(typeof D=="function")st=function(){D(Q)};else if(typeof MessageChannel<"u"){var ut=new MessageChannel,ht=ut.port2;ut.port1.onmessage=Q,st=function(){ht.postMessage(null)}}else st=function(){L(Q,0)};function lt(w,X){O=L(function(){w(u.unstable_now())},X)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(w){w.callback=null},u.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<w?Math.floor(1e3/w):5},u.unstable_getCurrentPriorityLevel=function(){return v},u.unstable_next=function(w){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var Z=v;v=X;try{return w()}finally{v=Z}},u.unstable_requestPaint=function(){b=!0},u.unstable_runWithPriority=function(w,X){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var Z=v;v=w;try{return X()}finally{v=Z}},u.unstable_scheduleCallback=function(w,X,Z){var rt=u.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?rt+Z:rt):Z=rt,w){case 1:var ot=-1;break;case 2:ot=250;break;case 5:ot=1073741823;break;case 4:ot=1e4;break;default:ot=5e3}return ot=Z+ot,w={id:g++,callback:X,priorityLevel:w,startTime:Z,expirationTime:ot,sortIndex:-1},Z>rt?(w.sortIndex=Z,t(h,w),e(d)===null&&w===e(h)&&(A?(_(O),O=-1):A=!0,lt(k,Z-rt))):(w.sortIndex=ot,t(d,w),S||E||(S=!0,K||(K=!0,st()))),w},u.unstable_shouldYield=U,u.unstable_wrapCallback=function(w){var X=v;return function(){var Z=v;v=X;try{return w.apply(this,arguments)}finally{v=Z}}}})(Bc)),Bc}var im;function MS(){return im||(im=1,Uc.exports=OS()),Uc.exports}var Fc={exports:{}},Ie={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sm;function kS(){if(sm)return Ie;sm=1;var u=Cf();function t(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)h+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(d,h,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:d,containerInfo:h,implementation:g}}var o=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(d,h){if(d==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Ie.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ie.createPortal=function(d,h){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return l(d,h,null,g)},Ie.flushSync=function(d){var h=o.T,g=s.p;try{if(o.T=null,s.p=2,d)return d()}finally{o.T=h,s.p=g,s.d.f()}},Ie.preconnect=function(d,h){typeof d=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(d,h))},Ie.prefetchDNS=function(d){typeof d=="string"&&s.d.D(d)},Ie.preinit=function(d,h){if(typeof d=="string"&&h&&typeof h.as=="string"){var g=h.as,p=f(g,h.crossOrigin),v=typeof h.integrity=="string"?h.integrity:void 0,E=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;g==="style"?s.d.S(d,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:E}):g==="script"&&s.d.X(d,{crossOrigin:p,integrity:v,fetchPriority:E,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Ie.preinitModule=function(d,h){if(typeof d=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var g=f(h.as,h.crossOrigin);s.d.M(d,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(d)},Ie.preload=function(d,h){if(typeof d=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var g=h.as,p=f(g,h.crossOrigin);s.d.L(d,g,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Ie.preloadModule=function(d,h){if(typeof d=="string")if(h){var g=f(h.as,h.crossOrigin);s.d.m(d,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(d)},Ie.requestFormReset=function(d){s.d.r(d)},Ie.unstable_batchedUpdates=function(d,h){return d(h)},Ie.useFormState=function(d,h,g){return o.H.useFormState(d,h,g)},Ie.useFormStatus=function(){return o.H.useHostTransitionStatus()},Ie.version="19.2.4",Ie}var nm;function wS(){if(nm)return Fc.exports;nm=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(t){console.error(t)}}return u(),Fc.exports=kS(),Fc.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rm;function NS(){if(rm)return ra;rm=1;var u=MS(),t=Cf(),e=wS();function s(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function l(i){var n=i,a=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(a=n.return),i=n.return;while(i)}return n.tag===3?a:null}function o(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function f(i){if(i.tag===31){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function d(i){if(l(i)!==i)throw Error(s(188))}function h(i){var n=i.alternate;if(!n){if(n=l(i),n===null)throw Error(s(188));return n!==i?null:i}for(var a=i,c=n;;){var m=a.return;if(m===null)break;var y=m.alternate;if(y===null){if(c=m.return,c!==null){a=c;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===a)return d(m),i;if(y===c)return d(m),n;y=y.sibling}throw Error(s(188))}if(a.return!==c.return)a=m,c=y;else{for(var T=!1,R=m.child;R;){if(R===a){T=!0,a=m,c=y;break}if(R===c){T=!0,c=m,a=y;break}R=R.sibling}if(!T){for(R=y.child;R;){if(R===a){T=!0,a=y,c=m;break}if(R===c){T=!0,c=y,a=m;break}R=R.sibling}if(!T)throw Error(s(189))}}if(a.alternate!==c)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?i:n}function g(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=g(i),n!==null)return n;i=i.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),D=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),Q=Symbol.iterator;function st(i){return i===null||typeof i!="object"?null:(i=Q&&i[Q]||i["@@iterator"],typeof i=="function"?i:null)}var ut=Symbol.for("react.client.reference");function ht(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===ut?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case A:return"Fragment";case L:return"Profiler";case b:return"StrictMode";case k:return"Suspense";case K:return"SuspenseList";case $:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case S:return"Portal";case D:return i.displayName||"Context";case _:return(i._context.displayName||"Context")+".Consumer";case C:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case O:return n=i.displayName||null,n!==null?n:ht(i.type)||"Memo";case F:n=i._payload,i=i._init;try{return ht(i(n))}catch{}}return null}var lt=Array.isArray,w=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},rt=[],ot=-1;function I(i){return{current:i}}function P(i){0>ot||(i.current=rt[ot],rt[ot]=null,ot--)}function it(i,n){ot++,rt[ot]=i.current,i.current=n}var nt=I(null),at=I(null),ft=I(null),Et=I(null);function wt(i,n){switch(it(ft,n),it(at,i),it(nt,null),n.nodeType){case 9:case 11:i=(i=n.documentElement)&&(i=i.namespaceURI)?S0(i):0;break;default:if(i=n.tagName,n=n.namespaceURI)n=S0(n),i=T0(n,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}P(nt),it(nt,i)}function kt(){P(nt),P(at),P(ft)}function De(i){i.memoizedState!==null&&it(Et,i);var n=nt.current,a=T0(n,i.type);n!==a&&(it(at,i),it(nt,a))}function ni(i){at.current===i&&(P(nt),P(at)),Et.current===i&&(P(Et),ta._currentValue=Z)}var ur,cn;function yi(i){if(ur===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);ur=n&&n[1]||"",cn=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ur+i+cn}var va=!1;function It(i,n){if(!i||va)return"";va=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var et=function(){throw Error()};if(Object.defineProperty(et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(et,[])}catch(q){var Y=q}Reflect.construct(i,[],et)}else{try{et.call()}catch(q){Y=q}i.call(et.prototype)}}else{try{throw Error()}catch(q){Y=q}(et=i())&&typeof et.catch=="function"&&et.catch(function(){})}}catch(q){if(q&&Y&&typeof q.stack=="string")return[q.stack,Y.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=c.DetermineComponentFrameRoot(),T=y[0],R=y[1];if(T&&R){var M=T.split(`
`),j=R.split(`
`);for(m=c=0;c<M.length&&!M[c].includes("DetermineComponentFrameRoot");)c++;for(;m<j.length&&!j[m].includes("DetermineComponentFrameRoot");)m++;if(c===M.length||m===j.length)for(c=M.length-1,m=j.length-1;1<=c&&0<=m&&M[c]!==j[m];)m--;for(;1<=c&&0<=m;c--,m--)if(M[c]!==j[m]){if(c!==1||m!==1)do if(c--,m--,0>m||M[c]!==j[m]){var W=`
`+M[c].replace(" at new "," at ");return i.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",i.displayName)),W}while(1<=c&&0<=m);break}}}finally{va=!1,Error.prepareStackTrace=a}return(a=i?i.displayName||i.name:"")?yi(a):""}function ge(i,n){switch(i.tag){case 26:case 27:case 5:return yi(i.type);case 16:return yi("Lazy");case 13:return i.child!==n&&n!==null?yi("Suspense Fallback"):yi("Suspense");case 19:return yi("SuspenseList");case 0:case 15:return It(i.type,!1);case 11:return It(i.type.render,!1);case 1:return It(i.type,!0);case 31:return yi("Activity");default:return""}}function Ce(i){try{var n="",a=null;do n+=ge(i,a),a=i,i=i.return;while(i);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var vi=Object.prototype.hasOwnProperty,Oe=u.unstable_scheduleCallback,bi=u.unstable_cancelCallback,Ui=u.unstable_shouldYield,Ea=u.unstable_requestPaint,me=u.unstable_now,Sa=u.unstable_getCurrentPriorityLevel,as=u.unstable_ImmediatePriority,cr=u.unstable_UserBlockingPriority,fn=u.unstable_NormalPriority,Ta=u.unstable_LowPriority,fr=u.unstable_IdlePriority,Fs=u.log,cv=u.unstable_setDisableYieldValue,hr=null,Ve=null;function ls(i){if(typeof Fs=="function"&&cv(i),Ve&&typeof Ve.setStrictMode=="function")try{Ve.setStrictMode(hr,i)}catch{}}var ze=Math.clz32?Math.clz32:dv,fv=Math.log,hv=Math.LN2;function dv(i){return i>>>=0,i===0?32:31-(fv(i)/hv|0)|0}var xa=256,Aa=262144,ba=4194304;function $s(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function La(i,n,a){var c=i.pendingLanes;if(c===0)return 0;var m=0,y=i.suspendedLanes,T=i.pingedLanes;i=i.warmLanes;var R=c&134217727;return R!==0?(c=R&~y,c!==0?m=$s(c):(T&=R,T!==0?m=$s(T):a||(a=R&~i,a!==0&&(m=$s(a))))):(R=c&~y,R!==0?m=$s(R):T!==0?m=$s(T):a||(a=c&~i,a!==0&&(m=$s(a)))),m===0?0:n!==0&&n!==m&&(n&y)===0&&(y=m&-m,a=n&-n,y>=a||y===32&&(a&4194048)!==0)?n:m}function dr(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function gv(i,n){switch(i){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eh(){var i=ba;return ba<<=1,(ba&62914560)===0&&(ba=4194304),i}function xo(i){for(var n=[],a=0;31>a;a++)n.push(i);return n}function gr(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function mv(i,n,a,c,m,y){var T=i.pendingLanes;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=a,i.entangledLanes&=a,i.errorRecoveryDisabledLanes&=a,i.shellSuspendCounter=0;var R=i.entanglements,M=i.expirationTimes,j=i.hiddenUpdates;for(a=T&~a;0<a;){var W=31-ze(a),et=1<<W;R[W]=0,M[W]=-1;var Y=j[W];if(Y!==null)for(j[W]=null,W=0;W<Y.length;W++){var q=Y[W];q!==null&&(q.lane&=-536870913)}a&=~et}c!==0&&ih(i,c,0),y!==0&&m===0&&i.tag!==0&&(i.suspendedLanes|=y&~(T&~n))}function ih(i,n,a){i.pendingLanes|=n,i.suspendedLanes&=~n;var c=31-ze(n);i.entangledLanes|=n,i.entanglements[c]=i.entanglements[c]|1073741824|a&261930}function sh(i,n){var a=i.entangledLanes|=n;for(i=i.entanglements;a;){var c=31-ze(a),m=1<<c;m&n|i[c]&n&&(i[c]|=n),a&=~m}}function nh(i,n){var a=n&-n;return a=(a&42)!==0?1:Ao(a),(a&(i.suspendedLanes|n))!==0?0:a}function Ao(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function bo(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function rh(){var i=X.p;return i!==0?i:(i=window.event,i===void 0?32:z0(i.type))}function ah(i,n){var a=X.p;try{return X.p=i,n()}finally{X.p=a}}var os=Math.random().toString(36).slice(2),Se="__reactFiber$"+os,we="__reactProps$"+os,hn="__reactContainer$"+os,Lo="__reactEvents$"+os,pv="__reactListeners$"+os,yv="__reactHandles$"+os,lh="__reactResources$"+os,mr="__reactMarker$"+os;function Ro(i){delete i[Se],delete i[we],delete i[Lo],delete i[pv],delete i[yv]}function dn(i){var n=i[Se];if(n)return n;for(var a=i.parentNode;a;){if(n=a[hn]||a[Se]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(i=D0(i);i!==null;){if(a=i[Se])return a;i=D0(i)}return n}i=a,a=i.parentNode}return null}function gn(i){if(i=i[Se]||i[hn]){var n=i.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return i}return null}function pr(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(s(33))}function mn(i){var n=i[lh];return n||(n=i[lh]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function pe(i){i[mr]=!0}var oh=new Set,uh={};function Gs(i,n){pn(i,n),pn(i+"Capture",n)}function pn(i,n){for(uh[i]=n,i=0;i<n.length;i++)oh.add(n[i])}var vv=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ch={},fh={};function Ev(i){return vi.call(fh,i)?!0:vi.call(ch,i)?!1:vv.test(i)?fh[i]=!0:(ch[i]=!0,!1)}function Ra(i,n,a){if(Ev(n))if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+a)}}function _a(i,n,a){if(a===null)i.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+a)}}function Bi(i,n,a,c){if(c===null)i.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttributeNS(n,a,""+c)}}function ri(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function hh(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Sv(i,n,a){var c=Object.getOwnPropertyDescriptor(i.constructor.prototype,n);if(!i.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,y=c.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return m.call(this)},set:function(T){a=""+T,y.call(this,T)}}),Object.defineProperty(i,n,{enumerable:c.enumerable}),{getValue:function(){return a},setValue:function(T){a=""+T},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function _o(i){if(!i._valueTracker){var n=hh(i)?"checked":"value";i._valueTracker=Sv(i,n,""+i[n])}}function dh(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var a=n.getValue(),c="";return i&&(c=hh(i)?i.checked?"true":"false":i.value),i=c,i!==a?(n.setValue(i),!0):!1}function Da(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Tv=/[\n"\\]/g;function ai(i){return i.replace(Tv,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Do(i,n,a,c,m,y,T,R){i.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?i.type=T:i.removeAttribute("type"),n!=null?T==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+ri(n)):i.value!==""+ri(n)&&(i.value=""+ri(n)):T!=="submit"&&T!=="reset"||i.removeAttribute("value"),n!=null?Io(i,T,ri(n)):a!=null?Io(i,T,ri(a)):c!=null&&i.removeAttribute("value"),m==null&&y!=null&&(i.defaultChecked=!!y),m!=null&&(i.checked=m&&typeof m!="function"&&typeof m!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?i.name=""+ri(R):i.removeAttribute("name")}function gh(i,n,a,c,m,y,T,R){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(i.type=y),n!=null||a!=null){if(!(y!=="submit"&&y!=="reset"||n!=null)){_o(i);return}a=a!=null?""+ri(a):"",n=n!=null?""+ri(n):a,R||n===i.value||(i.value=n),i.defaultValue=n}c=c??m,c=typeof c!="function"&&typeof c!="symbol"&&!!c,i.checked=R?i.checked:!!c,i.defaultChecked=!!c,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(i.name=T),_o(i)}function Io(i,n,a){n==="number"&&Da(i.ownerDocument)===i||i.defaultValue===""+a||(i.defaultValue=""+a)}function yn(i,n,a,c){if(i=i.options,n){n={};for(var m=0;m<a.length;m++)n["$"+a[m]]=!0;for(a=0;a<i.length;a++)m=n.hasOwnProperty("$"+i[a].value),i[a].selected!==m&&(i[a].selected=m),m&&c&&(i[a].defaultSelected=!0)}else{for(a=""+ri(a),n=null,m=0;m<i.length;m++){if(i[m].value===a){i[m].selected=!0,c&&(i[m].defaultSelected=!0);return}n!==null||i[m].disabled||(n=i[m])}n!==null&&(n.selected=!0)}}function mh(i,n,a){if(n!=null&&(n=""+ri(n),n!==i.value&&(i.value=n),a==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=a!=null?""+ri(a):""}function ph(i,n,a,c){if(n==null){if(c!=null){if(a!=null)throw Error(s(92));if(lt(c)){if(1<c.length)throw Error(s(93));c=c[0]}a=c}a==null&&(a=""),n=a}a=ri(n),i.defaultValue=a,c=i.textContent,c===a&&c!==""&&c!==null&&(i.value=c),_o(i)}function vn(i,n){if(n){var a=i.firstChild;if(a&&a===i.lastChild&&a.nodeType===3){a.nodeValue=n;return}}i.textContent=n}var xv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yh(i,n,a){var c=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":c?i.setProperty(n,a):typeof a!="number"||a===0||xv.has(n)?n==="float"?i.cssFloat=a:i[n]=(""+a).trim():i[n]=a+"px"}function vh(i,n,a){if(n!=null&&typeof n!="object")throw Error(s(62));if(i=i.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?i.setProperty(c,""):c==="float"?i.cssFloat="":i[c]="");for(var m in n)c=n[m],n.hasOwnProperty(m)&&a[m]!==c&&yh(i,m,c)}else for(var y in n)n.hasOwnProperty(y)&&yh(i,y,n[y])}function Co(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Av=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ia(i){return bv.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Fi(){}var Oo=null;function Mo(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var En=null,Sn=null;function Eh(i){var n=gn(i);if(n&&(i=n.stateNode)){var a=i[we]||null;t:switch(i=n.stateNode,n.type){case"input":if(Do(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=i;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ai(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var c=a[n];if(c!==i&&c.form===i.form){var m=c[we]||null;if(!m)throw Error(s(90));Do(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(n=0;n<a.length;n++)c=a[n],c.form===i.form&&dh(c)}break t;case"textarea":mh(i,a.value,a.defaultValue);break t;case"select":n=a.value,n!=null&&yn(i,!!a.multiple,n,!1)}}}var ko=!1;function Sh(i,n,a){if(ko)return i(n,a);ko=!0;try{var c=i(n);return c}finally{if(ko=!1,(En!==null||Sn!==null)&&(pl(),En&&(n=En,i=Sn,Sn=En=null,Eh(n),i)))for(n=0;n<i.length;n++)Eh(i[n])}}function yr(i,n){var a=i.stateNode;if(a===null)return null;var c=a[we]||null;if(c===null)return null;a=c[n];t:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(i=i.type,c=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!c;break t;default:i=!1}if(i)return null;if(a&&typeof a!="function")throw Error(s(231,n,typeof a));return a}var $i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wo=!1;if($i)try{var vr={};Object.defineProperty(vr,"passive",{get:function(){wo=!0}}),window.addEventListener("test",vr,vr),window.removeEventListener("test",vr,vr)}catch{wo=!1}var us=null,No=null,Ca=null;function Th(){if(Ca)return Ca;var i,n=No,a=n.length,c,m="value"in us?us.value:us.textContent,y=m.length;for(i=0;i<a&&n[i]===m[i];i++);var T=a-i;for(c=1;c<=T&&n[a-c]===m[y-c];c++);return Ca=m.slice(i,1<c?1-c:void 0)}function Oa(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function Ma(){return!0}function xh(){return!1}function Ne(i){function n(a,c,m,y,T){this._reactName=a,this._targetInst=m,this.type=c,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var R in i)i.hasOwnProperty(R)&&(a=i[R],this[R]=a?a(y):y[R]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ma:xh,this.isPropagationStopped=xh,this}return p(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Ma)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Ma)},persist:function(){},isPersistent:Ma}),n}var Hs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ka=Ne(Hs),Er=p({},Hs,{view:0,detail:0}),Lv=Ne(Er),Po,Uo,Sr,wa=p({},Er,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fo,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Sr&&(Sr&&i.type==="mousemove"?(Po=i.screenX-Sr.screenX,Uo=i.screenY-Sr.screenY):Uo=Po=0,Sr=i),Po)},movementY:function(i){return"movementY"in i?i.movementY:Uo}}),Ah=Ne(wa),Rv=p({},wa,{dataTransfer:0}),_v=Ne(Rv),Dv=p({},Er,{relatedTarget:0}),Bo=Ne(Dv),Iv=p({},Hs,{animationName:0,elapsedTime:0,pseudoElement:0}),Cv=Ne(Iv),Ov=p({},Hs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Mv=Ne(Ov),kv=p({},Hs,{data:0}),bh=Ne(kv),wv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uv(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=Pv[i])?!!n[i]:!1}function Fo(){return Uv}var Bv=p({},Er,{key:function(i){if(i.key){var n=wv[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=Oa(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Nv[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fo,charCode:function(i){return i.type==="keypress"?Oa(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Oa(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Fv=Ne(Bv),$v=p({},wa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lh=Ne($v),Gv=p({},Er,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fo}),Hv=Ne(Gv),Vv=p({},Hs,{propertyName:0,elapsedTime:0,pseudoElement:0}),zv=Ne(Vv),Kv=p({},wa,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),jv=Ne(Kv),Yv=p({},Hs,{newState:0,oldState:0}),qv=Ne(Yv),Xv=[9,13,27,32],$o=$i&&"CompositionEvent"in window,Tr=null;$i&&"documentMode"in document&&(Tr=document.documentMode);var Qv=$i&&"TextEvent"in window&&!Tr,Rh=$i&&(!$o||Tr&&8<Tr&&11>=Tr),_h=" ",Dh=!1;function Ih(i,n){switch(i){case"keyup":return Xv.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ch(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Tn=!1;function Wv(i,n){switch(i){case"compositionend":return Ch(n);case"keypress":return n.which!==32?null:(Dh=!0,_h);case"textInput":return i=n.data,i===_h&&Dh?null:i;default:return null}}function Zv(i,n){if(Tn)return i==="compositionend"||!$o&&Ih(i,n)?(i=Th(),Ca=No=us=null,Tn=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Rh&&n.locale!=="ko"?null:n.data;default:return null}}var Jv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Oh(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!Jv[i.type]:n==="textarea"}function Mh(i,n,a,c){En?Sn?Sn.push(c):Sn=[c]:En=c,n=Al(n,"onChange"),0<n.length&&(a=new ka("onChange","change",null,a,c),i.push({event:a,listeners:n}))}var xr=null,Ar=null;function tE(i){g0(i,0)}function Na(i){var n=pr(i);if(dh(n))return i}function kh(i,n){if(i==="change")return n}var wh=!1;if($i){var Go;if($i){var Ho="oninput"in document;if(!Ho){var Nh=document.createElement("div");Nh.setAttribute("oninput","return;"),Ho=typeof Nh.oninput=="function"}Go=Ho}else Go=!1;wh=Go&&(!document.documentMode||9<document.documentMode)}function Ph(){xr&&(xr.detachEvent("onpropertychange",Uh),Ar=xr=null)}function Uh(i){if(i.propertyName==="value"&&Na(Ar)){var n=[];Mh(n,Ar,i,Mo(i)),Sh(tE,n)}}function eE(i,n,a){i==="focusin"?(Ph(),xr=n,Ar=a,xr.attachEvent("onpropertychange",Uh)):i==="focusout"&&Ph()}function iE(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Na(Ar)}function sE(i,n){if(i==="click")return Na(n)}function nE(i,n){if(i==="input"||i==="change")return Na(n)}function rE(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var Ke=typeof Object.is=="function"?Object.is:rE;function br(i,n){if(Ke(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var a=Object.keys(i),c=Object.keys(n);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var m=a[c];if(!vi.call(n,m)||!Ke(i[m],n[m]))return!1}return!0}function Bh(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Fh(i,n){var a=Bh(i);i=0;for(var c;a;){if(a.nodeType===3){if(c=i+a.textContent.length,i<=n&&c>=n)return{node:a,offset:n-i};i=c}t:{for(;a;){if(a.nextSibling){a=a.nextSibling;break t}a=a.parentNode}a=void 0}a=Bh(a)}}function $h(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?$h(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function Gh(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=Da(i.document);n instanceof i.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)i=n.contentWindow;else break;n=Da(i.document)}return n}function Vo(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}var aE=$i&&"documentMode"in document&&11>=document.documentMode,xn=null,zo=null,Lr=null,Ko=!1;function Hh(i,n,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Ko||xn==null||xn!==Da(c)||(c=xn,"selectionStart"in c&&Vo(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Lr&&br(Lr,c)||(Lr=c,c=Al(zo,"onSelect"),0<c.length&&(n=new ka("onSelect","select",null,n,a),i.push({event:n,listeners:c}),n.target=xn)))}function Vs(i,n){var a={};return a[i.toLowerCase()]=n.toLowerCase(),a["Webkit"+i]="webkit"+n,a["Moz"+i]="moz"+n,a}var An={animationend:Vs("Animation","AnimationEnd"),animationiteration:Vs("Animation","AnimationIteration"),animationstart:Vs("Animation","AnimationStart"),transitionrun:Vs("Transition","TransitionRun"),transitionstart:Vs("Transition","TransitionStart"),transitioncancel:Vs("Transition","TransitionCancel"),transitionend:Vs("Transition","TransitionEnd")},jo={},Vh={};$i&&(Vh=document.createElement("div").style,"AnimationEvent"in window||(delete An.animationend.animation,delete An.animationiteration.animation,delete An.animationstart.animation),"TransitionEvent"in window||delete An.transitionend.transition);function zs(i){if(jo[i])return jo[i];if(!An[i])return i;var n=An[i],a;for(a in n)if(n.hasOwnProperty(a)&&a in Vh)return jo[i]=n[a];return i}var zh=zs("animationend"),Kh=zs("animationiteration"),jh=zs("animationstart"),lE=zs("transitionrun"),oE=zs("transitionstart"),uE=zs("transitioncancel"),Yh=zs("transitionend"),qh=new Map,Yo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yo.push("scrollEnd");function Ei(i,n){qh.set(i,n),Gs(n,[i])}var Pa=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},li=[],bn=0,qo=0;function Ua(){for(var i=bn,n=qo=bn=0;n<i;){var a=li[n];li[n++]=null;var c=li[n];li[n++]=null;var m=li[n];li[n++]=null;var y=li[n];if(li[n++]=null,c!==null&&m!==null){var T=c.pending;T===null?m.next=m:(m.next=T.next,T.next=m),c.pending=m}y!==0&&Xh(a,m,y)}}function Ba(i,n,a,c){li[bn++]=i,li[bn++]=n,li[bn++]=a,li[bn++]=c,qo|=c,i.lanes|=c,i=i.alternate,i!==null&&(i.lanes|=c)}function Xo(i,n,a,c){return Ba(i,n,a,c),Fa(i)}function Ks(i,n){return Ba(i,null,null,n),Fa(i)}function Xh(i,n,a){i.lanes|=a;var c=i.alternate;c!==null&&(c.lanes|=a);for(var m=!1,y=i.return;y!==null;)y.childLanes|=a,c=y.alternate,c!==null&&(c.childLanes|=a),y.tag===22&&(i=y.stateNode,i===null||i._visibility&1||(m=!0)),i=y,y=y.return;return i.tag===3?(y=i.stateNode,m&&n!==null&&(m=31-ze(a),i=y.hiddenUpdates,c=i[m],c===null?i[m]=[n]:c.push(n),n.lane=a|536870912),y):null}function Fa(i){if(50<Yr)throw Yr=0,nc=null,Error(s(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var Ln={};function cE(i,n,a,c){this.tag=i,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function je(i,n,a,c){return new cE(i,n,a,c)}function Qo(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Gi(i,n){var a=i.alternate;return a===null?(a=je(i.tag,n,i.key,i.mode),a.elementType=i.elementType,a.type=i.type,a.stateNode=i.stateNode,a.alternate=i,i.alternate=a):(a.pendingProps=n,a.type=i.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=i.flags&65011712,a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,n=i.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=i.sibling,a.index=i.index,a.ref=i.ref,a.refCleanup=i.refCleanup,a}function Qh(i,n){i.flags&=65011714;var a=i.alternate;return a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function $a(i,n,a,c,m,y){var T=0;if(c=i,typeof i=="function")Qo(i)&&(T=1);else if(typeof i=="string")T=mS(i,a,nt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case $:return i=je(31,a,n,m),i.elementType=$,i.lanes=y,i;case A:return js(a.children,m,y,n);case b:T=8,m|=24;break;case L:return i=je(12,a,n,m|2),i.elementType=L,i.lanes=y,i;case k:return i=je(13,a,n,m),i.elementType=k,i.lanes=y,i;case K:return i=je(19,a,n,m),i.elementType=K,i.lanes=y,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case D:T=10;break t;case _:T=9;break t;case C:T=11;break t;case O:T=14;break t;case F:T=16,c=null;break t}T=29,a=Error(s(130,i===null?"null":typeof i,"")),c=null}return n=je(T,a,n,m),n.elementType=i,n.type=c,n.lanes=y,n}function js(i,n,a,c){return i=je(7,i,c,n),i.lanes=a,i}function Wo(i,n,a){return i=je(6,i,null,n),i.lanes=a,i}function Wh(i){var n=je(18,null,null,0);return n.stateNode=i,n}function Zo(i,n,a){return n=je(4,i.children!==null?i.children:[],i.key,n),n.lanes=a,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}var Zh=new WeakMap;function oi(i,n){if(typeof i=="object"&&i!==null){var a=Zh.get(i);return a!==void 0?a:(n={value:i,source:n,stack:Ce(n)},Zh.set(i,n),n)}return{value:i,source:n,stack:Ce(n)}}var Rn=[],_n=0,Ga=null,Rr=0,ui=[],ci=0,cs=null,Li=1,Ri="";function Hi(i,n){Rn[_n++]=Rr,Rn[_n++]=Ga,Ga=i,Rr=n}function Jh(i,n,a){ui[ci++]=Li,ui[ci++]=Ri,ui[ci++]=cs,cs=i;var c=Li;i=Ri;var m=32-ze(c)-1;c&=~(1<<m),a+=1;var y=32-ze(n)+m;if(30<y){var T=m-m%5;y=(c&(1<<T)-1).toString(32),c>>=T,m-=T,Li=1<<32-ze(n)+m|a<<m|c,Ri=y+i}else Li=1<<y|a<<m|c,Ri=i}function Jo(i){i.return!==null&&(Hi(i,1),Jh(i,1,0))}function tu(i){for(;i===Ga;)Ga=Rn[--_n],Rn[_n]=null,Rr=Rn[--_n],Rn[_n]=null;for(;i===cs;)cs=ui[--ci],ui[ci]=null,Ri=ui[--ci],ui[ci]=null,Li=ui[--ci],ui[ci]=null}function td(i,n){ui[ci++]=Li,ui[ci++]=Ri,ui[ci++]=cs,Li=n.id,Ri=n.overflow,cs=i}var Te=null,Xt=null,Mt=!1,fs=null,fi=!1,eu=Error(s(519));function hs(i){var n=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw _r(oi(n,i)),eu}function ed(i){var n=i.stateNode,a=i.type,c=i.memoizedProps;switch(n[Se]=i,n[we]=c,a){case"dialog":Dt("cancel",n),Dt("close",n);break;case"iframe":case"object":case"embed":Dt("load",n);break;case"video":case"audio":for(a=0;a<Xr.length;a++)Dt(Xr[a],n);break;case"source":Dt("error",n);break;case"img":case"image":case"link":Dt("error",n),Dt("load",n);break;case"details":Dt("toggle",n);break;case"input":Dt("invalid",n),gh(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Dt("invalid",n);break;case"textarea":Dt("invalid",n),ph(n,c.value,c.defaultValue,c.children)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||c.suppressHydrationWarning===!0||v0(n.textContent,a)?(c.popover!=null&&(Dt("beforetoggle",n),Dt("toggle",n)),c.onScroll!=null&&Dt("scroll",n),c.onScrollEnd!=null&&Dt("scrollend",n),c.onClick!=null&&(n.onclick=Fi),n=!0):n=!1,n||hs(i,!0)}function id(i){for(Te=i.return;Te;)switch(Te.tag){case 5:case 31:case 13:fi=!1;return;case 27:case 3:fi=!0;return;default:Te=Te.return}}function Dn(i){if(i!==Te)return!1;if(!Mt)return id(i),Mt=!0,!1;var n=i.tag,a;if((a=n!==3&&n!==27)&&((a=n===5)&&(a=i.type,a=!(a!=="form"&&a!=="button")||Ec(i.type,i.memoizedProps)),a=!a),a&&Xt&&hs(i),id(i),n===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));Xt=_0(i)}else if(n===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));Xt=_0(i)}else n===27?(n=Xt,Rs(i.type)?(i=bc,bc=null,Xt=i):Xt=n):Xt=Te?di(i.stateNode.nextSibling):null;return!0}function Ys(){Xt=Te=null,Mt=!1}function iu(){var i=fs;return i!==null&&(Fe===null?Fe=i:Fe.push.apply(Fe,i),fs=null),i}function _r(i){fs===null?fs=[i]:fs.push(i)}var su=I(null),qs=null,Vi=null;function ds(i,n,a){it(su,n._currentValue),n._currentValue=a}function zi(i){i._currentValue=su.current,P(su)}function nu(i,n,a){for(;i!==null;){var c=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),i===a)break;i=i.return}}function ru(i,n,a,c){var m=i.child;for(m!==null&&(m.return=i);m!==null;){var y=m.dependencies;if(y!==null){var T=m.child;y=y.firstContext;t:for(;y!==null;){var R=y;y=m;for(var M=0;M<n.length;M++)if(R.context===n[M]){y.lanes|=a,R=y.alternate,R!==null&&(R.lanes|=a),nu(y.return,a,i),c||(T=null);break t}y=R.next}}else if(m.tag===18){if(T=m.return,T===null)throw Error(s(341));T.lanes|=a,y=T.alternate,y!==null&&(y.lanes|=a),nu(T,a,i),T=null}else T=m.child;if(T!==null)T.return=m;else for(T=m;T!==null;){if(T===i){T=null;break}if(m=T.sibling,m!==null){m.return=T.return,T=m;break}T=T.return}m=T}}function In(i,n,a,c){i=null;for(var m=n,y=!1;m!==null;){if(!y){if((m.flags&524288)!==0)y=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var T=m.alternate;if(T===null)throw Error(s(387));if(T=T.memoizedProps,T!==null){var R=m.type;Ke(m.pendingProps.value,T.value)||(i!==null?i.push(R):i=[R])}}else if(m===Et.current){if(T=m.alternate,T===null)throw Error(s(387));T.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(i!==null?i.push(ta):i=[ta])}m=m.return}i!==null&&ru(n,i,a,c),n.flags|=262144}function Ha(i){for(i=i.firstContext;i!==null;){if(!Ke(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Xs(i){qs=i,Vi=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function xe(i){return sd(qs,i)}function Va(i,n){return qs===null&&Xs(i),sd(i,n)}function sd(i,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},Vi===null){if(i===null)throw Error(s(308));Vi=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else Vi=Vi.next=n;return a}var fE=typeof AbortController<"u"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(a,c){i.push(c)}};this.abort=function(){n.aborted=!0,i.forEach(function(a){return a()})}},hE=u.unstable_scheduleCallback,dE=u.unstable_NormalPriority,le={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function au(){return{controller:new fE,data:new Map,refCount:0}}function Dr(i){i.refCount--,i.refCount===0&&hE(dE,function(){i.controller.abort()})}var Ir=null,lu=0,Cn=0,On=null;function gE(i,n){if(Ir===null){var a=Ir=[];lu=0,Cn=cc(),On={status:"pending",value:void 0,then:function(c){a.push(c)}}}return lu++,n.then(nd,nd),n}function nd(){if(--lu===0&&Ir!==null){On!==null&&(On.status="fulfilled");var i=Ir;Ir=null,Cn=0,On=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function mE(i,n){var a=[],c={status:"pending",value:null,reason:null,then:function(m){a.push(m)}};return i.then(function(){c.status="fulfilled",c.value=n;for(var m=0;m<a.length;m++)(0,a[m])(n)},function(m){for(c.status="rejected",c.reason=m,m=0;m<a.length;m++)(0,a[m])(void 0)}),c}var rd=w.S;w.S=function(i,n){Hg=me(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&gE(i,n),rd!==null&&rd(i,n)};var Qs=I(null);function ou(){var i=Qs.current;return i!==null?i:jt.pooledCache}function za(i,n){n===null?it(Qs,Qs.current):it(Qs,n.pool)}function ad(){var i=ou();return i===null?null:{parent:le._currentValue,pool:i}}var Mn=Error(s(460)),uu=Error(s(474)),Ka=Error(s(542)),ja={then:function(){}};function ld(i){return i=i.status,i==="fulfilled"||i==="rejected"}function od(i,n,a){switch(a=i[a],a===void 0?i.push(n):a!==n&&(n.then(Fi,Fi),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,cd(i),i;default:if(typeof n.status=="string")n.then(Fi,Fi);else{if(i=jt,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=n,i.status="pending",i.then(function(c){if(n.status==="pending"){var m=n;m.status="fulfilled",m.value=c}},function(c){if(n.status==="pending"){var m=n;m.status="rejected",m.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,cd(i),i}throw Zs=n,Mn}}function Ws(i){try{var n=i._init;return n(i._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Zs=a,Mn):a}}var Zs=null;function ud(){if(Zs===null)throw Error(s(459));var i=Zs;return Zs=null,i}function cd(i){if(i===Mn||i===Ka)throw Error(s(483))}var kn=null,Cr=0;function Ya(i){var n=Cr;return Cr+=1,kn===null&&(kn=[]),od(kn,i,n)}function Or(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function qa(i,n){throw n.$$typeof===v?Error(s(525)):(i=Object.prototype.toString.call(n),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function fd(i){function n(B,N){if(i){var z=B.deletions;z===null?(B.deletions=[N],B.flags|=16):z.push(N)}}function a(B,N){if(!i)return null;for(;N!==null;)n(B,N),N=N.sibling;return null}function c(B){for(var N=new Map;B!==null;)B.key!==null?N.set(B.key,B):N.set(B.index,B),B=B.sibling;return N}function m(B,N){return B=Gi(B,N),B.index=0,B.sibling=null,B}function y(B,N,z){return B.index=z,i?(z=B.alternate,z!==null?(z=z.index,z<N?(B.flags|=67108866,N):z):(B.flags|=67108866,N)):(B.flags|=1048576,N)}function T(B){return i&&B.alternate===null&&(B.flags|=67108866),B}function R(B,N,z,tt){return N===null||N.tag!==6?(N=Wo(z,B.mode,tt),N.return=B,N):(N=m(N,z),N.return=B,N)}function M(B,N,z,tt){var yt=z.type;return yt===A?W(B,N,z.props.children,tt,z.key):N!==null&&(N.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===F&&Ws(yt)===N.type)?(N=m(N,z.props),Or(N,z),N.return=B,N):(N=$a(z.type,z.key,z.props,null,B.mode,tt),Or(N,z),N.return=B,N)}function j(B,N,z,tt){return N===null||N.tag!==4||N.stateNode.containerInfo!==z.containerInfo||N.stateNode.implementation!==z.implementation?(N=Zo(z,B.mode,tt),N.return=B,N):(N=m(N,z.children||[]),N.return=B,N)}function W(B,N,z,tt,yt){return N===null||N.tag!==7?(N=js(z,B.mode,tt,yt),N.return=B,N):(N=m(N,z),N.return=B,N)}function et(B,N,z){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=Wo(""+N,B.mode,z),N.return=B,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case E:return z=$a(N.type,N.key,N.props,null,B.mode,z),Or(z,N),z.return=B,z;case S:return N=Zo(N,B.mode,z),N.return=B,N;case F:return N=Ws(N),et(B,N,z)}if(lt(N)||st(N))return N=js(N,B.mode,z,null),N.return=B,N;if(typeof N.then=="function")return et(B,Ya(N),z);if(N.$$typeof===D)return et(B,Va(B,N),z);qa(B,N)}return null}function Y(B,N,z,tt){var yt=N!==null?N.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return yt!==null?null:R(B,N,""+z,tt);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case E:return z.key===yt?M(B,N,z,tt):null;case S:return z.key===yt?j(B,N,z,tt):null;case F:return z=Ws(z),Y(B,N,z,tt)}if(lt(z)||st(z))return yt!==null?null:W(B,N,z,tt,null);if(typeof z.then=="function")return Y(B,N,Ya(z),tt);if(z.$$typeof===D)return Y(B,N,Va(B,z),tt);qa(B,z)}return null}function q(B,N,z,tt,yt){if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return B=B.get(z)||null,R(N,B,""+tt,yt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case E:return B=B.get(tt.key===null?z:tt.key)||null,M(N,B,tt,yt);case S:return B=B.get(tt.key===null?z:tt.key)||null,j(N,B,tt,yt);case F:return tt=Ws(tt),q(B,N,z,tt,yt)}if(lt(tt)||st(tt))return B=B.get(z)||null,W(N,B,tt,yt,null);if(typeof tt.then=="function")return q(B,N,z,Ya(tt),yt);if(tt.$$typeof===D)return q(B,N,z,Va(N,tt),yt);qa(N,tt)}return null}function gt(B,N,z,tt){for(var yt=null,Nt=null,mt=N,bt=N=0,Ot=null;mt!==null&&bt<z.length;bt++){mt.index>bt?(Ot=mt,mt=null):Ot=mt.sibling;var Pt=Y(B,mt,z[bt],tt);if(Pt===null){mt===null&&(mt=Ot);break}i&&mt&&Pt.alternate===null&&n(B,mt),N=y(Pt,N,bt),Nt===null?yt=Pt:Nt.sibling=Pt,Nt=Pt,mt=Ot}if(bt===z.length)return a(B,mt),Mt&&Hi(B,bt),yt;if(mt===null){for(;bt<z.length;bt++)mt=et(B,z[bt],tt),mt!==null&&(N=y(mt,N,bt),Nt===null?yt=mt:Nt.sibling=mt,Nt=mt);return Mt&&Hi(B,bt),yt}for(mt=c(mt);bt<z.length;bt++)Ot=q(mt,B,bt,z[bt],tt),Ot!==null&&(i&&Ot.alternate!==null&&mt.delete(Ot.key===null?bt:Ot.key),N=y(Ot,N,bt),Nt===null?yt=Ot:Nt.sibling=Ot,Nt=Ot);return i&&mt.forEach(function(Os){return n(B,Os)}),Mt&&Hi(B,bt),yt}function vt(B,N,z,tt){if(z==null)throw Error(s(151));for(var yt=null,Nt=null,mt=N,bt=N=0,Ot=null,Pt=z.next();mt!==null&&!Pt.done;bt++,Pt=z.next()){mt.index>bt?(Ot=mt,mt=null):Ot=mt.sibling;var Os=Y(B,mt,Pt.value,tt);if(Os===null){mt===null&&(mt=Ot);break}i&&mt&&Os.alternate===null&&n(B,mt),N=y(Os,N,bt),Nt===null?yt=Os:Nt.sibling=Os,Nt=Os,mt=Ot}if(Pt.done)return a(B,mt),Mt&&Hi(B,bt),yt;if(mt===null){for(;!Pt.done;bt++,Pt=z.next())Pt=et(B,Pt.value,tt),Pt!==null&&(N=y(Pt,N,bt),Nt===null?yt=Pt:Nt.sibling=Pt,Nt=Pt);return Mt&&Hi(B,bt),yt}for(mt=c(mt);!Pt.done;bt++,Pt=z.next())Pt=q(mt,B,bt,Pt.value,tt),Pt!==null&&(i&&Pt.alternate!==null&&mt.delete(Pt.key===null?bt:Pt.key),N=y(Pt,N,bt),Nt===null?yt=Pt:Nt.sibling=Pt,Nt=Pt);return i&&mt.forEach(function(RS){return n(B,RS)}),Mt&&Hi(B,bt),yt}function zt(B,N,z,tt){if(typeof z=="object"&&z!==null&&z.type===A&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case E:t:{for(var yt=z.key;N!==null;){if(N.key===yt){if(yt=z.type,yt===A){if(N.tag===7){a(B,N.sibling),tt=m(N,z.props.children),tt.return=B,B=tt;break t}}else if(N.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===F&&Ws(yt)===N.type){a(B,N.sibling),tt=m(N,z.props),Or(tt,z),tt.return=B,B=tt;break t}a(B,N);break}else n(B,N);N=N.sibling}z.type===A?(tt=js(z.props.children,B.mode,tt,z.key),tt.return=B,B=tt):(tt=$a(z.type,z.key,z.props,null,B.mode,tt),Or(tt,z),tt.return=B,B=tt)}return T(B);case S:t:{for(yt=z.key;N!==null;){if(N.key===yt)if(N.tag===4&&N.stateNode.containerInfo===z.containerInfo&&N.stateNode.implementation===z.implementation){a(B,N.sibling),tt=m(N,z.children||[]),tt.return=B,B=tt;break t}else{a(B,N);break}else n(B,N);N=N.sibling}tt=Zo(z,B.mode,tt),tt.return=B,B=tt}return T(B);case F:return z=Ws(z),zt(B,N,z,tt)}if(lt(z))return gt(B,N,z,tt);if(st(z)){if(yt=st(z),typeof yt!="function")throw Error(s(150));return z=yt.call(z),vt(B,N,z,tt)}if(typeof z.then=="function")return zt(B,N,Ya(z),tt);if(z.$$typeof===D)return zt(B,N,Va(B,z),tt);qa(B,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,N!==null&&N.tag===6?(a(B,N.sibling),tt=m(N,z),tt.return=B,B=tt):(a(B,N),tt=Wo(z,B.mode,tt),tt.return=B,B=tt),T(B)):a(B,N)}return function(B,N,z,tt){try{Cr=0;var yt=zt(B,N,z,tt);return kn=null,yt}catch(mt){if(mt===Mn||mt===Ka)throw mt;var Nt=je(29,mt,null,B.mode);return Nt.lanes=tt,Nt.return=B,Nt}finally{}}}var Js=fd(!0),hd=fd(!1),gs=!1;function cu(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fu(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ms(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function ps(i,n,a){var c=i.updateQueue;if(c===null)return null;if(c=c.shared,(Ut&2)!==0){var m=c.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),c.pending=n,n=Fa(i),Xh(i,null,a),n}return Ba(i,c,n,a),Fa(i)}function Mr(i,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194048)!==0)){var c=n.lanes;c&=i.pendingLanes,a|=c,n.lanes=a,sh(i,a)}}function hu(i,n){var a=i.updateQueue,c=i.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var m=null,y=null;if(a=a.firstBaseUpdate,a!==null){do{var T={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};y===null?m=y=T:y=y.next=T,a=a.next}while(a!==null);y===null?m=y=n:y=y.next=n}else m=y=n;a={baseState:c.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:c.shared,callbacks:c.callbacks},i.updateQueue=a;return}i=a.lastBaseUpdate,i===null?a.firstBaseUpdate=n:i.next=n,a.lastBaseUpdate=n}var du=!1;function kr(){if(du){var i=On;if(i!==null)throw i}}function wr(i,n,a,c){du=!1;var m=i.updateQueue;gs=!1;var y=m.firstBaseUpdate,T=m.lastBaseUpdate,R=m.shared.pending;if(R!==null){m.shared.pending=null;var M=R,j=M.next;M.next=null,T===null?y=j:T.next=j,T=M;var W=i.alternate;W!==null&&(W=W.updateQueue,R=W.lastBaseUpdate,R!==T&&(R===null?W.firstBaseUpdate=j:R.next=j,W.lastBaseUpdate=M))}if(y!==null){var et=m.baseState;T=0,W=j=M=null,R=y;do{var Y=R.lane&-536870913,q=Y!==R.lane;if(q?(Ct&Y)===Y:(c&Y)===Y){Y!==0&&Y===Cn&&(du=!0),W!==null&&(W=W.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});t:{var gt=i,vt=R;Y=n;var zt=a;switch(vt.tag){case 1:if(gt=vt.payload,typeof gt=="function"){et=gt.call(zt,et,Y);break t}et=gt;break t;case 3:gt.flags=gt.flags&-65537|128;case 0:if(gt=vt.payload,Y=typeof gt=="function"?gt.call(zt,et,Y):gt,Y==null)break t;et=p({},et,Y);break t;case 2:gs=!0}}Y=R.callback,Y!==null&&(i.flags|=64,q&&(i.flags|=8192),q=m.callbacks,q===null?m.callbacks=[Y]:q.push(Y))}else q={lane:Y,tag:R.tag,payload:R.payload,callback:R.callback,next:null},W===null?(j=W=q,M=et):W=W.next=q,T|=Y;if(R=R.next,R===null){if(R=m.shared.pending,R===null)break;q=R,R=q.next,q.next=null,m.lastBaseUpdate=q,m.shared.pending=null}}while(!0);W===null&&(M=et),m.baseState=M,m.firstBaseUpdate=j,m.lastBaseUpdate=W,y===null&&(m.shared.lanes=0),Ts|=T,i.lanes=T,i.memoizedState=et}}function dd(i,n){if(typeof i!="function")throw Error(s(191,i));i.call(n)}function gd(i,n){var a=i.callbacks;if(a!==null)for(i.callbacks=null,i=0;i<a.length;i++)dd(a[i],n)}var wn=I(null),Xa=I(0);function md(i,n){i=Ji,it(Xa,i),it(wn,n),Ji=i|n.baseLanes}function gu(){it(Xa,Ji),it(wn,wn.current)}function mu(){Ji=Xa.current,P(wn),P(Xa)}var Ye=I(null),hi=null;function ys(i){var n=i.alternate;it(ne,ne.current&1),it(Ye,i),hi===null&&(n===null||wn.current!==null||n.memoizedState!==null)&&(hi=i)}function pu(i){it(ne,ne.current),it(Ye,i),hi===null&&(hi=i)}function pd(i){i.tag===22?(it(ne,ne.current),it(Ye,i),hi===null&&(hi=i)):vs()}function vs(){it(ne,ne.current),it(Ye,Ye.current)}function qe(i){P(Ye),hi===i&&(hi=null),P(ne)}var ne=I(0);function Qa(i){for(var n=i;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||xc(a)||Ac(a)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Ki=0,At=null,Ht=null,oe=null,Wa=!1,Nn=!1,tn=!1,Za=0,Nr=0,Pn=null,pE=0;function ee(){throw Error(s(321))}function yu(i,n){if(n===null)return!1;for(var a=0;a<n.length&&a<i.length;a++)if(!Ke(i[a],n[a]))return!1;return!0}function vu(i,n,a,c,m,y){return Ki=y,At=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,w.H=i===null||i.memoizedState===null?Jd:ku,tn=!1,y=a(c,m),tn=!1,Nn&&(y=vd(n,a,c,m)),yd(i),y}function yd(i){w.H=Br;var n=Ht!==null&&Ht.next!==null;if(Ki=0,oe=Ht=At=null,Wa=!1,Nr=0,Pn=null,n)throw Error(s(300));i===null||ue||(i=i.dependencies,i!==null&&Ha(i)&&(ue=!0))}function vd(i,n,a,c){At=i;var m=0;do{if(Nn&&(Pn=null),Nr=0,Nn=!1,25<=m)throw Error(s(301));if(m+=1,oe=Ht=null,i.updateQueue!=null){var y=i.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}w.H=tg,y=n(a,c)}while(Nn);return y}function yE(){var i=w.H,n=i.useState()[0];return n=typeof n.then=="function"?Pr(n):n,i=i.useState()[0],(Ht!==null?Ht.memoizedState:null)!==i&&(At.flags|=1024),n}function Eu(){var i=Za!==0;return Za=0,i}function Su(i,n,a){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~a}function Tu(i){if(Wa){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}Wa=!1}Ki=0,oe=Ht=At=null,Nn=!1,Nr=Za=0,Pn=null}function Me(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oe===null?At.memoizedState=oe=i:oe=oe.next=i,oe}function re(){if(Ht===null){var i=At.alternate;i=i!==null?i.memoizedState:null}else i=Ht.next;var n=oe===null?At.memoizedState:oe.next;if(n!==null)oe=n,Ht=i;else{if(i===null)throw At.alternate===null?Error(s(467)):Error(s(310));Ht=i,i={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},oe===null?At.memoizedState=oe=i:oe=oe.next=i}return oe}function Ja(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Pr(i){var n=Nr;return Nr+=1,Pn===null&&(Pn=[]),i=od(Pn,i,n),n=At,(oe===null?n.memoizedState:oe.next)===null&&(n=n.alternate,w.H=n===null||n.memoizedState===null?Jd:ku),i}function tl(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Pr(i);if(i.$$typeof===D)return xe(i)}throw Error(s(438,String(i)))}function xu(i){var n=null,a=At.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var c=At.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(m){return m.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=Ja(),At.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(i),c=0;c<i;c++)a[c]=U;return n.index++,a}function ji(i,n){return typeof n=="function"?n(i):n}function el(i){var n=re();return Au(n,Ht,i)}function Au(i,n,a){var c=i.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=a;var m=i.baseQueue,y=c.pending;if(y!==null){if(m!==null){var T=m.next;m.next=y.next,y.next=T}n.baseQueue=m=y,c.pending=null}if(y=i.baseState,m===null)i.memoizedState=y;else{n=m.next;var R=T=null,M=null,j=n,W=!1;do{var et=j.lane&-536870913;if(et!==j.lane?(Ct&et)===et:(Ki&et)===et){var Y=j.revertLane;if(Y===0)M!==null&&(M=M.next={lane:0,revertLane:0,gesture:null,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),et===Cn&&(W=!0);else if((Ki&Y)===Y){j=j.next,Y===Cn&&(W=!0);continue}else et={lane:0,revertLane:j.revertLane,gesture:null,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},M===null?(R=M=et,T=y):M=M.next=et,At.lanes|=Y,Ts|=Y;et=j.action,tn&&a(y,et),y=j.hasEagerState?j.eagerState:a(y,et)}else Y={lane:et,revertLane:j.revertLane,gesture:j.gesture,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},M===null?(R=M=Y,T=y):M=M.next=Y,At.lanes|=et,Ts|=et;j=j.next}while(j!==null&&j!==n);if(M===null?T=y:M.next=R,!Ke(y,i.memoizedState)&&(ue=!0,W&&(a=On,a!==null)))throw a;i.memoizedState=y,i.baseState=T,i.baseQueue=M,c.lastRenderedState=y}return m===null&&(c.lanes=0),[i.memoizedState,c.dispatch]}function bu(i){var n=re(),a=n.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=i;var c=a.dispatch,m=a.pending,y=n.memoizedState;if(m!==null){a.pending=null;var T=m=m.next;do y=i(y,T.action),T=T.next;while(T!==m);Ke(y,n.memoizedState)||(ue=!0),n.memoizedState=y,n.baseQueue===null&&(n.baseState=y),a.lastRenderedState=y}return[y,c]}function Ed(i,n,a){var c=At,m=re(),y=Mt;if(y){if(a===void 0)throw Error(s(407));a=a()}else a=n();var T=!Ke((Ht||m).memoizedState,a);if(T&&(m.memoizedState=a,ue=!0),m=m.queue,_u(xd.bind(null,c,m,i),[i]),m.getSnapshot!==n||T||oe!==null&&oe.memoizedState.tag&1){if(c.flags|=2048,Un(9,{destroy:void 0},Td.bind(null,c,m,a,n),null),jt===null)throw Error(s(349));y||(Ki&127)!==0||Sd(c,n,a)}return a}function Sd(i,n,a){i.flags|=16384,i={getSnapshot:n,value:a},n=At.updateQueue,n===null?(n=Ja(),At.updateQueue=n,n.stores=[i]):(a=n.stores,a===null?n.stores=[i]:a.push(i))}function Td(i,n,a,c){n.value=a,n.getSnapshot=c,Ad(n)&&bd(i)}function xd(i,n,a){return a(function(){Ad(n)&&bd(i)})}function Ad(i){var n=i.getSnapshot;i=i.value;try{var a=n();return!Ke(i,a)}catch{return!0}}function bd(i){var n=Ks(i,2);n!==null&&$e(n,i,2)}function Lu(i){var n=Me();if(typeof i=="function"){var a=i;if(i=a(),tn){ls(!0);try{a()}finally{ls(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ji,lastRenderedState:i},n}function Ld(i,n,a,c){return i.baseState=a,Au(i,Ht,typeof c=="function"?c:ji)}function vE(i,n,a,c,m){if(nl(i))throw Error(s(485));if(i=n.action,i!==null){var y={payload:m,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){y.listeners.push(T)}};w.T!==null?a(!0):y.isTransition=!1,c(y),a=n.pending,a===null?(y.next=n.pending=y,Rd(n,y)):(y.next=a.next,n.pending=a.next=y)}}function Rd(i,n){var a=n.action,c=n.payload,m=i.state;if(n.isTransition){var y=w.T,T={};w.T=T;try{var R=a(m,c),M=w.S;M!==null&&M(T,R),_d(i,n,R)}catch(j){Ru(i,n,j)}finally{y!==null&&T.types!==null&&(y.types=T.types),w.T=y}}else try{y=a(m,c),_d(i,n,y)}catch(j){Ru(i,n,j)}}function _d(i,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){Dd(i,n,c)},function(c){return Ru(i,n,c)}):Dd(i,n,a)}function Dd(i,n,a){n.status="fulfilled",n.value=a,Id(n),i.state=a,n=i.pending,n!==null&&(a=n.next,a===n?i.pending=null:(a=a.next,n.next=a,Rd(i,a)))}function Ru(i,n,a){var c=i.pending;if(i.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=a,Id(n),n=n.next;while(n!==c)}i.action=null}function Id(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function Cd(i,n){return n}function Od(i,n){if(Mt){var a=jt.formState;if(a!==null){t:{var c=At;if(Mt){if(Xt){e:{for(var m=Xt,y=fi;m.nodeType!==8;){if(!y){m=null;break e}if(m=di(m.nextSibling),m===null){m=null;break e}}y=m.data,m=y==="F!"||y==="F"?m:null}if(m){Xt=di(m.nextSibling),c=m.data==="F!";break t}}hs(c)}c=!1}c&&(n=a[0])}}return a=Me(),a.memoizedState=a.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cd,lastRenderedState:n},a.queue=c,a=Qd.bind(null,At,c),c.dispatch=a,c=Lu(!1),y=Mu.bind(null,At,!1,c.queue),c=Me(),m={state:n,dispatch:null,action:i,pending:null},c.queue=m,a=vE.bind(null,At,m,y,a),m.dispatch=a,c.memoizedState=i,[n,a,!1]}function Md(i){var n=re();return kd(n,Ht,i)}function kd(i,n,a){if(n=Au(i,n,Cd)[0],i=el(ji)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=Pr(n)}catch(T){throw T===Mn?Ka:T}else c=n;n=re();var m=n.queue,y=m.dispatch;return a!==n.memoizedState&&(At.flags|=2048,Un(9,{destroy:void 0},EE.bind(null,m,a),null)),[c,y,i]}function EE(i,n){i.action=n}function wd(i){var n=re(),a=Ht;if(a!==null)return kd(n,a,i);re(),n=n.memoizedState,a=re();var c=a.queue.dispatch;return a.memoizedState=i,[n,c,!1]}function Un(i,n,a,c){return i={tag:i,create:a,deps:c,inst:n,next:null},n=At.updateQueue,n===null&&(n=Ja(),At.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=i.next=i:(c=a.next,a.next=i,i.next=c,n.lastEffect=i),i}function Nd(){return re().memoizedState}function il(i,n,a,c){var m=Me();At.flags|=i,m.memoizedState=Un(1|n,{destroy:void 0},a,c===void 0?null:c)}function sl(i,n,a,c){var m=re();c=c===void 0?null:c;var y=m.memoizedState.inst;Ht!==null&&c!==null&&yu(c,Ht.memoizedState.deps)?m.memoizedState=Un(n,y,a,c):(At.flags|=i,m.memoizedState=Un(1|n,y,a,c))}function Pd(i,n){il(8390656,8,i,n)}function _u(i,n){sl(2048,8,i,n)}function SE(i){At.flags|=4;var n=At.updateQueue;if(n===null)n=Ja(),At.updateQueue=n,n.events=[i];else{var a=n.events;a===null?n.events=[i]:a.push(i)}}function Ud(i){var n=re().memoizedState;return SE({ref:n,nextImpl:i}),function(){if((Ut&2)!==0)throw Error(s(440));return n.impl.apply(void 0,arguments)}}function Bd(i,n){return sl(4,2,i,n)}function Fd(i,n){return sl(4,4,i,n)}function $d(i,n){if(typeof n=="function"){i=i();var a=n(i);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function Gd(i,n,a){a=a!=null?a.concat([i]):null,sl(4,4,$d.bind(null,n,i),a)}function Du(){}function Hd(i,n){var a=re();n=n===void 0?null:n;var c=a.memoizedState;return n!==null&&yu(n,c[1])?c[0]:(a.memoizedState=[i,n],i)}function Vd(i,n){var a=re();n=n===void 0?null:n;var c=a.memoizedState;if(n!==null&&yu(n,c[1]))return c[0];if(c=i(),tn){ls(!0);try{i()}finally{ls(!1)}}return a.memoizedState=[c,n],c}function Iu(i,n,a){return a===void 0||(Ki&1073741824)!==0&&(Ct&261930)===0?i.memoizedState=n:(i.memoizedState=a,i=zg(),At.lanes|=i,Ts|=i,a)}function zd(i,n,a,c){return Ke(a,n)?a:wn.current!==null?(i=Iu(i,a,c),Ke(i,n)||(ue=!0),i):(Ki&42)===0||(Ki&1073741824)!==0&&(Ct&261930)===0?(ue=!0,i.memoizedState=a):(i=zg(),At.lanes|=i,Ts|=i,n)}function Kd(i,n,a,c,m){var y=X.p;X.p=y!==0&&8>y?y:8;var T=w.T,R={};w.T=R,Mu(i,!1,n,a);try{var M=m(),j=w.S;if(j!==null&&j(R,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var W=mE(M,c);Ur(i,n,W,We(i))}else Ur(i,n,c,We(i))}catch(et){Ur(i,n,{then:function(){},status:"rejected",reason:et},We())}finally{X.p=y,T!==null&&R.types!==null&&(T.types=R.types),w.T=T}}function TE(){}function Cu(i,n,a,c){if(i.tag!==5)throw Error(s(476));var m=jd(i).queue;Kd(i,m,n,Z,a===null?TE:function(){return Yd(i),a(c)})}function jd(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ji,lastRenderedState:Z},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ji,lastRenderedState:a},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function Yd(i){var n=jd(i);n.next===null&&(n=i.alternate.memoizedState),Ur(i,n.next.queue,{},We())}function Ou(){return xe(ta)}function qd(){return re().memoizedState}function Xd(){return re().memoizedState}function xE(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var a=We();i=ms(a);var c=ps(n,i,a);c!==null&&($e(c,n,a),Mr(c,n,a)),n={cache:au()},i.payload=n;return}n=n.return}}function AE(i,n,a){var c=We();a={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},nl(i)?Wd(n,a):(a=Xo(i,n,a,c),a!==null&&($e(a,i,c),Zd(a,n,c)))}function Qd(i,n,a){var c=We();Ur(i,n,a,c)}function Ur(i,n,a,c){var m={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(nl(i))Wd(n,m);else{var y=i.alternate;if(i.lanes===0&&(y===null||y.lanes===0)&&(y=n.lastRenderedReducer,y!==null))try{var T=n.lastRenderedState,R=y(T,a);if(m.hasEagerState=!0,m.eagerState=R,Ke(R,T))return Ba(i,n,m,0),jt===null&&Ua(),!1}catch{}finally{}if(a=Xo(i,n,m,c),a!==null)return $e(a,i,c),Zd(a,n,c),!0}return!1}function Mu(i,n,a,c){if(c={lane:2,revertLane:cc(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},nl(i)){if(n)throw Error(s(479))}else n=Xo(i,a,c,2),n!==null&&$e(n,i,2)}function nl(i){var n=i.alternate;return i===At||n!==null&&n===At}function Wd(i,n){Nn=Wa=!0;var a=i.pending;a===null?n.next=n:(n.next=a.next,a.next=n),i.pending=n}function Zd(i,n,a){if((a&4194048)!==0){var c=n.lanes;c&=i.pendingLanes,a|=c,n.lanes=a,sh(i,a)}}var Br={readContext:xe,use:tl,useCallback:ee,useContext:ee,useEffect:ee,useImperativeHandle:ee,useLayoutEffect:ee,useInsertionEffect:ee,useMemo:ee,useReducer:ee,useRef:ee,useState:ee,useDebugValue:ee,useDeferredValue:ee,useTransition:ee,useSyncExternalStore:ee,useId:ee,useHostTransitionStatus:ee,useFormState:ee,useActionState:ee,useOptimistic:ee,useMemoCache:ee,useCacheRefresh:ee};Br.useEffectEvent=ee;var Jd={readContext:xe,use:tl,useCallback:function(i,n){return Me().memoizedState=[i,n===void 0?null:n],i},useContext:xe,useEffect:Pd,useImperativeHandle:function(i,n,a){a=a!=null?a.concat([i]):null,il(4194308,4,$d.bind(null,n,i),a)},useLayoutEffect:function(i,n){return il(4194308,4,i,n)},useInsertionEffect:function(i,n){il(4,2,i,n)},useMemo:function(i,n){var a=Me();n=n===void 0?null:n;var c=i();if(tn){ls(!0);try{i()}finally{ls(!1)}}return a.memoizedState=[c,n],c},useReducer:function(i,n,a){var c=Me();if(a!==void 0){var m=a(n);if(tn){ls(!0);try{a(n)}finally{ls(!1)}}}else m=n;return c.memoizedState=c.baseState=m,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:m},c.queue=i,i=i.dispatch=AE.bind(null,At,i),[c.memoizedState,i]},useRef:function(i){var n=Me();return i={current:i},n.memoizedState=i},useState:function(i){i=Lu(i);var n=i.queue,a=Qd.bind(null,At,n);return n.dispatch=a,[i.memoizedState,a]},useDebugValue:Du,useDeferredValue:function(i,n){var a=Me();return Iu(a,i,n)},useTransition:function(){var i=Lu(!1);return i=Kd.bind(null,At,i.queue,!0,!1),Me().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,a){var c=At,m=Me();if(Mt){if(a===void 0)throw Error(s(407));a=a()}else{if(a=n(),jt===null)throw Error(s(349));(Ct&127)!==0||Sd(c,n,a)}m.memoizedState=a;var y={value:a,getSnapshot:n};return m.queue=y,Pd(xd.bind(null,c,y,i),[i]),c.flags|=2048,Un(9,{destroy:void 0},Td.bind(null,c,y,a,n),null),a},useId:function(){var i=Me(),n=jt.identifierPrefix;if(Mt){var a=Ri,c=Li;a=(c&~(1<<32-ze(c)-1)).toString(32)+a,n="_"+n+"R_"+a,a=Za++,0<a&&(n+="H"+a.toString(32)),n+="_"}else a=pE++,n="_"+n+"r_"+a.toString(32)+"_";return i.memoizedState=n},useHostTransitionStatus:Ou,useFormState:Od,useActionState:Od,useOptimistic:function(i){var n=Me();n.memoizedState=n.baseState=i;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=Mu.bind(null,At,!0,a),a.dispatch=n,[i,n]},useMemoCache:xu,useCacheRefresh:function(){return Me().memoizedState=xE.bind(null,At)},useEffectEvent:function(i){var n=Me(),a={impl:i};return n.memoizedState=a,function(){if((Ut&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}},ku={readContext:xe,use:tl,useCallback:Hd,useContext:xe,useEffect:_u,useImperativeHandle:Gd,useInsertionEffect:Bd,useLayoutEffect:Fd,useMemo:Vd,useReducer:el,useRef:Nd,useState:function(){return el(ji)},useDebugValue:Du,useDeferredValue:function(i,n){var a=re();return zd(a,Ht.memoizedState,i,n)},useTransition:function(){var i=el(ji)[0],n=re().memoizedState;return[typeof i=="boolean"?i:Pr(i),n]},useSyncExternalStore:Ed,useId:qd,useHostTransitionStatus:Ou,useFormState:Md,useActionState:Md,useOptimistic:function(i,n){var a=re();return Ld(a,Ht,i,n)},useMemoCache:xu,useCacheRefresh:Xd};ku.useEffectEvent=Ud;var tg={readContext:xe,use:tl,useCallback:Hd,useContext:xe,useEffect:_u,useImperativeHandle:Gd,useInsertionEffect:Bd,useLayoutEffect:Fd,useMemo:Vd,useReducer:bu,useRef:Nd,useState:function(){return bu(ji)},useDebugValue:Du,useDeferredValue:function(i,n){var a=re();return Ht===null?Iu(a,i,n):zd(a,Ht.memoizedState,i,n)},useTransition:function(){var i=bu(ji)[0],n=re().memoizedState;return[typeof i=="boolean"?i:Pr(i),n]},useSyncExternalStore:Ed,useId:qd,useHostTransitionStatus:Ou,useFormState:wd,useActionState:wd,useOptimistic:function(i,n){var a=re();return Ht!==null?Ld(a,Ht,i,n):(a.baseState=i,[i,a.queue.dispatch])},useMemoCache:xu,useCacheRefresh:Xd};tg.useEffectEvent=Ud;function wu(i,n,a,c){n=i.memoizedState,a=a(c,n),a=a==null?n:p({},n,a),i.memoizedState=a,i.lanes===0&&(i.updateQueue.baseState=a)}var Nu={enqueueSetState:function(i,n,a){i=i._reactInternals;var c=We(),m=ms(c);m.payload=n,a!=null&&(m.callback=a),n=ps(i,m,c),n!==null&&($e(n,i,c),Mr(n,i,c))},enqueueReplaceState:function(i,n,a){i=i._reactInternals;var c=We(),m=ms(c);m.tag=1,m.payload=n,a!=null&&(m.callback=a),n=ps(i,m,c),n!==null&&($e(n,i,c),Mr(n,i,c))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var a=We(),c=ms(a);c.tag=2,n!=null&&(c.callback=n),n=ps(i,c,a),n!==null&&($e(n,i,a),Mr(n,i,a))}};function eg(i,n,a,c,m,y,T){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(c,y,T):n.prototype&&n.prototype.isPureReactComponent?!br(a,c)||!br(m,y):!0}function ig(i,n,a,c){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,c),n.state!==i&&Nu.enqueueReplaceState(n,n.state,null)}function en(i,n){var a=n;if("ref"in n){a={};for(var c in n)c!=="ref"&&(a[c]=n[c])}if(i=i.defaultProps){a===n&&(a=p({},a));for(var m in i)a[m]===void 0&&(a[m]=i[m])}return a}function sg(i){Pa(i)}function ng(i){console.error(i)}function rg(i){Pa(i)}function rl(i,n){try{var a=i.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function ag(i,n,a){try{var c=i.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Pu(i,n,a){return a=ms(a),a.tag=3,a.payload={element:null},a.callback=function(){rl(i,n)},a}function lg(i){return i=ms(i),i.tag=3,i}function og(i,n,a,c){var m=a.type.getDerivedStateFromError;if(typeof m=="function"){var y=c.value;i.payload=function(){return m(y)},i.callback=function(){ag(n,a,c)}}var T=a.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(i.callback=function(){ag(n,a,c),typeof m!="function"&&(xs===null?xs=new Set([this]):xs.add(this));var R=c.stack;this.componentDidCatch(c.value,{componentStack:R!==null?R:""})})}function bE(i,n,a,c,m){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=a.alternate,n!==null&&In(n,a,m,!0),a=Ye.current,a!==null){switch(a.tag){case 31:case 13:return hi===null?yl():a.alternate===null&&ie===0&&(ie=3),a.flags&=-257,a.flags|=65536,a.lanes=m,c===ja?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([c]):n.add(c),lc(i,c,m)),!1;case 22:return a.flags|=65536,c===ja?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([c]):a.add(c)),lc(i,c,m)),!1}throw Error(s(435,a.tag))}return lc(i,c,m),yl(),!1}if(Mt)return n=Ye.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=m,c!==eu&&(i=Error(s(422),{cause:c}),_r(oi(i,a)))):(c!==eu&&(n=Error(s(423),{cause:c}),_r(oi(n,a))),i=i.current.alternate,i.flags|=65536,m&=-m,i.lanes|=m,c=oi(c,a),m=Pu(i.stateNode,c,m),hu(i,m),ie!==4&&(ie=2)),!1;var y=Error(s(520),{cause:c});if(y=oi(y,a),jr===null?jr=[y]:jr.push(y),ie!==4&&(ie=2),n===null)return!0;c=oi(c,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,i=m&-m,a.lanes|=i,i=Pu(a.stateNode,c,i),hu(a,i),!1;case 1:if(n=a.type,y=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(xs===null||!xs.has(y))))return a.flags|=65536,m&=-m,a.lanes|=m,m=lg(m),og(m,i,a,c),hu(a,m),!1}a=a.return}while(a!==null);return!1}var Uu=Error(s(461)),ue=!1;function Ae(i,n,a,c){n.child=i===null?hd(n,null,a,c):Js(n,i.child,a,c)}function ug(i,n,a,c,m){a=a.render;var y=n.ref;if("ref"in c){var T={};for(var R in c)R!=="ref"&&(T[R]=c[R])}else T=c;return Xs(n),c=vu(i,n,a,T,y,m),R=Eu(),i!==null&&!ue?(Su(i,n,m),Yi(i,n,m)):(Mt&&R&&Jo(n),n.flags|=1,Ae(i,n,c,m),n.child)}function cg(i,n,a,c,m){if(i===null){var y=a.type;return typeof y=="function"&&!Qo(y)&&y.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=y,fg(i,n,y,c,m)):(i=$a(a.type,null,c,n,n.mode,m),i.ref=n.ref,i.return=n,n.child=i)}if(y=i.child,!Ku(i,m)){var T=y.memoizedProps;if(a=a.compare,a=a!==null?a:br,a(T,c)&&i.ref===n.ref)return Yi(i,n,m)}return n.flags|=1,i=Gi(y,c),i.ref=n.ref,i.return=n,n.child=i}function fg(i,n,a,c,m){if(i!==null){var y=i.memoizedProps;if(br(y,c)&&i.ref===n.ref)if(ue=!1,n.pendingProps=c=y,Ku(i,m))(i.flags&131072)!==0&&(ue=!0);else return n.lanes=i.lanes,Yi(i,n,m)}return Bu(i,n,a,c,m)}function hg(i,n,a,c){var m=c.children,y=i!==null?i.memoizedState:null;if(i===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(y=y!==null?y.baseLanes|a:a,i!==null){for(c=n.child=i.child,m=0;c!==null;)m=m|c.lanes|c.childLanes,c=c.sibling;c=m&~y}else c=0,n.child=null;return dg(i,n,y,a,c)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&za(n,y!==null?y.cachePool:null),y!==null?md(n,y):gu(),pd(n);else return c=n.lanes=536870912,dg(i,n,y!==null?y.baseLanes|a:a,a,c)}else y!==null?(za(n,y.cachePool),md(n,y),vs(),n.memoizedState=null):(i!==null&&za(n,null),gu(),vs());return Ae(i,n,m,a),n.child}function Fr(i,n){return i!==null&&i.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function dg(i,n,a,c,m){var y=ou();return y=y===null?null:{parent:le._currentValue,pool:y},n.memoizedState={baseLanes:a,cachePool:y},i!==null&&za(n,null),gu(),pd(n),i!==null&&In(i,n,c,!0),n.childLanes=m,null}function al(i,n){return n=ol({mode:n.mode,children:n.children},i.mode),n.ref=i.ref,i.child=n,n.return=i,n}function gg(i,n,a){return Js(n,i.child,null,a),i=al(n,n.pendingProps),i.flags|=2,qe(n),n.memoizedState=null,i}function LE(i,n,a){var c=n.pendingProps,m=(n.flags&128)!==0;if(n.flags&=-129,i===null){if(Mt){if(c.mode==="hidden")return i=al(n,c),n.lanes=536870912,Fr(null,i);if(pu(n),(i=Xt)?(i=R0(i,fi),i=i!==null&&i.data==="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:cs!==null?{id:Li,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},a=Wh(i),a.return=n,n.child=a,Te=n,Xt=null)):i=null,i===null)throw hs(n);return n.lanes=536870912,null}return al(n,c)}var y=i.memoizedState;if(y!==null){var T=y.dehydrated;if(pu(n),m)if(n.flags&256)n.flags&=-257,n=gg(i,n,a);else if(n.memoizedState!==null)n.child=i.child,n.flags|=128,n=null;else throw Error(s(558));else if(ue||In(i,n,a,!1),m=(a&i.childLanes)!==0,ue||m){if(c=jt,c!==null&&(T=nh(c,a),T!==0&&T!==y.retryLane))throw y.retryLane=T,Ks(i,T),$e(c,i,T),Uu;yl(),n=gg(i,n,a)}else i=y.treeContext,Xt=di(T.nextSibling),Te=n,Mt=!0,fs=null,fi=!1,i!==null&&td(n,i),n=al(n,c),n.flags|=4096;return n}return i=Gi(i.child,{mode:c.mode,children:c.children}),i.ref=n.ref,n.child=i,i.return=n,i}function ll(i,n){var a=n.ref;if(a===null)i!==null&&i.ref!==null&&(n.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(s(284));(i===null||i.ref!==a)&&(n.flags|=4194816)}}function Bu(i,n,a,c,m){return Xs(n),a=vu(i,n,a,c,void 0,m),c=Eu(),i!==null&&!ue?(Su(i,n,m),Yi(i,n,m)):(Mt&&c&&Jo(n),n.flags|=1,Ae(i,n,a,m),n.child)}function mg(i,n,a,c,m,y){return Xs(n),n.updateQueue=null,a=vd(n,c,a,m),yd(i),c=Eu(),i!==null&&!ue?(Su(i,n,y),Yi(i,n,y)):(Mt&&c&&Jo(n),n.flags|=1,Ae(i,n,a,y),n.child)}function pg(i,n,a,c,m){if(Xs(n),n.stateNode===null){var y=Ln,T=a.contextType;typeof T=="object"&&T!==null&&(y=xe(T)),y=new a(c,y),n.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Nu,n.stateNode=y,y._reactInternals=n,y=n.stateNode,y.props=c,y.state=n.memoizedState,y.refs={},cu(n),T=a.contextType,y.context=typeof T=="object"&&T!==null?xe(T):Ln,y.state=n.memoizedState,T=a.getDerivedStateFromProps,typeof T=="function"&&(wu(n,a,T,c),y.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(T=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),T!==y.state&&Nu.enqueueReplaceState(y,y.state,null),wr(n,c,y,m),kr(),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(i===null){y=n.stateNode;var R=n.memoizedProps,M=en(a,R);y.props=M;var j=y.context,W=a.contextType;T=Ln,typeof W=="object"&&W!==null&&(T=xe(W));var et=a.getDerivedStateFromProps;W=typeof et=="function"||typeof y.getSnapshotBeforeUpdate=="function",R=n.pendingProps!==R,W||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(R||j!==T)&&ig(n,y,c,T),gs=!1;var Y=n.memoizedState;y.state=Y,wr(n,c,y,m),kr(),j=n.memoizedState,R||Y!==j||gs?(typeof et=="function"&&(wu(n,a,et,c),j=n.memoizedState),(M=gs||eg(n,a,M,c,Y,j,T))?(W||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(n.flags|=4194308)):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=j),y.props=c,y.state=j,y.context=T,c=M):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{y=n.stateNode,fu(i,n),T=n.memoizedProps,W=en(a,T),y.props=W,et=n.pendingProps,Y=y.context,j=a.contextType,M=Ln,typeof j=="object"&&j!==null&&(M=xe(j)),R=a.getDerivedStateFromProps,(j=typeof R=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==et||Y!==M)&&ig(n,y,c,M),gs=!1,Y=n.memoizedState,y.state=Y,wr(n,c,y,m),kr();var q=n.memoizedState;T!==et||Y!==q||gs||i!==null&&i.dependencies!==null&&Ha(i.dependencies)?(typeof R=="function"&&(wu(n,a,R,c),q=n.memoizedState),(W=gs||eg(n,a,W,c,Y,q,M)||i!==null&&i.dependencies!==null&&Ha(i.dependencies))?(j||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(c,q,M),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(c,q,M)),typeof y.componentDidUpdate=="function"&&(n.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=q),y.props=c,y.state=q,y.context=M,c=W):(typeof y.componentDidUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=1024),c=!1)}return y=c,ll(i,n),c=(n.flags&128)!==0,y||c?(y=n.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:y.render(),n.flags|=1,i!==null&&c?(n.child=Js(n,i.child,null,m),n.child=Js(n,null,a,m)):Ae(i,n,a,m),n.memoizedState=y.state,i=n.child):i=Yi(i,n,m),i}function yg(i,n,a,c){return Ys(),n.flags|=256,Ae(i,n,a,c),n.child}var Fu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $u(i){return{baseLanes:i,cachePool:ad()}}function Gu(i,n,a){return i=i!==null?i.childLanes&~a:0,n&&(i|=Qe),i}function vg(i,n,a){var c=n.pendingProps,m=!1,y=(n.flags&128)!==0,T;if((T=y)||(T=i!==null&&i.memoizedState===null?!1:(ne.current&2)!==0),T&&(m=!0,n.flags&=-129),T=(n.flags&32)!==0,n.flags&=-33,i===null){if(Mt){if(m?ys(n):vs(),(i=Xt)?(i=R0(i,fi),i=i!==null&&i.data!=="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:cs!==null?{id:Li,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},a=Wh(i),a.return=n,n.child=a,Te=n,Xt=null)):i=null,i===null)throw hs(n);return Ac(i)?n.lanes=32:n.lanes=536870912,null}var R=c.children;return c=c.fallback,m?(vs(),m=n.mode,R=ol({mode:"hidden",children:R},m),c=js(c,m,a,null),R.return=n,c.return=n,R.sibling=c,n.child=R,c=n.child,c.memoizedState=$u(a),c.childLanes=Gu(i,T,a),n.memoizedState=Fu,Fr(null,c)):(ys(n),Hu(n,R))}var M=i.memoizedState;if(M!==null&&(R=M.dehydrated,R!==null)){if(y)n.flags&256?(ys(n),n.flags&=-257,n=Vu(i,n,a)):n.memoizedState!==null?(vs(),n.child=i.child,n.flags|=128,n=null):(vs(),R=c.fallback,m=n.mode,c=ol({mode:"visible",children:c.children},m),R=js(R,m,a,null),R.flags|=2,c.return=n,R.return=n,c.sibling=R,n.child=c,Js(n,i.child,null,a),c=n.child,c.memoizedState=$u(a),c.childLanes=Gu(i,T,a),n.memoizedState=Fu,n=Fr(null,c));else if(ys(n),Ac(R)){if(T=R.nextSibling&&R.nextSibling.dataset,T)var j=T.dgst;T=j,c=Error(s(419)),c.stack="",c.digest=T,_r({value:c,source:null,stack:null}),n=Vu(i,n,a)}else if(ue||In(i,n,a,!1),T=(a&i.childLanes)!==0,ue||T){if(T=jt,T!==null&&(c=nh(T,a),c!==0&&c!==M.retryLane))throw M.retryLane=c,Ks(i,c),$e(T,i,c),Uu;xc(R)||yl(),n=Vu(i,n,a)}else xc(R)?(n.flags|=192,n.child=i.child,n=null):(i=M.treeContext,Xt=di(R.nextSibling),Te=n,Mt=!0,fs=null,fi=!1,i!==null&&td(n,i),n=Hu(n,c.children),n.flags|=4096);return n}return m?(vs(),R=c.fallback,m=n.mode,M=i.child,j=M.sibling,c=Gi(M,{mode:"hidden",children:c.children}),c.subtreeFlags=M.subtreeFlags&65011712,j!==null?R=Gi(j,R):(R=js(R,m,a,null),R.flags|=2),R.return=n,c.return=n,c.sibling=R,n.child=c,Fr(null,c),c=n.child,R=i.child.memoizedState,R===null?R=$u(a):(m=R.cachePool,m!==null?(M=le._currentValue,m=m.parent!==M?{parent:M,pool:M}:m):m=ad(),R={baseLanes:R.baseLanes|a,cachePool:m}),c.memoizedState=R,c.childLanes=Gu(i,T,a),n.memoizedState=Fu,Fr(i.child,c)):(ys(n),a=i.child,i=a.sibling,a=Gi(a,{mode:"visible",children:c.children}),a.return=n,a.sibling=null,i!==null&&(T=n.deletions,T===null?(n.deletions=[i],n.flags|=16):T.push(i)),n.child=a,n.memoizedState=null,a)}function Hu(i,n){return n=ol({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function ol(i,n){return i=je(22,i,null,n),i.lanes=0,i}function Vu(i,n,a){return Js(n,i.child,null,a),i=Hu(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function Eg(i,n,a){i.lanes|=n;var c=i.alternate;c!==null&&(c.lanes|=n),nu(i.return,n,a)}function zu(i,n,a,c,m,y){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:m,treeForkCount:y}:(T.isBackwards=n,T.rendering=null,T.renderingStartTime=0,T.last=c,T.tail=a,T.tailMode=m,T.treeForkCount=y)}function Sg(i,n,a){var c=n.pendingProps,m=c.revealOrder,y=c.tail;c=c.children;var T=ne.current,R=(T&2)!==0;if(R?(T=T&1|2,n.flags|=128):T&=1,it(ne,T),Ae(i,n,c,a),c=Mt?Rr:0,!R&&i!==null&&(i.flags&128)!==0)t:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Eg(i,a,n);else if(i.tag===19)Eg(i,a,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break t;for(;i.sibling===null;){if(i.return===null||i.return===n)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(m){case"forwards":for(a=n.child,m=null;a!==null;)i=a.alternate,i!==null&&Qa(i)===null&&(m=a),a=a.sibling;a=m,a===null?(m=n.child,n.child=null):(m=a.sibling,a.sibling=null),zu(n,!1,m,a,y,c);break;case"backwards":case"unstable_legacy-backwards":for(a=null,m=n.child,n.child=null;m!==null;){if(i=m.alternate,i!==null&&Qa(i)===null){n.child=m;break}i=m.sibling,m.sibling=a,a=m,m=i}zu(n,!0,a,null,y,c);break;case"together":zu(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function Yi(i,n,a){if(i!==null&&(n.dependencies=i.dependencies),Ts|=n.lanes,(a&n.childLanes)===0)if(i!==null){if(In(i,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(s(153));if(n.child!==null){for(i=n.child,a=Gi(i,i.pendingProps),n.child=a,a.return=n;i.sibling!==null;)i=i.sibling,a=a.sibling=Gi(i,i.pendingProps),a.return=n;a.sibling=null}return n.child}function Ku(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&Ha(i)))}function RE(i,n,a){switch(n.tag){case 3:wt(n,n.stateNode.containerInfo),ds(n,le,i.memoizedState.cache),Ys();break;case 27:case 5:De(n);break;case 4:wt(n,n.stateNode.containerInfo);break;case 10:ds(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,pu(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(ys(n),n.flags|=128,null):(a&n.child.childLanes)!==0?vg(i,n,a):(ys(n),i=Yi(i,n,a),i!==null?i.sibling:null);ys(n);break;case 19:var m=(i.flags&128)!==0;if(c=(a&n.childLanes)!==0,c||(In(i,n,a,!1),c=(a&n.childLanes)!==0),m){if(c)return Sg(i,n,a);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),it(ne,ne.current),c)break;return null;case 22:return n.lanes=0,hg(i,n,a,n.pendingProps);case 24:ds(n,le,i.memoizedState.cache)}return Yi(i,n,a)}function Tg(i,n,a){if(i!==null)if(i.memoizedProps!==n.pendingProps)ue=!0;else{if(!Ku(i,a)&&(n.flags&128)===0)return ue=!1,RE(i,n,a);ue=(i.flags&131072)!==0}else ue=!1,Mt&&(n.flags&1048576)!==0&&Jh(n,Rr,n.index);switch(n.lanes=0,n.tag){case 16:t:{var c=n.pendingProps;if(i=Ws(n.elementType),n.type=i,typeof i=="function")Qo(i)?(c=en(i,c),n.tag=1,n=pg(null,n,i,c,a)):(n.tag=0,n=Bu(null,n,i,c,a));else{if(i!=null){var m=i.$$typeof;if(m===C){n.tag=11,n=ug(null,n,i,c,a);break t}else if(m===O){n.tag=14,n=cg(null,n,i,c,a);break t}}throw n=ht(i)||i,Error(s(306,n,""))}}return n;case 0:return Bu(i,n,n.type,n.pendingProps,a);case 1:return c=n.type,m=en(c,n.pendingProps),pg(i,n,c,m,a);case 3:t:{if(wt(n,n.stateNode.containerInfo),i===null)throw Error(s(387));c=n.pendingProps;var y=n.memoizedState;m=y.element,fu(i,n),wr(n,c,null,a);var T=n.memoizedState;if(c=T.cache,ds(n,le,c),c!==y.cache&&ru(n,[le],a,!0),kr(),c=T.element,y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:T.cache},n.updateQueue.baseState=y,n.memoizedState=y,n.flags&256){n=yg(i,n,c,a);break t}else if(c!==m){m=oi(Error(s(424)),n),_r(m),n=yg(i,n,c,a);break t}else{switch(i=n.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Xt=di(i.firstChild),Te=n,Mt=!0,fs=null,fi=!0,a=hd(n,null,c,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(Ys(),c===m){n=Yi(i,n,a);break t}Ae(i,n,c,a)}n=n.child}return n;case 26:return ll(i,n),i===null?(a=M0(n.type,null,n.pendingProps,null))?n.memoizedState=a:Mt||(a=n.type,i=n.pendingProps,c=bl(ft.current).createElement(a),c[Se]=n,c[we]=i,be(c,a,i),pe(c),n.stateNode=c):n.memoizedState=M0(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return De(n),i===null&&Mt&&(c=n.stateNode=I0(n.type,n.pendingProps,ft.current),Te=n,fi=!0,m=Xt,Rs(n.type)?(bc=m,Xt=di(c.firstChild)):Xt=m),Ae(i,n,n.pendingProps.children,a),ll(i,n),i===null&&(n.flags|=4194304),n.child;case 5:return i===null&&Mt&&((m=c=Xt)&&(c=iS(c,n.type,n.pendingProps,fi),c!==null?(n.stateNode=c,Te=n,Xt=di(c.firstChild),fi=!1,m=!0):m=!1),m||hs(n)),De(n),m=n.type,y=n.pendingProps,T=i!==null?i.memoizedProps:null,c=y.children,Ec(m,y)?c=null:T!==null&&Ec(m,T)&&(n.flags|=32),n.memoizedState!==null&&(m=vu(i,n,yE,null,null,a),ta._currentValue=m),ll(i,n),Ae(i,n,c,a),n.child;case 6:return i===null&&Mt&&((i=a=Xt)&&(a=sS(a,n.pendingProps,fi),a!==null?(n.stateNode=a,Te=n,Xt=null,i=!0):i=!1),i||hs(n)),null;case 13:return vg(i,n,a);case 4:return wt(n,n.stateNode.containerInfo),c=n.pendingProps,i===null?n.child=Js(n,null,c,a):Ae(i,n,c,a),n.child;case 11:return ug(i,n,n.type,n.pendingProps,a);case 7:return Ae(i,n,n.pendingProps,a),n.child;case 8:return Ae(i,n,n.pendingProps.children,a),n.child;case 12:return Ae(i,n,n.pendingProps.children,a),n.child;case 10:return c=n.pendingProps,ds(n,n.type,c.value),Ae(i,n,c.children,a),n.child;case 9:return m=n.type._context,c=n.pendingProps.children,Xs(n),m=xe(m),c=c(m),n.flags|=1,Ae(i,n,c,a),n.child;case 14:return cg(i,n,n.type,n.pendingProps,a);case 15:return fg(i,n,n.type,n.pendingProps,a);case 19:return Sg(i,n,a);case 31:return LE(i,n,a);case 22:return hg(i,n,a,n.pendingProps);case 24:return Xs(n),c=xe(le),i===null?(m=ou(),m===null&&(m=jt,y=au(),m.pooledCache=y,y.refCount++,y!==null&&(m.pooledCacheLanes|=a),m=y),n.memoizedState={parent:c,cache:m},cu(n),ds(n,le,m)):((i.lanes&a)!==0&&(fu(i,n),wr(n,null,null,a),kr()),m=i.memoizedState,y=n.memoizedState,m.parent!==c?(m={parent:c,cache:c},n.memoizedState=m,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=m),ds(n,le,c)):(c=y.cache,ds(n,le,c),c!==m.cache&&ru(n,[le],a,!0))),Ae(i,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function qi(i){i.flags|=4}function ju(i,n,a,c,m){if((n=(i.mode&32)!==0)&&(n=!1),n){if(i.flags|=16777216,(m&335544128)===m)if(i.stateNode.complete)i.flags|=8192;else if(qg())i.flags|=8192;else throw Zs=ja,uu}else i.flags&=-16777217}function xg(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!U0(n))if(qg())i.flags|=8192;else throw Zs=ja,uu}function ul(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?eh():536870912,i.lanes|=n,Gn|=n)}function $r(i,n){if(!Mt)switch(i.tailMode){case"hidden":n=i.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?i.tail=null:a.sibling=null;break;case"collapsed":a=i.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:c.sibling=null}}function Qt(i){var n=i.alternate!==null&&i.alternate.child===i.child,a=0,c=0;if(n)for(var m=i.child;m!==null;)a|=m.lanes|m.childLanes,c|=m.subtreeFlags&65011712,c|=m.flags&65011712,m.return=i,m=m.sibling;else for(m=i.child;m!==null;)a|=m.lanes|m.childLanes,c|=m.subtreeFlags,c|=m.flags,m.return=i,m=m.sibling;return i.subtreeFlags|=c,i.childLanes=a,n}function _E(i,n,a){var c=n.pendingProps;switch(tu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(n),null;case 1:return Qt(n),null;case 3:return a=n.stateNode,c=null,i!==null&&(c=i.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),zi(le),kt(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(i===null||i.child===null)&&(Dn(n)?qi(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,iu())),Qt(n),null;case 26:var m=n.type,y=n.memoizedState;return i===null?(qi(n),y!==null?(Qt(n),xg(n,y)):(Qt(n),ju(n,m,null,c,a))):y?y!==i.memoizedState?(qi(n),Qt(n),xg(n,y)):(Qt(n),n.flags&=-16777217):(i=i.memoizedProps,i!==c&&qi(n),Qt(n),ju(n,m,i,c,a)),null;case 27:if(ni(n),a=ft.current,m=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&qi(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return Qt(n),null}i=nt.current,Dn(n)?ed(n):(i=I0(m,c,a),n.stateNode=i,qi(n))}return Qt(n),null;case 5:if(ni(n),m=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&qi(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return Qt(n),null}if(y=nt.current,Dn(n))ed(n);else{var T=bl(ft.current);switch(y){case 1:y=T.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:y=T.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":y=T.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":y=T.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":y=T.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof c.is=="string"?T.createElement("select",{is:c.is}):T.createElement("select"),c.multiple?y.multiple=!0:c.size&&(y.size=c.size);break;default:y=typeof c.is=="string"?T.createElement(m,{is:c.is}):T.createElement(m)}}y[Se]=n,y[we]=c;t:for(T=n.child;T!==null;){if(T.tag===5||T.tag===6)y.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===n)break t;for(;T.sibling===null;){if(T.return===null||T.return===n)break t;T=T.return}T.sibling.return=T.return,T=T.sibling}n.stateNode=y;t:switch(be(y,m,c),m){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break t;case"img":c=!0;break t;default:c=!1}c&&qi(n)}}return Qt(n),ju(n,n.type,i===null?null:i.memoizedProps,n.pendingProps,a),null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==c&&qi(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(s(166));if(i=ft.current,Dn(n)){if(i=n.stateNode,a=n.memoizedProps,c=null,m=Te,m!==null)switch(m.tag){case 27:case 5:c=m.memoizedProps}i[Se]=n,i=!!(i.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||v0(i.nodeValue,a)),i||hs(n,!0)}else i=bl(i).createTextNode(c),i[Se]=n,n.stateNode=i}return Qt(n),null;case 31:if(a=n.memoizedState,i===null||i.memoizedState!==null){if(c=Dn(n),a!==null){if(i===null){if(!c)throw Error(s(318));if(i=n.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(557));i[Se]=n}else Ys(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Qt(n),i=!1}else a=iu(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=a),i=!0;if(!i)return n.flags&256?(qe(n),n):(qe(n),null);if((n.flags&128)!==0)throw Error(s(558))}return Qt(n),null;case 13:if(c=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(m=Dn(n),c!==null&&c.dehydrated!==null){if(i===null){if(!m)throw Error(s(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(s(317));m[Se]=n}else Ys(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Qt(n),m=!1}else m=iu(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=m),m=!0;if(!m)return n.flags&256?(qe(n),n):(qe(n),null)}return qe(n),(n.flags&128)!==0?(n.lanes=a,n):(a=c!==null,i=i!==null&&i.memoizedState!==null,a&&(c=n.child,m=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(m=c.alternate.memoizedState.cachePool.pool),y=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),y!==m&&(c.flags|=2048)),a!==i&&a&&(n.child.flags|=8192),ul(n,n.updateQueue),Qt(n),null);case 4:return kt(),i===null&&gc(n.stateNode.containerInfo),Qt(n),null;case 10:return zi(n.type),Qt(n),null;case 19:if(P(ne),c=n.memoizedState,c===null)return Qt(n),null;if(m=(n.flags&128)!==0,y=c.rendering,y===null)if(m)$r(c,!1);else{if(ie!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(y=Qa(i),y!==null){for(n.flags|=128,$r(c,!1),i=y.updateQueue,n.updateQueue=i,ul(n,i),n.subtreeFlags=0,i=a,a=n.child;a!==null;)Qh(a,i),a=a.sibling;return it(ne,ne.current&1|2),Mt&&Hi(n,c.treeForkCount),n.child}i=i.sibling}c.tail!==null&&me()>gl&&(n.flags|=128,m=!0,$r(c,!1),n.lanes=4194304)}else{if(!m)if(i=Qa(y),i!==null){if(n.flags|=128,m=!0,i=i.updateQueue,n.updateQueue=i,ul(n,i),$r(c,!0),c.tail===null&&c.tailMode==="hidden"&&!y.alternate&&!Mt)return Qt(n),null}else 2*me()-c.renderingStartTime>gl&&a!==536870912&&(n.flags|=128,m=!0,$r(c,!1),n.lanes=4194304);c.isBackwards?(y.sibling=n.child,n.child=y):(i=c.last,i!==null?i.sibling=y:n.child=y,c.last=y)}return c.tail!==null?(i=c.tail,c.rendering=i,c.tail=i.sibling,c.renderingStartTime=me(),i.sibling=null,a=ne.current,it(ne,m?a&1|2:a&1),Mt&&Hi(n,c.treeForkCount),i):(Qt(n),null);case 22:case 23:return qe(n),mu(),c=n.memoizedState!==null,i!==null?i.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(a&536870912)!==0&&(n.flags&128)===0&&(Qt(n),n.subtreeFlags&6&&(n.flags|=8192)):Qt(n),a=n.updateQueue,a!==null&&ul(n,a.retryQueue),a=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==a&&(n.flags|=2048),i!==null&&P(Qs),null;case 24:return a=null,i!==null&&(a=i.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),zi(le),Qt(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function DE(i,n){switch(tu(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return zi(le),kt(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return ni(n),null;case 31:if(n.memoizedState!==null){if(qe(n),n.alternate===null)throw Error(s(340));Ys()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 13:if(qe(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(s(340));Ys()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return P(ne),null;case 4:return kt(),null;case 10:return zi(n.type),null;case 22:case 23:return qe(n),mu(),i!==null&&P(Qs),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return zi(le),null;case 25:return null;default:return null}}function Ag(i,n){switch(tu(n),n.tag){case 3:zi(le),kt();break;case 26:case 27:case 5:ni(n);break;case 4:kt();break;case 31:n.memoizedState!==null&&qe(n);break;case 13:qe(n);break;case 19:P(ne);break;case 10:zi(n.type);break;case 22:case 23:qe(n),mu(),i!==null&&P(Qs);break;case 24:zi(le)}}function Gr(i,n){try{var a=n.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var m=c.next;a=m;do{if((a.tag&i)===i){c=void 0;var y=a.create,T=a.inst;c=y(),T.destroy=c}a=a.next}while(a!==m)}}catch(R){Ft(n,n.return,R)}}function Es(i,n,a){try{var c=n.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var y=m.next;c=y;do{if((c.tag&i)===i){var T=c.inst,R=T.destroy;if(R!==void 0){T.destroy=void 0,m=n;var M=a,j=R;try{j()}catch(W){Ft(m,M,W)}}}c=c.next}while(c!==y)}}catch(W){Ft(n,n.return,W)}}function bg(i){var n=i.updateQueue;if(n!==null){var a=i.stateNode;try{gd(n,a)}catch(c){Ft(i,i.return,c)}}}function Lg(i,n,a){a.props=en(i.type,i.memoizedProps),a.state=i.memoizedState;try{a.componentWillUnmount()}catch(c){Ft(i,n,c)}}function Hr(i,n){try{var a=i.ref;if(a!==null){switch(i.tag){case 26:case 27:case 5:var c=i.stateNode;break;case 30:c=i.stateNode;break;default:c=i.stateNode}typeof a=="function"?i.refCleanup=a(c):a.current=c}}catch(m){Ft(i,n,m)}}function _i(i,n){var a=i.ref,c=i.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(m){Ft(i,n,m)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(m){Ft(i,n,m)}else a.current=null}function Rg(i){var n=i.type,a=i.memoizedProps,c=i.stateNode;try{t:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break t;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(m){Ft(i,i.return,m)}}function Yu(i,n,a){try{var c=i.stateNode;QE(c,i.type,a,n),c[we]=n}catch(m){Ft(i,i.return,m)}}function _g(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Rs(i.type)||i.tag===4}function qu(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||_g(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Rs(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Xu(i,n,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(i,n):(n=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,n.appendChild(i),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=Fi));else if(c!==4&&(c===27&&Rs(i.type)&&(a=i.stateNode,n=null),i=i.child,i!==null))for(Xu(i,n,a),i=i.sibling;i!==null;)Xu(i,n,a),i=i.sibling}function cl(i,n,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?a.insertBefore(i,n):a.appendChild(i);else if(c!==4&&(c===27&&Rs(i.type)&&(a=i.stateNode),i=i.child,i!==null))for(cl(i,n,a),i=i.sibling;i!==null;)cl(i,n,a),i=i.sibling}function Dg(i){var n=i.stateNode,a=i.memoizedProps;try{for(var c=i.type,m=n.attributes;m.length;)n.removeAttributeNode(m[0]);be(n,c,a),n[Se]=i,n[we]=a}catch(y){Ft(i,i.return,y)}}var Xi=!1,ce=!1,Qu=!1,Ig=typeof WeakSet=="function"?WeakSet:Set,ye=null;function IE(i,n){if(i=i.containerInfo,yc=Ol,i=Gh(i),Vo(i)){if("selectionStart"in i)var a={start:i.selectionStart,end:i.selectionEnd};else t:{a=(a=i.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var m=c.anchorOffset,y=c.focusNode;c=c.focusOffset;try{a.nodeType,y.nodeType}catch{a=null;break t}var T=0,R=-1,M=-1,j=0,W=0,et=i,Y=null;e:for(;;){for(var q;et!==a||m!==0&&et.nodeType!==3||(R=T+m),et!==y||c!==0&&et.nodeType!==3||(M=T+c),et.nodeType===3&&(T+=et.nodeValue.length),(q=et.firstChild)!==null;)Y=et,et=q;for(;;){if(et===i)break e;if(Y===a&&++j===m&&(R=T),Y===y&&++W===c&&(M=T),(q=et.nextSibling)!==null)break;et=Y,Y=et.parentNode}et=q}a=R===-1||M===-1?null:{start:R,end:M}}else a=null}a=a||{start:0,end:0}}else a=null;for(vc={focusedElem:i,selectionRange:a},Ol=!1,ye=n;ye!==null;)if(n=ye,i=n.child,(n.subtreeFlags&1028)!==0&&i!==null)i.return=n,ye=i;else for(;ye!==null;){switch(n=ye,y=n.alternate,i=n.flags,n.tag){case 0:if((i&4)!==0&&(i=n.updateQueue,i=i!==null?i.events:null,i!==null))for(a=0;a<i.length;a++)m=i[a],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&y!==null){i=void 0,a=n,m=y.memoizedProps,y=y.memoizedState,c=a.stateNode;try{var gt=en(a.type,m);i=c.getSnapshotBeforeUpdate(gt,y),c.__reactInternalSnapshotBeforeUpdate=i}catch(vt){Ft(a,a.return,vt)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,a=i.nodeType,a===9)Tc(i);else if(a===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Tc(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=n.sibling,i!==null){i.return=n.return,ye=i;break}ye=n.return}}function Cg(i,n,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:Wi(i,a),c&4&&Gr(5,a);break;case 1:if(Wi(i,a),c&4)if(i=a.stateNode,n===null)try{i.componentDidMount()}catch(T){Ft(a,a.return,T)}else{var m=en(a.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(m,n,i.__reactInternalSnapshotBeforeUpdate)}catch(T){Ft(a,a.return,T)}}c&64&&bg(a),c&512&&Hr(a,a.return);break;case 3:if(Wi(i,a),c&64&&(i=a.updateQueue,i!==null)){if(n=null,a.child!==null)switch(a.child.tag){case 27:case 5:n=a.child.stateNode;break;case 1:n=a.child.stateNode}try{gd(i,n)}catch(T){Ft(a,a.return,T)}}break;case 27:n===null&&c&4&&Dg(a);case 26:case 5:Wi(i,a),n===null&&c&4&&Rg(a),c&512&&Hr(a,a.return);break;case 12:Wi(i,a);break;case 31:Wi(i,a),c&4&&kg(i,a);break;case 13:Wi(i,a),c&4&&wg(i,a),c&64&&(i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(a=BE.bind(null,a),nS(i,a))));break;case 22:if(c=a.memoizedState!==null||Xi,!c){n=n!==null&&n.memoizedState!==null||ce,m=Xi;var y=ce;Xi=c,(ce=n)&&!y?Zi(i,a,(a.subtreeFlags&8772)!==0):Wi(i,a),Xi=m,ce=y}break;case 30:break;default:Wi(i,a)}}function Og(i){var n=i.alternate;n!==null&&(i.alternate=null,Og(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&Ro(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Wt=null,Pe=!1;function Qi(i,n,a){for(a=a.child;a!==null;)Mg(i,n,a),a=a.sibling}function Mg(i,n,a){if(Ve&&typeof Ve.onCommitFiberUnmount=="function")try{Ve.onCommitFiberUnmount(hr,a)}catch{}switch(a.tag){case 26:ce||_i(a,n),Qi(i,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:ce||_i(a,n);var c=Wt,m=Pe;Rs(a.type)&&(Wt=a.stateNode,Pe=!1),Qi(i,n,a),Wr(a.stateNode),Wt=c,Pe=m;break;case 5:ce||_i(a,n);case 6:if(c=Wt,m=Pe,Wt=null,Qi(i,n,a),Wt=c,Pe=m,Wt!==null)if(Pe)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(a.stateNode)}catch(y){Ft(a,n,y)}else try{Wt.removeChild(a.stateNode)}catch(y){Ft(a,n,y)}break;case 18:Wt!==null&&(Pe?(i=Wt,b0(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,a.stateNode),Xn(i)):b0(Wt,a.stateNode));break;case 4:c=Wt,m=Pe,Wt=a.stateNode.containerInfo,Pe=!0,Qi(i,n,a),Wt=c,Pe=m;break;case 0:case 11:case 14:case 15:Es(2,a,n),ce||Es(4,a,n),Qi(i,n,a);break;case 1:ce||(_i(a,n),c=a.stateNode,typeof c.componentWillUnmount=="function"&&Lg(a,n,c)),Qi(i,n,a);break;case 21:Qi(i,n,a);break;case 22:ce=(c=ce)||a.memoizedState!==null,Qi(i,n,a),ce=c;break;default:Qi(i,n,a)}}function kg(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Xn(i)}catch(a){Ft(n,n.return,a)}}}function wg(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Xn(i)}catch(a){Ft(n,n.return,a)}}function CE(i){switch(i.tag){case 31:case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new Ig),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new Ig),n;default:throw Error(s(435,i.tag))}}function fl(i,n){var a=CE(i);n.forEach(function(c){if(!a.has(c)){a.add(c);var m=FE.bind(null,i,c);c.then(m,m)}})}function Ue(i,n){var a=n.deletions;if(a!==null)for(var c=0;c<a.length;c++){var m=a[c],y=i,T=n,R=T;t:for(;R!==null;){switch(R.tag){case 27:if(Rs(R.type)){Wt=R.stateNode,Pe=!1;break t}break;case 5:Wt=R.stateNode,Pe=!1;break t;case 3:case 4:Wt=R.stateNode.containerInfo,Pe=!0;break t}R=R.return}if(Wt===null)throw Error(s(160));Mg(y,T,m),Wt=null,Pe=!1,y=m.alternate,y!==null&&(y.return=null),m.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)Ng(n,i),n=n.sibling}var Si=null;function Ng(i,n){var a=i.alternate,c=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Ue(n,i),Be(i),c&4&&(Es(3,i,i.return),Gr(3,i),Es(5,i,i.return));break;case 1:Ue(n,i),Be(i),c&512&&(ce||a===null||_i(a,a.return)),c&64&&Xi&&(i=i.updateQueue,i!==null&&(c=i.callbacks,c!==null&&(a=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var m=Si;if(Ue(n,i),Be(i),c&512&&(ce||a===null||_i(a,a.return)),c&4){var y=a!==null?a.memoizedState:null;if(c=i.memoizedState,a===null)if(c===null)if(i.stateNode===null){t:{c=i.type,a=i.memoizedProps,m=m.ownerDocument||m;e:switch(c){case"title":y=m.getElementsByTagName("title")[0],(!y||y[mr]||y[Se]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=m.createElement(c),m.head.insertBefore(y,m.querySelector("head > title"))),be(y,c,a),y[Se]=i,pe(y),c=y;break t;case"link":var T=N0("link","href",m).get(c+(a.href||""));if(T){for(var R=0;R<T.length;R++)if(y=T[R],y.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&y.getAttribute("rel")===(a.rel==null?null:a.rel)&&y.getAttribute("title")===(a.title==null?null:a.title)&&y.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){T.splice(R,1);break e}}y=m.createElement(c),be(y,c,a),m.head.appendChild(y);break;case"meta":if(T=N0("meta","content",m).get(c+(a.content||""))){for(R=0;R<T.length;R++)if(y=T[R],y.getAttribute("content")===(a.content==null?null:""+a.content)&&y.getAttribute("name")===(a.name==null?null:a.name)&&y.getAttribute("property")===(a.property==null?null:a.property)&&y.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&y.getAttribute("charset")===(a.charSet==null?null:a.charSet)){T.splice(R,1);break e}}y=m.createElement(c),be(y,c,a),m.head.appendChild(y);break;default:throw Error(s(468,c))}y[Se]=i,pe(y),c=y}i.stateNode=c}else P0(m,i.type,i.stateNode);else i.stateNode=w0(m,c,i.memoizedProps);else y!==c?(y===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):y.count--,c===null?P0(m,i.type,i.stateNode):w0(m,c,i.memoizedProps)):c===null&&i.stateNode!==null&&Yu(i,i.memoizedProps,a.memoizedProps)}break;case 27:Ue(n,i),Be(i),c&512&&(ce||a===null||_i(a,a.return)),a!==null&&c&4&&Yu(i,i.memoizedProps,a.memoizedProps);break;case 5:if(Ue(n,i),Be(i),c&512&&(ce||a===null||_i(a,a.return)),i.flags&32){m=i.stateNode;try{vn(m,"")}catch(gt){Ft(i,i.return,gt)}}c&4&&i.stateNode!=null&&(m=i.memoizedProps,Yu(i,m,a!==null?a.memoizedProps:m)),c&1024&&(Qu=!0);break;case 6:if(Ue(n,i),Be(i),c&4){if(i.stateNode===null)throw Error(s(162));c=i.memoizedProps,a=i.stateNode;try{a.nodeValue=c}catch(gt){Ft(i,i.return,gt)}}break;case 3:if(_l=null,m=Si,Si=Ll(n.containerInfo),Ue(n,i),Si=m,Be(i),c&4&&a!==null&&a.memoizedState.isDehydrated)try{Xn(n.containerInfo)}catch(gt){Ft(i,i.return,gt)}Qu&&(Qu=!1,Pg(i));break;case 4:c=Si,Si=Ll(i.stateNode.containerInfo),Ue(n,i),Be(i),Si=c;break;case 12:Ue(n,i),Be(i);break;case 31:Ue(n,i),Be(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,fl(i,c)));break;case 13:Ue(n,i),Be(i),i.child.flags&8192&&i.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(dl=me()),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,fl(i,c)));break;case 22:m=i.memoizedState!==null;var M=a!==null&&a.memoizedState!==null,j=Xi,W=ce;if(Xi=j||m,ce=W||M,Ue(n,i),ce=W,Xi=j,Be(i),c&8192)t:for(n=i.stateNode,n._visibility=m?n._visibility&-2:n._visibility|1,m&&(a===null||M||Xi||ce||sn(i)),a=null,n=i;;){if(n.tag===5||n.tag===26){if(a===null){M=a=n;try{if(y=M.stateNode,m)T=y.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{R=M.stateNode;var et=M.memoizedProps.style,Y=et!=null&&et.hasOwnProperty("display")?et.display:null;R.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(gt){Ft(M,M.return,gt)}}}else if(n.tag===6){if(a===null){M=n;try{M.stateNode.nodeValue=m?"":M.memoizedProps}catch(gt){Ft(M,M.return,gt)}}}else if(n.tag===18){if(a===null){M=n;try{var q=M.stateNode;m?L0(q,!0):L0(M.stateNode,!1)}catch(gt){Ft(M,M.return,gt)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break t;for(;n.sibling===null;){if(n.return===null||n.return===i)break t;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=i.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,fl(i,a))));break;case 19:Ue(n,i),Be(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,fl(i,c)));break;case 30:break;case 21:break;default:Ue(n,i),Be(i)}}function Be(i){var n=i.flags;if(n&2){try{for(var a,c=i.return;c!==null;){if(_g(c)){a=c;break}c=c.return}if(a==null)throw Error(s(160));switch(a.tag){case 27:var m=a.stateNode,y=qu(i);cl(i,y,m);break;case 5:var T=a.stateNode;a.flags&32&&(vn(T,""),a.flags&=-33);var R=qu(i);cl(i,R,T);break;case 3:case 4:var M=a.stateNode.containerInfo,j=qu(i);Xu(i,j,M);break;default:throw Error(s(161))}}catch(W){Ft(i,i.return,W)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function Pg(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;Pg(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function Wi(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)Cg(i,n.alternate,n),n=n.sibling}function sn(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:Es(4,n,n.return),sn(n);break;case 1:_i(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&Lg(n,n.return,a),sn(n);break;case 27:Wr(n.stateNode);case 26:case 5:_i(n,n.return),sn(n);break;case 22:n.memoizedState===null&&sn(n);break;case 30:sn(n);break;default:sn(n)}i=i.sibling}}function Zi(i,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,m=i,y=n,T=y.flags;switch(y.tag){case 0:case 11:case 15:Zi(m,y,a),Gr(4,y);break;case 1:if(Zi(m,y,a),c=y,m=c.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(j){Ft(c,c.return,j)}if(c=y,m=c.updateQueue,m!==null){var R=c.stateNode;try{var M=m.shared.hiddenCallbacks;if(M!==null)for(m.shared.hiddenCallbacks=null,m=0;m<M.length;m++)dd(M[m],R)}catch(j){Ft(c,c.return,j)}}a&&T&64&&bg(y),Hr(y,y.return);break;case 27:Dg(y);case 26:case 5:Zi(m,y,a),a&&c===null&&T&4&&Rg(y),Hr(y,y.return);break;case 12:Zi(m,y,a);break;case 31:Zi(m,y,a),a&&T&4&&kg(m,y);break;case 13:Zi(m,y,a),a&&T&4&&wg(m,y);break;case 22:y.memoizedState===null&&Zi(m,y,a),Hr(y,y.return);break;case 30:break;default:Zi(m,y,a)}n=n.sibling}}function Wu(i,n){var a=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==a&&(i!=null&&i.refCount++,a!=null&&Dr(a))}function Zu(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Dr(i))}function Ti(i,n,a,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Ug(i,n,a,c),n=n.sibling}function Ug(i,n,a,c){var m=n.flags;switch(n.tag){case 0:case 11:case 15:Ti(i,n,a,c),m&2048&&Gr(9,n);break;case 1:Ti(i,n,a,c);break;case 3:Ti(i,n,a,c),m&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Dr(i)));break;case 12:if(m&2048){Ti(i,n,a,c),i=n.stateNode;try{var y=n.memoizedProps,T=y.id,R=y.onPostCommit;typeof R=="function"&&R(T,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(M){Ft(n,n.return,M)}}else Ti(i,n,a,c);break;case 31:Ti(i,n,a,c);break;case 13:Ti(i,n,a,c);break;case 23:break;case 22:y=n.stateNode,T=n.alternate,n.memoizedState!==null?y._visibility&2?Ti(i,n,a,c):Vr(i,n):y._visibility&2?Ti(i,n,a,c):(y._visibility|=2,Bn(i,n,a,c,(n.subtreeFlags&10256)!==0||!1)),m&2048&&Wu(T,n);break;case 24:Ti(i,n,a,c),m&2048&&Zu(n.alternate,n);break;default:Ti(i,n,a,c)}}function Bn(i,n,a,c,m){for(m=m&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var y=i,T=n,R=a,M=c,j=T.flags;switch(T.tag){case 0:case 11:case 15:Bn(y,T,R,M,m),Gr(8,T);break;case 23:break;case 22:var W=T.stateNode;T.memoizedState!==null?W._visibility&2?Bn(y,T,R,M,m):Vr(y,T):(W._visibility|=2,Bn(y,T,R,M,m)),m&&j&2048&&Wu(T.alternate,T);break;case 24:Bn(y,T,R,M,m),m&&j&2048&&Zu(T.alternate,T);break;default:Bn(y,T,R,M,m)}n=n.sibling}}function Vr(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=i,c=n,m=c.flags;switch(c.tag){case 22:Vr(a,c),m&2048&&Wu(c.alternate,c);break;case 24:Vr(a,c),m&2048&&Zu(c.alternate,c);break;default:Vr(a,c)}n=n.sibling}}var zr=8192;function Fn(i,n,a){if(i.subtreeFlags&zr)for(i=i.child;i!==null;)Bg(i,n,a),i=i.sibling}function Bg(i,n,a){switch(i.tag){case 26:Fn(i,n,a),i.flags&zr&&i.memoizedState!==null&&pS(a,Si,i.memoizedState,i.memoizedProps);break;case 5:Fn(i,n,a);break;case 3:case 4:var c=Si;Si=Ll(i.stateNode.containerInfo),Fn(i,n,a),Si=c;break;case 22:i.memoizedState===null&&(c=i.alternate,c!==null&&c.memoizedState!==null?(c=zr,zr=16777216,Fn(i,n,a),zr=c):Fn(i,n,a));break;default:Fn(i,n,a)}}function Fg(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function Kr(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];ye=c,Gg(c,i)}Fg(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)$g(i),i=i.sibling}function $g(i){switch(i.tag){case 0:case 11:case 15:Kr(i),i.flags&2048&&Es(9,i,i.return);break;case 3:Kr(i);break;case 12:Kr(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&2&&(i.return===null||i.return.tag!==13)?(n._visibility&=-3,hl(i)):Kr(i);break;default:Kr(i)}}function hl(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var c=n[a];ye=c,Gg(c,i)}Fg(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:Es(8,n,n.return),hl(n);break;case 22:a=n.stateNode,a._visibility&2&&(a._visibility&=-3,hl(n));break;default:hl(n)}i=i.sibling}}function Gg(i,n){for(;ye!==null;){var a=ye;switch(a.tag){case 0:case 11:case 15:Es(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Dr(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,ye=c;else t:for(a=i;ye!==null;){c=ye;var m=c.sibling,y=c.return;if(Og(c),c===a){ye=null;break t}if(m!==null){m.return=y,ye=m;break t}ye=y}}}var OE={getCacheForType:function(i){var n=xe(le),a=n.data.get(i);return a===void 0&&(a=i(),n.data.set(i,a)),a},cacheSignal:function(){return xe(le).controller.signal}},ME=typeof WeakMap=="function"?WeakMap:Map,Ut=0,jt=null,_t=null,Ct=0,Bt=0,Xe=null,Ss=!1,$n=!1,Ju=!1,Ji=0,ie=0,Ts=0,nn=0,tc=0,Qe=0,Gn=0,jr=null,Fe=null,ec=!1,dl=0,Hg=0,gl=1/0,ml=null,xs=null,fe=0,As=null,Hn=null,ts=0,ic=0,sc=null,Vg=null,Yr=0,nc=null;function We(){return(Ut&2)!==0&&Ct!==0?Ct&-Ct:w.T!==null?cc():rh()}function zg(){if(Qe===0)if((Ct&536870912)===0||Mt){var i=Aa;Aa<<=1,(Aa&3932160)===0&&(Aa=262144),Qe=i}else Qe=536870912;return i=Ye.current,i!==null&&(i.flags|=32),Qe}function $e(i,n,a){(i===jt&&(Bt===2||Bt===9)||i.cancelPendingCommit!==null)&&(Vn(i,0),bs(i,Ct,Qe,!1)),gr(i,a),((Ut&2)===0||i!==jt)&&(i===jt&&((Ut&2)===0&&(nn|=a),ie===4&&bs(i,Ct,Qe,!1)),Di(i))}function Kg(i,n,a){if((Ut&6)!==0)throw Error(s(327));var c=!a&&(n&127)===0&&(n&i.expiredLanes)===0||dr(i,n),m=c?NE(i,n):ac(i,n,!0),y=c;do{if(m===0){$n&&!c&&bs(i,n,0,!1);break}else{if(a=i.current.alternate,y&&!kE(a)){m=ac(i,n,!1),y=!1;continue}if(m===2){if(y=n,i.errorRecoveryDisabledLanes&y)var T=0;else T=i.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){n=T;t:{var R=i;m=jr;var M=R.current.memoizedState.isDehydrated;if(M&&(Vn(R,T).flags|=256),T=ac(R,T,!1),T!==2){if(Ju&&!M){R.errorRecoveryDisabledLanes|=y,nn|=y,m=4;break t}y=Fe,Fe=m,y!==null&&(Fe===null?Fe=y:Fe.push.apply(Fe,y))}m=T}if(y=!1,m!==2)continue}}if(m===1){Vn(i,0),bs(i,n,0,!0);break}t:{switch(c=i,y=m,y){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:bs(c,n,Qe,!Ss);break t;case 2:Fe=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(m=dl+300-me(),10<m)){if(bs(c,n,Qe,!Ss),La(c,0,!0)!==0)break t;ts=n,c.timeoutHandle=x0(jg.bind(null,c,a,Fe,ml,ec,n,Qe,nn,Gn,Ss,y,"Throttled",-0,0),m);break t}jg(c,a,Fe,ml,ec,n,Qe,nn,Gn,Ss,y,null,-0,0)}}break}while(!0);Di(i)}function jg(i,n,a,c,m,y,T,R,M,j,W,et,Y,q){if(i.timeoutHandle=-1,et=n.subtreeFlags,et&8192||(et&16785408)===16785408){et={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fi},Bg(n,y,et);var gt=(y&62914560)===y?dl-me():(y&4194048)===y?Hg-me():0;if(gt=yS(et,gt),gt!==null){ts=y,i.cancelPendingCommit=gt(t0.bind(null,i,n,y,a,c,m,T,R,M,W,et,null,Y,q)),bs(i,y,T,!j);return}}t0(i,n,y,a,c,m,T,R,M)}function kE(i){for(var n=i;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var m=a[c],y=m.getSnapshot;m=m.value;try{if(!Ke(y(),m))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function bs(i,n,a,c){n&=~tc,n&=~nn,i.suspendedLanes|=n,i.pingedLanes&=~n,c&&(i.warmLanes|=n),c=i.expirationTimes;for(var m=n;0<m;){var y=31-ze(m),T=1<<y;c[y]=-1,m&=~T}a!==0&&ih(i,a,n)}function pl(){return(Ut&6)===0?(qr(0),!1):!0}function rc(){if(_t!==null){if(Bt===0)var i=_t.return;else i=_t,Vi=qs=null,Tu(i),kn=null,Cr=0,i=_t;for(;i!==null;)Ag(i.alternate,i),i=i.return;_t=null}}function Vn(i,n){var a=i.timeoutHandle;a!==-1&&(i.timeoutHandle=-1,JE(a)),a=i.cancelPendingCommit,a!==null&&(i.cancelPendingCommit=null,a()),ts=0,rc(),jt=i,_t=a=Gi(i.current,null),Ct=n,Bt=0,Xe=null,Ss=!1,$n=dr(i,n),Ju=!1,Gn=Qe=tc=nn=Ts=ie=0,Fe=jr=null,ec=!1,(n&8)!==0&&(n|=n&32);var c=i.entangledLanes;if(c!==0)for(i=i.entanglements,c&=n;0<c;){var m=31-ze(c),y=1<<m;n|=i[m],c&=~y}return Ji=n,Ua(),a}function Yg(i,n){At=null,w.H=Br,n===Mn||n===Ka?(n=ud(),Bt=3):n===uu?(n=ud(),Bt=4):Bt=n===Uu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Xe=n,_t===null&&(ie=1,rl(i,oi(n,i.current)))}function qg(){var i=Ye.current;return i===null?!0:(Ct&4194048)===Ct?hi===null:(Ct&62914560)===Ct||(Ct&536870912)!==0?i===hi:!1}function Xg(){var i=w.H;return w.H=Br,i===null?Br:i}function Qg(){var i=w.A;return w.A=OE,i}function yl(){ie=4,Ss||(Ct&4194048)!==Ct&&Ye.current!==null||($n=!0),(Ts&134217727)===0&&(nn&134217727)===0||jt===null||bs(jt,Ct,Qe,!1)}function ac(i,n,a){var c=Ut;Ut|=2;var m=Xg(),y=Qg();(jt!==i||Ct!==n)&&(ml=null,Vn(i,n)),n=!1;var T=ie;t:do try{if(Bt!==0&&_t!==null){var R=_t,M=Xe;switch(Bt){case 8:rc(),T=6;break t;case 3:case 2:case 9:case 6:Ye.current===null&&(n=!0);var j=Bt;if(Bt=0,Xe=null,zn(i,R,M,j),a&&$n){T=0;break t}break;default:j=Bt,Bt=0,Xe=null,zn(i,R,M,j)}}wE(),T=ie;break}catch(W){Yg(i,W)}while(!0);return n&&i.shellSuspendCounter++,Vi=qs=null,Ut=c,w.H=m,w.A=y,_t===null&&(jt=null,Ct=0,Ua()),T}function wE(){for(;_t!==null;)Wg(_t)}function NE(i,n){var a=Ut;Ut|=2;var c=Xg(),m=Qg();jt!==i||Ct!==n?(ml=null,gl=me()+500,Vn(i,n)):$n=dr(i,n);t:do try{if(Bt!==0&&_t!==null){n=_t;var y=Xe;e:switch(Bt){case 1:Bt=0,Xe=null,zn(i,n,y,1);break;case 2:case 9:if(ld(y)){Bt=0,Xe=null,Zg(n);break}n=function(){Bt!==2&&Bt!==9||jt!==i||(Bt=7),Di(i)},y.then(n,n);break t;case 3:Bt=7;break t;case 4:Bt=5;break t;case 7:ld(y)?(Bt=0,Xe=null,Zg(n)):(Bt=0,Xe=null,zn(i,n,y,7));break;case 5:var T=null;switch(_t.tag){case 26:T=_t.memoizedState;case 5:case 27:var R=_t;if(T?U0(T):R.stateNode.complete){Bt=0,Xe=null;var M=R.sibling;if(M!==null)_t=M;else{var j=R.return;j!==null?(_t=j,vl(j)):_t=null}break e}}Bt=0,Xe=null,zn(i,n,y,5);break;case 6:Bt=0,Xe=null,zn(i,n,y,6);break;case 8:rc(),ie=6;break t;default:throw Error(s(462))}}PE();break}catch(W){Yg(i,W)}while(!0);return Vi=qs=null,w.H=c,w.A=m,Ut=a,_t!==null?0:(jt=null,Ct=0,Ua(),ie)}function PE(){for(;_t!==null&&!Ui();)Wg(_t)}function Wg(i){var n=Tg(i.alternate,i,Ji);i.memoizedProps=i.pendingProps,n===null?vl(i):_t=n}function Zg(i){var n=i,a=n.alternate;switch(n.tag){case 15:case 0:n=mg(a,n,n.pendingProps,n.type,void 0,Ct);break;case 11:n=mg(a,n,n.pendingProps,n.type.render,n.ref,Ct);break;case 5:Tu(n);default:Ag(a,n),n=_t=Qh(n,Ji),n=Tg(a,n,Ji)}i.memoizedProps=i.pendingProps,n===null?vl(i):_t=n}function zn(i,n,a,c){Vi=qs=null,Tu(n),kn=null,Cr=0;var m=n.return;try{if(bE(i,m,n,a,Ct)){ie=1,rl(i,oi(a,i.current)),_t=null;return}}catch(y){if(m!==null)throw _t=m,y;ie=1,rl(i,oi(a,i.current)),_t=null;return}n.flags&32768?(Mt||c===1?i=!0:$n||(Ct&536870912)!==0?i=!1:(Ss=i=!0,(c===2||c===9||c===3||c===6)&&(c=Ye.current,c!==null&&c.tag===13&&(c.flags|=16384))),Jg(n,i)):vl(n)}function vl(i){var n=i;do{if((n.flags&32768)!==0){Jg(n,Ss);return}i=n.return;var a=_E(n.alternate,n,Ji);if(a!==null){_t=a;return}if(n=n.sibling,n!==null){_t=n;return}_t=n=i}while(n!==null);ie===0&&(ie=5)}function Jg(i,n){do{var a=DE(i.alternate,i);if(a!==null){a.flags&=32767,_t=a;return}if(a=i.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(i=i.sibling,i!==null)){_t=i;return}_t=i=a}while(i!==null);ie=6,_t=null}function t0(i,n,a,c,m,y,T,R,M){i.cancelPendingCommit=null;do El();while(fe!==0);if((Ut&6)!==0)throw Error(s(327));if(n!==null){if(n===i.current)throw Error(s(177));if(y=n.lanes|n.childLanes,y|=qo,mv(i,a,y,T,R,M),i===jt&&(_t=jt=null,Ct=0),Hn=n,As=i,ts=a,ic=y,sc=m,Vg=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,$E(fn,function(){return r0(),null})):(i.callbackNode=null,i.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=w.T,w.T=null,m=X.p,X.p=2,T=Ut,Ut|=4;try{IE(i,n,a)}finally{Ut=T,X.p=m,w.T=c}}fe=1,e0(),i0(),s0()}}function e0(){if(fe===1){fe=0;var i=As,n=Hn,a=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||a){a=w.T,w.T=null;var c=X.p;X.p=2;var m=Ut;Ut|=4;try{Ng(n,i);var y=vc,T=Gh(i.containerInfo),R=y.focusedElem,M=y.selectionRange;if(T!==R&&R&&R.ownerDocument&&$h(R.ownerDocument.documentElement,R)){if(M!==null&&Vo(R)){var j=M.start,W=M.end;if(W===void 0&&(W=j),"selectionStart"in R)R.selectionStart=j,R.selectionEnd=Math.min(W,R.value.length);else{var et=R.ownerDocument||document,Y=et&&et.defaultView||window;if(Y.getSelection){var q=Y.getSelection(),gt=R.textContent.length,vt=Math.min(M.start,gt),zt=M.end===void 0?vt:Math.min(M.end,gt);!q.extend&&vt>zt&&(T=zt,zt=vt,vt=T);var B=Fh(R,vt),N=Fh(R,zt);if(B&&N&&(q.rangeCount!==1||q.anchorNode!==B.node||q.anchorOffset!==B.offset||q.focusNode!==N.node||q.focusOffset!==N.offset)){var z=et.createRange();z.setStart(B.node,B.offset),q.removeAllRanges(),vt>zt?(q.addRange(z),q.extend(N.node,N.offset)):(z.setEnd(N.node,N.offset),q.addRange(z))}}}}for(et=[],q=R;q=q.parentNode;)q.nodeType===1&&et.push({element:q,left:q.scrollLeft,top:q.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<et.length;R++){var tt=et[R];tt.element.scrollLeft=tt.left,tt.element.scrollTop=tt.top}}Ol=!!yc,vc=yc=null}finally{Ut=m,X.p=c,w.T=a}}i.current=n,fe=2}}function i0(){if(fe===2){fe=0;var i=As,n=Hn,a=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||a){a=w.T,w.T=null;var c=X.p;X.p=2;var m=Ut;Ut|=4;try{Cg(i,n.alternate,n)}finally{Ut=m,X.p=c,w.T=a}}fe=3}}function s0(){if(fe===4||fe===3){fe=0,Ea();var i=As,n=Hn,a=ts,c=Vg;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?fe=5:(fe=0,Hn=As=null,n0(i,i.pendingLanes));var m=i.pendingLanes;if(m===0&&(xs=null),bo(a),n=n.stateNode,Ve&&typeof Ve.onCommitFiberRoot=="function")try{Ve.onCommitFiberRoot(hr,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=w.T,m=X.p,X.p=2,w.T=null;try{for(var y=i.onRecoverableError,T=0;T<c.length;T++){var R=c[T];y(R.value,{componentStack:R.stack})}}finally{w.T=n,X.p=m}}(ts&3)!==0&&El(),Di(i),m=i.pendingLanes,(a&261930)!==0&&(m&42)!==0?i===nc?Yr++:(Yr=0,nc=i):Yr=0,qr(0)}}function n0(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,Dr(n)))}function El(){return e0(),i0(),s0(),r0()}function r0(){if(fe!==5)return!1;var i=As,n=ic;ic=0;var a=bo(ts),c=w.T,m=X.p;try{X.p=32>a?32:a,w.T=null,a=sc,sc=null;var y=As,T=ts;if(fe=0,Hn=As=null,ts=0,(Ut&6)!==0)throw Error(s(331));var R=Ut;if(Ut|=4,$g(y.current),Ug(y,y.current,T,a),Ut=R,qr(0,!1),Ve&&typeof Ve.onPostCommitFiberRoot=="function")try{Ve.onPostCommitFiberRoot(hr,y)}catch{}return!0}finally{X.p=m,w.T=c,n0(i,n)}}function a0(i,n,a){n=oi(a,n),n=Pu(i.stateNode,n,2),i=ps(i,n,2),i!==null&&(gr(i,2),Di(i))}function Ft(i,n,a){if(i.tag===3)a0(i,i,a);else for(;n!==null;){if(n.tag===3){a0(n,i,a);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(xs===null||!xs.has(c))){i=oi(a,i),a=lg(2),c=ps(n,a,2),c!==null&&(og(a,c,n,i),gr(c,2),Di(c));break}}n=n.return}}function lc(i,n,a){var c=i.pingCache;if(c===null){c=i.pingCache=new ME;var m=new Set;c.set(n,m)}else m=c.get(n),m===void 0&&(m=new Set,c.set(n,m));m.has(a)||(Ju=!0,m.add(a),i=UE.bind(null,i,n,a),n.then(i,i))}function UE(i,n,a){var c=i.pingCache;c!==null&&c.delete(n),i.pingedLanes|=i.suspendedLanes&a,i.warmLanes&=~a,jt===i&&(Ct&a)===a&&(ie===4||ie===3&&(Ct&62914560)===Ct&&300>me()-dl?(Ut&2)===0&&Vn(i,0):tc|=a,Gn===Ct&&(Gn=0)),Di(i)}function l0(i,n){n===0&&(n=eh()),i=Ks(i,n),i!==null&&(gr(i,n),Di(i))}function BE(i){var n=i.memoizedState,a=0;n!==null&&(a=n.retryLane),l0(i,a)}function FE(i,n){var a=0;switch(i.tag){case 31:case 13:var c=i.stateNode,m=i.memoizedState;m!==null&&(a=m.retryLane);break;case 19:c=i.stateNode;break;case 22:c=i.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(n),l0(i,a)}function $E(i,n){return Oe(i,n)}var Sl=null,Kn=null,oc=!1,Tl=!1,uc=!1,Ls=0;function Di(i){i!==Kn&&i.next===null&&(Kn===null?Sl=Kn=i:Kn=Kn.next=i),Tl=!0,oc||(oc=!0,HE())}function qr(i,n){if(!uc&&Tl){uc=!0;do for(var a=!1,c=Sl;c!==null;){if(i!==0){var m=c.pendingLanes;if(m===0)var y=0;else{var T=c.suspendedLanes,R=c.pingedLanes;y=(1<<31-ze(42|i)+1)-1,y&=m&~(T&~R),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(a=!0,f0(c,y))}else y=Ct,y=La(c,c===jt?y:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(y&3)===0||dr(c,y)||(a=!0,f0(c,y));c=c.next}while(a);uc=!1}}function GE(){o0()}function o0(){Tl=oc=!1;var i=0;Ls!==0&&ZE()&&(i=Ls);for(var n=me(),a=null,c=Sl;c!==null;){var m=c.next,y=u0(c,n);y===0?(c.next=null,a===null?Sl=m:a.next=m,m===null&&(Kn=a)):(a=c,(i!==0||(y&3)!==0)&&(Tl=!0)),c=m}fe!==0&&fe!==5||qr(i),Ls!==0&&(Ls=0)}function u0(i,n){for(var a=i.suspendedLanes,c=i.pingedLanes,m=i.expirationTimes,y=i.pendingLanes&-62914561;0<y;){var T=31-ze(y),R=1<<T,M=m[T];M===-1?((R&a)===0||(R&c)!==0)&&(m[T]=gv(R,n)):M<=n&&(i.expiredLanes|=R),y&=~R}if(n=jt,a=Ct,a=La(i,i===n?a:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c=i.callbackNode,a===0||i===n&&(Bt===2||Bt===9)||i.cancelPendingCommit!==null)return c!==null&&c!==null&&bi(c),i.callbackNode=null,i.callbackPriority=0;if((a&3)===0||dr(i,a)){if(n=a&-a,n===i.callbackPriority)return n;switch(c!==null&&bi(c),bo(a)){case 2:case 8:a=cr;break;case 32:a=fn;break;case 268435456:a=fr;break;default:a=fn}return c=c0.bind(null,i),a=Oe(a,c),i.callbackPriority=n,i.callbackNode=a,n}return c!==null&&c!==null&&bi(c),i.callbackPriority=2,i.callbackNode=null,2}function c0(i,n){if(fe!==0&&fe!==5)return i.callbackNode=null,i.callbackPriority=0,null;var a=i.callbackNode;if(El()&&i.callbackNode!==a)return null;var c=Ct;return c=La(i,i===jt?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c===0?null:(Kg(i,c,n),u0(i,me()),i.callbackNode!=null&&i.callbackNode===a?c0.bind(null,i):null)}function f0(i,n){if(El())return null;Kg(i,n,!0)}function HE(){tS(function(){(Ut&6)!==0?Oe(as,GE):o0()})}function cc(){if(Ls===0){var i=Cn;i===0&&(i=xa,xa<<=1,(xa&261888)===0&&(xa=256)),Ls=i}return Ls}function h0(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Ia(""+i)}function d0(i,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,i.id&&a.setAttribute("form",i.id),n.parentNode.insertBefore(a,n),i=new FormData(i),a.parentNode.removeChild(a),i}function VE(i,n,a,c,m){if(n==="submit"&&a&&a.stateNode===m){var y=h0((m[we]||null).action),T=c.submitter;T&&(n=(n=T[we]||null)?h0(n.formAction):T.getAttribute("formAction"),n!==null&&(y=n,T=null));var R=new ka("action","action",null,c,m);i.push({event:R,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Ls!==0){var M=T?d0(m,T):new FormData(m);Cu(a,{pending:!0,data:M,method:m.method,action:y},null,M)}}else typeof y=="function"&&(R.preventDefault(),M=T?d0(m,T):new FormData(m),Cu(a,{pending:!0,data:M,method:m.method,action:y},y,M))},currentTarget:m}]})}}for(var fc=0;fc<Yo.length;fc++){var hc=Yo[fc],zE=hc.toLowerCase(),KE=hc[0].toUpperCase()+hc.slice(1);Ei(zE,"on"+KE)}Ei(zh,"onAnimationEnd"),Ei(Kh,"onAnimationIteration"),Ei(jh,"onAnimationStart"),Ei("dblclick","onDoubleClick"),Ei("focusin","onFocus"),Ei("focusout","onBlur"),Ei(lE,"onTransitionRun"),Ei(oE,"onTransitionStart"),Ei(uE,"onTransitionCancel"),Ei(Yh,"onTransitionEnd"),pn("onMouseEnter",["mouseout","mouseover"]),pn("onMouseLeave",["mouseout","mouseover"]),pn("onPointerEnter",["pointerout","pointerover"]),pn("onPointerLeave",["pointerout","pointerover"]),Gs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xr));function g0(i,n){n=(n&4)!==0;for(var a=0;a<i.length;a++){var c=i[a],m=c.event;c=c.listeners;t:{var y=void 0;if(n)for(var T=c.length-1;0<=T;T--){var R=c[T],M=R.instance,j=R.currentTarget;if(R=R.listener,M!==y&&m.isPropagationStopped())break t;y=R,m.currentTarget=j;try{y(m)}catch(W){Pa(W)}m.currentTarget=null,y=M}else for(T=0;T<c.length;T++){if(R=c[T],M=R.instance,j=R.currentTarget,R=R.listener,M!==y&&m.isPropagationStopped())break t;y=R,m.currentTarget=j;try{y(m)}catch(W){Pa(W)}m.currentTarget=null,y=M}}}}function Dt(i,n){var a=n[Lo];a===void 0&&(a=n[Lo]=new Set);var c=i+"__bubble";a.has(c)||(m0(n,i,2,!1),a.add(c))}function dc(i,n,a){var c=0;n&&(c|=4),m0(a,i,c,n)}var xl="_reactListening"+Math.random().toString(36).slice(2);function gc(i){if(!i[xl]){i[xl]=!0,oh.forEach(function(a){a!=="selectionchange"&&(jE.has(a)||dc(a,!1,i),dc(a,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[xl]||(n[xl]=!0,dc("selectionchange",!1,n))}}function m0(i,n,a,c){switch(z0(n)){case 2:var m=SS;break;case 8:m=TS;break;default:m=Ic}a=m.bind(null,n,a,i),m=void 0,!wo||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),c?m!==void 0?i.addEventListener(n,a,{capture:!0,passive:m}):i.addEventListener(n,a,!0):m!==void 0?i.addEventListener(n,a,{passive:m}):i.addEventListener(n,a,!1)}function mc(i,n,a,c,m){var y=c;if((n&1)===0&&(n&2)===0&&c!==null)t:for(;;){if(c===null)return;var T=c.tag;if(T===3||T===4){var R=c.stateNode.containerInfo;if(R===m)break;if(T===4)for(T=c.return;T!==null;){var M=T.tag;if((M===3||M===4)&&T.stateNode.containerInfo===m)return;T=T.return}for(;R!==null;){if(T=dn(R),T===null)return;if(M=T.tag,M===5||M===6||M===26||M===27){c=y=T;continue t}R=R.parentNode}}c=c.return}Sh(function(){var j=y,W=Mo(a),et=[];t:{var Y=qh.get(i);if(Y!==void 0){var q=ka,gt=i;switch(i){case"keypress":if(Oa(a)===0)break t;case"keydown":case"keyup":q=Fv;break;case"focusin":gt="focus",q=Bo;break;case"focusout":gt="blur",q=Bo;break;case"beforeblur":case"afterblur":q=Bo;break;case"click":if(a.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=Ah;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=_v;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=Hv;break;case zh:case Kh:case jh:q=Cv;break;case Yh:q=zv;break;case"scroll":case"scrollend":q=Lv;break;case"wheel":q=jv;break;case"copy":case"cut":case"paste":q=Mv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=Lh;break;case"toggle":case"beforetoggle":q=qv}var vt=(n&4)!==0,zt=!vt&&(i==="scroll"||i==="scrollend"),B=vt?Y!==null?Y+"Capture":null:Y;vt=[];for(var N=j,z;N!==null;){var tt=N;if(z=tt.stateNode,tt=tt.tag,tt!==5&&tt!==26&&tt!==27||z===null||B===null||(tt=yr(N,B),tt!=null&&vt.push(Qr(N,tt,z))),zt)break;N=N.return}0<vt.length&&(Y=new q(Y,gt,null,a,W),et.push({event:Y,listeners:vt}))}}if((n&7)===0){t:{if(Y=i==="mouseover"||i==="pointerover",q=i==="mouseout"||i==="pointerout",Y&&a!==Oo&&(gt=a.relatedTarget||a.fromElement)&&(dn(gt)||gt[hn]))break t;if((q||Y)&&(Y=W.window===W?W:(Y=W.ownerDocument)?Y.defaultView||Y.parentWindow:window,q?(gt=a.relatedTarget||a.toElement,q=j,gt=gt?dn(gt):null,gt!==null&&(zt=l(gt),vt=gt.tag,gt!==zt||vt!==5&&vt!==27&&vt!==6)&&(gt=null)):(q=null,gt=j),q!==gt)){if(vt=Ah,tt="onMouseLeave",B="onMouseEnter",N="mouse",(i==="pointerout"||i==="pointerover")&&(vt=Lh,tt="onPointerLeave",B="onPointerEnter",N="pointer"),zt=q==null?Y:pr(q),z=gt==null?Y:pr(gt),Y=new vt(tt,N+"leave",q,a,W),Y.target=zt,Y.relatedTarget=z,tt=null,dn(W)===j&&(vt=new vt(B,N+"enter",gt,a,W),vt.target=z,vt.relatedTarget=zt,tt=vt),zt=tt,q&&gt)e:{for(vt=YE,B=q,N=gt,z=0,tt=B;tt;tt=vt(tt))z++;tt=0;for(var yt=N;yt;yt=vt(yt))tt++;for(;0<z-tt;)B=vt(B),z--;for(;0<tt-z;)N=vt(N),tt--;for(;z--;){if(B===N||N!==null&&B===N.alternate){vt=B;break e}B=vt(B),N=vt(N)}vt=null}else vt=null;q!==null&&p0(et,Y,q,vt,!1),gt!==null&&zt!==null&&p0(et,zt,gt,vt,!0)}}t:{if(Y=j?pr(j):window,q=Y.nodeName&&Y.nodeName.toLowerCase(),q==="select"||q==="input"&&Y.type==="file")var Nt=kh;else if(Oh(Y))if(wh)Nt=nE;else{Nt=iE;var mt=eE}else q=Y.nodeName,!q||q.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?j&&Co(j.elementType)&&(Nt=kh):Nt=sE;if(Nt&&(Nt=Nt(i,j))){Mh(et,Nt,a,W);break t}mt&&mt(i,Y,j),i==="focusout"&&j&&Y.type==="number"&&j.memoizedProps.value!=null&&Io(Y,"number",Y.value)}switch(mt=j?pr(j):window,i){case"focusin":(Oh(mt)||mt.contentEditable==="true")&&(xn=mt,zo=j,Lr=null);break;case"focusout":Lr=zo=xn=null;break;case"mousedown":Ko=!0;break;case"contextmenu":case"mouseup":case"dragend":Ko=!1,Hh(et,a,W);break;case"selectionchange":if(aE)break;case"keydown":case"keyup":Hh(et,a,W)}var bt;if($o)t:{switch(i){case"compositionstart":var Ot="onCompositionStart";break t;case"compositionend":Ot="onCompositionEnd";break t;case"compositionupdate":Ot="onCompositionUpdate";break t}Ot=void 0}else Tn?Ih(i,a)&&(Ot="onCompositionEnd"):i==="keydown"&&a.keyCode===229&&(Ot="onCompositionStart");Ot&&(Rh&&a.locale!=="ko"&&(Tn||Ot!=="onCompositionStart"?Ot==="onCompositionEnd"&&Tn&&(bt=Th()):(us=W,No="value"in us?us.value:us.textContent,Tn=!0)),mt=Al(j,Ot),0<mt.length&&(Ot=new bh(Ot,i,null,a,W),et.push({event:Ot,listeners:mt}),bt?Ot.data=bt:(bt=Ch(a),bt!==null&&(Ot.data=bt)))),(bt=Qv?Wv(i,a):Zv(i,a))&&(Ot=Al(j,"onBeforeInput"),0<Ot.length&&(mt=new bh("onBeforeInput","beforeinput",null,a,W),et.push({event:mt,listeners:Ot}),mt.data=bt)),VE(et,i,j,a,W)}g0(et,n)})}function Qr(i,n,a){return{instance:i,listener:n,currentTarget:a}}function Al(i,n){for(var a=n+"Capture",c=[];i!==null;){var m=i,y=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||y===null||(m=yr(i,a),m!=null&&c.unshift(Qr(i,m,y)),m=yr(i,n),m!=null&&c.push(Qr(i,m,y))),i.tag===3)return c;i=i.return}return[]}function YE(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function p0(i,n,a,c,m){for(var y=n._reactName,T=[];a!==null&&a!==c;){var R=a,M=R.alternate,j=R.stateNode;if(R=R.tag,M!==null&&M===c)break;R!==5&&R!==26&&R!==27||j===null||(M=j,m?(j=yr(a,y),j!=null&&T.unshift(Qr(a,j,M))):m||(j=yr(a,y),j!=null&&T.push(Qr(a,j,M)))),a=a.return}T.length!==0&&i.push({event:n,listeners:T})}var qE=/\r\n?/g,XE=/\u0000|\uFFFD/g;function y0(i){return(typeof i=="string"?i:""+i).replace(qE,`
`).replace(XE,"")}function v0(i,n){return n=y0(n),y0(i)===n}function Vt(i,n,a,c,m,y){switch(a){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||vn(i,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&vn(i,""+c);break;case"className":_a(i,"class",c);break;case"tabIndex":_a(i,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":_a(i,a,c);break;case"style":vh(i,c,y);break;case"data":if(n!=="object"){_a(i,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||a!=="href")){i.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(a);break}c=Ia(""+c),i.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){i.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(a==="formAction"?(n!=="input"&&Vt(i,n,"name",m.name,m,null),Vt(i,n,"formEncType",m.formEncType,m,null),Vt(i,n,"formMethod",m.formMethod,m,null),Vt(i,n,"formTarget",m.formTarget,m,null)):(Vt(i,n,"encType",m.encType,m,null),Vt(i,n,"method",m.method,m,null),Vt(i,n,"target",m.target,m,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(a);break}c=Ia(""+c),i.setAttribute(a,c);break;case"onClick":c!=null&&(i.onclick=Fi);break;case"onScroll":c!=null&&Dt("scroll",i);break;case"onScrollEnd":c!=null&&Dt("scrollend",i);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(m.children!=null)throw Error(s(60));i.innerHTML=a}}break;case"multiple":i.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":i.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){i.removeAttribute("xlink:href");break}a=Ia(""+c),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,""+c):i.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,""):i.removeAttribute(a);break;case"capture":case"download":c===!0?i.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(a,c):i.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?i.setAttribute(a,c):i.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?i.removeAttribute(a):i.setAttribute(a,c);break;case"popover":Dt("beforetoggle",i),Dt("toggle",i),Ra(i,"popover",c);break;case"xlinkActuate":Bi(i,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Bi(i,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Bi(i,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Bi(i,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Bi(i,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Bi(i,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Bi(i,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Bi(i,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Bi(i,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ra(i,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Av.get(a)||a,Ra(i,a,c))}}function pc(i,n,a,c,m,y){switch(a){case"style":vh(i,c,y);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(m.children!=null)throw Error(s(60));i.innerHTML=a}}break;case"children":typeof c=="string"?vn(i,c):(typeof c=="number"||typeof c=="bigint")&&vn(i,""+c);break;case"onScroll":c!=null&&Dt("scroll",i);break;case"onScrollEnd":c!=null&&Dt("scrollend",i);break;case"onClick":c!=null&&(i.onclick=Fi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!uh.hasOwnProperty(a))t:{if(a[0]==="o"&&a[1]==="n"&&(m=a.endsWith("Capture"),n=a.slice(2,m?a.length-7:void 0),y=i[we]||null,y=y!=null?y[a]:null,typeof y=="function"&&i.removeEventListener(n,y,m),typeof c=="function")){typeof y!="function"&&y!==null&&(a in i?i[a]=null:i.hasAttribute(a)&&i.removeAttribute(a)),i.addEventListener(n,c,m);break t}a in i?i[a]=c:c===!0?i.setAttribute(a,""):Ra(i,a,c)}}}function be(i,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Dt("error",i),Dt("load",i);var c=!1,m=!1,y;for(y in a)if(a.hasOwnProperty(y)){var T=a[y];if(T!=null)switch(y){case"src":c=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Vt(i,n,y,T,a,null)}}m&&Vt(i,n,"srcSet",a.srcSet,a,null),c&&Vt(i,n,"src",a.src,a,null);return;case"input":Dt("invalid",i);var R=y=T=m=null,M=null,j=null;for(c in a)if(a.hasOwnProperty(c)){var W=a[c];if(W!=null)switch(c){case"name":m=W;break;case"type":T=W;break;case"checked":M=W;break;case"defaultChecked":j=W;break;case"value":y=W;break;case"defaultValue":R=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(s(137,n));break;default:Vt(i,n,c,W,a,null)}}gh(i,y,R,M,j,T,m,!1);return;case"select":Dt("invalid",i),c=T=y=null;for(m in a)if(a.hasOwnProperty(m)&&(R=a[m],R!=null))switch(m){case"value":y=R;break;case"defaultValue":T=R;break;case"multiple":c=R;default:Vt(i,n,m,R,a,null)}n=y,a=T,i.multiple=!!c,n!=null?yn(i,!!c,n,!1):a!=null&&yn(i,!!c,a,!0);return;case"textarea":Dt("invalid",i),y=m=c=null;for(T in a)if(a.hasOwnProperty(T)&&(R=a[T],R!=null))switch(T){case"value":c=R;break;case"defaultValue":m=R;break;case"children":y=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(s(91));break;default:Vt(i,n,T,R,a,null)}ph(i,c,m,y);return;case"option":for(M in a)if(a.hasOwnProperty(M)&&(c=a[M],c!=null))switch(M){case"selected":i.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:Vt(i,n,M,c,a,null)}return;case"dialog":Dt("beforetoggle",i),Dt("toggle",i),Dt("cancel",i),Dt("close",i);break;case"iframe":case"object":Dt("load",i);break;case"video":case"audio":for(c=0;c<Xr.length;c++)Dt(Xr[c],i);break;case"image":Dt("error",i),Dt("load",i);break;case"details":Dt("toggle",i);break;case"embed":case"source":case"link":Dt("error",i),Dt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in a)if(a.hasOwnProperty(j)&&(c=a[j],c!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Vt(i,n,j,c,a,null)}return;default:if(Co(n)){for(W in a)a.hasOwnProperty(W)&&(c=a[W],c!==void 0&&pc(i,n,W,c,a,void 0));return}}for(R in a)a.hasOwnProperty(R)&&(c=a[R],c!=null&&Vt(i,n,R,c,a,null))}function QE(i,n,a,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,y=null,T=null,R=null,M=null,j=null,W=null;for(q in a){var et=a[q];if(a.hasOwnProperty(q)&&et!=null)switch(q){case"checked":break;case"value":break;case"defaultValue":M=et;default:c.hasOwnProperty(q)||Vt(i,n,q,null,c,et)}}for(var Y in c){var q=c[Y];if(et=a[Y],c.hasOwnProperty(Y)&&(q!=null||et!=null))switch(Y){case"type":y=q;break;case"name":m=q;break;case"checked":j=q;break;case"defaultChecked":W=q;break;case"value":T=q;break;case"defaultValue":R=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(s(137,n));break;default:q!==et&&Vt(i,n,Y,q,c,et)}}Do(i,T,R,M,j,W,y,m);return;case"select":q=T=R=Y=null;for(y in a)if(M=a[y],a.hasOwnProperty(y)&&M!=null)switch(y){case"value":break;case"multiple":q=M;default:c.hasOwnProperty(y)||Vt(i,n,y,null,c,M)}for(m in c)if(y=c[m],M=a[m],c.hasOwnProperty(m)&&(y!=null||M!=null))switch(m){case"value":Y=y;break;case"defaultValue":R=y;break;case"multiple":T=y;default:y!==M&&Vt(i,n,m,y,c,M)}n=R,a=T,c=q,Y!=null?yn(i,!!a,Y,!1):!!c!=!!a&&(n!=null?yn(i,!!a,n,!0):yn(i,!!a,a?[]:"",!1));return;case"textarea":q=Y=null;for(R in a)if(m=a[R],a.hasOwnProperty(R)&&m!=null&&!c.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:Vt(i,n,R,null,c,m)}for(T in c)if(m=c[T],y=a[T],c.hasOwnProperty(T)&&(m!=null||y!=null))switch(T){case"value":Y=m;break;case"defaultValue":q=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(s(91));break;default:m!==y&&Vt(i,n,T,m,c,y)}mh(i,Y,q);return;case"option":for(var gt in a)if(Y=a[gt],a.hasOwnProperty(gt)&&Y!=null&&!c.hasOwnProperty(gt))switch(gt){case"selected":i.selected=!1;break;default:Vt(i,n,gt,null,c,Y)}for(M in c)if(Y=c[M],q=a[M],c.hasOwnProperty(M)&&Y!==q&&(Y!=null||q!=null))switch(M){case"selected":i.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:Vt(i,n,M,Y,c,q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vt in a)Y=a[vt],a.hasOwnProperty(vt)&&Y!=null&&!c.hasOwnProperty(vt)&&Vt(i,n,vt,null,c,Y);for(j in c)if(Y=c[j],q=a[j],c.hasOwnProperty(j)&&Y!==q&&(Y!=null||q!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,n));break;default:Vt(i,n,j,Y,c,q)}return;default:if(Co(n)){for(var zt in a)Y=a[zt],a.hasOwnProperty(zt)&&Y!==void 0&&!c.hasOwnProperty(zt)&&pc(i,n,zt,void 0,c,Y);for(W in c)Y=c[W],q=a[W],!c.hasOwnProperty(W)||Y===q||Y===void 0&&q===void 0||pc(i,n,W,Y,c,q);return}}for(var B in a)Y=a[B],a.hasOwnProperty(B)&&Y!=null&&!c.hasOwnProperty(B)&&Vt(i,n,B,null,c,Y);for(et in c)Y=c[et],q=a[et],!c.hasOwnProperty(et)||Y===q||Y==null&&q==null||Vt(i,n,et,Y,c,q)}function E0(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function WE(){if(typeof performance.getEntriesByType=="function"){for(var i=0,n=0,a=performance.getEntriesByType("resource"),c=0;c<a.length;c++){var m=a[c],y=m.transferSize,T=m.initiatorType,R=m.duration;if(y&&R&&E0(T)){for(T=0,R=m.responseEnd,c+=1;c<a.length;c++){var M=a[c],j=M.startTime;if(j>R)break;var W=M.transferSize,et=M.initiatorType;W&&E0(et)&&(M=M.responseEnd,T+=W*(M<R?1:(R-j)/(M-j)))}if(--c,n+=8*(y+T)/(m.duration/1e3),i++,10<i)break}}if(0<i)return n/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var yc=null,vc=null;function bl(i){return i.nodeType===9?i:i.ownerDocument}function S0(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function T0(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function Ec(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Sc=null;function ZE(){var i=window.event;return i&&i.type==="popstate"?i===Sc?!1:(Sc=i,!0):(Sc=null,!1)}var x0=typeof setTimeout=="function"?setTimeout:void 0,JE=typeof clearTimeout=="function"?clearTimeout:void 0,A0=typeof Promise=="function"?Promise:void 0,tS=typeof queueMicrotask=="function"?queueMicrotask:typeof A0<"u"?function(i){return A0.resolve(null).then(i).catch(eS)}:x0;function eS(i){setTimeout(function(){throw i})}function Rs(i){return i==="head"}function b0(i,n){var a=n,c=0;do{var m=a.nextSibling;if(i.removeChild(a),m&&m.nodeType===8)if(a=m.data,a==="/$"||a==="/&"){if(c===0){i.removeChild(m),Xn(n);return}c--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")c++;else if(a==="html")Wr(i.ownerDocument.documentElement);else if(a==="head"){a=i.ownerDocument.head,Wr(a);for(var y=a.firstChild;y;){var T=y.nextSibling,R=y.nodeName;y[mr]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&y.rel.toLowerCase()==="stylesheet"||a.removeChild(y),y=T}}else a==="body"&&Wr(i.ownerDocument.body);a=m}while(a);Xn(n)}function L0(i,n){var a=i;i=0;do{var c=a.nextSibling;if(a.nodeType===1?n?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(n?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(i===0)break;i--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||i++;a=c}while(a)}function Tc(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Tc(a),Ro(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}i.removeChild(a)}}function iS(i,n,a,c){for(;i.nodeType===1;){var m=a;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(c){if(!i[mr])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(y=i.getAttribute("rel"),y==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(y!==m.rel||i.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||i.getAttribute("title")!==(m.title==null?null:m.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(y=i.getAttribute("src"),(y!==(m.src==null?null:m.src)||i.getAttribute("type")!==(m.type==null?null:m.type)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&y&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var y=m.name==null?null:""+m.name;if(m.type==="hidden"&&i.getAttribute("name")===y)return i}else return i;if(i=di(i.nextSibling),i===null)break}return null}function sS(i,n,a){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=di(i.nextSibling),i===null))return null;return i}function R0(i,n){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!n||(i=di(i.nextSibling),i===null))return null;return i}function xc(i){return i.data==="$?"||i.data==="$~"}function Ac(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function nS(i,n){var a=i.ownerDocument;if(i.data==="$~")i._reactRetry=n;else if(i.data!=="$?"||a.readyState!=="loading")n();else{var c=function(){n(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),i._reactRetry=c}}function di(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return i}var bc=null;function _0(i){i=i.nextSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="/$"||a==="/&"){if(n===0)return di(i.nextSibling);n--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||n++}i=i.nextSibling}return null}function D0(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var a=i.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(n===0)return i;n--}else a!=="/$"&&a!=="/&"||n++}i=i.previousSibling}return null}function I0(i,n,a){switch(n=bl(a),i){case"html":if(i=n.documentElement,!i)throw Error(s(452));return i;case"head":if(i=n.head,!i)throw Error(s(453));return i;case"body":if(i=n.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function Wr(i){for(var n=i.attributes;n.length;)i.removeAttributeNode(n[0]);Ro(i)}var gi=new Map,C0=new Set;function Ll(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var es=X.d;X.d={f:rS,r:aS,D:lS,C:oS,L:uS,m:cS,X:hS,S:fS,M:dS};function rS(){var i=es.f(),n=pl();return i||n}function aS(i){var n=gn(i);n!==null&&n.tag===5&&n.type==="form"?Yd(n):es.r(i)}var jn=typeof document>"u"?null:document;function O0(i,n,a){var c=jn;if(c&&typeof n=="string"&&n){var m=ai(n);m='link[rel="'+i+'"][href="'+m+'"]',typeof a=="string"&&(m+='[crossorigin="'+a+'"]'),C0.has(m)||(C0.add(m),i={rel:i,crossOrigin:a,href:n},c.querySelector(m)===null&&(n=c.createElement("link"),be(n,"link",i),pe(n),c.head.appendChild(n)))}}function lS(i){es.D(i),O0("dns-prefetch",i,null)}function oS(i,n){es.C(i,n),O0("preconnect",i,n)}function uS(i,n,a){es.L(i,n,a);var c=jn;if(c&&i&&n){var m='link[rel="preload"][as="'+ai(n)+'"]';n==="image"&&a&&a.imageSrcSet?(m+='[imagesrcset="'+ai(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(m+='[imagesizes="'+ai(a.imageSizes)+'"]')):m+='[href="'+ai(i)+'"]';var y=m;switch(n){case"style":y=Yn(i);break;case"script":y=qn(i)}gi.has(y)||(i=p({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:i,as:n},a),gi.set(y,i),c.querySelector(m)!==null||n==="style"&&c.querySelector(Zr(y))||n==="script"&&c.querySelector(Jr(y))||(n=c.createElement("link"),be(n,"link",i),pe(n),c.head.appendChild(n)))}}function cS(i,n){es.m(i,n);var a=jn;if(a&&i){var c=n&&typeof n.as=="string"?n.as:"script",m='link[rel="modulepreload"][as="'+ai(c)+'"][href="'+ai(i)+'"]',y=m;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=qn(i)}if(!gi.has(y)&&(i=p({rel:"modulepreload",href:i},n),gi.set(y,i),a.querySelector(m)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Jr(y)))return}c=a.createElement("link"),be(c,"link",i),pe(c),a.head.appendChild(c)}}}function fS(i,n,a){es.S(i,n,a);var c=jn;if(c&&i){var m=mn(c).hoistableStyles,y=Yn(i);n=n||"default";var T=m.get(y);if(!T){var R={loading:0,preload:null};if(T=c.querySelector(Zr(y)))R.loading=5;else{i=p({rel:"stylesheet",href:i,"data-precedence":n},a),(a=gi.get(y))&&Lc(i,a);var M=T=c.createElement("link");pe(M),be(M,"link",i),M._p=new Promise(function(j,W){M.onload=j,M.onerror=W}),M.addEventListener("load",function(){R.loading|=1}),M.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Rl(T,n,c)}T={type:"stylesheet",instance:T,count:1,state:R},m.set(y,T)}}}function hS(i,n){es.X(i,n);var a=jn;if(a&&i){var c=mn(a).hoistableScripts,m=qn(i),y=c.get(m);y||(y=a.querySelector(Jr(m)),y||(i=p({src:i,async:!0},n),(n=gi.get(m))&&Rc(i,n),y=a.createElement("script"),pe(y),be(y,"link",i),a.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},c.set(m,y))}}function dS(i,n){es.M(i,n);var a=jn;if(a&&i){var c=mn(a).hoistableScripts,m=qn(i),y=c.get(m);y||(y=a.querySelector(Jr(m)),y||(i=p({src:i,async:!0,type:"module"},n),(n=gi.get(m))&&Rc(i,n),y=a.createElement("script"),pe(y),be(y,"link",i),a.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},c.set(m,y))}}function M0(i,n,a,c){var m=(m=ft.current)?Ll(m):null;if(!m)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=Yn(a.href),a=mn(m).hoistableStyles,c=a.get(n),c||(c={type:"style",instance:null,count:0,state:null},a.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){i=Yn(a.href);var y=mn(m).hoistableStyles,T=y.get(i);if(T||(m=m.ownerDocument||m,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(i,T),(y=m.querySelector(Zr(i)))&&!y._p&&(T.instance=y,T.state.loading=5),gi.has(i)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},gi.set(i,a),y||gS(m,i,a,T.state))),n&&c===null)throw Error(s(528,""));return T}if(n&&c!==null)throw Error(s(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=qn(a),a=mn(m).hoistableScripts,c=a.get(n),c||(c={type:"script",instance:null,count:0,state:null},a.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function Yn(i){return'href="'+ai(i)+'"'}function Zr(i){return'link[rel="stylesheet"]['+i+"]"}function k0(i){return p({},i,{"data-precedence":i.precedence,precedence:null})}function gS(i,n,a,c){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=i.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),be(n,"link",a),pe(n),i.head.appendChild(n))}function qn(i){return'[src="'+ai(i)+'"]'}function Jr(i){return"script[async]"+i}function w0(i,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var c=i.querySelector('style[data-href~="'+ai(a.href)+'"]');if(c)return n.instance=c,pe(c),c;var m=p({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(i.ownerDocument||i).createElement("style"),pe(c),be(c,"style",m),Rl(c,a.precedence,i),n.instance=c;case"stylesheet":m=Yn(a.href);var y=i.querySelector(Zr(m));if(y)return n.state.loading|=4,n.instance=y,pe(y),y;c=k0(a),(m=gi.get(m))&&Lc(c,m),y=(i.ownerDocument||i).createElement("link"),pe(y);var T=y;return T._p=new Promise(function(R,M){T.onload=R,T.onerror=M}),be(y,"link",c),n.state.loading|=4,Rl(y,a.precedence,i),n.instance=y;case"script":return y=qn(a.src),(m=i.querySelector(Jr(y)))?(n.instance=m,pe(m),m):(c=a,(m=gi.get(y))&&(c=p({},a),Rc(c,m)),i=i.ownerDocument||i,m=i.createElement("script"),pe(m),be(m,"link",c),i.head.appendChild(m),n.instance=m);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,Rl(c,a.precedence,i));return n.instance}function Rl(i,n,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=c.length?c[c.length-1]:null,y=m,T=0;T<c.length;T++){var R=c[T];if(R.dataset.precedence===n)y=R;else if(y!==m)break}y?y.parentNode.insertBefore(i,y.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(i,n.firstChild))}function Lc(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function Rc(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var _l=null;function N0(i,n,a){if(_l===null){var c=new Map,m=_l=new Map;m.set(a,c)}else m=_l,c=m.get(a),c||(c=new Map,m.set(a,c));if(c.has(i))return c;for(c.set(i,null),a=a.getElementsByTagName(i),m=0;m<a.length;m++){var y=a[m];if(!(y[mr]||y[Se]||i==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var T=y.getAttribute(n)||"";T=i+T;var R=c.get(T);R?R.push(y):c.set(T,[y])}}return c}function P0(i,n,a){i=i.ownerDocument||i,i.head.insertBefore(a,n==="title"?i.querySelector("head > title"):null)}function mS(i,n,a){if(a===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return i=n.disabled,typeof n.precedence=="string"&&i==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function U0(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function pS(i,n,a,c){if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var m=Yn(c.href),y=n.querySelector(Zr(m));if(y){n=y._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(i.count++,i=Dl.bind(i),n.then(i,i)),a.state.loading|=4,a.instance=y,pe(y);return}y=n.ownerDocument||n,c=k0(c),(m=gi.get(m))&&Lc(c,m),y=y.createElement("link"),pe(y);var T=y;T._p=new Promise(function(R,M){T.onload=R,T.onerror=M}),be(y,"link",c),a.instance=y}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(i.count++,a=Dl.bind(i),n.addEventListener("load",a),n.addEventListener("error",a))}}var _c=0;function yS(i,n){return i.stylesheets&&i.count===0&&Cl(i,i.stylesheets),0<i.count||0<i.imgCount?function(a){var c=setTimeout(function(){if(i.stylesheets&&Cl(i,i.stylesheets),i.unsuspend){var y=i.unsuspend;i.unsuspend=null,y()}},6e4+n);0<i.imgBytes&&_c===0&&(_c=62500*WE());var m=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&Cl(i,i.stylesheets),i.unsuspend)){var y=i.unsuspend;i.unsuspend=null,y()}},(i.imgBytes>_c?50:800)+n);return i.unsuspend=a,function(){i.unsuspend=null,clearTimeout(c),clearTimeout(m)}}:null}function Dl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Cl(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Il=null;function Cl(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Il=new Map,n.forEach(vS,i),Il=null,Dl.call(i))}function vS(i,n){if(!(n.state.loading&4)){var a=Il.get(i);if(a)var c=a.get(null);else{a=new Map,Il.set(i,a);for(var m=i.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<m.length;y++){var T=m[y];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(a.set(T.dataset.precedence,T),c=T)}c&&a.set(null,c)}m=n.instance,T=m.getAttribute("data-precedence"),y=a.get(T)||c,y===c&&a.set(null,m),a.set(T,m),this.count++,c=Dl.bind(this),m.addEventListener("load",c),m.addEventListener("error",c),y?y.parentNode.insertBefore(m,y.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(m,i.firstChild)),n.state.loading|=4}}var ta={$$typeof:D,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function ES(i,n,a,c,m,y,T,R,M){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xo(0),this.hiddenUpdates=xo(null),this.identifierPrefix=c,this.onUncaughtError=m,this.onCaughtError=y,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function B0(i,n,a,c,m,y,T,R,M,j,W,et){return i=new ES(i,n,a,T,M,j,W,et,R),n=1,y===!0&&(n|=24),y=je(3,null,null,n),i.current=y,y.stateNode=i,n=au(),n.refCount++,i.pooledCache=n,n.refCount++,y.memoizedState={element:c,isDehydrated:a,cache:n},cu(y),i}function F0(i){return i?(i=Ln,i):Ln}function $0(i,n,a,c,m,y){m=F0(m),c.context===null?c.context=m:c.pendingContext=m,c=ms(n),c.payload={element:a},y=y===void 0?null:y,y!==null&&(c.callback=y),a=ps(i,c,n),a!==null&&($e(a,i,n),Mr(a,i,n))}function G0(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var a=i.retryLane;i.retryLane=a!==0&&a<n?a:n}}function Dc(i,n){G0(i,n),(i=i.alternate)&&G0(i,n)}function H0(i){if(i.tag===13||i.tag===31){var n=Ks(i,67108864);n!==null&&$e(n,i,67108864),Dc(i,67108864)}}function V0(i){if(i.tag===13||i.tag===31){var n=We();n=Ao(n);var a=Ks(i,n);a!==null&&$e(a,i,n),Dc(i,n)}}var Ol=!0;function SS(i,n,a,c){var m=w.T;w.T=null;var y=X.p;try{X.p=2,Ic(i,n,a,c)}finally{X.p=y,w.T=m}}function TS(i,n,a,c){var m=w.T;w.T=null;var y=X.p;try{X.p=8,Ic(i,n,a,c)}finally{X.p=y,w.T=m}}function Ic(i,n,a,c){if(Ol){var m=Cc(c);if(m===null)mc(i,n,c,Ml,a),K0(i,c);else if(AS(m,i,n,a,c))c.stopPropagation();else if(K0(i,c),n&4&&-1<xS.indexOf(i)){for(;m!==null;){var y=gn(m);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var T=$s(y.pendingLanes);if(T!==0){var R=y;for(R.pendingLanes|=2,R.entangledLanes|=2;T;){var M=1<<31-ze(T);R.entanglements[1]|=M,T&=~M}Di(y),(Ut&6)===0&&(gl=me()+500,qr(0))}}break;case 31:case 13:R=Ks(y,2),R!==null&&$e(R,y,2),pl(),Dc(y,2)}if(y=Cc(c),y===null&&mc(i,n,c,Ml,a),y===m)break;m=y}m!==null&&c.stopPropagation()}else mc(i,n,c,null,a)}}function Cc(i){return i=Mo(i),Oc(i)}var Ml=null;function Oc(i){if(Ml=null,i=dn(i),i!==null){var n=l(i);if(n===null)i=null;else{var a=n.tag;if(a===13){if(i=o(n),i!==null)return i;i=null}else if(a===31){if(i=f(n),i!==null)return i;i=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return Ml=i,null}function z0(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Sa()){case as:return 2;case cr:return 8;case fn:case Ta:return 32;case fr:return 268435456;default:return 32}default:return 32}}var Mc=!1,_s=null,Ds=null,Is=null,ea=new Map,ia=new Map,Cs=[],xS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function K0(i,n){switch(i){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":Ds=null;break;case"mouseover":case"mouseout":Is=null;break;case"pointerover":case"pointerout":ea.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":ia.delete(n.pointerId)}}function sa(i,n,a,c,m,y){return i===null||i.nativeEvent!==y?(i={blockedOn:n,domEventName:a,eventSystemFlags:c,nativeEvent:y,targetContainers:[m]},n!==null&&(n=gn(n),n!==null&&H0(n)),i):(i.eventSystemFlags|=c,n=i.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),i)}function AS(i,n,a,c,m){switch(n){case"focusin":return _s=sa(_s,i,n,a,c,m),!0;case"dragenter":return Ds=sa(Ds,i,n,a,c,m),!0;case"mouseover":return Is=sa(Is,i,n,a,c,m),!0;case"pointerover":var y=m.pointerId;return ea.set(y,sa(ea.get(y)||null,i,n,a,c,m)),!0;case"gotpointercapture":return y=m.pointerId,ia.set(y,sa(ia.get(y)||null,i,n,a,c,m)),!0}return!1}function j0(i){var n=dn(i.target);if(n!==null){var a=l(n);if(a!==null){if(n=a.tag,n===13){if(n=o(a),n!==null){i.blockedOn=n,ah(i.priority,function(){V0(a)});return}}else if(n===31){if(n=f(a),n!==null){i.blockedOn=n,ah(i.priority,function(){V0(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){i.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}i.blockedOn=null}function kl(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var a=Cc(i.nativeEvent);if(a===null){a=i.nativeEvent;var c=new a.constructor(a.type,a);Oo=c,a.target.dispatchEvent(c),Oo=null}else return n=gn(a),n!==null&&H0(n),i.blockedOn=a,!1;n.shift()}return!0}function Y0(i,n,a){kl(i)&&a.delete(n)}function bS(){Mc=!1,_s!==null&&kl(_s)&&(_s=null),Ds!==null&&kl(Ds)&&(Ds=null),Is!==null&&kl(Is)&&(Is=null),ea.forEach(Y0),ia.forEach(Y0)}function wl(i,n){i.blockedOn===n&&(i.blockedOn=null,Mc||(Mc=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,bS)))}var Nl=null;function q0(i){Nl!==i&&(Nl=i,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){Nl===i&&(Nl=null);for(var n=0;n<i.length;n+=3){var a=i[n],c=i[n+1],m=i[n+2];if(typeof c!="function"){if(Oc(c||a)===null)continue;break}var y=gn(a);y!==null&&(i.splice(n,3),n-=3,Cu(y,{pending:!0,data:m,method:a.method,action:c},c,m))}}))}function Xn(i){function n(M){return wl(M,i)}_s!==null&&wl(_s,i),Ds!==null&&wl(Ds,i),Is!==null&&wl(Is,i),ea.forEach(n),ia.forEach(n);for(var a=0;a<Cs.length;a++){var c=Cs[a];c.blockedOn===i&&(c.blockedOn=null)}for(;0<Cs.length&&(a=Cs[0],a.blockedOn===null);)j0(a),a.blockedOn===null&&Cs.shift();if(a=(i.ownerDocument||i).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var m=a[c],y=a[c+1],T=m[we]||null;if(typeof y=="function")T||q0(a);else if(T){var R=null;if(y&&y.hasAttribute("formAction")){if(m=y,T=y[we]||null)R=T.formAction;else if(Oc(m)!==null)continue}else R=T.action;typeof R=="function"?a[c+1]=R:(a.splice(c,3),c-=3),q0(a)}}}function X0(){function i(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(T){return m=T})},focusReset:"manual",scroll:"manual"})}function n(){m!==null&&(m(),m=null),c||setTimeout(a,20)}function a(){if(!c&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,m=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(a,100),function(){c=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),m!==null&&(m(),m=null)}}}function kc(i){this._internalRoot=i}Pl.prototype.render=kc.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(s(409));var a=n.current,c=We();$0(a,c,i,n,null,null)},Pl.prototype.unmount=kc.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;$0(i.current,2,null,i,null,null),pl(),n[hn]=null}};function Pl(i){this._internalRoot=i}Pl.prototype.unstable_scheduleHydration=function(i){if(i){var n=rh();i={blockedOn:null,target:i,priority:n};for(var a=0;a<Cs.length&&n!==0&&n<Cs[a].priority;a++);Cs.splice(a,0,i),a===0&&j0(i)}};var Q0=t.version;if(Q0!=="19.2.4")throw Error(s(527,Q0,"19.2.4"));X.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=h(n),i=i!==null?g(i):null,i=i===null?null:i.stateNode,i};var LS={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:w,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ul.isDisabled&&Ul.supportsFiber)try{hr=Ul.inject(LS),Ve=Ul}catch{}}return ra.createRoot=function(i,n){if(!r(i))throw Error(s(299));var a=!1,c="",m=sg,y=ng,T=rg;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(m=n.onUncaughtError),n.onCaughtError!==void 0&&(y=n.onCaughtError),n.onRecoverableError!==void 0&&(T=n.onRecoverableError)),n=B0(i,1,!1,null,null,a,c,null,m,y,T,X0),i[hn]=n.current,gc(i),new kc(n)},ra.hydrateRoot=function(i,n,a){if(!r(i))throw Error(s(299));var c=!1,m="",y=sg,T=ng,R=rg,M=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(y=a.onUncaughtError),a.onCaughtError!==void 0&&(T=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError),a.formState!==void 0&&(M=a.formState)),n=B0(i,1,!0,n,a??null,c,m,M,y,T,R,X0),n.context=F0(null),a=n.current,c=We(),c=Ao(c),m=ms(c),m.callback=null,ps(a,m,c),a=c,n.current.lanes=a,gr(n,a),Di(n),i[hn]=n.current,gc(i),new Pl(n)},ra.version="19.2.4",ra}var am;function PS(){if(am)return Pc.exports;am=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(t){console.error(t)}}return u(),Pc.exports=NS(),Pc.exports}var US=PS();const BS=Dp(US),FS="https://my-api-proxy.xvirus238.workers.dev/",$S=async()=>{try{const u=await fetch(`${FS}?type=matches`);if(!u.ok)throw new Error("Worker Error");return await u.json()}catch(u){return console.error("Error fetching matches:",u),[]}},GS=async(u,t)=>({summary:"Streaming details soon.",sources:[]}),HS=async(u,t)=>({summary:"AI Analysis coming soon.",sources:[]}),VS=`
#EXTINF:-1, FEATURED: beIN SPORTS HD 1 (Main)
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6123/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 2
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/2500/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 3
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6124/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 4
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6125/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 5
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6126/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 6
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6127/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 7
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6128/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 8
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6129/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD 9
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/6130/index.m3u8
#EXTINF:-1,beIN SPORTS Full HD XTRA
http://78ovretb.rostelekom.xyz/iptv/4274R9L8ETX3VRQ5QV8LLUA4/19078/index.m3u8
#EXTINF:-1,DAZN 1 HD
http://wo0dyefk.dienalt.org/iptv/DV3AC2Q6YSR9XE/19158/index.m3u8
#EXTINF:-1,DAZN 2 HD
http://wo0dyefk.dienalt.org/iptv/DV3AC2Q6YSR9XE/2532/index.m3u8
#EXTINF:-1,DAZN COMBAT (Global)
http://dazn-combat-rakuten.amagi.tv/hls/amagi_hls_data_rakutenAA-dazn-combat-rakuten/CDN/master.m3u8
`,zS=u=>{const t=u.split(`
`),e=[];let s="";for(const r of t){const l=r.trim();if(l.startsWith("#EXTINF:")){const o=l.lastIndexOf(",");o!==-1&&(s=l.substring(o+1).trim())}else l.startsWith("http")&&s&&(!s.includes("---")&&!s.includes("===")&&s.length>0&&e.push({name:s,url:l}),s="")}return e};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KS=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jS=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,s)=>s?s.toUpperCase():e.toLowerCase()),lm=u=>{const t=jS(u);return t.charAt(0).toUpperCase()+t.slice(1)},Ip=(...u)=>u.filter((t,e,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===e).join(" ").trim(),YS=u=>{for(const t in u)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var qS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XS=Jt.forwardRef(({color:u="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:s,className:r="",children:l,iconNode:o,...f},d)=>Jt.createElement("svg",{ref:d,...qS,width:t,height:t,stroke:u,strokeWidth:s?Number(e)*24/Number(t):e,className:Ip("lucide",r),...!l&&!YS(f)&&{"aria-hidden":"true"},...f},[...o.map(([h,g])=>Jt.createElement(h,g)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=(u,t)=>{const e=Jt.forwardRef(({className:s,...r},l)=>Jt.createElement(XS,{ref:l,iconNode:t,className:Ip(`lucide-${KS(lm(u))}`,`lucide-${u}`,s),...r}));return e.displayName=lm(u),e};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QS=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],WS=Ee("activity",QS);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZS=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],JS=Ee("calendar",ZS);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Cp=Ee("circle-alert",tT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],iT=Ee("circle-play",eT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sT=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],om=Ee("external-link",sT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],rT=Ee("github",nT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],lT=Ee("globe",aT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],uT=Ee("play",oT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Op=Ee("radio",cT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fT=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],hT=Ee("refresh-ccw",fT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],gT=Ee("refresh-cw",dT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],um=Ee("search",mT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],yT=Ee("shield-alert",pT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ET=Ee("shield-check",vT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],TT=Ee("trending-up",ST);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],AT=Ee("trophy",xT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],LT=Ee("tv",bT);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],cm=Ee("zap",RT),_T=({match:u,onSelect:t,isSelected:e})=>{const s=u.status==="LIVE";return G.jsxs("div",{onClick:()=>t(u),className:`relative group cursor-pointer transition-all duration-300 rounded-xl p-5 border-2 ${e?"border-green-500 bg-green-500/10":"border-white/5 bg-white/5 hover:bg-white/10 hover:border-white/20"}`,children:[G.jsxs("div",{className:"flex justify-between items-start mb-4",children:[G.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded bg-white/10 text-xs font-semibold uppercase tracking-wider text-slate-400",children:[G.jsx(AT,{size:12}),u.league]}),s&&G.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold animate-pulse",children:[G.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),"LIVE"]})]}),G.jsxs("div",{className:"flex items-center justify-between gap-4",children:[G.jsxs("div",{className:"flex-1 text-center",children:[G.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-2 font-bold text-lg",children:u.homeTeam.charAt(0)}),G.jsx("h3",{className:"font-bold text-sm md:text-base line-clamp-1",children:u.homeTeam})]}),G.jsx("div",{className:"flex flex-col items-center justify-center min-w-[60px]",children:s&&u.score?G.jsxs("div",{className:"text-2xl font-black text-white",children:[u.score.home," - ",u.score.away]}):G.jsxs("div",{className:"flex flex-col items-center",children:[G.jsx("span",{className:"text-xs text-slate-500 uppercase",children:"VS"}),G.jsx("span",{className:"text-sm font-semibold mt-1",children:u.startTime})]})}),G.jsxs("div",{className:"flex-1 text-center",children:[G.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-2 font-bold text-lg",children:u.awayTeam.charAt(0)}),G.jsx("h3",{className:"font-bold text-sm md:text-base line-clamp-1",children:u.awayTeam})]})]}),G.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex items-center justify-between",children:[G.jsxs("button",{className:"text-xs font-bold flex items-center gap-1 text-green-400 group-hover:text-green-300 transition-colors",children:[G.jsx(uT,{size:14,fill:"currentColor"}),"WATCH OPTIONS"]}),G.jsxs("button",{className:"text-xs font-bold flex items-center gap-1 text-blue-400",children:[G.jsx(JS,{size:14}),"DETAILS"]})]})]})},DT=({streamingInfo:u,analysisInfo:t,isLoading:e})=>e?G.jsxs("div",{className:"flex flex-col gap-6 animate-pulse",children:[G.jsx("div",{className:"h-48 glass rounded-2xl"}),G.jsx("div",{className:"h-64 glass rounded-2xl"})]}):G.jsxs("div",{className:"flex flex-col gap-6",children:[G.jsxs("section",{className:"glass rounded-2xl overflow-hidden border border-green-500/20",children:[G.jsxs("div",{className:"bg-green-500/10 px-6 py-4 flex items-center gap-2 border-b border-green-500/20",children:[G.jsx(Op,{size:18,className:"text-green-400"}),G.jsx("h2",{className:"font-bold text-green-400",children:"OFFICIAL STREAMING SOURCES"})]}),G.jsxs("div",{className:"p-6",children:[G.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-4 whitespace-pre-wrap",children:(u==null?void 0:u.summary)||"Select a match to see official streaming guides."}),(u==null?void 0:u.sources)&&u.sources.length>0&&G.jsx("div",{className:"grid grid-cols-1 gap-2",children:u.sources.map((s,r)=>G.jsxs("a",{href:s.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors border border-white/10",children:[G.jsx("span",{className:"text-xs font-medium text-slate-200 line-clamp-1",children:s.title}),G.jsx(om,{size:14,className:"text-slate-400"})]},r))})]})]}),G.jsxs("section",{className:"glass rounded-2xl overflow-hidden border border-blue-500/20",children:[G.jsxs("div",{className:"bg-blue-500/10 px-6 py-4 flex items-center gap-2 border-b border-blue-500/20",children:[G.jsx(TT,{size:18,className:"text-blue-400"}),G.jsx("h2",{className:"font-bold text-blue-400",children:"AI MATCH ANALYSIS & ODDS"})]}),G.jsxs("div",{className:"p-6",children:[G.jsx("p",{className:"text-slate-300 text-sm leading-relaxed mb-4 whitespace-pre-wrap",children:(t==null?void 0:t.summary)||"Our AI will analyze team form and tactics once a match is selected."}),(t==null?void 0:t.sources)&&t.sources.length>0&&G.jsx("div",{className:"grid grid-cols-1 gap-2",children:t.sources.map((s,r)=>G.jsxs("a",{href:s.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors border border-white/10",children:[G.jsx("span",{className:"text-xs font-medium text-slate-200 line-clamp-1",children:s.title}),G.jsx(om,{size:14,className:"text-slate-400"})]},r))})]})]}),G.jsxs("div",{className:"flex items-center gap-2 p-4 rounded-xl bg-orange-500/10 border border-orange-500/20 text-orange-400 text-xs",children:[G.jsx(Cp,{size:14}),G.jsx("span",{children:"Always use official broadcasters. Avoid clicking suspicious unofficial links."})]})]}),ct=Number.isFinite||function(u){return typeof u=="number"&&isFinite(u)},IT=Number.isSafeInteger||function(u){return typeof u=="number"&&Math.abs(u)<=CT},CT=Number.MAX_SAFE_INTEGER||9007199254740991;let pt=(function(u){return u.NETWORK_ERROR="networkError",u.MEDIA_ERROR="mediaError",u.KEY_SYSTEM_ERROR="keySystemError",u.MUX_ERROR="muxError",u.OTHER_ERROR="otherError",u})({}),V=(function(u){return u.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",u.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",u.KEY_SYSTEM_NO_SESSION="keySystemNoSession",u.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",u.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",u.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",u.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",u.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",u.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",u.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",u.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",u.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",u.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",u.MANIFEST_LOAD_ERROR="manifestLoadError",u.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",u.MANIFEST_PARSING_ERROR="manifestParsingError",u.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",u.LEVEL_EMPTY_ERROR="levelEmptyError",u.LEVEL_LOAD_ERROR="levelLoadError",u.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",u.LEVEL_PARSING_ERROR="levelParsingError",u.LEVEL_SWITCH_ERROR="levelSwitchError",u.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",u.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",u.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",u.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",u.FRAG_LOAD_ERROR="fragLoadError",u.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",u.FRAG_DECRYPT_ERROR="fragDecryptError",u.FRAG_PARSING_ERROR="fragParsingError",u.FRAG_GAP="fragGap",u.REMUX_ALLOC_ERROR="remuxAllocError",u.KEY_LOAD_ERROR="keyLoadError",u.KEY_LOAD_TIMEOUT="keyLoadTimeOut",u.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",u.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",u.BUFFER_APPEND_ERROR="bufferAppendError",u.BUFFER_APPENDING_ERROR="bufferAppendingError",u.BUFFER_STALLED_ERROR="bufferStalledError",u.BUFFER_FULL_ERROR="bufferFullError",u.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",u.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",u.ASSET_LIST_LOAD_ERROR="assetListLoadError",u.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",u.ASSET_LIST_PARSING_ERROR="assetListParsingError",u.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",u.INTERNAL_EXCEPTION="internalException",u.INTERNAL_ABORTED="aborted",u.ATTACH_MEDIA_ERROR="attachMediaError",u.UNKNOWN="unknown",u})({}),x=(function(u){return u.MEDIA_ATTACHING="hlsMediaAttaching",u.MEDIA_ATTACHED="hlsMediaAttached",u.MEDIA_DETACHING="hlsMediaDetaching",u.MEDIA_DETACHED="hlsMediaDetached",u.MEDIA_ENDED="hlsMediaEnded",u.STALL_RESOLVED="hlsStallResolved",u.BUFFER_RESET="hlsBufferReset",u.BUFFER_CODECS="hlsBufferCodecs",u.BUFFER_CREATED="hlsBufferCreated",u.BUFFER_APPENDING="hlsBufferAppending",u.BUFFER_APPENDED="hlsBufferAppended",u.BUFFER_EOS="hlsBufferEos",u.BUFFERED_TO_END="hlsBufferedToEnd",u.BUFFER_FLUSHING="hlsBufferFlushing",u.BUFFER_FLUSHED="hlsBufferFlushed",u.MANIFEST_LOADING="hlsManifestLoading",u.MANIFEST_LOADED="hlsManifestLoaded",u.MANIFEST_PARSED="hlsManifestParsed",u.LEVEL_SWITCHING="hlsLevelSwitching",u.LEVEL_SWITCHED="hlsLevelSwitched",u.LEVEL_LOADING="hlsLevelLoading",u.LEVEL_LOADED="hlsLevelLoaded",u.LEVEL_UPDATED="hlsLevelUpdated",u.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",u.LEVELS_UPDATED="hlsLevelsUpdated",u.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",u.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",u.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",u.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",u.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",u.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",u.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",u.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",u.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",u.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",u.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",u.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",u.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",u.CUES_PARSED="hlsCuesParsed",u.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",u.INIT_PTS_FOUND="hlsInitPtsFound",u.FRAG_LOADING="hlsFragLoading",u.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",u.FRAG_LOADED="hlsFragLoaded",u.FRAG_DECRYPTED="hlsFragDecrypted",u.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",u.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",u.FRAG_PARSING_METADATA="hlsFragParsingMetadata",u.FRAG_PARSED="hlsFragParsed",u.FRAG_BUFFERED="hlsFragBuffered",u.FRAG_CHANGED="hlsFragChanged",u.FPS_DROP="hlsFpsDrop",u.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",u.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",u.ERROR="hlsError",u.DESTROYING="hlsDestroying",u.KEY_LOADING="hlsKeyLoading",u.KEY_LOADED="hlsKeyLoaded",u.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",u.BACK_BUFFER_REACHED="hlsBackBufferReached",u.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",u.ASSET_LIST_LOADING="hlsAssetListLoading",u.ASSET_LIST_LOADED="hlsAssetListLoaded",u.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",u.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",u.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",u.INTERSTITIAL_STARTED="hlsInterstitialStarted",u.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",u.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",u.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",u.INTERSTITIAL_ENDED="hlsInterstitialEnded",u.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",u.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",u.EVENT_CUE_ENTER="hlsEventCueEnter",u})({});var Rt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},dt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Qn{constructor(t,e=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=s}sample(t,e){const s=Math.pow(this.alpha_,t);this.estimate_=e*(1-s)+s*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class OT{constructor(t,e,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Qn(t),this.fast_=new Qn(e),this.defaultTTFB_=r,this.ttfb_=new Qn(t)}update(t,e){const{slow_:s,fast_:r,ttfb_:l}=this;s.halfLife!==t&&(this.slow_=new Qn(t,s.getEstimate(),s.getTotalWeight())),r.halfLife!==e&&(this.fast_=new Qn(e,r.getEstimate(),r.getTotalWeight())),l.halfLife!==t&&(this.ttfb_=new Qn(t,l.getEstimate(),l.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const s=8*e,r=t/1e3,l=s/r;this.fast_.sample(r,l),this.slow_.sample(r,l)}sampleTTFB(t){const e=t/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(s,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function MT(u,t,e){return(t=wT(t))in u?Object.defineProperty(u,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):u[t]=e,u}function Kt(){return Kt=Object.assign?Object.assign.bind():function(u){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)({}).hasOwnProperty.call(e,s)&&(u[s]=e[s])}return u},Kt.apply(null,arguments)}function fm(u,t){var e=Object.keys(u);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(u);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),e.push.apply(e,s)}return e}function $t(u){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fm(Object(e),!0).forEach(function(s){MT(u,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(e)):fm(Object(e)).forEach(function(s){Object.defineProperty(u,s,Object.getOwnPropertyDescriptor(e,s))})}return u}function kT(u,t){if(typeof u!="object"||!u)return u;var e=u[Symbol.toPrimitive];if(e!==void 0){var s=e.call(u,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(u)}function wT(u){var t=kT(u,"string");return typeof t=="symbol"?t:t+""}class pi{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${t}]:`;this.trace=ws,this.debug=e.debug.bind(null,s),this.log=e.log.bind(null,s),this.warn=e.warn.bind(null,s),this.info=e.info.bind(null,s),this.error=e.error.bind(null,s)}}const ws=function(){},NT={trace:ws,debug:ws,log:ws,warn:ws,info:ws,error:ws};function ff(){return Kt({},NT)}function PT(u,t){const e=self.console[u];return e?e.bind(self.console,`${t?"["+t+"] ":""}[${u}] >`):ws}function hm(u,t,e){return t[u]?t[u].bind(t):PT(u,e)}const hf=ff();function UT(u,t,e){const s=ff();if(typeof console=="object"&&u===!0||typeof u=="object"){const r=["debug","log","info","warn","error"];r.forEach(l=>{s[l]=hm(l,u,e)});try{s.log(`Debug logs enabled for "${t}" in hls.js version 1.6.15`)}catch{return ff()}r.forEach(l=>{hf[l]=hm(l,u)})}else Kt(hf,s);return s}const Gt=hf;function Us(u=!0){return typeof self>"u"?void 0:(u||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function BT(u){return typeof self<"u"&&u===self.ManagedMediaSource}function Mp(u,t){const e=Object.keys(u),s=Object.keys(t),r=e.length,l=s.length;return!r||!l||r===l&&!e.some(o=>s.indexOf(o)===-1)}function si(u,t=!1){if(typeof TextDecoder<"u"){const h=new TextDecoder("utf-8").decode(u);if(t){const g=h.indexOf("\0");return g!==-1?h.substring(0,g):h}return h.replace(/\0/g,"")}const e=u.length;let s,r,l,o="",f=0;for(;f<e;){if(s=u[f++],s===0&&t)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:r=u[f++],o+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=u[f++],l=u[f++],o+=String.fromCharCode((s&15)<<12|(r&63)<<6|(l&63)<<0);break}}return o}function Re(u){let t="";for(let e=0;e<u.length;e++){let s=u[e].toString(16);s.length<2&&(s="0"+s),t+=s}return t}function kp(u){return Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function FT(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var $c={exports:{}},dm;function $T(){return dm||(dm=1,(function(u,t){(function(e){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,f={buildAbsoluteURL:function(d,h,g){if(g=g||{},d=d.trim(),h=h.trim(),!h){if(!g.alwaysNormalize)return d;var p=f.parseURL(d);if(!p)throw new Error("Error trying to parse base URL.");return p.path=f.normalizePath(p.path),f.buildURLFromParts(p)}var v=f.parseURL(h);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return g.alwaysNormalize?(v.path=f.normalizePath(v.path),f.buildURLFromParts(v)):h;var E=f.parseURL(d);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var S=r.exec(E.path);E.netLoc=S[1],E.path=S[2]}E.netLoc&&!E.path&&(E.path="/");var A={scheme:E.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(A.netLoc=E.netLoc,v.path[0]!=="/"))if(!v.path)A.path=E.path,v.params||(A.params=E.params,v.query||(A.query=E.query));else{var b=E.path,L=b.substring(0,b.lastIndexOf("/")+1)+v.path;A.path=f.normalizePath(L)}return A.path===null&&(A.path=g.alwaysNormalize?f.normalizePath(v.path):v.path),f.buildURLFromParts(A)},parseURL:function(d){var h=s.exec(d);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(l,"");d.length!==(d=d.replace(o,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};u.exports=f})()})($c)),$c.exports}var Of=$T();class Mf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Yt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class wp{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof t=="string"&&(t={url:t}),this.base=t,HT(this,"stats")}setByteRange(t,e){const s=t.split("@",2);let r;s.length===1?r=(e==null?void 0:e.byteRangeEndOffset)||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Yt.AUDIO]:null,[Yt.VIDEO]:null,[Yt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Mf),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Of.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Yt.AUDIO]=null,t[Yt.VIDEO]=null,t[Yt.AUDIOVIDEO]=null}}function ae(u){return u.sn!=="initSegment"}class Gc extends wp{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange.length){const t=this.byteRange[0],e=this.byteRange[1];if(ct(t)&&ct(e))return e-t}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){var t;const{levelkeys:e}=this;if(!e||e.NONE)return null;if(e.identity)this._decryptdata||(this._decryptdata=e.identity.getDecryptData(this.sn));else if(!((t=this._decryptdata)!=null&&t.keyId)){const s=Object.keys(e);if(s.length===1){const r=this._decryptdata=e[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,e))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const t=ct(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var e;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(e=this.levelkeys[s[0]])!=null&&e.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){if(!ct(t)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=t}get ref(){return ae(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){const e=this.levelkeys;if(e){var s;const r=e[t];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,e))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,s,r,l,o=!1){const{elementaryStreams:f}=this,d=f[t];if(!d){f[t]={startPTS:e,endPTS:s,startDTS:r,endDTS:l,partial:o};return}d.startPTS=Math.min(d.startPTS,e),d.endPTS=Math.max(d.endPTS,s),d.startDTS=Math.min(d.startDTS,r),d.endDTS=Math.max(d.endDTS,l)}}class GT extends wp{constructor(t,e,s,r,l){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=r;const o=t.enumeratedString("BYTERANGE");o&&this.setByteRange(o,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function Np(u,t){const e=Object.getPrototypeOf(u);if(e){const s=Object.getOwnPropertyDescriptor(e,t);return s||Np(e,t)}}function HT(u,t){const e=Np(u,t);e&&(e.enumerable=!0,Object.defineProperty(u,t,e))}const gm=Math.pow(2,32)-1,VT=[].push,Pp={video:1,audio:2,id3:3,text:4};function he(u){return String.fromCharCode.apply(null,u)}function Up(u,t){const e=u[t]<<8|u[t+1];return e<0?65536+e:e}function St(u,t){const e=Bp(u,t);return e<0?4294967296+e:e}function mm(u,t){let e=St(u,t);return e*=Math.pow(2,32),e+=St(u,t+4),e}function Bp(u,t){return u[t]<<24|u[t+1]<<16|u[t+2]<<8|u[t+3]}function zT(u){const t=u.byteLength;for(let e=0;e<t;){const s=St(u,e);if(s>8&&u[e+4]===109&&u[e+5]===111&&u[e+6]===111&&u[e+7]===102)return!0;e=s>1?e+s:t}return!1}function Lt(u,t){const e=[];if(!t.length)return e;const s=u.byteLength;for(let r=0;r<s;){const l=St(u,r),o=he(u.subarray(r+4,r+8)),f=l>1?r+l:s;if(o===t[0])if(t.length===1)e.push(u.subarray(r+8,f));else{const d=Lt(u.subarray(r+8,f),t.slice(1));d.length&&VT.apply(e,d)}r=f}return e}function KT(u){const t=[],e=u[0];let s=8;const r=St(u,s);s+=4;let l=0,o=0;e===0?(l=St(u,s),o=St(u,s+4),s+=8):(l=mm(u,s),o=mm(u,s+8),s+=16),s+=2;let f=u.length+o;const d=Up(u,s);s+=2;for(let h=0;h<d;h++){let g=s;const p=St(u,g);g+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return Gt.warn("SIDX has hierarchical references (not supported)"),null;const S=St(u,g);g+=4,t.push({referenceSize:v,subsegmentDuration:S,info:{duration:S/r,start:f,end:f+v-1}}),f+=v,g+=4,s=g}return{earliestPresentationTime:l,timescale:r,version:e,referencesCount:d,references:t}}function Fp(u){const t=[],e=Lt(u,["moov","trak"]);for(let r=0;r<e.length;r++){const l=e[r],o=Lt(l,["tkhd"])[0];if(o){let f=o[0];const d=St(o,f===0?12:20),h=Lt(l,["mdia","mdhd"])[0];if(h){f=h[0];const g=St(h,f===0?12:20),p=Lt(l,["mdia","hdlr"])[0];if(p){const v=he(p.subarray(8,12)),E={soun:Yt.AUDIO,vide:Yt.VIDEO}[v],S=Lt(l,["mdia","minf","stbl","stsd"])[0],A=jT(S);E?(t[d]={timescale:g,type:E,stsd:A},t[E]=$t({timescale:g,id:d},A)):t[d]={timescale:g,type:v,stsd:A}}}}}return Lt(u,["moov","mvex","trex"]).forEach(r=>{const l=St(r,4),o=t[l];o&&(o.default={duration:St(r,12),flags:St(r,20)})}),t}function jT(u){const t=u.subarray(8),e=t.subarray(86),s=he(t.subarray(4,8));let r=s,l;const o=s==="enca"||s==="encv";if(o){const h=Lt(t,[s])[0].subarray(s==="enca"?28:78);Lt(h,["sinf"]).forEach(p=>{const v=Lt(p,["schm"])[0];if(v){const E=he(v.subarray(4,8));if(E==="cbcs"||E==="cenc"){const S=Lt(p,["frma"])[0];S&&(r=he(S))}}})}const f=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const d=Lt(e,["avcC"])[0];d&&d.length>3&&(r+="."+Fl(d[1])+Fl(d[2])+Fl(d[3]),l=Bl(f==="avc1"?"dva1":"dvav",e));break}case"mp4a":{const d=Lt(t,[s])[0],h=Lt(d.subarray(28),["esds"])[0];if(h&&h.length>7){let g=4;if(h[g++]!==3)break;g=Hc(h,g),g+=2;const p=h[g++];if(p&128&&(g+=2),p&64&&(g+=h[g++]),h[g++]!==4)break;g=Hc(h,g);const v=h[g++];if(v===64)r+="."+Fl(v);else break;if(g+=12,h[g++]!==5)break;g=Hc(h,g);const E=h[g++];let S=(E&248)>>3;S===31&&(S+=1+((E&7)<<3)+((h[g]&224)>>5)),r+="."+S}break}case"hvc1":case"hev1":{const d=Lt(e,["hvcC"])[0];if(d&&d.length>12){const h=d[1],g=["","A","B","C"][h>>6],p=h&31,v=St(d,2),E=(h&32)>>5?"H":"L",S=d[12],A=d.subarray(6,12);r+="."+g+p,r+="."+YT(v).toString(16).toUpperCase(),r+="."+E+S;let b="";for(let L=A.length;L--;){const _=A[L];(_||b)&&(b="."+_.toString(16).toUpperCase()+b)}r+=b}l=Bl(f=="hev1"?"dvhe":"dvh1",e);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Bl(r,e)||r;break}case"vp09":{const d=Lt(e,["vpcC"])[0];if(d&&d.length>6){const h=d[4],g=d[5],p=d[6]>>4&15;r+="."+Oi(h)+"."+Oi(g)+"."+Oi(p)}break}case"av01":{const d=Lt(e,["av1C"])[0];if(d&&d.length>2){const h=d[1]>>>5,g=d[1]&31,p=d[2]>>>7?"H":"M",v=(d[2]&64)>>6,E=(d[2]&32)>>5,S=h===2&&v?E?12:10:v?10:8,A=(d[2]&16)>>4,b=(d[2]&8)>>3,L=(d[2]&4)>>2,_=d[2]&3;r+="."+h+"."+Oi(g)+p+"."+Oi(S)+"."+A+"."+b+L+_+"."+Oi(1)+"."+Oi(1)+"."+Oi(1)+"."+0,l=Bl("dav1",e)}break}}return{codec:r,encrypted:o,supplemental:l}}function Bl(u,t){const e=Lt(t,["dvvC"]),s=e.length?e[0]:Lt(t,["dvcC"])[0];if(s){const r=s[2]>>1&127,l=s[2]<<5&32|s[3]>>3&31;return u+"."+Oi(r)+"."+Oi(l)}}function YT(u){let t=0;for(let e=0;e<32;e++)t|=(u>>e&1)<<31-e;return t>>>0}function Hc(u,t){const e=t+5;for(;u[t++]&128&&t<e;);return t}function Fl(u){return("0"+u.toString(16).toUpperCase()).slice(-2)}function Oi(u){return(u<10?"0":"")+u}function qT(u,t){if(!u||!t)return;const e=t.keyId;e&&t.isCommonEncryption&&$p(u,(s,r)=>{const l=s.subarray(8,24);l.some(o=>o!==0)||(Gt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Re(l)} -> ${Re(e)}`),s.set(e,8))})}function XT(u){const t=[];return $p(u,e=>t.push(e.subarray(8,24))),t}function $p(u,t){Lt(u,["moov","trak"]).forEach(s=>{const r=Lt(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const l=r.subarray(8);let o=Lt(l,["enca"]);const f=o.length>0;f||(o=Lt(l,["encv"])),o.forEach(d=>{const h=f?d.subarray(28):d.subarray(78);Lt(h,["sinf"]).forEach(p=>{const v=Gp(p);v&&t(v,f)})})})}function Gp(u){const t=Lt(u,["schm"])[0];if(t){const e=he(t.subarray(4,8));if(e==="cbcs"||e==="cenc"){const s=Lt(u,["schi","tenc"])[0];if(s)return s}}}function QT(u,t,e){const s={},r=Lt(u,["moof","traf"]);for(let l=0;l<r.length;l++){const o=r[l],f=Lt(o,["tfhd"])[0],d=St(f,4),h=t[d];if(!h)continue;s[d]||(s[d]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type});const g=s[d],p=Lt(o,["tfdt"])[0];if(p){const D=p[0];let C=St(p,4);D===1&&(C===gm?e.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=gm+1,C+=St(p,8))),ct(C)&&(!ct(g.start)||C<g.start)&&(g.start=C)}const v=h.default,E=St(f,0)|(v==null?void 0:v.flags);let S=(v==null?void 0:v.duration)||0;E&8&&(E&2?S=St(f,12):S=St(f,8));const A=Lt(o,["trun"]);let b=g.start||0,L=0,_=S;for(let D=0;D<A.length;D++){const C=A[D],k=St(C,4),K=g.sampleCount;g.sampleCount+=k;const O=C[3]&1,F=C[3]&4,$=C[2]&1,U=C[2]&2,Q=C[2]&4,st=C[2]&8;let ut=8,ht=k;for(O&&(ut+=4),F&&k&&(!(C[ut+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=K),ut+=4,$?(_=St(C,ut),ut+=4):_=S,U&&(ut+=4),st&&(ut+=4),b+=_,L+=_,ht--);ht--;)$?(_=St(C,ut),ut+=4):_=S,U&&(ut+=4),Q&&(C[ut+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(ht+1),g.keyFrameStart=b),ut+=4),st&&(ut+=4),b+=_,L+=_;!L&&S&&(L+=S*k)}g.duration+=L}if(!Object.keys(s).some(l=>s[l].duration)){let l=1/0,o=0;const f=Lt(u,["sidx"]);for(let d=0;d<f.length;d++){const h=KT(f[d]);if(h!=null&&h.references){l=Math.min(l,h.earliestPresentationTime/h.timescale);const g=h.references.reduce((p,v)=>p+v.info.duration||0,0);o=Math.max(o,g+h.earliestPresentationTime/h.timescale)}}o&&ct(o)&&Object.keys(s).forEach(d=>{s[d].duration||(s[d].duration=o*s[d].timescale-s[d].start)})}return s}function WT(u){const t={valid:null,remainder:null},e=Lt(u,["moof"]);if(e.length<2)return t.remainder=u,t;const s=e[e.length-1];return t.valid=u.slice(0,s.byteOffset-8),t.remainder=u.slice(s.byteOffset-8),t}function mi(u,t){const e=new Uint8Array(u.length+t.length);return e.set(u),e.set(t,u.length),e}function pm(u,t){const e=[],s=t.samples,r=t.timescale,l=t.id;let o=!1;return Lt(s,["moof"]).map(d=>{const h=d.byteOffset-8;Lt(d,["traf"]).map(p=>{const v=Lt(p,["tfdt"]).map(E=>{const S=E[0];let A=St(E,4);return S===1&&(A*=Math.pow(2,32),A+=St(E,8)),A/r})[0];return v!==void 0&&(u=v),Lt(p,["tfhd"]).map(E=>{const S=St(E,4),A=St(E,0)&16777215,b=(A&1)!==0,L=(A&2)!==0,_=(A&8)!==0;let D=0;const C=(A&16)!==0;let k=0;const K=(A&32)!==0;let O=8;S===l&&(b&&(O+=8),L&&(O+=4),_&&(D=St(E,O),O+=4),C&&(k=St(E,O),O+=4),K&&(O+=4),t.type==="video"&&(o=Eo(t.codec)),Lt(p,["trun"]).map(F=>{const $=F[0],U=St(F,0)&16777215,Q=(U&1)!==0;let st=0;const ut=(U&4)!==0,ht=(U&256)!==0;let lt=0;const w=(U&512)!==0;let X=0;const Z=(U&1024)!==0,rt=(U&2048)!==0;let ot=0;const I=St(F,4);let P=8;Q&&(st=St(F,P),P+=4),ut&&(P+=4);let it=st+h;for(let nt=0;nt<I;nt++){if(ht?(lt=St(F,P),P+=4):lt=D,w?(X=St(F,P),P+=4):X=k,Z&&(P+=4),rt&&($===0?ot=St(F,P):ot=Bp(F,P),P+=4),t.type===Yt.VIDEO){let at=0;for(;at<X;){const ft=St(s,it);if(it+=4,ZT(o,s[it])){const Et=s.subarray(it,it+ft);kf(Et,o?2:1,u+ot/r,e)}it+=ft,at+=ft+4}}u+=lt/r}}))})})}),e}function Eo(u){if(!u)return!1;const t=u.substring(0,4);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function ZT(u,t){if(u){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function kf(u,t,e,s){const r=Hp(u);let l=0;l+=t;let o=0,f=0,d=0;for(;l<r.length;){o=0;do{if(l>=r.length)break;d=r[l++],o+=d}while(d===255);f=0;do{if(l>=r.length)break;d=r[l++],f+=d}while(d===255);const h=r.length-l;let g=l;if(f<h)l+=f;else if(f>h){Gt.error(`Malformed SEI payload. ${f} is too small, only ${h} bytes left to parse.`);break}if(o===4){if(r[g++]===181){const v=Up(r,g);if(g+=2,v===49){const E=St(r,g);if(g+=4,E===1195456820){const S=r[g++];if(S===3){const A=r[g++],b=31&A,L=64&A,_=L?2+b*3:0,D=new Uint8Array(_);if(L){D[0]=A;for(let C=1;C<_;C++)D[C]=r[g++]}s.push({type:S,payloadType:o,pts:e,bytes:D})}}}}}else if(o===5&&f>16){const p=[];for(let S=0;S<16;S++){const A=r[g++].toString(16);p.push(A.length==1?"0"+A:A),(S===3||S===5||S===7||S===9)&&p.push("-")}const v=f-16,E=new Uint8Array(v);for(let S=0;S<v;S++)E[S]=r[g++];s.push({payloadType:o,pts:e,uuid:p.join(""),userData:si(E),userDataBytes:E})}}}function Hp(u){const t=u.byteLength,e=[];let s=1;for(;s<t-2;)u[s]===0&&u[s+1]===0&&u[s+2]===3?(e.push(s+2),s+=2):s++;if(e.length===0)return u;const r=t-e.length,l=new Uint8Array(r);let o=0;for(s=0;s<r;o++,s++)o===e[0]&&(o++,e.shift()),l[s]=u[o];return l}function JT(u){const t=u[0];let e="",s="",r=0,l=0,o=0,f=0,d=0,h=0;if(t===0){for(;he(u.subarray(h,h+1))!=="\0";)e+=he(u.subarray(h,h+1)),h+=1;for(e+=he(u.subarray(h,h+1)),h+=1;he(u.subarray(h,h+1))!=="\0";)s+=he(u.subarray(h,h+1)),h+=1;s+=he(u.subarray(h,h+1)),h+=1,r=St(u,12),l=St(u,16),f=St(u,20),d=St(u,24),h=28}else if(t===1){h+=4,r=St(u,h),h+=4;const p=St(u,h);h+=4;const v=St(u,h);for(h+=4,o=2**32*p+v,IT(o)||(o=Number.MAX_SAFE_INTEGER,Gt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),f=St(u,h),h+=4,d=St(u,h),h+=4;he(u.subarray(h,h+1))!=="\0";)e+=he(u.subarray(h,h+1)),h+=1;for(e+=he(u.subarray(h,h+1)),h+=1;he(u.subarray(h,h+1))!=="\0";)s+=he(u.subarray(h,h+1)),h+=1;s+=he(u.subarray(h,h+1)),h+=1}const g=u.subarray(h,u.byteLength);return{schemeIdUri:e,value:s,timeScale:r,presentationTime:o,presentationTimeDelta:l,eventDuration:f,id:d,payload:g}}function tx(u,...t){const e=t.length;let s=8,r=e;for(;r--;)s+=t[r].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(u,4),r=0,s=8;r<e;r++)l.set(t[r],s),s+=t[r].byteLength;return l}function ex(u,t,e){if(u.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let l;s>0?(l=new Uint8Array(4),t.length>0&&new DataView(l.buffer).setUint32(0,t.length,!1)):l=new Uint8Array;const o=new Uint8Array(4);return e.byteLength>0&&new DataView(o.buffer).setUint32(0,e.byteLength,!1),tx([112,115,115,104],new Uint8Array([s,0,0,0]),u,l,r,o,e)}function ix(u){const t=[];if(u instanceof ArrayBuffer){const e=u.byteLength;let s=0;for(;s+32<e;){const r=new DataView(u,s),l=sx(r);t.push(l),s+=l.size}}return t}function sx(u){const t=u.getUint32(0),e=u.byteOffset,s=u.byteLength;if(s<t)return{offset:e,size:s};if(u.getUint32(4)!==1886614376)return{offset:e,size:t};const l=u.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:e,size:t};const o=u.buffer,f=Re(new Uint8Array(o,e+12,16));let d=null,h=null,g=0;if(l===0)g=28;else{const v=u.getUint32(28);if(!v||s<32+v*16)return{offset:e,size:t};d=[];for(let E=0;E<v;E++)d.push(new Uint8Array(o,e+32+E*16,16));g=32+v*16}if(!g)return{offset:e,size:t};const p=u.getUint32(g);return t-32<p?{offset:e,size:t}:(h=new Uint8Array(o,e+g+4,p),{version:l,systemId:f,kids:d,data:h,offset:e,size:t})}const Vp=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),lr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function wf(u,t){const e=lr[t];return!!e&&!!e[u.slice(0,4)]}function fa(u,t,e=!0){return!u.split(",").some(s=>!Nf(s,t,e))}function Nf(u,t,e=!0){var s;const r=Us(e);return(s=r==null?void 0:r.isTypeSupported(ha(u,t)))!=null?s:!1}function ha(u,t){return`${t}/mp4;codecs=${u}`}function ym(u){if(u){const t=u.substring(0,4);return lr.video[t]}return 2}function lo(u){const t=Vp();return u.split(",").reduce((e,s)=>{const l=t&&Eo(s)?9:lr.video[s];return l?(l*2+e)/(e?3:2):(lr.audio[s]+e)/(e?2:1)},0)}const Vc={};function nx(u,t=!0){if(Vc[u])return Vc[u];const e={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[u];for(let r=0;r<e.length;r++){var s;if(Nf(e[r],"audio",t))return Vc[u]=e[r],e[r];if(e[r]==="mp3"&&(s=Us(t))!=null&&s.isTypeSupported("audio/mpeg"))return""}return u}const rx=/flac|opus|mp4a\.40\.34/i;function oo(u,t=!0){return u.replace(rx,e=>nx(e.toLowerCase(),t))}function ax(u,t){const e=[];if(u){const s=u.split(",");for(let r=0;r<s.length;r++)wf(s[r],"video")||e.push(s[r])}return t&&e.push(t),e.join(",")}function Jl(u,t){if(u&&(u.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(u)!==-1)&&(vm(u,"audio")||vm(u,"video")))return u;if(t){const e=t.split(",");if(e.length>1){if(u){for(let s=e.length;s--;)if(e[s].substring(0,4)===u.substring(0,4))return e[s]}return e[0]}}return t||u}function vm(u,t){return wf(u,t)&&Nf(u,t)}function lx(u){const t=u.split(",");for(let e=0;e<t.length;e++){const s=t[e].split(".");s.length>2&&s[0]==="avc1"&&(t[e]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return t.join(",")}function ox(u){if(u.startsWith("av01.")){const t=u.split("."),e=["0","111","01","01","01","0"];for(let s=t.length;s>4&&s<10;s++)t[s]=e[s-4];return t.join(".")}return u}function Em(u){const t=Us(u)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function df(u){return u.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const ux={supported:!0,powerEfficient:!0,smooth:!0},cx={supported:!1,smooth:!1,powerEfficient:!1},zp={supported:!0,configurations:[],decodingInfoResults:[ux]};function Kp(u,t){return{supported:!1,configurations:t,decodingInfoResults:[cx],error:u}}function fx(u,t,e,s,r,l){const o=u.videoCodec,f=u.audioCodec?u.audioGroups:null,d=l==null?void 0:l.audioCodec,h=l==null?void 0:l.channels,g=h?parseInt(h):d?1/0:2;let p=null;if(f!=null&&f.length)try{f.length===1&&f[0]?p=t.groups[f[0]].channels:p=f.reduce((v,E)=>{if(E){const S=t.groups[E];if(!S)throw new Error(`Audio track group ${E} not found`);Object.keys(S.channels).forEach(A=>{v[A]=(v[A]||0)+S.channels[A]})}return v},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(v=>Eo(v))||u.width>1920&&u.height>1088||u.height>1920&&u.width>1088||u.frameRate>Math.max(s,30)||u.videoRange!=="SDR"&&u.videoRange!==e||u.bitrate>Math.max(r,8e6))||!!p&&ct(g)&&Object.keys(p).some(v=>parseInt(v)>g)}function jp(u,t,e,s={}){const r=u.videoCodec;if(!r&&!u.audioCodec||!e)return Promise.resolve(zp);const l=[],o=hx(u),f=o.length,d=dx(u,t,f>0),h=d.length;for(let g=f||1*h||1;g--;){const p={type:"media-source"};if(f&&(p.video=o[g%f]),h){p.audio=d[g%h];const v=p.audio.bitrate;p.video&&v&&(p.video.bitrate-=v)}l.push(p)}if(r){const g=navigator.userAgent;if(r.split(",").some(p=>Eo(p))&&Vp())return Promise.resolve(Kp(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${g})`),l))}return Promise.all(l.map(g=>{const p=mx(g);return s[p]||(s[p]=e.decodingInfo(g))})).then(g=>({supported:!g.some(p=>!p.supported),configurations:l,decodingInfoResults:g})).catch(g=>({supported:!1,configurations:l,decodingInfoResults:[],error:g}))}function hx(u){var t;const e=(t=u.videoCodec)==null?void 0:t.split(","),s=Yp(u),r=u.width||640,l=u.height||480,o=u.frameRate||30,f=u.videoRange.toLowerCase();return e?e.map(d=>{const h={contentType:ha(ox(d),"video"),width:r,height:l,bitrate:s,framerate:o};return f!=="sdr"&&(h.transferFunction=f),h}):[]}function dx(u,t,e){var s;const r=(s=u.audioCodec)==null?void 0:s.split(","),l=Yp(u);return r&&u.audioGroups?u.audioGroups.reduce((o,f)=>{var d;const h=f?(d=t.groups[f])==null?void 0:d.tracks:null;return h?h.reduce((g,p)=>{if(p.groupId===f){const v=parseFloat(p.channels||"");r.forEach(E=>{const S={contentType:ha(E,"audio"),bitrate:e?gx(E,l):l};v&&(S.channels=""+v),g.push(S)})}return g},o):o},[]):[]}function gx(u,t){if(t<=1)return 1;let e=128e3;return u==="ec-3"?e=768e3:u==="ac-3"&&(e=64e4),Math.min(t/2,e)}function Yp(u){return Math.ceil(Math.max(u.bitrate*.9,u.averageBitrate)/1e3)*1e3||1}function mx(u){let t="";const{audio:e,video:s}=u;if(s){const r=df(s.contentType);t+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(e){const r=df(e.contentType);t+=`${s?"_":""}${r}_c${e.channels}`}return t}const gf=["NONE","TYPE-0","TYPE-1",null];function px(u){return gf.indexOf(u)>-1}const uo=["SDR","PQ","HLG"];function yx(u){return!!u&&uo.indexOf(u)>-1}var to={No:"",Yes:"YES",v2:"v2"};function Sm(u){const{canSkipUntil:t,canSkipDateRanges:e,age:s}=u,r=s<t/2;return t&&r?e?to.v2:to.Yes:to.No}class Tm{constructor(t,e,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=s}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class da{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const s=(e=t.supplemental)==null?void 0:e.videoCodec;s&&s!==t.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return xm(this._audioGroups,t)}hasSubtitleGroup(t){return xm(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e){if(t==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(e)===-1&&s.push(e)}else if(t==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(e)===-1&&s.push(e)}}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return(t=this.audioGroups)==null?void 0:t[0]}get textGroupId(){var t;return(t=this.subtitleGroups)==null?void 0:t[0]}addFallback(){}}function xm(u,t){return!t||!u?!1:u.indexOf(t)!==-1}function vx(){if(typeof matchMedia=="function"){const u=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(u.media!==t.media)return u.matches===!0}return!1}function Ex(u,t){let e=!1,s=[];if(u&&(e=u!=="SDR",s=[u]),t){s=t.allowedVideoRanges||uo.slice(0);const r=s.join("")!=="SDR"&&!t.videoCodec;e=t.preferHDR!==void 0?t.preferHDR:r&&vx(),e||(s=["SDR"])}return{preferHDR:e,allowedVideoRanges:s}}const Sx=u=>{const t=new WeakSet;return(e,s)=>{if(u&&(s=u(e,s)),typeof s=="object"&&s!==null){if(t.has(s))return;t.add(s)}return s}},qt=(u,t)=>JSON.stringify(u,Sx(t));function Tx(u,t,e,s,r){const l=Object.keys(u),o=s==null?void 0:s.channels,f=s==null?void 0:s.audioCodec,d=r==null?void 0:r.videoCodec,h=o&&parseInt(o)===2;let g=!1,p=!1,v=1/0,E=1/0,S=1/0,A=1/0,b=0,L=[];const{preferHDR:_,allowedVideoRanges:D}=Ex(t,r);for(let F=l.length;F--;){const $=u[l[F]];g||(g=$.channels[2]>0),v=Math.min(v,$.minHeight),E=Math.min(E,$.minFramerate),S=Math.min(S,$.minBitrate),D.filter(Q=>$.videoRanges[Q]>0).length>0&&(p=!0)}v=ct(v)?v:0,E=ct(E)?E:0;const C=Math.max(1080,v),k=Math.max(30,E);S=ct(S)?S:e,e=Math.max(S,e),p||(t=void 0);const K=l.length>1;return{codecSet:l.reduce((F,$)=>{const U=u[$];if($===F)return F;if(L=p?D.filter(Q=>U.videoRanges[Q]>0):[],K){if(U.minBitrate>e)return Ii($,`min bitrate of ${U.minBitrate} > current estimate of ${e}`),F;if(!U.hasDefaultAudio)return Ii($,"no renditions with default or auto-select sound found"),F;if(f&&$.indexOf(f.substring(0,4))%5!==0)return Ii($,`audio codec preference "${f}" not found`),F;if(o&&!h){if(!U.channels[o])return Ii($,`no renditions with ${o} channel sound found (channels options: ${Object.keys(U.channels)})`),F}else if((!f||h)&&g&&U.channels[2]===0)return Ii($,"no renditions with stereo sound found"),F;if(U.minHeight>C)return Ii($,`min resolution of ${U.minHeight} > maximum of ${C}`),F;if(U.minFramerate>k)return Ii($,`min framerate of ${U.minFramerate} > maximum of ${k}`),F;if(!L.some(Q=>U.videoRanges[Q]>0))return Ii($,`no variants with VIDEO-RANGE of ${qt(L)} found`),F;if(d&&$.indexOf(d.substring(0,4))%5!==0)return Ii($,`video codec preference "${d}" not found`),F;if(U.maxScore<b)return Ii($,`max score of ${U.maxScore} < selected max of ${b}`),F}return F&&(lo($)>=lo(F)||U.fragmentError>u[F].fragmentError)?F:(A=U.minIndex,b=U.maxScore,$)},void 0),videoRanges:L,preferHDR:_,minFramerate:E,minBitrate:S,minIndex:A}}function Ii(u,t){Gt.log(`[abr] start candidates with "${u}" ignored because ${t}`)}function qp(u){return u.reduce((t,e)=>{let s=t.groups[e.groupId];s||(s=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(e);const r=e.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||e.default,s.hasAutoSelect=s.hasAutoSelect||e.autoselect,s.hasDefault&&(t.hasDefaultAudio=!0),s.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function xx(u,t,e,s){return u.slice(e,s+1).reduce((r,l,o)=>{if(!l.codecSet)return r;const f=l.audioGroups;let d=r[l.codecSet];d||(r[l.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!f,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,l.bitrate);const h=Math.min(l.height,l.width);return d.minHeight=Math.min(d.minHeight,h),d.minFramerate=Math.min(d.minFramerate,l.frameRate),d.minIndex=Math.min(d.minIndex,o),d.maxScore=Math.max(d.maxScore,l.score),d.fragmentError+=l.fragmentError,d.videoRanges[l.videoRange]=(d.videoRanges[l.videoRange]||0)+1,f&&f.forEach(g=>{if(!g)return;const p=t.groups[g];p&&(d.hasDefaultAudio=d.hasDefaultAudio||t.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{d.channels[v]=(d.channels[v]||0)+p.channels[v]}))}),r},{})}function Am(u){if(!u)return u;const{lang:t,assocLang:e,characteristics:s,channels:r,audioCodec:l}=u;return{lang:t,assocLang:e,characteristics:s,channels:r,audioCodec:l}}function ki(u,t,e){if("attrs"in u){const s=t.indexOf(u);if(s!==-1)return s}for(let s=0;s<t.length;s++){const r=t[s];if(on(u,r,e))return s}return-1}function on(u,t,e){const{groupId:s,name:r,lang:l,assocLang:o,default:f}=u,d=u.forced;return(s===void 0||t.groupId===s)&&(r===void 0||t.name===r)&&(l===void 0||Ax(l,t.lang))&&(l===void 0||t.assocLang===o)&&(f===void 0||t.default===f)&&(d===void 0||t.forced===d)&&(!("characteristics"in u)||bx(u.characteristics||"",t.characteristics))&&(e===void 0||e(u,t))}function Ax(u,t="--"){return u.length===t.length?u===t:u.startsWith(t)||t.startsWith(u)}function bx(u,t=""){const e=u.split(","),s=t.split(",");return e.length===s.length&&!e.some(r=>s.indexOf(r)===-1)}function ln(u,t){const{audioCodec:e,channels:s}=u;return(e===void 0||(t.audioCodec||"").substring(0,4)===e.substring(0,4))&&(s===void 0||s===(t.channels||"2"))}function Lx(u,t,e,s,r){const l=t[s],f=t.reduce((v,E,S)=>{const A=E.uri;return(v[A]||(v[A]=[])).push(S),v},{})[l.uri];f.length>1&&(s=Math.max.apply(Math,f));const d=l.videoRange,h=l.frameRate,g=l.codecSet.substring(0,4),p=bm(t,s,v=>{if(v.videoRange!==d||v.frameRate!==h||v.codecSet.substring(0,4)!==g)return!1;const E=v.audioGroups,S=e.filter(A=>!E||E.indexOf(A.groupId)!==-1);return ki(u,S,r)>-1});return p>-1?p:bm(t,s,v=>{const E=v.audioGroups,S=e.filter(A=>!E||E.indexOf(A.groupId)!==-1);return ki(u,S,r)>-1})}function bm(u,t,e){for(let s=t;s>-1;s--)if(e(u[s]))return s;for(let s=t+1;s<u.length;s++)if(e(u[s]))return s;return-1}function co(u,t){var e;return!!u&&u!==((e=t.loadLevelObj)==null?void 0:e.uri)}class Rx extends pi{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var s;const{fragCurrent:r,partCurrent:l,hls:o}=this,{autoLevelEnabled:f,media:d}=o;if(!r||!d)return;const h=performance.now(),g=l?l.stats:r.stats,p=l?l.duration:r.duration,v=h-g.loading.start,E=o.minAutoLevel,S=r.level,A=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||S<=E){this.clearTimer(),this._nextAutoLevel=-1;return}if(!f)return;const b=A>-1&&A!==S,L=!!e||b;if(!L&&(d.paused||!d.playbackRate||!d.readyState))return;const _=o.mainForwardBufferInfo;if(!L&&_===null)return;const D=this.bwEstimator.getEstimateTTFB(),C=Math.abs(d.playbackRate);if(v<=Math.max(D,1e3*(p/(C*2))))return;const k=_?_.len/C:0,K=g.loading.first?g.loading.first-g.loading.start:-1,O=g.loaded&&K>-1,F=this.getBwEstimate(),$=o.levels,U=$[S],Q=Math.max(g.loaded,Math.round(p*(r.bitrate||U.averageBitrate)/8));let st=O?v-K:v;st<1&&O&&(st=Math.min(v,g.loaded*8/F));const ut=O?g.loaded*1e3/st:0,ht=D/1e3,lt=ut?(Q-g.loaded)/ut:Q*8/F+ht;if(lt<=k)return;const w=ut?ut*8:F,X=((s=(e==null?void 0:e.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,Z=this.hls.config.abrBandWidthUpFactor;let rt=Number.POSITIVE_INFINITY,ot;for(ot=S-1;ot>E;ot--){const nt=$[ot].maxBitrate,at=!$[ot].details||X;if(rt=this.getTimeToLoadFrag(ht,w,p*nt,at),rt<Math.min(k,p+ht))break}if(rt>=lt||rt>p*10)return;O?this.bwEstimator.sample(v-Math.min(D,K),g.loaded):this.bwEstimator.sampleTTFB(v);const I=$[ot].maxBitrate;this.getBwEstimate()*Z>I&&this.resetEstimator(I);const P=this.findBestLevel(I,E,ot,0,k,1,1);P>-1&&(ot=P),this.warn(`Fragment ${r.sn}${l?" part "+l.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${lt.toFixed(3)} s
      Estimated load time for down switch fragment: ${rt.toFixed(3)} s
      TTFB estimate: ${K|0} ms
      Current BW estimate: ${ct(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ot} @ ${I|0} bps`),o.nextLoadLevel=o.nextAutoLevel=ot,this.clearTimer();const it=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===ot&&ot>0){const nt=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ot>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${nt.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,ot>E){let at=this.findBestLevel(this.hls.levels[E].bitrate,E,ot,0,nt,1,1);at===-1&&(at=E),this.hls.nextLoadLevel=this.hls.nextAutoLevel=at,this.resetEstimator(this.hls.levels[at].bitrate)}}};b||lt>rt*2?it():this.timer=self.setInterval(it,rt*1e3),o.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:l,stats:g})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new OT(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.FRAG_LOADING,this.onFragLoading,this),t.on(x.FRAG_LOADED,this.onFragLoaded,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this),t.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.FRAG_LOADING,this.onFragLoading,this),t.off(x.FRAG_LOADED,this.onFragLoaded,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this),t.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const s=e.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=e.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case V.FRAG_LOAD_TIMEOUT:{const s=e.frag,{fragCurrent:r,partCurrent:l}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const o=performance.now(),f=l?l.stats:s.stats,d=o-f.loading.start,h=f.loading.first?f.loading.first-f.loading.start:-1;if(f.loaded&&h>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(p,h),f.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(t,e,s,r){const l=t+s/e,o=r?t+this.lastLevelLoadSec:0;return l+o}onLevelLoaded(t,e){const s=this.hls.config,{loading:r}=e.stats,l=r.end-r.first;ct(l)&&(this.lastLevelLoadSec=l/1e3),e.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,{frag:e,part:s}){const r=s?s.stats:e.stats;if(e.type===dt.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=s?s.duration:e.duration,o=this.hls.levels[e.level],f=(o.loaded?o.loaded.bytes:0)+r.loaded,d=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:f,duration:d},o.realBitrate=Math.round(8*f/d)}if(e.bitrateTest){const l={stats:r,frag:e,part:s,id:e.type};this.onFragBuffered(x.FRAG_BUFFERED,l),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:s,part:r}=e,l=r!=null&&r.stats.loaded?r.stats:s.stats;if(l.aborted||this.ignoreFragment(s))return;const o=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,l.loaded),l.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==dt.MAIN||t.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,l=this.findBestLevel(s,e,t,0,r,1,1);if(l>-1)return l;const o=this.hls.firstLevel,f=Math.min(Math.max(o,e),t);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${f}`),f}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(t!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return t;const l=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){const o=this.hls.levels;if(o.length>Math.max(t,l)&&o[t].loadError<=o[l].loadError)return t}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:l,minAutoLevel:o}=s,f=e?e.duration:t?t.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay();let g=l.abrBandWidthFactor,p=l.abrBandWidthUpFactor;if(h){const b=this.findBestLevel(d,o,r,h,0,g,p);if(b>=0)return this.rebufferNotice=-1,b}let v=f?Math.min(f,l.maxStarvationDelay):l.maxStarvationDelay;if(!h){const b=this.bitrateTestDelay;b&&(v=(f?Math.min(f,l.maxLoadingDelay):l.maxLoadingDelay)-b,this.info(`bitrate test took ${Math.round(1e3*b)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),g=p=1)}const E=this.findBestLevel(d,o,r,h,v,g,p);if(this.rebufferNotice!==E&&(this.rebufferNotice=E,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${E}`)),E>-1)return E;const S=s.levels[o],A=s.loadLevelObj;return A&&(S==null?void 0:S.bitrate)<A.bitrate?o:s.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const s=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,r=t.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,s,r,l,o,f){var d;const h=r+l,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:v,partCurrent:E}=this,{levels:S,allAudioTracks:A,loadLevel:b,config:L}=this.hls;if(S.length===1)return 0;const _=S[p],D=!!((d=this.hls.latestLevelDetails)!=null&&d.live),C=b===-1||g===-1;let k,K="SDR",O=(_==null?void 0:_.frameRate)||0;const{audioPreference:F,videoPreference:$}=L,U=this.audioTracksByGroup||(this.audioTracksByGroup=qp(A));let Q=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const w=this.codecTiers||(this.codecTiers=xx(S,U,e,s)),X=Tx(w,K,t,F,$),{codecSet:Z,videoRanges:rt,minFramerate:ot,minBitrate:I,minIndex:P,preferHDR:it}=X;Q=P,k=Z,K=it?rt[rt.length-1]:rt[0],O=ot,t=Math.max(t,I),this.log(`picked start tier ${qt(X)}`)}else k=_==null?void 0:_.codecSet,K=_==null?void 0:_.videoRange;const st=E?E.duration:v?v.duration:0,ut=this.bwEstimator.getEstimateTTFB()/1e3,ht=[];for(let w=s;w>=e;w--){var lt;const X=S[w],Z=w>p;if(!X)continue;if(L.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const at=navigator.mediaCapabilities;typeof(at==null?void 0:at.decodingInfo)=="function"&&fx(X,U,K,O,t,F)?(X.supportedPromise=jp(X,U,at,this.supportedCache),X.supportedPromise.then(ft=>{if(!this.hls)return;X.supportedResult=ft;const Et=this.hls.levels,wt=Et.indexOf(X);ft.error?this.warn(`MediaCapabilities decodingInfo error: "${ft.error}" for level ${wt} ${qt(ft)}`):ft.supported?ft.decodingInfoResults.some(kt=>kt.smooth===!1||kt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${wt} not smooth or powerEfficient: ${qt(ft)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${wt} ${qt(ft)}`),wt>-1&&Et.length>1&&(this.log(`Removing unsupported level ${wt}`),this.hls.removeLevel(wt),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ft=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ft}`)})):X.supportedResult=zp}if((k&&X.codecSet!==k||K&&X.videoRange!==K||Z&&O>X.frameRate||!Z&&O>0&&O<X.frameRate||(lt=X.supportedResult)!=null&&(lt=lt.decodingInfoResults)!=null&&lt.some(at=>at.smooth===!1))&&(!C||w!==Q)){ht.push(w);continue}const rt=X.details,ot=(E?rt==null?void 0:rt.partTarget:rt==null?void 0:rt.averagetargetduration)||st;let I;Z?I=f*t:I=o*t;const P=st&&r>=st*2&&l===0?X.averageBitrate:X.maxBitrate,it=this.getTimeToLoadFrag(ut,I,P*ot,rt===void 0);if(I>=P&&(w===g||X.loadError===0&&X.fragmentError===0)&&(it<=ut||!ct(it)||D&&!this.bitrateTestDelay||it<h)){const at=this.forcedAutoLevel;return w!==b&&(at===-1||at!==b)&&(ht.length&&this.trace(`Skipped level(s) ${ht.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[ht[0]].codecs}" ${S[ht[0]].videoRange}; not compatible with "${k}" ${K}`),this.info(`switch candidate:${p}->${w} adjustedbw(${Math.round(I)})-bitrate=${Math.round(I-P)} ttfb:${ut.toFixed(1)} avgDuration:${ot.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${it.toFixed(1)} firstSelection:${C} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${b}`)),C&&(this.firstSelection=w),w}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:s}=this.hls;return Math.min(Math.max(t,s),e)}}const Xp={search:function(u,t){let e=0,s=u.length-1,r=null,l=null;for(;e<=s;){r=(e+s)/2|0,l=u[r];const o=t(l);if(o>0)e=r+1;else if(o<0)s=r-1;else return l}return null}};function _x(u,t,e){if(t===null||!Array.isArray(u)||!u.length||!ct(t))return null;const s=u[0].programDateTime;if(t<(s||0))return null;const r=u[u.length-1].endProgramDateTime;if(t>=(r||0))return null;for(let l=0;l<u.length;++l){const o=u[l];if(Ix(t,e,o))return o}return null}function un(u,t,e=0,s=0,r=.005){let l=null;if(u){l=t[1+u.sn-t[0].sn]||null;const f=u.endDTS-e;f>0&&f<15e-7&&(e+=15e-7),l&&u.level!==l.level&&l.end<=u.end&&(l=t[2+u.sn-t[0].sn]||null)}else e===0&&t[0].start===0&&(l=t[0]);if(l&&((!u||u.level===l.level)&&Lm(e,s,l)===0||Dx(l,u,Math.min(r,s))))return l;const o=Xp.search(t,Lm.bind(null,e,s));return o&&(o!==u||!l)?o:l}function Dx(u,t,e){if(t&&t.start===0&&t.level<u.level&&(t.endPTS||0)>0){const s=t.tagList.reduce((r,l)=>(l[0]==="INF"&&(r+=parseFloat(l[1])),r),e);return u.start<=s}return!1}function Lm(u=0,t=0,e){if(e.start<=u&&e.start+e.duration>u)return 0;const s=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-s<=u?1:e.start-s>u&&e.start?-1:0}function Ix(u,t,e){const s=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-s>u}function Qp(u,t,e){if(u&&u.startCC<=t&&u.endCC>=t){let s=u.fragments;const{fragmentHint:r}=u;r&&(s=s.concat(r));let l;return Xp.search(s,o=>o.cc<t?1:o.cc>t?-1:(l=o,o.end<=e?1:o.start>e?-1:0)),l||null}return null}function fo(u){switch(u.details){case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_TIMEOUT:case V.LEVEL_LOAD_TIMEOUT:case V.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Wp(u){return u.details.startsWith("key")}function Zp(u){return Wp(u)&&!!u.frag&&!u.frag.decryptdata}function Rm(u,t){const e=fo(t);return u.default[`${e?"timeout":"error"}Retry`]}function Pf(u,t){const e=u.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*u.retryDelayMs,u.maxRetryDelayMs)}function _m(u){return $t($t({},u),{errorRetry:null,timeoutRetry:null})}function ho(u,t,e,s){if(!u)return!1;const r=s==null?void 0:s.code,l=t<u.maxNumRetry&&(Cx(r)||!!e);return u.shouldRetry?u.shouldRetry(u,t,e,s,l):l}function Cx(u){return mf(u)||!!u&&(u<400||u>499)}function mf(u){return u===0&&navigator.onLine===!1}var Le={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Je={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class Ox extends pi{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(x.ERROR,this.onError,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(x.ERROR,this.onError,this),t.off(x.ERROR,this.onErrorOut,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return(t==null?void 0:t.type)===dt.MAIN?t.level:this.getVariantIndex()}getVariantIndex(){var t;const e=this.hls,s=e.currentLevel;return(t=e.loadLevelObj)!=null&&t.details||s===-1?e.loadLevel:s}variantHasKey(t,e){if(t){var s;if((s=t.details)!=null&&s.hasKey(e))return!0;const r=t.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var f;return(f=o.details)==null?void 0:f.hasKey(e)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(t,e){var s;if(e.fatal)return;const r=this.hls,l=e.context;switch(e.details){case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case V.FRAG_PARSING_ERROR:if((s=e.frag)!=null&&s.gap){e.errorAction=sr();return}case V.FRAG_GAP:case V.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=Le.SendAlternateToPenaltyBox;return}case V.LEVEL_EMPTY_ERROR:case V.LEVEL_PARSING_ERROR:{var o;const d=e.parent===dt.MAIN?e.level:r.loadLevel;e.details===V.LEVEL_EMPTY_ERROR&&((o=e.context)!=null&&(o=o.levelDetails)!=null&&o.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,d):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,d))}return;case V.LEVEL_LOAD_ERROR:case V.LEVEL_LOAD_TIMEOUT:typeof(l==null?void 0:l.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,l.level));return;case V.AUDIO_TRACK_LOAD_ERROR:case V.AUDIO_TRACK_LOAD_TIMEOUT:case V.SUBTITLE_LOAD_ERROR:case V.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const d=r.loadLevelObj;if(d&&(l.type===Rt.AUDIO_TRACK&&d.hasAudioGroup(l.groupId)||l.type===Rt.SUBTITLE_TRACK&&d.hasSubtitleGroup(l.groupId))){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=Le.SendAlternateToPenaltyBox,e.errorAction.flags=Je.MoveAllAlternatesMatchingHost;return}}return;case V.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:e.errorAction={action:Le.SendAlternateToPenaltyBox,flags:Je.MoveAllAlternatesMatchingHDCP};return;case V.KEY_SYSTEM_SESSION_UPDATE_FAILED:case V.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case V.KEY_SYSTEM_NO_SESSION:e.errorAction={action:Le.SendAlternateToPenaltyBox,flags:Je.MoveAllAlternatesMatchingKey};return;case V.BUFFER_ADD_CODEC_ERROR:case V.REMUX_ALLOC_ERROR:case V.BUFFER_APPEND_ERROR:if(!e.errorAction){var f;e.errorAction=this.getLevelSwitchAction(e,(f=e.level)!=null?f:r.loadLevel)}return;case V.INTERNAL_EXCEPTION:case V.BUFFER_APPENDING_ERROR:case V.BUFFER_FULL_ERROR:case V.LEVEL_SWITCH_ERROR:case V.BUFFER_STALLED_ERROR:case V.BUFFER_SEEK_OVER_HOLE:case V.BUFFER_NUDGE_ON_STALL:e.errorAction=sr();return}e.type===pt.KEY_SYSTEM_ERROR&&(e.levelRetry=!1,e.errorAction=sr())}getPlaylistRetryOrSwitchAction(t,e){const s=this.hls,r=Rm(s.config.playlistLoadPolicy,t),l=this.playlistError++;if(ho(r,l,fo(t),t.response))return{action:Le.RetryRequest,flags:Je.None,retryConfig:r,retryCount:l};const f=this.getLevelSwitchAction(t,e);return r&&(f.retryConfig=r,f.retryCount=l),f}getFragRetryOrSwitchAction(t){const e=this.hls,s=this.getVariantLevelIndex(t.frag),r=e.levels[s],{fragLoadPolicy:l,keyLoadPolicy:o}=e.config,f=Rm(Wp(t)?o:l,t),d=e.levels.reduce((g,p)=>g+p.fragmentError,0);if(r&&(t.details!==V.FRAG_GAP&&r.fragmentError++,!Zp(t)&&ho(f,d,fo(t),t.response)))return{action:Le.RetryRequest,flags:Je.None,retryConfig:f,retryCount:d};const h=this.getLevelSwitchAction(t,s);return f&&(h.retryConfig=f,h.retryCount=d),h}getLevelSwitchAction(t,e){const s=this.hls;e==null&&(e=s.loadLevel);const r=this.hls.levels[e];if(r){var l,o;const h=t.details;r.loadError++,h===V.BUFFER_APPEND_ERROR&&r.fragmentError++;let g=-1;const{levels:p,loadLevel:v,minAutoLevel:E,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const A=(l=t.frag)==null?void 0:l.type,L=(A===dt.AUDIO&&h===V.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(h===V.BUFFER_ADD_CODEC_ERROR||h===V.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:K})=>r.audioCodec!==K),D=t.sourceBufferName==="video"&&(h===V.BUFFER_ADD_CODEC_ERROR||h===V.BUFFER_APPEND_ERROR)&&p.some(({codecSet:K,audioCodec:O})=>r.codecSet!==K&&r.audioCodec===O),{type:C,groupId:k}=(o=t.context)!=null?o:{};for(let K=p.length;K--;){const O=(K+v)%p.length;if(O!==v&&O>=E&&O<=S&&p[O].loadError===0){var f,d;const F=p[O];if(h===V.FRAG_GAP&&A===dt.MAIN&&t.frag){const $=p[O].details;if($){const U=un(t.frag,$.fragments,t.frag.start);if(U!=null&&U.gap)continue}}else{if(C===Rt.AUDIO_TRACK&&F.hasAudioGroup(k)||C===Rt.SUBTITLE_TRACK&&F.hasSubtitleGroup(k))continue;if(A===dt.AUDIO&&(f=r.audioGroups)!=null&&f.some($=>F.hasAudioGroup($))||A===dt.SUBTITLE&&(d=r.subtitleGroups)!=null&&d.some($=>F.hasSubtitleGroup($))||L&&r.audioCodec===F.audioCodec||D&&r.codecSet===F.codecSet||!L&&r.codecSet!==F.codecSet)continue}g=O;break}}if(g>-1&&s.loadLevel!==g)return t.levelRetry=!0,this.playlistError=0,{action:Le.SendAlternateToPenaltyBox,flags:Je.None,nextAutoLevel:g}}return{action:Le.SendAlternateToPenaltyBox,flags:Je.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var s;switch((s=e.errorAction)==null?void 0:s.action){case Le.DoNothing:break;case Le.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==V.FRAG_GAP?e.fatal=!0:/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,s=t.errorAction;if(!s)return;const{flags:r}=s,l=s.nextAutoLevel;switch(r){case Je.None:this.switchLevel(t,l);break;case Je.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(t.frag),h=e.levels[d],g=h==null?void 0:h.attrs["HDCP-LEVEL"];if(s.hdcpLevel=g,g==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(g){e.maxHdcpLevel=gf[gf.indexOf(g)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}}case Je.MoveAllAlternatesMatchingKey:{const d=t.decryptdata;if(d){const h=this.hls.levels,g=h.length;for(let v=g;v--;)if(this.variantHasKey(h[v],d)){var o,f;this.log(`Banned key found in level ${v} (${h[v].bitrate}bps) or audio group "${(o=h[v].audioGroups)==null?void 0:o.join(",")}" (${(f=t.frag)==null?void 0:f.type} fragment) ${Re(d.keyId||[])}`),h[v].fragmentError++,h[v].loadError++,this.log(`Removing level ${v} with key error (${t.error})`),this.hls.removeLevel(v)}const p=t.frag;if(this.hls.levels.length<g)s.resolved=!0;else if(p&&p.type!==dt.MAIN){const v=p.decryptdata;v&&!d.matches(v)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(t,l)}switchLevel(t,e){if(e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===V.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo")){const s=df(t.mimeType),r=this.hls.levels;for(let l=r.length;l--;)r[l][`${t.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${l} for ${t.details} ("${s}" not supported)`),this.hls.removeLevel(l))}}}function sr(u){const t={action:Le.DoNothing,flags:Je.None};return u&&(t.resolved=!0),t}var de={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Mx{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t&&(t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.BUFFER_APPENDED,this.onBufferAppended,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this),t.on(x.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.BUFFER_APPENDED,this.onBufferAppended,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this),t.off(x.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const s=this.activePartLists[e];if(s)for(let r=s.length;r--;){const l=s[r];if(!l)break;if(l.start<=t&&t<=l.end&&l.loaded)return l}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,s){const{fragments:r}=this,l=Object.keys(r);for(let o=l.length;o--;){const f=r[l[o]];if((f==null?void 0:f.body.type)===e&&(!s||f.buffered)){const d=f.body;if(d.start<=t&&t<=d.end)return d}}return null}detectEvictedFragments(t,e,s,r,l){this.timeRanges&&(this.timeRanges[t]=e);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(f=>{const d=this.fragments[f];if(!d||o>=d.body.sn)return;if(!d.buffered&&(!d.loaded||l)){d.body.type===s&&this.removeFragment(d.body);return}const h=d.range[t];if(h){if(h.time.length===0){this.removeFragment(d.body);return}h.time.some(g=>{const p=!this.isTimeBuffered(g.startPTS,g.endPTS,e);return p&&this.removeFragment(d.body),p})}})}detectPartialFragments(t){const e=this.timeRanges;if(!e||t.frag.sn==="initSegment")return;const s=t.frag,r=Wn(s),l=this.fragments[r];if(!l||l.buffered&&s.gap)return;const o=!s.relurl;Object.keys(e).forEach(f=>{const d=s.elementaryStreams[f];if(!d)return;const h=e[f],g=o||d.partial===!0;l.range[f]=this.getBufferedTimes(s,t.part,g,h)}),l.loaded=null,Object.keys(l.range).length?(this.bufferedEnd(l,s),$l(l)||this.removeParts(s.sn-1,s.type)):this.removeFragment(l.body)}bufferedEnd(t,e){t.buffered=!0,(t.body.endList=e.endList||t.body.endList)&&(this.endListFragments[t.body.type]=t)}removeParts(t,e){const s=this.activePartLists[e];s&&(this.activePartLists[e]=Dm(s,r=>r.fragment.sn>=t))}fragBuffered(t,e){const s=Wn(t);let r=this.fragments[s];!r&&e&&(r=this.fragments[s]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,t))}getBufferedTimes(t,e,s,r){const l={time:[],partial:s},o=t.start,f=t.end,d=t.minEndPTS||f,h=t.maxStartPTS||o;for(let g=0;g<r.length;g++){const p=r.start(g)-this.bufferPadding,v=r.end(g)+this.bufferPadding;if(h>=p&&d<=v){l.time.push({startPTS:Math.max(o,r.start(g)),endPTS:Math.min(f,r.end(g))});break}else if(o<v&&f>p){const E=Math.max(o,r.start(g)),S=Math.min(f,r.end(g));S>E&&(l.partial=!0,l.time.push({startPTS:E,endPTS:S}))}else if(f<=p)break}return l}getPartialFragment(t){let e=null,s,r,l,o=0;const{bufferPadding:f,fragments:d}=this;return Object.keys(d).forEach(h=>{const g=d[h];g&&$l(g)&&(r=g.body.start-f,l=g.body.end+f,t>=r&&t<=l&&(s=Math.min(t-r,l-t),o<=s&&(e=g.body,o=s)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||$l(e))}getState(t){const e=Wn(t),s=this.fragments[e];return s?s.buffered?$l(s)?de.PARTIAL:de.OK:de.APPENDING:de.NOT_LOADED}isTimeBuffered(t,e,s){let r,l;for(let o=0;o<s.length;o++){if(r=s.start(o)-this.bufferPadding,l=s.end(o)+this.bufferPadding,t>=r&&e<=l)return!0;if(e<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if(e.frag.sn==="initSegment"||e.frag.bitrateTest)return;const s=e.frag,r=e.part?null:e,l=Wn(s);this.fragments[l]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:s,part:r,timeRanges:l,type:o}=e;if(s.sn==="initSegment")return;const f=s.type;if(r){let h=this.activePartLists[f];h||(this.activePartLists[f]=h=[]),h.push(r)}this.timeRanges=l;const d=l[o];this.detectEvictedFragments(o,d,f,r)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=Wn(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,s=Object.keys(e);if(!t)return s.length>0;for(let r=s.length;r--;){const l=e[s[r]];if((l==null?void 0:l.body.type)===t)return!0}return!1}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,s,r,l){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const f=this.fragments[o];if(!f)return;const d=f.body;d.type!==s||r&&!d.gap||d.start<e&&d.end>t&&(f.buffered||l)&&this.removeFragment(d)})}removeFragment(t){const e=Wn(t);t.clearElementaryStreamInfo();const s=this.activePartLists[t.type];if(s){const r=t.sn;this.activePartLists[t.type]=Dm(s,l=>l.fragment.sn!==r)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const e=(t=this.hls)==null||(t=t.latestLevelDetails)==null?void 0:t.partList;e&&e.forEach(s=>s.clearElementaryStreamInfo())}}function $l(u){var t,e,s;return u.buffered&&!!(u.body.gap||(t=u.range.video)!=null&&t.partial||(e=u.range.audio)!=null&&e.partial||(s=u.range.audiovideo)!=null&&s.partial)}function Wn(u){return`${u.type}_${u.level}_${u.sn}`}function Dm(u,t){return u.filter(e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s})}var Bs={cbc:0,ctr:1};class kx{constructor(t,e,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=s}decrypt(t,e){switch(this.aesMode){case Bs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case Bs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function wx(u){const t=u.byteLength,e=t&&new DataView(u.buffer).getUint8(t-1);return e?u.slice(0,t-e):u}class Nx{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=e.getUint32(r*4);return s}initTable(){const t=this.sBox,e=this.invSBox,s=this.subMix,r=s[0],l=s[1],o=s[2],f=s[3],d=this.invSubMix,h=d[0],g=d[1],p=d[2],v=d[3],E=new Uint32Array(256);let S=0,A=0,b=0;for(b=0;b<256;b++)b<128?E[b]=b<<1:E[b]=b<<1^283;for(b=0;b<256;b++){let L=A^A<<1^A<<2^A<<3^A<<4;L=L>>>8^L&255^99,t[S]=L,e[L]=S;const _=E[S],D=E[_],C=E[D];let k=E[L]*257^L*16843008;r[S]=k<<24|k>>>8,l[S]=k<<16|k>>>16,o[S]=k<<8|k>>>24,f[S]=k,k=C*16843009^D*65537^_*257^S*16843008,h[L]=k<<24|k>>>8,g[L]=k<<16|k>>>16,p[L]=k<<8|k>>>24,v[L]=k,S?(S=_^E[E[E[C^_]]],A^=E[E[A]]):S=A=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let s=!0,r=0;for(;r<e.length&&s;)s=e[r]===this.key[r],r++;if(s)return;this.key=e;const l=this.keySize=e.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const o=this.ksRows=(l+6+1)*4;let f,d;const h=this.keySchedule=new Uint32Array(o),g=this.invKeySchedule=new Uint32Array(o),p=this.sBox,v=this.rcon,E=this.invSubMix,S=E[0],A=E[1],b=E[2],L=E[3];let _,D;for(f=0;f<o;f++){if(f<l){_=h[f]=e[f];continue}D=_,f%l===0?(D=D<<8|D>>>24,D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255],D^=v[f/l|0]<<24):l>6&&f%l===4&&(D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255]),h[f]=_=(h[f-l]^D)>>>0}for(d=0;d<o;d++)f=o-d,d&3?D=h[f]:D=h[f-4],d<4||f<=4?g[d]=D:g[d]=S[p[D>>>24]]^A[p[D>>>16&255]]^b[p[D>>>8&255]]^L[p[D&255]],g[d]=g[d]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,s){const r=this.keySize+6,l=this.invKeySchedule,o=this.invSBox,f=this.invSubMix,d=f[0],h=f[1],g=f[2],p=f[3],v=this.uint8ArrayToUint32Array_(s);let E=v[0],S=v[1],A=v[2],b=v[3];const L=new Int32Array(t),_=new Int32Array(L.length);let D,C,k,K,O,F,$,U,Q,st,ut,ht,lt,w;const X=this.networkToHostOrderSwap;for(;e<L.length;){for(Q=X(L[e]),st=X(L[e+1]),ut=X(L[e+2]),ht=X(L[e+3]),O=Q^l[0],F=ht^l[1],$=ut^l[2],U=st^l[3],lt=4,w=1;w<r;w++)D=d[O>>>24]^h[F>>16&255]^g[$>>8&255]^p[U&255]^l[lt],C=d[F>>>24]^h[$>>16&255]^g[U>>8&255]^p[O&255]^l[lt+1],k=d[$>>>24]^h[U>>16&255]^g[O>>8&255]^p[F&255]^l[lt+2],K=d[U>>>24]^h[O>>16&255]^g[F>>8&255]^p[$&255]^l[lt+3],O=D,F=C,$=k,U=K,lt=lt+4;D=o[O>>>24]<<24^o[F>>16&255]<<16^o[$>>8&255]<<8^o[U&255]^l[lt],C=o[F>>>24]<<24^o[$>>16&255]<<16^o[U>>8&255]<<8^o[O&255]^l[lt+1],k=o[$>>>24]<<24^o[U>>16&255]<<16^o[O>>8&255]<<8^o[F&255]^l[lt+2],K=o[U>>>24]<<24^o[O>>16&255]<<16^o[F>>8&255]<<8^o[$&255]^l[lt+3],_[e]=X(D^E),_[e+1]=X(K^S),_[e+2]=X(k^A),_[e+3]=X(C^b),E=Q,S=st,A=ut,b=ht,e=e+4}return _.buffer}}class Px{constructor(t,e,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=s}expandKey(){const t=Ux(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}function Ux(u){switch(u){case Bs.cbc:return"AES-CBC";case Bs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${u}`)}}const Bx=16;class Uf{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const s=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?wx(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,s,r){return this.useSoftware?new Promise((l,o)=>{const f=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(f,e,s,r);const d=this.flush();d?l(d.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,s,r)}softwareDecrypt(t,e,s,r){const{currentIV:l,currentResult:o,remainderData:f}=this;if(r!==Bs.cbc||e.byteLength!==16)return Gt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),f&&(t=mi(f,t),this.remainderData=null);const d=this.getValidChunk(t);if(!d.length)return null;l&&(s=l);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new Nx),h.expandKey(e);const g=o;return this.currentResult=h.decrypt(d.buffer,0,s),this.currentIV=d.slice(-16).buffer,g||null}webCryptoDecrypt(t,e,s,r){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,s,r));this.key=e,this.fastAesKey=new Px(this.subtle,e,r)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new kx(this.subtle,new Uint8Array(s),r).decrypt(t.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(Gt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(t,e,s,r)))}onWebCryptoError(t,e,s,r){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,s,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const s=t.length-t.length%Bx;return s!==t.length&&(e=t.slice(0,s),this.remainderData=t.slice(s)),e}logOnce(t){this.logEnabled&&(Gt.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Im=Math.pow(2,17);class Fx{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const s=t.url;if(!s)return Promise.reject(new ns({type:pt.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,l=r.fLoader,o=r.loader;return new Promise((f,d)=>{if(this.loader&&this.loader.destroy(),t.gap)if(t.tagList.some(S=>S[0]==="GAP")){d(Om(t));return}else t.gap=!1;const h=this.loader=l?new l(r):new o(r),g=Cm(t);t.loader=h;const p=_m(r.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:Im};t.stats=h.stats;const E={onSuccess:(S,A,b,L)=>{this.resetLoader(t,h);let _=S.data;b.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),f({frag:t,part:null,payload:_,networkDetails:L})},onError:(S,A,b,L)=>{this.resetLoader(t,h),d(new ns({type:pt.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:$t({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:b,stats:L}))},onAbort:(S,A,b)=>{this.resetLoader(t,h),d(new ns({type:pt.NETWORK_ERROR,details:V.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:b,stats:S}))},onTimeout:(S,A,b)=>{this.resetLoader(t,h),d(new ns({type:pt.NETWORK_ERROR,details:V.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:b,stats:S}))}};e&&(E.onProgress=(S,A,b,L)=>e({frag:t,part:null,payload:b,networkDetails:L})),h.load(g,v,E)})}loadPart(t,e,s){this.abort();const r=this.config,l=r.fLoader,o=r.loader;return new Promise((f,d)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){d(Om(t,e));return}const h=this.loader=l?new l(r):new o(r),g=Cm(t,e);t.loader=h;const p=_m(r.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Im};e.stats=h.stats,h.load(g,v,{onSuccess:(E,S,A,b)=>{this.resetLoader(t,h),this.updateStatsFromPart(t,e);const L={frag:t,part:e,payload:E.data,networkDetails:b};s(L),f(L)},onError:(E,S,A,b)=>{this.resetLoader(t,h),d(new ns({type:pt.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:$t({url:g.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:A,stats:b}))},onAbort:(E,S,A)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,h),d(new ns({type:pt.NETWORK_ERROR,details:V.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:A,stats:E}))},onTimeout:(E,S,A)=>{this.resetLoader(t,h),d(new ns({type:pt.NETWORK_ERROR,details:V.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:A,stats:E}))}})})}updateStatsFromPart(t,e){const s=t.stats,r=e.stats,l=r.total;if(s.loaded+=r.loaded,l){const d=Math.round(t.duration/e.duration),h=Math.min(Math.round(s.loaded/l),d),p=(d-h)*Math.round(s.loaded/h);s.total=s.loaded+p}else s.total=Math.max(s.loaded,s.total);const o=s.loading,f=r.loading;o.start?o.first+=f.first-f.start:(o.start=f.start,o.first=f.first),o.end=f.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Cm(u,t=null){const e=t||u,s={frag:u,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,l=e.byteRangeEndOffset;if(ct(r)&&ct(l)){var o;let f=r,d=l;if(u.sn==="initSegment"&&$x((o=u.decryptdata)==null?void 0:o.method)){const h=l-r;h%16&&(d=l+(16-h%16)),r!==0&&(s.resetIV=!0,f=r-16)}s.rangeStart=f,s.rangeEnd=d}return s}function Om(u,t){const e=new Error(`GAP ${u.gap?"tag":"attribute"} found`),s={type:pt.MEDIA_ERROR,details:V.FRAG_GAP,fatal:!1,frag:u,error:e,networkDetails:null};return t&&(s.part=t),(t||u).stats.aborted=!0,new ns(s)}function $x(u){return u==="AES-128"||u==="AES-256"}class ns extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class Jp extends pi{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Bf{constructor(t,e,s,r=0,l=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Gl(),this.buffering={audio:Gl(),video:Gl(),audiovideo:Gl()},this.level=t,this.sn=e,this.id=s,this.size=r,this.part=l,this.partial=o}}function Gl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Mm={length:0,start:()=>0,end:()=>0};class Tt{static isBuffered(t,e){if(t){const s=Tt.getBuffered(t);for(let r=s.length;r--;)if(e>=s.start(r)&&e<=s.end(r))return!0}return!1}static bufferedRanges(t){if(t){const e=Tt.getBuffered(t);return Tt.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let s=0;s<t.length;s++)e.push({start:t.start(s),end:t.end(s)});return e}static bufferInfo(t,e,s){if(t){const r=Tt.bufferedRanges(t);if(r.length)return Tt.bufferedInfo(r,e,s)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,s){e=Math.max(0,e),t.length>1&&t.sort((g,p)=>g.start-p.start||p.end-g.end);let r=-1,l=[];if(s)for(let g=0;g<t.length;g++){e>=t[g].start&&e<=t[g].end&&(r=g);const p=l.length;if(p){const v=l[p-1].end;t[g].start-v<s?t[g].end>v&&(l[p-1].end=t[g].end):l.push(t[g])}else l.push(t[g])}else l=t;let o=0,f,d=e,h=e;for(let g=0;g<l.length;g++){const p=l[g].start,v=l[g].end;if(r===-1&&e>=p&&e<=v&&(r=g),e+s>=p&&e<v)d=p,h=v,o=h-e;else if(e+s<p){f=p;break}}return{len:o,start:d||0,end:h||0,nextStart:f,buffered:t,bufferedIndex:r}}static getBuffered(t){try{return t.buffered||Mm}catch(e){return Gt.log("failed to get media.buffered",e),Mm}}}const ty=/\{\$([a-zA-Z0-9-_]+)\}/g;function km(u){return ty.test(u)}function pf(u,t){if(u.variableList!==null||u.hasVariableRefs){const e=u.variableList;return t.replace(ty,s=>{const r=s.substring(2,s.length-1),l=e==null?void 0:e[r];return l===void 0?(u.playlistParsingError||(u.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):l})}return t}function wm(u,t,e){let s=u.variableList;s||(u.variableList=s={});let r,l;if("QUERYPARAM"in t){r=t.QUERYPARAM;try{const o=new self.URL(e).searchParams;if(o.has(r))l=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${e}"`)}catch(o){u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=t.NAME,l=t.VALUE;r in s?u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=l||""}function Gx(u,t,e){const s=t.IMPORT;if(e&&s in e){let r=u.variableList;r||(u.variableList=r={}),r[s]=e[s]}else u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const Hx=/^(\d+)x(\d+)$/,Nm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Zt{constructor(t,e){typeof t=="string"&&(t=Zt.parseAttrList(t,e)),Kt(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>t.substring(0,2)==="X-")}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const s=new Uint8Array(e.length/2);for(let r=0;r<e.length/2;r++)s[r]=parseInt(e.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const s=this[t];return s?parseFloat(s):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const s=this[t];return(s?s.split(/[ ,]+/):[]).reduce((r,l)=>(r[l.toLowerCase()]=!0,r),e)}bool(t){return this[t]==="YES"}decimalResolution(t){const e=Hx.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let s;const r={};for(Nm.lastIndex=0;(s=Nm.exec(t))!==null;){const o=s[1].trim();let f=s[2];const d=f.indexOf('"')===0&&f.lastIndexOf('"')===f.length-1;let h=!1;if(d)f=f.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(e&&(d||h))f=pf(e,f);else if(!h&&!d)switch(o){case"CLOSED-CAPTIONS":if(f==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Gt.warn(`${t}: attribute ${o} is missing quotes`)}r[o]=f}return r}}const Vx="com.apple.hls.interstitial";function zx(u){return u!=="ID"&&u!=="CLASS"&&u!=="CUE"&&u!=="START-DATE"&&u!=="DURATION"&&u!=="END-DATE"&&u!=="END-ON-NEXT"}function Kx(u){return u==="SCTE35-OUT"||u==="SCTE35-IN"||u==="SCTE35-CMD"}class ey{constructor(t,e,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(e==null?void 0:e.tagAnchor)||null,this.tagOrder=(r=e==null?void 0:e.tagOrder)!=null?r:s,e){const l=e.attr;for(const o in l)if(Object.prototype.hasOwnProperty.call(t,o)&&t[o]!==l[o]){Gt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=o;break}t=Kt(new Zt({}),l,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const l=(e==null?void 0:e.endDate)||new Date(this.attr["END-DATE"]);ct(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return t===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return t===null||t.programDateTime===null?(Gt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${t}`),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return e!==null?this._dateAtEnd=new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(ct(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Vx}get isValid(){return!!this.id&&!this._badValueForSameId&&ct(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const jx=10;class Yx{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,s=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!s||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||e===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1}hasKey(t){return this.encryptedFragments.some(e=>{let s=e.decryptdata;return s||(e.setKeyFormat(t.keyFormat),s=e.decryptdata),!!s&&t.matches(s)})}get hasProgramDateTime(){return this.fragments.length?ct(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||jx}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(e!==-1){for(let s=t.length;s--;)if(t[s].index>e)return t[s].index;return e}}return 0}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}function go(u,t){return u.length===t.length?!u.some((e,s)=>e!==t[s]):!1}function Pm(u,t){return!u&&!t?!0:!u||!t?!1:go(u,t)}function nr(u){return u==="AES-128"||u==="AES-256"||u==="AES-256-CTR"}function Ff(u){switch(u){case"AES-128":case"AES-256":return Bs.cbc;case"AES-256-CTR":return Bs.ctr;default:throw new Error(`invalid full segment method ${u}`)}}function $f(u){return Uint8Array.from(atob(u),t=>t.charCodeAt(0))}function yf(u){return Uint8Array.from(unescape(encodeURIComponent(u)),t=>t.charCodeAt(0))}function qx(u){const t=yf(u).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function iy(u){const t=function(s,r,l){const o=s[r];s[r]=s[l],s[l]=o};t(u,0,3),t(u,1,2),t(u,4,5),t(u,6,7)}function sy(u){const t=u.split(":");let e=null;if(t[0]==="data"&&t.length===2){const s=t[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const l=r[0]==="base64",o=r[1];l?(s.splice(-1,1),e=$f(o)):e=qx(o)}}return e}const mo=typeof self<"u"?self:void 0;var te={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_e={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function eo(u){switch(u){case _e.FAIRPLAY:return te.FAIRPLAY;case _e.PLAYREADY:return te.PLAYREADY;case _e.WIDEVINE:return te.WIDEVINE;case _e.CLEARKEY:return te.CLEARKEY}}function zc(u){switch(u){case te.FAIRPLAY:return _e.FAIRPLAY;case te.PLAYREADY:return _e.PLAYREADY;case te.WIDEVINE:return _e.WIDEVINE;case te.CLEARKEY:return _e.CLEARKEY}}function la(u){const{drmSystems:t,widevineLicenseUrl:e}=u,s=t?[te.FAIRPLAY,te.WIDEVINE,te.PLAYREADY,te.CLEARKEY].filter(r=>!!t[r]):[];return!s[te.WIDEVINE]&&e&&s.push(te.WIDEVINE),s}const ny=(function(u){return mo!=null&&(u=mo.navigator)!=null&&u.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Xx(u,t,e,s){let r;switch(u){case te.FAIRPLAY:r=["cenc","sinf"];break;case te.WIDEVINE:case te.PLAYREADY:r=["cenc"];break;case te.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${u}`)}return Qx(r,t,e,s)}function Qx(u,t,e,s){return[{initDataTypes:u,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:t.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:e.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Wx(u){var t;return!!u&&(u.sessionType==="persistent-license"||!!((t=u.sessionTypes)!=null&&t.some(e=>e==="persistent-license")))}function ry(u){const t=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/2),e=String.fromCharCode.apply(null,Array.from(t)),s=e.substring(e.indexOf("<"),e.length),o=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(o){const f=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(f){const d=$f(f).subarray(0,16);return iy(d),d}}return null}let Zn={};class Ps{static clearKeyUriToKeyIdMap(){Zn={}}static setKeyIdForUri(t,e){Zn[t]=e}static addKeyIdForUri(t){const e=Object.keys(Zn).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,e),Zn[t]=s,s}constructor(t,e,s,r=[1],l=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=s,this.keyFormatVersions=r,this.iv=l,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!nr(t),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(kp(o)))}matches(t){return t.uri===this.uri&&t.method===this.method&&t.encrypted===this.encrypted&&t.keyFormat===this.keyFormat&&go(t.keyFormatVersions,this.keyFormatVersions)&&Pm(t.iv,this.iv)&&Pm(t.keyId,this.keyId)}isSupported(){if(this.method){if(nr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case _e.FAIRPLAY:case _e.WIDEVINE:case _e.PLAYREADY:case _e.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t,e){if(!this.encrypted||!this.uri)return null;if(nr(this.method)){let l=this.iv;return l||(typeof t!="number"&&(Gt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0),l=Jx(t)),new Ps(this.method,this.uri,"identity",this.keyFormatVersions,l)}if(this.keyId){const l=Zn[this.uri];if(l&&!go(this.keyId,l)&&Ps.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=sy(this.uri);if(s)switch(this.keyFormat){case _e.WIDEVINE:if(this.pssh=s,!this.keyId){const l=ix(s.buffer);if(l.length){var r;const o=l[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=Um(e));break;case _e.PLAYREADY:{const l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ex(l,null,s),this.keyId=ry(s);break}default:{let l=s.subarray(0,16);if(l.length!==16){const o=new Uint8Array(16);o.set(l,16-l.length),l=o}this.keyId=l;break}}if(!this.keyId||this.keyId.byteLength!==16){let l;l=Zx(e),l||(l=Um(e),l||(l=Zn[this.uri])),l&&(this.keyId=l,Ps.setKeyIdForUri(this.uri,l))}return this}}function Zx(u){const t=u==null?void 0:u[_e.WIDEVINE];return t?t.keyId:null}function Um(u){const t=u==null?void 0:u[_e.PLAYREADY];if(t){const e=sy(t.uri);if(e)return ry(e)}return null}function Jx(u){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=u>>8*(15-e)&255;return t}const Bm=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Fm=/#EXT-X-MEDIA:(.*)/g,tA=/^#EXT(?:INF|-X-TARGETDURATION):/m,Kc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),eA=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class wi{static findGroup(t,e){for(let s=0;s<t.length;s++){const r=t[s];if(r.id===e)return r}}static resolve(t,e){return Of.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return tA.test(t)}static parseMasterPlaylist(t,e){const s=km(t),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},l=[];if(Bm.lastIndex=0,!t.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=Bm.exec(t))!=null;)if(o[1]){var f;const h=new Zt(o[1],r),g=pf(r,o[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:wi.resolve(g,e)},v=h.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),Hm(h.CODECS,p);const E=h["SUPPLEMENTAL-CODECS"];E&&(p.supplemental={},Hm(E,p.supplemental)),(f=p.unknownCodecs)!=null&&f.length||l.push(p),r.levels.push(p)}else if(o[3]){const h=o[3],g=o[4];switch(h){case"SESSION-DATA":{const p=new Zt(g,r),v=p["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=p);break}case"SESSION-KEY":{const p=$m(g,e,r);p.encrypted&&p.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(p)):Gt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new Zt(g,r);wm(r,p,e)}break}case"CONTENT-STEERING":{const p=new Zt(g,r);r.contentSteering={uri:wi.resolve(p["SERVER-URI"],e),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Gm(g);break}}}const d=l.length>0&&l.length<r.levels.length;return r.levels=d?l:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(t,e,s){let r;const l={},o=s.levels,f={AUDIO:o.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:o.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(Fm.lastIndex=0;(r=Fm.exec(t))!==null;){const h=new Zt(r[1],s),g=h.TYPE;if(g){const p=f[g],v=l[g]||[];l[g]=v;const E=h.LANGUAGE,S=h["ASSOC-LANGUAGE"],A=h.CHANNELS,b=h.CHARACTERISTICS,L=h["INSTREAM-ID"],_={attrs:h,bitrate:0,id:d++,groupId:h["GROUP-ID"]||"",name:h.NAME||E||"",type:g,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:E,url:h.URI?wi.resolve(h.URI,e):""};if(S&&(_.assocLang=S),A&&(_.channels=A),b&&(_.characteristics=b),L&&(_.instreamId=L),p!=null&&p.length){const D=wi.findGroup(p,_.groupId)||p[0];Vm(_,D,"audioCodec"),Vm(_,D,"textCodec")}v.push(_)}}return l}static parseLevelPlaylist(t,e,s,r,l,o){var f;const d={url:e},h=new Yx(e),g=h.fragments,p=[];let v=null,E=0,S=0,A=0,b=0,L=0,_=null,D=new Gc(r,d),C,k,K,O=-1,F=!1,$=null,U;if(Kc.lastIndex=0,h.m3u8=t,h.hasVariableRefs=km(t),((f=Kc.exec(t))==null?void 0:f[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(C=Kc.exec(t))!==null;){F&&(F=!1,D=new Gc(r,d),D.playlistOffset=A,D.setStart(A),D.sn=E,D.cc=b,L&&(D.bitrate=L),D.level=s,v&&(D.initSegment=v,v.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),$&&(D.setByteRange($),$=null)));const ht=C[1];if(ht){D.duration=parseFloat(ht);const lt=(" "+C[2]).slice(1);D.title=lt||null,D.tagList.push(lt?["INF",ht,lt]:["INF",ht])}else if(C[3]){if(ct(D.duration)){D.playlistOffset=A,D.setStart(A),K&&Km(D,K,h),D.sn=E,D.level=s,D.cc=b,g.push(D);const lt=(" "+C[3]).slice(1);D.relurl=pf(h,lt),vf(D,_,p),_=D,A+=D.duration,E++,S=0,F=!0}}else{if(C=C[0].match(eA),!C){Gt.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<C.length&&C[k]===void 0;k++);const lt=(" "+C[k]).slice(1),w=(" "+C[k+1]).slice(1),X=C[k+2]?(" "+C[k+2]).slice(1):null;switch(lt){case"BYTERANGE":_?D.setByteRange(w,_):D.setByteRange(w);break;case"PROGRAM-DATE-TIME":D.rawProgramDateTime=w,D.tagList.push(["PROGRAM-DATE-TIME",w]),O===-1&&(O=g.length);break;case"PLAYLIST-TYPE":h.type&&is(h,lt,C),h.type=w.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?is(h,lt,C):g.length>0&&jm(h,lt,C),E=h.startSN=parseInt(w);break;case"SKIP":{h.skippedSegments&&is(h,lt,C);const Z=new Zt(w,h),rt=Z.decimalInteger("SKIPPED-SEGMENTS");if(ct(rt)){h.skippedSegments+=rt;for(let I=rt;I--;)g.push(null);E+=rt}const ot=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ot&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(ot.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&is(h,lt,C),h.targetduration=Math.max(parseInt(w),1);break;case"VERSION":h.version!==null&&is(h,lt,C),h.version=parseInt(w);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||is(h,lt,C),h.live=!1;break;case"#":(w||X)&&D.tagList.push(X?[w,X]:[w]);break;case"DISCONTINUITY":b++,D.tagList.push(["DIS"]);break;case"GAP":D.gap=!0,D.tagList.push([lt]);break;case"BITRATE":D.tagList.push([lt,w]),L=parseInt(w)*1e3,ct(L)?D.bitrate=L:L=0;break;case"DATERANGE":{const Z=new Zt(w,h),rt=new ey(Z,h.dateRanges[Z.ID],h.dateRangeTagCount);h.dateRangeTagCount++,rt.isValid||h.skippedSegments?h.dateRanges[rt.id]=rt:Gt.warn(`Ignoring invalid DATERANGE tag: "${w}"`),D.tagList.push(["EXT-X-DATERANGE",w]);break}case"DEFINE":{{const Z=new Zt(w,h);"IMPORT"in Z?Gx(h,Z,o):wm(h,Z,e)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?is(h,lt,C):g.length>0&&jm(h,lt,C),h.startCC=b=parseInt(w);break;case"KEY":{const Z=$m(w,e,h);if(Z.isSupported()){if(Z.method==="NONE"){K=void 0;break}K||(K={});const rt=K[Z.keyFormat];rt!=null&&rt.matches(Z)||(rt&&(K=Kt({},K)),K[Z.keyFormat]=Z)}else Gt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${w}"`);break}case"START":h.startTimeOffset=Gm(w);break;case"MAP":{const Z=new Zt(w,h);if(D.duration){const rt=new Gc(r,d);zm(rt,Z,s,K),v=rt,D.initSegment=v,v.rawProgramDateTime&&!D.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime)}else{const rt=D.byteRangeEndOffset;if(rt){const ot=D.byteRangeStartOffset;$=`${rt-ot}@${ot}`}else $=null;zm(D,Z,s,K),v=D,F=!0}v.cc=b;break}case"SERVER-CONTROL":{U&&is(h,lt,C),U=new Zt(w),h.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),h.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&is(h,lt,C);const Z=new Zt(w);h.partTarget=Z.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Z=h.partList;Z||(Z=h.partList=[]);const rt=S>0?Z[Z.length-1]:void 0,ot=S++,I=new Zt(w,h),P=new GT(I,D,d,ot,rt);Z.push(P),D.duration+=P.duration;break}case"PRELOAD-HINT":{const Z=new Zt(w,h);h.preloadHint=Z;break}case"RENDITION-REPORT":{const Z=new Zt(w,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(Z);break}default:Gt.warn(`line parsed but not handled: ${C}`);break}}}_&&!_.relurl?(g.pop(),A-=_.duration,h.partList&&(h.fragmentHint=_)):h.partList&&(vf(D,_,p),D.cc=b,h.fragmentHint=D,K&&Km(D,K,h)),h.targetduration||(h.playlistParsingError=new Error("Missing Target Duration"));const Q=g.length,st=g[0],ut=g[Q-1];if(A+=h.skippedSegments*h.targetduration,A>0&&Q&&ut){h.averagetargetduration=A/Q;const ht=ut.sn;h.endSN=ht!=="initSegment"?ht:0,h.live||(ut.endList=!0),O>0&&(sA(g,O),st&&p.unshift(st))}return h.fragmentHint&&(A+=h.fragmentHint.duration),h.totalduration=A,p.length&&h.dateRangeTagCount&&st&&ay(p,h),h.endCC=b,h}}function ay(u,t){let e=u.length;if(!e)if(t.hasProgramDateTime){const f=t.fragments[t.fragments.length-1];u.push(f),e++}else return;const s=u[e-1],r=t.live?1/0:t.totalduration,l=Object.keys(t.dateRanges);for(let f=l.length;f--;){const d=t.dateRanges[l[f]],h=d.startDate.getTime();d.tagAnchor=s.ref;for(let g=e;g--;){var o;if(((o=u[g])==null?void 0:o.sn)<t.startSN)break;const p=iA(t,h,u,g,r);if(p!==-1){d.tagAnchor=t.fragments[p].ref;break}}}}function iA(u,t,e,s,r){const l=e[s];if(l){const f=l.programDateTime;if(t>=f||s===0){var o;const d=(((o=e[s+1])==null?void 0:o.start)||r)-l.start;if(t<=f+d*1e3){const h=e[s].sn-u.startSN;if(h<0)return-1;const g=u.fragments;if(g.length>e.length){const v=(e[s+1]||g[g.length-1]).sn-u.startSN;for(let E=v;E>h;E--){const S=g[E].programDateTime;if(t>=S&&t<S+g[E].duration*1e3)return E}}return h}}}return-1}function $m(u,t,e){var s,r;const l=new Zt(u,e),o=(s=l.METHOD)!=null?s:"",f=l.URI,d=l.hexadecimalInteger("IV"),h=l.KEYFORMATVERSIONS,g=(r=l.KEYFORMAT)!=null?r:"identity";f&&l.IV&&!d&&Gt.error(`Invalid IV: ${l.IV}`);const p=f?wi.resolve(f,t):"",v=(h||"1").split("/").map(Number).filter(Number.isFinite);return new Ps(o,p,g,v,d,l.KEYID)}function Gm(u){const e=new Zt(u).decimalFloatingPoint("TIME-OFFSET");return ct(e)?e:null}function Hm(u,t){let e=(u||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=e.filter(l=>wf(l,s));r.length&&(t[`${s}Codec`]=r.map(l=>l.split("/")[0]).join(","),e=e.filter(l=>r.indexOf(l)===-1))}),t.unknownCodecs=e}function Vm(u,t,e){const s=t[e];s&&(u[e]=s)}function sA(u,t){let e=u[t];for(let s=t;s--;){const r=u[s];if(!r)return;r.programDateTime=e.programDateTime-r.duration*1e3,e=r}}function vf(u,t,e){u.rawProgramDateTime?e.push(u):t!=null&&t.programDateTime&&(u.programDateTime=t.endProgramDateTime)}function zm(u,t,e,s){u.relurl=t.URI,t.BYTERANGE&&u.setByteRange(t.BYTERANGE),u.level=e,u.sn="initSegment",s&&(u.levelkeys=s),u.initSegment=null}function Km(u,t,e){u.levelkeys=t;const{encryptedFragments:s}=e;(!s.length||s[s.length-1].levelkeys!==t)&&Object.keys(t).some(r=>t[r].isCommonEncryption)&&s.push(u)}function is(u,t,e){u.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${e[0]})`)}function jm(u,t,e){u.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${e[0]})`)}function jc(u,t){const e=t.startPTS;if(ct(e)){let s=0,r;t.sn>u.sn?(s=e-u.start,r=u):(s=u.start-e,r=t),r.duration!==s&&r.setDuration(s)}else t.sn>u.sn?u.cc===t.cc&&u.minEndPTS?t.setStart(u.start+(u.minEndPTS-u.start)):t.setStart(u.start+u.duration):t.setStart(Math.max(u.start-t.duration,0))}function ly(u,t,e,s,r,l,o){s-e<=0&&(o.warn("Fragment should have a positive duration",t),s=e+t.duration,l=r+t.duration);let d=e,h=s;const g=t.startPTS,p=t.endPTS;if(ct(g)){const L=Math.abs(g-e);u&&L>u.totalduration?o.warn(`media timestamps and playlist times differ by ${L}s for level ${t.level} ${u.url}`):ct(t.deltaPTS)?t.deltaPTS=Math.max(L,t.deltaPTS):t.deltaPTS=L,d=Math.max(e,g),e=Math.min(e,g),r=t.startDTS!==void 0?Math.min(r,t.startDTS):r,h=Math.min(s,p),s=Math.max(s,p),l=t.endDTS!==void 0?Math.max(l,t.endDTS):l}const v=e-t.start;t.start!==0&&t.setStart(e),t.setDuration(s-t.start),t.startPTS=e,t.maxStartPTS=d,t.startDTS=r,t.endPTS=s,t.minEndPTS=h,t.endDTS=l;const E=t.sn;if(!u||E<u.startSN||E>u.endSN)return 0;let S;const A=E-u.startSN,b=u.fragments;for(b[A]=t,S=A;S>0;S--)jc(b[S],b[S-1]);for(S=A;S<b.length-1;S++)jc(b[S],b[S+1]);return u.fragmentHint&&jc(b[b.length-1],u.fragmentHint),u.PTSKnown=u.alignedSliding=!0,v}function nA(u,t,e){if(u===t)return;let s=null;const r=u.fragments;for(let g=r.length-1;g>=0;g--){const p=r[g].initSegment;if(p){s=p;break}}u.fragmentHint&&delete u.fragmentHint.endPTS;let l;lA(u,t,(g,p,v,E)=>{if((!t.startCC||t.skippedSegments)&&p.cc!==g.cc){const S=g.cc-p.cc;for(let A=v;A<E.length;A++)E[A].cc+=S;t.endCC=E[E.length-1].cc}ct(g.startPTS)&&ct(g.endPTS)&&(p.setStart(p.startPTS=g.startPTS),p.startDTS=g.startDTS,p.maxStartPTS=g.maxStartPTS,p.endPTS=g.endPTS,p.endDTS=g.endDTS,p.minEndPTS=g.minEndPTS,p.setDuration(g.endPTS-g.startPTS),p.duration&&(l=p),t.PTSKnown=t.alignedSliding=!0),g.hasStreams&&(p.elementaryStreams=g.elementaryStreams),p.loader=g.loader,g.hasStats&&(p.stats=g.stats),g.initSegment&&(p.initSegment=g.initSegment,s=g.initSegment)});const o=t.fragments,f=t.fragmentHint?o.concat(t.fragmentHint):o;if(s&&f.forEach(g=>{var p;g&&(!g.initSegment||g.initSegment.relurl===((p=s)==null?void 0:p.relurl))&&(g.initSegment=s)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(g=>!g),t.deltaUpdateFailed){e.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let g=t.skippedSegments;g--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=rA(u.dateRanges,t,e));const g=u.fragments.filter(p=>p.rawProgramDateTime);if(u.hasProgramDateTime&&!t.hasProgramDateTime)for(let p=1;p<f.length;p++)f[p].programDateTime===null&&vf(f[p],f[p-1],g);ay(g,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var d;const g=cy(u,t.startSN-1);t.startCC=(d=g==null?void 0:g.cc)!=null?d:o[0].cc}aA(u.partList,t.partList,(g,p)=>{p.elementaryStreams=g.elementaryStreams,p.stats=g.stats}),l?ly(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS,e):oy(u,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=u.driftStartTime,t.driftStart=u.driftStart;const h=t.advancedDateTime;if(t.advanced&&h){const g=t.edge;t.driftStart||(t.driftStartTime=h,t.driftStart=g),t.driftEndTime=h,t.driftEnd=g}else t.driftEndTime=u.driftEndTime,t.driftEnd=u.driftEnd,t.advancedDateTime=u.advancedDateTime;t.requestScheduled===-1&&(t.requestScheduled=u.requestScheduled)}function rA(u,t,e){const{dateRanges:s,recentlyRemovedDateranges:r}=t,l=Kt({},u);r&&r.forEach(d=>{delete l[d]});const f=Object.keys(l).length;return f?(Object.keys(s).forEach(d=>{const h=l[d],g=new ey(s[d].attr,h);g.isValid?(l[d]=g,h||(g.tagOrder+=f)):e.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${qt(s[d].attr)}"`)}),l):s}function aA(u,t,e){if(u&&t){let s=0;for(let r=0,l=u.length;r<=l;r++){const o=u[r],f=t[r+s];o&&f&&o.index===f.index&&o.fragment.sn===f.fragment.sn?e(o,f):s--}}}function lA(u,t,e){const s=t.skippedSegments,r=Math.max(u.startSN,t.startSN)-t.startSN,l=(u.fragmentHint?1:0)+(s?t.endSN:Math.min(u.endSN,t.endSN))-t.startSN,o=t.startSN-u.startSN,f=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,d=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments;for(let h=r;h<=l;h++){const g=d[o+h];let p=f[h];if(s&&!p&&g&&(p=t.fragments[h]=g),g&&p){e(g,p,h,f);const v=g.relurl,E=p.relurl;if(v&&oA(v,E)){t.playlistParsingError=Ym(`media sequence mismatch ${p.sn}:`,u,t,g,p);return}else if(g.cc!==p.cc){t.playlistParsingError=Ym(`discontinuity sequence mismatch (${g.cc}!=${p.cc})`,u,t,g,p);return}}}}function Ym(u,t,e,s,r){return new Error(`${u} ${r.url}
Playlist starting @${t.startSN}
${t.m3u8}

Playlist starting @${e.startSN}
${e.m3u8}`)}function oy(u,t,e=!0){const s=t.startSN+t.skippedSegments-u.startSN,r=u.fragments,l=s>=0;let o=0;if(l&&s<r.length)o=r[s].start;else if(l&&t.startSN===u.endSN+1)o=u.fragmentEnd;else if(l&&e)o=u.fragmentStart+s*t.levelTargetDuration;else if(!t.skippedSegments&&t.fragmentStart===0)o=u.fragmentStart;else return;Ef(t,o)}function Ef(u,t){if(t){const e=u.fragments;for(let s=u.skippedSegments;s<e.length;s++)e[s].addStart(t);u.fragmentHint&&u.fragmentHint.addStart(t)}}function uy(u,t=1/0){let e=1e3*u.targetduration;if(u.updated){const s=u.fragments;if(s.length&&e*4>t){const l=s[s.length-1].duration*1e3;l<e&&(e=l)}}else e/=2;return Math.round(e)}function cy(u,t,e){if(!u)return null;let s=u.fragments[t-u.startSN];return s||(s=u.fragmentHint,s&&s.sn===t)?s:t<u.startSN&&e&&e.sn===t?e:null}function qm(u,t,e){return u?fy(u.partList,t,e):null}function fy(u,t,e){if(u)for(let s=u.length;s--;){const r=u[s];if(r.index===e&&r.fragment.sn===t)return r}return null}function hy(u){u.forEach((t,e)=>{var s;(s=t.details)==null||s.fragments.forEach(r=>{r.level=e,r.initSegment&&(r.initSegment.level=e)})})}function oA(u,t){return u!==t&&t?Xm(u)!==Xm(t):!1}function Xm(u){return u.replace(/\?[^?]*$/,"")}function oa(u,t){for(let s=0,r=u.length;s<r;s++){var e;if(((e=u[s])==null?void 0:e.cc)===t)return u[s]}return null}function uA(u,t){return!!(u&&t.startCC<u.endCC&&t.endCC>u.startCC)}function Qm(u,t){const e=u.start+t;u.startPTS=e,u.setStart(e),u.endPTS=e+u.duration}function dy(u,t){const e=t.fragments;for(let s=0,r=e.length;s<r;s++)Qm(e[s],u);t.fragmentHint&&Qm(t.fragmentHint,u),t.alignedSliding=!0}function cA(u,t){u&&(gy(t,u),t.alignedSliding||po(t,u),!t.alignedSliding&&!t.skippedSegments&&oy(u,t,!1))}function gy(u,t){if(!uA(t,u))return;const e=Math.min(t.endCC,u.endCC),s=oa(t.fragments,e),r=oa(u.fragments,e);if(!s||!r)return;Gt.log(`Aligning playlist at start of dicontinuity sequence ${e}`);const l=s.start-r.start;dy(l,u)}function po(u,t){if(!u.hasProgramDateTime||!t.hasProgramDateTime)return;const e=u.fragments,s=t.fragments;if(!e.length||!s.length)return;let r,l;const o=Math.min(t.endCC,u.endCC);t.startCC<o&&u.startCC<o&&(r=oa(s,o),l=oa(e,o)),(!r||!l)&&(r=s[Math.floor(s.length/2)],l=oa(e,r.cc)||e[Math.floor(e.length/2)]);const f=r.programDateTime,d=l.programDateTime;if(!f||!d)return;const h=(d-f)/1e3-(l.start-r.start);dy(h,u)}function ke(u,t,e){He(u,t,e),u.addEventListener(t,e)}function He(u,t,e){u.removeEventListener(t,e)}const fA={toString:function(u){let t="";const e=u.length;for(let s=0;s<e;s++)t+=`[${u.start(s).toFixed(3)}-${u.end(s).toFixed(3)}]`;return t}},J={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Gf extends Jp{constructor(t,e,s,r,l){super(r,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=J.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:f,media:d,mediaBuffer:h,state:g}=this,p=d?d.currentTime:0,v=Tt.bufferInfo(h||d,p,o.maxBufferHole),E=!v.len;if(this.log(`Media seeking to ${ct(p)?p.toFixed(3):p}, state: ${g}, ${E?"out of":"in"} buffer`),this.state===J.ENDED)this.resetLoadingState();else if(f){const S=o.maxFragLookUpTolerance,A=f.start-S,b=f.start+f.duration+S;if(E||b<v.start||A>v.end){const L=p>b;(p<A||L)&&(L&&f.loader&&(this.log(`Cancelling fragment load for seek (sn: ${f.sn})`),f.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(p>S&&(this.lastCurrentTime=p),!this.loadingParts){const A=Math.max(v.end,p),b=this.shouldLoadParts(this.getLevelDetails(),A);b&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=b)}}this.hls.hasEnoughToStart||(this.log(`Setting ${E?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,E&&(this.startPosition=p)),E&&this.state===J.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=t,this.fragmentLoader=new Fx(t.config),this.keyLoader=s,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Uf(t.config)}registerListeners(){const{hls:t}=this;t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if(this.state===J.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=J.STOPPED}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return e===-1&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const s=t.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const l=t.buffered;this.config.maxBufferHole&&l&&l.length>1&&(t=Tt.bufferedInfo(l,t.start,0));const o=t.nextStart;if(o&&o>r&&o<e.edge||this.media.currentTime<t.start)return!1;const d=e.partList;if(d!=null&&d.length){const g=d[d.length-1];return Tt.isBuffered(this.media,g.start+g.duration/2)}const h=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const t=this.config.timelineOffset;if(t){var e;return((e=this.getLevelDetails())==null?void 0:e.appliedTimelineOffset)||t}return 0}onMediaAttached(t,e){const s=this.media=this.mediaBuffer=e.media;ke(s,"seeking",this.onMediaSeeking),ke(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===J.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(t,e){const s=!!e.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),He(r,"seeking",this.onMediaSeeking),He(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=J.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,s){this.startFragRequested=!0,this._loadFragForPlayback(t,e,s)}_loadFragForPlayback(t,e,s){const r=l=>{const o=l.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(o,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(t,e,s,r).then(l=>{if(!l)return;const o=this.state,f=l.frag;if(this.fragContextChanged(f)){(o===J.FRAG_LOADING||!this.fragCurrent&&o===J.PARSING)&&(this.fragmentTracker.removeFragment(f),this.state=J.IDLE);return}"payload"in l&&(this.log(`Loaded ${f.type} sn: ${f.sn} of ${this.playlistLabel()} ${f.level}`),this.hls.trigger(x.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(`Frag error: ${(l==null?void 0:l.message)||l}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:s}=this;if(s.getState(t)===de.APPENDING){const l=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,l),f=Math.max(t.duration,o?o.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?t.sn-d.sn:0)===1||this.reduceMaxBufferLength(f,t.duration))&&s.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?s.removeAllFragments():s.hasParts(t.type)&&(s.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),s.getState(t)===de.PARTIAL&&s.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return(e==null?void 0:e.live)&&e.type!=="EVENT"&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e,s=null){if(!(t-e))return;const r={startOffset:t,endOffset:e,type:s};this.hls.trigger(x.BUFFER_FLUSHING,r)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(s=>{const r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:l,payload:o}=s,f=l.decryptdata;if(o&&o.byteLength>0&&f!=null&&f.key&&f.iv&&nr(f.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),f.key.buffer,f.iv.buffer,Ff(f.method)).catch(h=>{throw r.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:l}),h}).then(h=>{const g=self.performance.now();return r.trigger(x.FRAG_DECRYPTED,{frag:l,payload:h,stats:{tstart:d,tdecrypt:g}}),s.payload=h,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(s),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const s=t.frag.stats;this.state!==J.STOPPED&&(this.state=J.IDLE),t.frag.data=new Uint8Array(t.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(t,e){var s,r;const l=t.tracks;if(l&&!e.encrypted&&((s=l.audio)!=null&&s.encrypted||(r=l.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,f=new Error(`Encrypted track with no key in ${this.fragInfo(e)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(f.message),!o||o.mediaKeys?!1:(this.hls.trigger(x.ERROR,{type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_KEYS,fatal:!1,error:f,frag:e}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)} > buffer:${s?fA.toString(Tt.getBuffered(s)):"(detached)"})`),ae(t)){var r;if(t.type!==dt.SUBTITLE){const o=t.elementaryStreams;if(!Object.keys(o).some(f=>!!o[f])){this.state=J.IDLE;return}}const l=(r=this.levels)==null?void 0:r[t.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=J.IDLE}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:s,part:r,partsLoaded:l}=t,o=!l||l.length===0||l.some(d=>!d),f=new Bf(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!o);e.flush(f)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,s=null,r){var l;this.fragCurrent=t;const o=e.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let f=null;if(t.encrypted&&!((l=t.decryptdata)!=null&&l.key)){if(this.log(`Loading key for ${t.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${t.level}`),this.state=J.KEY_LOADING,this.fragCurrent=t,f=this.keyLoader.load(t).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(x.KEY_LOADED,v),this.state===J.KEY_LOADING&&(this.state=J.IDLE),v}),this.hls.trigger(x.KEY_LOADING,{frag:t}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else t.encrypted||(f=this.keyLoader.loadClear(t,o.encryptedFragments,this.startFragRequested),f&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(ae(t)&&(!d||t.sn!==d.sn)){const v=this.shouldLoadParts(e.details,t.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${d==null?void 0:d.sn}->${t.sn}`),this.loadingParts=v)}if(s=Math.max(t.start,s||0),this.loadingParts&&ae(t)){const v=o.partList;if(v&&r){s>o.fragmentEnd&&o.fragmentHint&&(t=o.fragmentHint);const E=this.getNextPart(v,t,s);if(E>-1){const S=v[E];t=this.fragCurrent=S.fragment,this.log(`Loading ${t.type} sn: ${t.sn} part: ${S.index} (${E}/${v.length-1}) of ${this.fragInfo(t,!1,S)}) cc: ${t.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=J.FRAG_LOADING;let A;return f?A=f.then(b=>!b||this.fragContextChanged(b.frag)?null:this.doFragPartsLoad(t,S,e,r)).catch(b=>this.handleFragLoadError(b)):A=this.doFragPartsLoad(t,S,e,r).catch(b=>this.handleFragLoadError(b)),this.hls.trigger(x.FRAG_LOADING,{frag:t,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!t.url||this.loadedEndOfParts(v,s))return Promise.resolve(null)}}if(ae(t)&&this.loadingParts){var h;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${t.sn} loaded parts: ${(h=o.partList)==null?void 0:h.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!t.url)return Promise.resolve(null);this.log(`Loading ${t.type} sn: ${t.sn} of ${this.fragInfo(t,!1)}) cc: ${t.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),ct(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=J.FRAG_LOADING;const g=this.config.progressive&&t.type!==dt.SUBTITLE;let p;return g&&f?p=f.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(t,r)).catch(v=>this.handleFragLoadError(v)):p=Promise.all([this.fragmentLoader.load(t,g?r:void 0),f]).then(([v])=>(!g&&r&&r(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(x.FRAG_LOADING,{frag:t,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(t,e,s,r){return new Promise((l,o)=>{var f;const d=[],h=(f=s.details)==null?void 0:f.partList,g=p=>{this.fragmentLoader.loadPart(t,p,r).then(v=>{d[p.index]=v;const E=v.part;this.hls.trigger(x.FRAG_LOADED,v);const S=qm(s.details,t.sn,p.index+1)||fy(h,t.sn,p.index+1);if(S)g(S);else return l({frag:t,part:E,partsLoaded:d})}).catch(o)};g(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;e.frag&&e.details===V.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):e.frag&&e.type===pt.KEY_SYSTEM_ERROR?(e.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(e.frag)):this.hls.trigger(x.ERROR,e)}else this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==J.PARSING){!this.fragCurrent&&this.state!==J.STOPPED&&this.state!==J.ERROR&&(this.state=J.IDLE);return}const{frag:s,part:r,level:l}=e,o=self.performance.now();s.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const f=this.getLevelDetails(),h=f&&s.sn>f.endSN||this.shouldLoadParts(f,s.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(s,r,l,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var s;const l=t.partList[0];if(l.fragment.type===dt.SUBTITLE)return!1;const o=l.end+(((s=t.fragmentHint)==null?void 0:s.duration)||0);if(e>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:s}=this,{level:r,sn:l,part:o}=t;if(!(e!=null&&e[r]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const f=e[r],d=f.details,h=o>-1?qm(d,l,o):null,g=h?h.fragment:cy(d,l,s);return g?(s&&s!==g&&(g.stats=s.stats),{frag:g,part:h,level:f}):null}bufferFragmentData(t,e,s,r,l){if(this.state!==J.PARSING)return;const{data1:o,data2:f}=t;let d=o;if(f&&(d=mi(o,f)),!d.length)return;const h=this.initPTS[e.cc],g=h?-h.baseTime/h.timescale:void 0,p={type:t.type,frag:e,part:s,chunkMeta:r,offset:g,parent:e.type,data:d};if(this.hls.trigger(x.BUFFER_APPENDING,p),t.dropped&&t.independent&&!s){if(l)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!Tt.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const s=e.currentTime,r=Tt.bufferInfo(e,s,0),l=t.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),f=Math.max(Math.min(t.start-o,r.end-o),s+o);t.start-f>o&&this.flushMainBuffer(f,t.start)}getFwdBufferInfo(t,e){var s;const r=this.getLoadPosition();if(!ct(r))return null;const o=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,r,e,o)}getFwdBufferInfoAtPos(t,e,s,r){const l=Tt.bufferInfo(t,e,r);if(l.len===0&&l.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(e,s);if(o&&(l.nextStart<=o.end||o.gap)){const f=Math.max(Math.min(l.nextStart,o.end)-e,r);return Tt.bufferInfo(t,e,f)}}return l}getMaxBufferLength(t){const{config:e}=this;let s;return t?s=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):s=e.maxBufferLength,Math.min(s,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const s=this.config,r=Math.max(Math.min(t-e,s.maxBufferLength),e),l=Math.max(t-e*3,s.maxMaxBufferLength/2,r);return l>=r?(s.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(t,e=dt.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(t,e){const s=e.fragments,r=s.length;if(!r)return null;const{config:l}=this,o=s[0].start,f=l.lowLatencyMode&&!!e.partList;let d=null;if(e.live){const p=l.initialLiveManifestSize;if(r<p)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${p})`),null;if(!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<o){var h;f&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(e);const v=this.hls.startPosition,E=this.hls.liveSyncPosition,S=d?(v!==-1&&v>=o?v:E)||d.start:t;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${E} frag.start: ${(h=d)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=S}}else t<=o&&(d=s[0]);if(!d){const p=this.loadingParts?e.partEnd:e.fragmentEnd;d=this.getFragmentAtPosition(t,p,e)}let g=this.filterReplacedPrimary(d,e);if(!g&&d){const p=d.sn-e.startSN;g=this.filterReplacedPrimary(s[p+1]||null,e)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(t,e){const s=this.fragmentTracker.getState(t);return(s===de.OK||s===de.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,s,r,l){let o=null;if(t.gap&&(o=this.getNextFragment(this.nextLoadPosition,e),o&&!o.gap&&s.nextStart)){const f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(f!==null&&s.len+f.len>=l){const d=o.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Wm(this.config)){var t;if((t=this.hls.interstitialsManager)==null||(t=t.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(t,e){if(!t)return t;if(Wm(this.config)&&t.type!==dt.SUBTITLE){const s=this.hls.interstitialsManager,r=s==null?void 0:s.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(t.start-r.start)>1||r.start===0)return null}else if(t.end<=r.start&&(e==null?void 0:e.live)===!1||t.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||t.start-r.end>1))return null}const l=s==null?void 0:s.playerQueue;if(l)for(let o=l.length;o--;){const f=l[o].interstitial;if(f.appendInPlace&&t.start>=f.startTime&&t.end<=f.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!t.initSegment.data&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,s){let r=-1,l=!1,o=!0;for(let f=0,d=t.length;f<d;f++){const h=t[f];if(o=o&&!h.independent,r>-1&&s<h.start)break;const g=h.loaded;g?r=-1:(l||(h.independent||o)&&h.fragment===e)&&(h.fragment!==e&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${h.start}`),r=f),l=g}return r}loadedEndOfParts(t,e){let s;for(let r=t.length;r--;){if(s=t[r],!s.loaded)return!1;if(e>s.start)return!0}return!1}getInitialLiveFragment(t){const e=t.fragments,s=this.fragPrevious;let r=null;if(s){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=_x(e,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const l=s.sn+1;if(l>=t.startSN&&l<=t.endSN){const o=e[l-t.startSN];s.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=Qp(t,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(r=this.getFragmentAtPosition(l,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r}getFragmentAtPosition(t,e,s){const{config:r}=this;let{fragPrevious:l}=this,{fragments:o,endSN:f}=s;const{fragmentHint:d}=s,{maxFragLookUpTolerance:h}=r,g=s.partList,p=!!(this.loadingParts&&g!=null&&g.length&&d);p&&!this.bitrateTest&&g[g.length-1].fragment.sn===d.sn&&(o=o.concat(d),f=d.sn);let v;if(t<e){var E;const A=t<this.lastCurrentTime||t>e-h||(E=this.media)!=null&&E.paused||!this.startFragRequested?0:h;v=un(l,o,t,A)}else v=o[o.length-1];if(v){const S=v.sn-s.startSN,A=this.fragmentTracker.getState(v);if((A===de.OK||A===de.PARTIAL&&v.gap)&&(l=v),l&&v.sn===l.sn&&(!p||g[0].fragment.sn>v.sn||!s.live)&&v.level===l.level){const L=o[S+1];v.sn<f&&this.fragmentTracker.getState(L)!==de.OK?v=L:v=null}}return v}alignPlaylists(t,e,s){const r=t.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const l=t.fragmentStart,o=!e,f=t.alignedSliding&&ct(l);if(o||!f&&!l){cA(s,t);const d=t.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} fragments: ${r}`),d}return l}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let s=this.startPosition;s<e&&(s=-1);const r=this.timelineOffset;if(s===-1){const l=this.startTimeOffset!==null,o=l?this.startTimeOffset:t.startTimeOffset;o!==null&&ct(o)?(s=e+o,o<0&&(s+=t.edge),s=Math.min(Math.max(e,s),e+t.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${o} found in ${l?"multivariant":"media"} playlist`),this.startPosition=s):t.live?(s=this.hls.liveSyncPosition||e,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var t;const{media:e}=this;let s=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&e?s=e.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&ae(t)&&t.stats.aborted&&(this.log(`Fragment ${t.sn}${e?" part "+e.index:""} of ${this.playlistLabel()} ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==J.FRAG_LOADING_WAITING_RETRY)&&(this.state=J.IDLE)}onFragmentOrKeyLoadError(t,e){var s;if(e.chunkMeta&&!e.frag){const L=this.getCurrentContext(e.chunkMeta);L&&(e.frag=L.frag)}const r=e.frag;if(!r||r.type!==t||!this.levels)return;if(this.fragContextChanged(r)){var l;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(l=this.fragCurrent)==null?void 0:l.url}`);return}const o=e.details===V.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const f=e.errorAction;if(!f){this.state=J.ERROR;return}const{action:d,flags:h,retryCount:g=0,retryConfig:p}=f,v=!!p,E=v&&d===Le.RetryRequest,S=v&&!f.resolved&&h===Je.MoveAllAlternatesMatchingHost,A=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!E&&S&&ae(r)&&!r.endList&&A&&!Zp(e))this.resetFragmentErrors(t),this.treatAsGap(r),f.resolved=!0;else if((E||S)&&g<p.maxNumRetry){var b;const L=mf((b=e.response)==null?void 0:b.code),_=Pf(p,g);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=J.FRAG_LOADING_WAITING_RETRY,f.resolved=!0,L){this.log("Waiting for connection (offline)"),this.retryDate=1/0,e.reason="offline";return}this.warn(`Fragment ${r.sn} of ${t} ${r.level} errored with ${e.details}, retrying loading ${g+1}/${p.maxNumRetry} in ${_}ms`)}else if(p)if(this.resetFragmentErrors(t),g<p.maxNumRetry)!o&&d!==Le.RemoveAlternatePermanently&&(f.resolved=!0);else{this.warn(`${e.details} reached or exceeded max retry (${g})`);return}else d===Le.SendAlternateToPenaltyBox?this.state=J.WAITING_LEVEL:this.state=J.ERROR;this.tickImmediate()}checkRetryDate(){const t=self.performance.now(),e=this.retryDate,s=e===1/0;(!e||t>=e||s&&!mf(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=J.IDLE)}reduceLengthAndFlushBuffer(t){if(this.state===J.PARSING||this.state===J.PARSED){const e=t.frag,s=t.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),l=r&&r.len>.5;l&&this.reduceMaxBufferLength(r.len,(e==null?void 0:e.duration)||10);const o=!l;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(t){t===dt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==J.STOPPED&&(this.state=J.IDLE)}afterBufferFlushed(t,e,s){if(!t)return;const r=Tt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,s),this.state===J.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==J.STOPPED&&(this.state=J.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=this.levelLastLoaded,e=t?t.details:null;e!=null&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.log(`Loading context changed while buffering sn ${t.sn} of ${this.playlistLabel()} ${t.level===-1?"<removed>":t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,s,r){const l=s.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(t.elementaryStreams).reduce((d,h)=>{const g=t.elementaryStreams[h];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${t.sn} ${h} duration reliably (${p})`),d||!1;const v=r?0:ly(l,t,g.startPTS,g.endPTS,g.startDTS,g.endDTS,this);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:l,level:s,drift:v,type:h,frag:t,start:g.startPTS,end:g.endPTS}),!0}return d},!1)){var f;const d=((f=this.transmuxer)==null?void 0:f.error)===null;if((s.fragmentError===0||d&&(s.fragmentError<2||t.endList))&&this.treatAsGap(t,s),d){const h=new Error(`Found no media in fragment ${t.sn} of ${this.playlistLabel()} ${t.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(h.message),this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:t,reason:`Found no media in msn ${t.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=J.PARSED,this.log(`Parsed ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)})`),this.hls.trigger(x.FRAG_PARSED,{frag:t,part:e})}playlistLabel(){return this.playlistType===dt.MAIN?"level":"track"}fragInfo(t,e=!0,s){var r,l;return`${this.playlistLabel()} ${t.level} (${s?"part":"frag"}:[${((r=e&&!s?t.startPTS:(s||t).start)!=null?r:NaN).toFixed(3)}-${((l=e&&!s?t.endPTS:(s||t).end)!=null?l:NaN).toFixed(3)}]${s&&t.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;(t=this.transmuxer)==null||t.reset()}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function Wm(u){return!!u.interstitialsController&&u.enableInterstitialPlayback!==!1}class my{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let s;if(t.length)t.length===1?s=t[0]:s=hA(t,e);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function hA(u,t){const e=new Uint8Array(t);let s=0;for(let r=0;r<u.length;r++){const l=u[r];e.set(l,s),s+=l.length}return e}var Yc={exports:{}},Zm;function dA(){return Zm||(Zm=1,(function(u){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(d,h,g){this.fn=d,this.context=h,this.once=g||!1}function l(d,h,g,p,v){if(typeof g!="function")throw new TypeError("The listener must be a function");var E=new r(g,p||d,v),S=e?e+h:h;return d._events[S]?d._events[S].fn?d._events[S]=[d._events[S],E]:d._events[S].push(E):(d._events[S]=E,d._eventsCount++),d}function o(d,h){--d._eventsCount===0?d._events=new s:delete d._events[h]}function f(){this._events=new s,this._eventsCount=0}f.prototype.eventNames=function(){var h=[],g,p;if(this._eventsCount===0)return h;for(p in g=this._events)t.call(g,p)&&h.push(e?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(g)):h},f.prototype.listeners=function(h){var g=e?e+h:h,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,E=p.length,S=new Array(E);v<E;v++)S[v]=p[v].fn;return S},f.prototype.listenerCount=function(h){var g=e?e+h:h,p=this._events[g];return p?p.fn?1:p.length:0},f.prototype.emit=function(h,g,p,v,E,S){var A=e?e+h:h;if(!this._events[A])return!1;var b=this._events[A],L=arguments.length,_,D;if(b.fn){switch(b.once&&this.removeListener(h,b.fn,void 0,!0),L){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,g),!0;case 3:return b.fn.call(b.context,g,p),!0;case 4:return b.fn.call(b.context,g,p,v),!0;case 5:return b.fn.call(b.context,g,p,v,E),!0;case 6:return b.fn.call(b.context,g,p,v,E,S),!0}for(D=1,_=new Array(L-1);D<L;D++)_[D-1]=arguments[D];b.fn.apply(b.context,_)}else{var C=b.length,k;for(D=0;D<C;D++)switch(b[D].once&&this.removeListener(h,b[D].fn,void 0,!0),L){case 1:b[D].fn.call(b[D].context);break;case 2:b[D].fn.call(b[D].context,g);break;case 3:b[D].fn.call(b[D].context,g,p);break;case 4:b[D].fn.call(b[D].context,g,p,v);break;default:if(!_)for(k=1,_=new Array(L-1);k<L;k++)_[k-1]=arguments[k];b[D].fn.apply(b[D].context,_)}}return!0},f.prototype.on=function(h,g,p){return l(this,h,g,p,!1)},f.prototype.once=function(h,g,p){return l(this,h,g,p,!0)},f.prototype.removeListener=function(h,g,p,v){var E=e?e+h:h;if(!this._events[E])return this;if(!g)return o(this,E),this;var S=this._events[E];if(S.fn)S.fn===g&&(!v||S.once)&&(!p||S.context===p)&&o(this,E);else{for(var A=0,b=[],L=S.length;A<L;A++)(S[A].fn!==g||v&&!S[A].once||p&&S[A].context!==p)&&b.push(S[A]);b.length?this._events[E]=b.length===1?b[0]:b:o(this,E)}return this},f.prototype.removeAllListeners=function(h){var g;return h?(g=e?e+h:h,this._events[g]&&o(this,g)):(this._events=new s,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=e,f.EventEmitter=f,u.exports=f})(Yc)),Yc.exports}var gA=dA(),Hf=FT(gA);const ga="1.6.15",or={};function mA(){return typeof __HLS_WORKER_BUNDLE__=="function"}function pA(){const u=or[ga];if(u)return u.clientCount++,u;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t),r={worker:new self.Worker(e),objectURL:e,clientCount:1};return or[ga]=r,r}function yA(u){const t=or[u];if(t)return t.clientCount++,t;const e=new self.URL(u,self.location.href).href,r={worker:new self.Worker(e),scriptURL:e,clientCount:1};return or[u]=r,r}function vA(u){const t=or[u||ga];if(t&&t.clientCount--===1){const{worker:s,objectURL:r}=t;delete or[u||ga],r&&self.URL.revokeObjectURL(r),s.terminate()}}function py(u,t){return t+10<=u.length&&u[t]===51&&u[t+1]===68&&u[t+2]===73&&u[t+3]<255&&u[t+4]<255&&u[t+6]<128&&u[t+7]<128&&u[t+8]<128&&u[t+9]<128}function Vf(u,t){return t+10<=u.length&&u[t]===73&&u[t+1]===68&&u[t+2]===51&&u[t+3]<255&&u[t+4]<255&&u[t+6]<128&&u[t+7]<128&&u[t+8]<128&&u[t+9]<128}function So(u,t){let e=0;return e=(u[t]&127)<<21,e|=(u[t+1]&127)<<14,e|=(u[t+2]&127)<<7,e|=u[t+3]&127,e}function ma(u,t){const e=t;let s=0;for(;Vf(u,t);){s+=10;const r=So(u,t+6);s+=r,py(u,t+10)&&(s+=10),t+=s}if(s>0)return u.subarray(e,e+s)}function EA(u,t,e,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=t[e+2],o=l>>2&15;if(o>12){const E=new Error(`invalid ADTS sampling index:${o}`);u.emit(x.ERROR,x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}const f=(l>>6&3)+1,d=t[e+3]>>6&3|(l&1)<<2,h="mp4a.40."+f,g=r[o];let p=o;(f===5||f===29)&&(p-=3);const v=[f<<3|(p&14)>>1,(p&1)<<7|d<<3];return Gt.log(`manifest codec:${s}, parsed codec:${h}, channels:${d}, rate:${g} (ADTS object type:${f} sampling index:${o})`),{config:v,samplerate:g,channelCount:d,codec:h,parsedCodec:h,manifestCodec:s}}function yy(u,t){return u[t]===255&&(u[t+1]&246)===240}function vy(u,t){return u[t+1]&1?7:9}function zf(u,t){return(u[t+3]&3)<<11|u[t+4]<<3|(u[t+5]&224)>>>5}function SA(u,t){return t+5<u.length}function yo(u,t){return t+1<u.length&&yy(u,t)}function TA(u,t){return SA(u,t)&&yy(u,t)&&zf(u,t)<=u.length-t}function xA(u,t){if(yo(u,t)){const e=vy(u,t);if(t+e>=u.length)return!1;const s=zf(u,t);if(s<=e)return!1;const r=t+s;return r===u.length||yo(u,r)}return!1}function Ey(u,t,e,s,r){if(!u.samplerate){const l=EA(t,e,s,r);if(!l)return;Kt(u,l)}}function Sy(u){return 1024*9e4/u}function AA(u,t){const e=vy(u,t);if(t+e<=u.length){const s=zf(u,t)-e;if(s>0)return{headerLength:e,frameLength:s}}}function Ty(u,t,e,s,r){const l=Sy(u.samplerate),o=s+r*l,f=AA(t,e);let d;if(f){const{frameLength:p,headerLength:v}=f,E=v+p,S=Math.max(0,e+E-t.length);S?(d=new Uint8Array(E-v),d.set(t.subarray(e+v,t.length),0)):d=t.subarray(e+v,e+E);const A={unit:d,pts:o};return S||u.samples.push(A),{sample:A,length:E,missing:S}}const h=t.length-e;return d=new Uint8Array(h),d.set(t.subarray(e,t.length),0),{sample:{unit:d,pts:o},length:h,missing:-1}}function bA(u,t){return Vf(u,t)&&So(u,t+6)+10<=u.length-t}function LA(u){return u instanceof ArrayBuffer?u:u.byteOffset==0&&u.byteLength==u.buffer.byteLength?u.buffer:new Uint8Array(u).buffer}function qc(u,t=0,e=1/0){return RA(u,t,e,Uint8Array)}function RA(u,t,e,s){const r=_A(u);let l=1;"BYTES_PER_ELEMENT"in s&&(l=s.BYTES_PER_ELEMENT);const o=DA(u)?u.byteOffset:0,f=(o+u.byteLength)/l,d=(o+t)/l,h=Math.floor(Math.max(0,Math.min(d,f))),g=Math.floor(Math.min(h+Math.max(e,0),f));return new s(r,h,g-h)}function _A(u){return u instanceof ArrayBuffer?u:u.buffer}function DA(u){return u&&u.buffer instanceof ArrayBuffer&&u.byteLength!==void 0&&u.byteOffset!==void 0}function IA(u){const t={key:u.type,description:"",data:"",mimeType:null,pictureType:null},e=3;if(u.size<2)return;if(u.data[0]!==e){console.log("Ignore frame with unrecognized character encoding");return}const s=u.data.subarray(1).indexOf(0);if(s===-1)return;const r=si(qc(u.data,1,s)),l=u.data[2+s],o=u.data.subarray(3+s).indexOf(0);if(o===-1)return;const f=si(qc(u.data,3+s,o));let d;return r==="-->"?d=si(qc(u.data,4+s+o)):d=LA(u.data.subarray(4+s+o)),t.mimeType=r,t.pictureType=l,t.description=f,t.data=d,t}function CA(u){if(u.size<2)return;const t=si(u.data,!0),e=new Uint8Array(u.data.subarray(t.length+1));return{key:u.type,info:t,data:e.buffer}}function OA(u){if(u.size<2)return;if(u.type==="TXXX"){let e=1;const s=si(u.data.subarray(e),!0);e+=s.length+1;const r=si(u.data.subarray(e));return{key:u.type,info:s,data:r}}const t=si(u.data.subarray(1));return{key:u.type,info:"",data:t}}function MA(u){if(u.type==="WXXX"){if(u.size<2)return;let e=1;const s=si(u.data.subarray(e),!0);e+=s.length+1;const r=si(u.data.subarray(e));return{key:u.type,info:s,data:r}}const t=si(u.data);return{key:u.type,info:"",data:t}}function kA(u){return u.type==="PRIV"?CA(u):u.type[0]==="W"?MA(u):u.type==="APIC"?IA(u):OA(u)}function wA(u){const t=String.fromCharCode(u[0],u[1],u[2],u[3]),e=So(u,4),s=10;return{type:t,size:e,data:u.subarray(s,s+e)}}const Hl=10,NA=10;function xy(u){let t=0;const e=[];for(;Vf(u,t);){const s=So(u,t+6);u[t+5]>>6&1&&(t+=Hl),t+=Hl;const r=t+s;for(;t+NA<r;){const l=wA(u.subarray(t)),o=kA(l);o&&e.push(o),t+=l.size+Hl}py(u,t)&&(t+=Hl)}return e}function Ay(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"}function PA(u){if(u.data.byteLength===8){const t=new Uint8Array(u.data),e=t[3]&1;let s=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return s/=45,e&&(s+=4772185884e-2),Math.round(s)}}function Kf(u){const t=xy(u);for(let e=0;e<t.length;e++){const s=t[e];if(Ay(s))return PA(s)}}let ei=(function(u){return u.audioId3="org.id3",u.dateRange="com.apple.quicktime.HLS",u.emsg="https://aomedia.org/emsg/ID3",u.misbklv="urn:misb:KLV:bin:1910.1",u})({});function Mi(u="",t=9e4){return{type:u,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class jf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,s){}demux(t,e){this.cachedData&&(t=mi(this.cachedData,t),this.cachedData=null);let s=ma(t,0),r=s?s.length:0,l;const o=this._audioTrack,f=this._id3Track,d=s?Kf(s):void 0,h=t.length;for((this.basePTS===null||this.frameIndex===0&&ct(d))&&(this.basePTS=UA(d,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ei.audioId3,duration:Number.POSITIVE_INFINITY});r<h;){if(this.canParse(t,r)){const g=this.appendFrame(o,t,r);g?(this.frameIndex++,this.lastPTS=g.sample.pts,r+=g.length,l=r):r=h}else bA(t,r)?(s=ma(t,r),f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ei.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,l=r):r++;if(r===h&&l!==h){const g=t.slice(l);this.cachedData?this.cachedData=mi(this.cachedData,g):this.cachedData=g}}return{audioTrack:o,videoTrack:Mi(),id3Track:f,textTrack:Mi()}}demuxSampleAes(t,e,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Mi(),id3Track:this._id3Track,textTrack:Mi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const UA=(u,t,e)=>{if(ct(u))return u*90;const s=e?e.baseTime*9e4/e.timescale:0;return t*9e4+s};let Vl=null;const BA=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],FA=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],$A=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],GA=[0,1,1,4];function by(u,t,e,s,r){if(e+24>t.length)return;const l=Ly(t,e);if(l&&e+l.frameLength<=t.length){const o=l.samplesPerFrame*9e4/l.sampleRate,f=s+r*o,d={unit:t.subarray(e,e+l.frameLength),pts:f,dts:f};return u.config=[],u.channelCount=l.channelCount,u.samplerate=l.sampleRate,u.samples.push(d),{sample:d,length:l.frameLength,missing:0}}}function Ly(u,t){const e=u[t+1]>>3&3,s=u[t+1]>>1&3,r=u[t+2]>>4&15,l=u[t+2]>>2&3;if(e!==1&&r!==0&&r!==15&&l!==3){const o=u[t+2]>>1&1,f=u[t+3]>>6,d=e===3?3-s:s===3?3:4,h=BA[d*14+r-1]*1e3,p=FA[(e===3?0:e===2?1:2)*3+l],v=f===3?1:2,E=$A[e][s],S=GA[s],A=E*8*S,b=Math.floor(E*h/p+o)*S;if(Vl===null){const D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Vl=D?parseInt(D[1]):0}return!!Vl&&Vl<=87&&s===2&&h>=224e3&&f===0&&(u[t+3]=u[t+3]|128),{sampleRate:p,channelCount:v,frameLength:b,samplesPerFrame:A}}}function Yf(u,t){return u[t]===255&&(u[t+1]&224)===224&&(u[t+1]&6)!==0}function Ry(u,t){return t+1<u.length&&Yf(u,t)}function HA(u,t){return Yf(u,t)&&4<=u.length-t}function _y(u,t){if(t+1<u.length&&Yf(u,t)){const s=Ly(u,t);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const l=t+r;return l===u.length||Ry(u,l)}return!1}class VA extends jf{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,s,r){super.resetInitSegment(t,e,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const s=ma(t,0);let r=(s==null?void 0:s.length)||0;if(_y(t,r))return!1;for(let l=t.length;r<l;r++)if(xA(t,r))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return TA(t,e)}appendFrame(t,e,s){Ey(t,this.observer,e,s,t.manifestCodec);const r=Ty(t,e,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Dy=(u,t)=>{let e=0,s=5;t+=s;const r=new Uint32Array(1),l=new Uint32Array(1),o=new Uint8Array(1);for(;s>0;){o[0]=u[t];const f=Math.min(s,8),d=8-f;l[0]=4278190080>>>24+d<<d,r[0]=(o[0]&l[0])>>d,e=e?e<<f|r[0]:r[0],t+=1,s-=f}return e};class zA extends jf{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,s,r){super.resetInitSegment(t,e,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,s){const r=Iy(t,e,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:t.samples[t.samples.length-1],length:r,missing:0}}static probe(t){if(!t)return!1;const e=ma(t,0);if(!e)return!1;const s=e.length;return t[s]===11&&t[s+1]===119&&Kf(e)!==void 0&&Dy(t,s)<16}}function Iy(u,t,e,s,r){if(e+8>t.length||t[e]!==11||t[e+1]!==119)return-1;const l=t[e+4]>>6;if(l>=3)return-1;const f=[48e3,44100,32e3][l],d=t[e+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+l]*2;if(e+g>t.length)return-1;const p=t[e+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const E=(t[e+6]<<8|t[e+7])>>12-v&1,A=[2,1,2,3,3,4,4,5][p]+E,b=t[e+5]>>3,L=t[e+5]&7,_=new Uint8Array([l<<6|b<<1|L>>2,(L&3)<<6|p<<3|E<<2|d>>4,d<<4&224]),D=1536/f*9e4,C=s+r*D,k=t.subarray(e,e+g);return u.config=_,u.channelCount=A,u.samplerate=f,u.samples.push({unit:k,pts:C}),g}class KA extends jf{resetInitSegment(t,e,s,r){super.resetInitSegment(t,e,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=ma(t,0);let s=(e==null?void 0:e.length)||0;if(e&&t[s]===11&&t[s+1]===119&&Kf(e)!==void 0&&Dy(t,s)<=16)return!1;for(let r=t.length;s<r;s++)if(_y(t,s))return Gt.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return HA(t,e)}appendFrame(t,e,s){if(this.basePTS!==null)return by(t,e,s,this.basePTS,this.frameIndex)}}const jA=/\/emsg[-/]ID3/i;class YA{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,s,r){const l=this.videoTrack=Mi("video",1),o=this.audioTrack=Mi("audio",1),f=this.txtTrack=Mi("text",1);if(this.id3Track=Mi("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const d=Fp(t);if(d.video){const{id:h,timescale:g,codec:p,supplemental:v}=d.video;l.id=h,l.timescale=f.timescale=g,l.codec=p,l.supplemental=v}if(d.audio){const{id:h,timescale:g,codec:p}=d.audio;o.id=h,o.timescale=g,o.codec=p}f.id=Pp.text,l.sampleDuration=0,l.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(t){return zT(t)}demux(t,e){this.timeOffset=e;let s=t;const r=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=mi(this.remainderData,t));const f=WT(s);this.remainderData=f.remainder,r.samples=f.valid||new Uint8Array}else r.samples=s;const o=this.extractID3Track(r,e);return l.samples=pm(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,s=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(e,this.timeOffset);return s.samples=pm(t,e),{videoTrack:e,audioTrack:Mi(),id3Track:r,textTrack:Mi()}}extractID3Track(t,e){const s=this.id3Track;if(t.samples.length){const r=Lt(t.samples,["emsg"]);r&&r.forEach(l=>{const o=JT(l);if(jA.test(o.schemeIdUri)){const f=Jm(o,e);let d=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const h=o.payload;s.samples.push({data:h,len:h.byteLength,dts:f,pts:f,type:ei.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const f=Jm(o,e);s.samples.push({data:o.payload,len:o.payload.byteLength,dts:f,pts:f,type:ei.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(t,e,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Jm(u,t){return ct(u.presentationTime)?u.presentationTime/u.timeScale:t+u.presentationTimeDelta/u.timeScale}class qA{constructor(t,e,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Uf(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,Bs.cbc)}decryptAacSample(t,e,s){const r=t[e].unit;if(r.length<=16)return;const l=r.subarray(16,r.length-r.length%16),o=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(o).then(f=>{const d=new Uint8Array(f);r.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,s)}).catch(s)}decryptAacSamples(t,e,s){for(;;e++){if(e>=t.length){s();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,s=new Int8Array(e);let r=0;for(let l=32;l<t.length-16;l+=160,r+=16)s.set(t.subarray(l,l+16),r);return s}getAvcDecryptedUnit(t,e){const s=new Uint8Array(e);let r=0;for(let l=32;l<t.length-16;l+=160,r+=16)t.set(s.subarray(r,r+16),l);return t}decryptAvcSample(t,e,s,r,l){const o=Hp(l.data),f=this.getAvcEncryptedData(o);this.decryptBuffer(f.buffer).then(d=>{l.data=this.getAvcDecryptedUnit(o,d),this.decrypter.isSync()||this.decryptAvcSamples(t,e,s+1,r)}).catch(r)}decryptAvcSamples(t,e,s,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,s=0){if(e>=t.length){r();return}const l=t[e].units;for(;!(s>=l.length);s++){const o=l[s];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(t,e,s,r,o),!this.decrypter.isSync()))return}}}}class Cy{constructor(){this.VideoSample=null}createVideoSample(t,e,s){return{key:t,frame:!1,pts:e,dts:s,units:[],length:0}}getLastNalUnit(t){var e;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=t[t.length-1]),(e=s)!=null&&e.units){const l=s.units;r=l[l.length-1]}return r}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){const s=e.samples,r=s.length;if(r){const l=s[r-1];t.pts=l.pts,t.dts=l.dts}else{e.dropped++;return}}e.samples.push(t)}}parseNALu(t,e,s){const r=e.byteLength;let l=t.naluState||0;const o=l,f=[];let d=0,h,g,p,v=-1,E=0;for(l===-1&&(v=0,E=this.getNALuType(e,0),l=0,d=1);d<r;){if(h=e[d++],!l){l=h?0:1;continue}if(l===1){l=h?0:2;continue}if(!h)l=3;else if(h===1){if(g=d-l-1,v>=0){const S={data:e.subarray(v,g),type:E};f.push(S)}else{const S=this.getLastNalUnit(t.samples);S&&(o&&d<=4-o&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-o)),g>0&&(S.data=mi(S.data,e.subarray(0,g)),S.state=0))}d<r?(p=this.getNALuType(e,d),v=d,E=p,l=0):l=-1}else l=0}if(v>=0&&l>=0){const S={data:e.subarray(v,r),type:E,state:l};f.push(S)}if(f.length===0){const S=this.getLastNalUnit(t.samples);S&&(S.data=mi(S.data,e))}return t.naluState=l,f}}class ua{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,s=t.byteLength-e,r=new Uint8Array(4),l=Math.min(4,e);if(l===0)throw new Error("no bytes available");r.set(t.subarray(s,s+l)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const s=this.word>>>32-e;if(t>32&&Gt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?s<<e|this.readBits(e):s}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class XA extends Cy{parsePES(t,e,s,r){const l=this.parseNALu(t,s.data,r);let o=this.VideoSample,f,d=!1;s.data=null,o&&l.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.forEach(h=>{var g,p;switch(h.type){case 1:{let A=!1;f=!0;const b=h.data;if(d&&b.length>4){const L=this.readSliceType(b);(L===2||L===4||L===7||L===9)&&(A=!0)}if(A){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.frame=!0,o.key=A;break}case 5:f=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 6:{f=!0,kf(h.data,1,s.pts,e.samples);break}case 7:{var E,S;f=!0,d=!0;const A=h.data,b=this.readSPS(A);if(!t.sps||t.width!==b.width||t.height!==b.height||((E=t.pixelRatio)==null?void 0:E[0])!==b.pixelRatio[0]||((S=t.pixelRatio)==null?void 0:S[1])!==b.pixelRatio[1]){t.width=b.width,t.height=b.height,t.pixelRatio=b.pixelRatio,t.sps=[A];const L=A.subarray(1,4);let _="avc1.";for(let D=0;D<3;D++){let C=L[D].toString(16);C.length<2&&(C="0"+C),_+=C}t.codec=_}break}case 8:f=!0,t.pps=[h.data];break;case 9:f=!0,t.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:f=!0;break;default:f=!1;break}o&&f&&o.units.push(h)}),r&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}getNALuType(t,e){return t[e]&31}readSliceType(t){const e=new ua(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let s=8,r=8,l;for(let o=0;o<t;o++)r!==0&&(l=e.readEG(),r=(s+l+256)%256),s=r===0?s:r}readSPS(t){const e=new ua(t);let s=0,r=0,l=0,o=0,f,d,h;const g=e.readUByte.bind(e),p=e.readBits.bind(e),v=e.readUEG.bind(e),E=e.readBoolean.bind(e),S=e.skipBits.bind(e),A=e.skipEG.bind(e),b=e.skipUEG.bind(e),L=this.skipScalingList.bind(this);g();const _=g();if(p(5),S(3),g(),b(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const F=v();if(F===3&&S(1),b(),b(),S(1),E())for(d=F!==3?8:12,h=0;h<d;h++)E()&&(h<6?L(16,e):L(64,e))}b();const D=v();if(D===0)v();else if(D===1)for(S(1),A(),A(),f=v(),h=0;h<f;h++)A();b(),S(1);const C=v(),k=v(),K=p(1);K===0&&S(1),S(1),E()&&(s=v(),r=v(),l=v(),o=v());let O=[1,1];if(E()&&E())switch(g()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((C+1)*16-s*2-r*2),height:(2-K)*(k+1)*16-(K?2:4)*(l+o),pixelRatio:O}}}class QA extends Cy{constructor(...t){super(...t),this.initVPS=null}parsePES(t,e,s,r){const l=this.parseNALu(t,s.data,r);let o=this.VideoSample,f,d=!1;s.data=null,o&&l.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.forEach(h=>{var g,p;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),o.frame=!0,f=!0;break;case 16:case 17:case 18:case 21:if(f=!0,d){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:f=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 39:f=!0,kf(h.data,2,s.pts,e.samples);break;case 32:f=!0,t.vps||(typeof t.params!="object"&&(t.params={}),t.params=Kt(t.params,this.readVPS(h.data)),this.initVPS=h.data),t.vps=[h.data];break;case 33:if(f=!0,d=!0,t.vps!==void 0&&t.vps[0]!==this.initVPS&&t.sps!==void 0&&!this.matchSPS(t.sps[0],h.data)&&(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const E=this.readSPS(h.data);t.width=E.width,t.height=E.height,t.pixelRatio=E.pixelRatio,t.codec=E.codecString,t.sps=[],typeof t.params!="object"&&(t.params={});for(const S in E.params)t.params[S]=E.params[S]}this.pushParameterSet(t.sps,h.data,t.vps),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0;break;case 34:if(f=!0,typeof t.params=="object"){if(!t.pps){t.pps=[];const E=this.readPPS(h.data);for(const S in E)t.params[S]=E[S]}this.pushParameterSet(t.pps,h.data,t.vps)}break;case 35:f=!0,t.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:f=!1;break}o&&f&&o.units.push(h)}),r&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}pushParameterSet(t,e,s){(s&&s[0]===this.initVPS||!s&&!t.length)&&t.push(e)}getNALuType(t,e){return(t[e]&126)>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let s=0;for(let r=0;r<t.byteLength;r++)r>=2&&t[r]===3&&t[r-1]===0&&t[r-2]===0||(e[s]=t[r],s++);return new Uint8Array(e.buffer,0,s)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new ua(t);e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6);const s=e.readBits(3),r=e.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(t){const e=new ua(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const s=e.readBits(3);e.readBoolean();const r=e.readBits(2),l=e.readBoolean(),o=e.readBits(5),f=e.readUByte(),d=e.readUByte(),h=e.readUByte(),g=e.readUByte(),p=e.readUByte(),v=e.readUByte(),E=e.readUByte(),S=e.readUByte(),A=e.readUByte(),b=e.readUByte(),L=e.readUByte(),_=[],D=[];for(let It=0;It<s;It++)_.push(e.readBoolean()),D.push(e.readBoolean());if(s>0)for(let It=s;It<8;It++)e.readBits(2);for(let It=0;It<s;It++)_[It]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),D[It]&&e.readUByte();e.readUEG();const C=e.readUEG();C==3&&e.skipBits(1);const k=e.readUEG(),K=e.readUEG(),O=e.readBoolean();let F=0,$=0,U=0,Q=0;O&&(F+=e.readUEG(),$+=e.readUEG(),U+=e.readUEG(),Q+=e.readUEG());const st=e.readUEG(),ut=e.readUEG(),ht=e.readUEG(),lt=e.readBoolean();for(let It=lt?0:s;It<=s;It++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(let ge=0;ge<4;ge++)for(let Ce=0;Ce<(ge===3?2:6);Ce++)if(!e.readBoolean())e.readUEG();else{const Oe=Math.min(64,1<<4+(ge<<1));ge>1&&e.readEG();for(let bi=0;bi<Oe;bi++)e.readEG()}e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const Z=e.readUEG();let rt=0;for(let It=0;It<Z;It++){let ge=!1;if(It!==0&&(ge=e.readBoolean()),ge){It===Z&&e.readUEG(),e.readBoolean(),e.readUEG();let Ce=0;for(let vi=0;vi<=rt;vi++){const Oe=e.readBoolean();let bi=!1;Oe||(bi=e.readBoolean()),(Oe||bi)&&Ce++}rt=Ce}else{const Ce=e.readUEG(),vi=e.readUEG();rt=Ce+vi;for(let Oe=0;Oe<Ce;Oe++)e.readUEG(),e.readBoolean();for(let Oe=0;Oe<vi;Oe++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const It=e.readUEG();for(let ge=0;ge<It;ge++){for(let Ce=0;Ce<ht+4;Ce++)e.readBits(1);e.readBits(1)}}let I=0,P=1,it=1,nt=!0,at=1,ft=0;e.readBoolean(),e.readBoolean();let Et=!1;if(e.readBoolean()){if(e.readBoolean()){const Ui=e.readUByte(),Ea=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],me=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ui>0&&Ui<16?(P=Ea[Ui-1],it=me[Ui-1]):Ui===255&&(P=e.readBits(16),it=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),Et=e.readBoolean(),Et&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG()),e.readBoolean()&&(at=e.readBits(32),ft=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){const me=e.readBoolean(),Sa=e.readBoolean();let as=!1;(me||Sa)&&(as=e.readBoolean(),as&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),as&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let cr=0;cr<=s;cr++){nt=e.readBoolean();const fn=nt||e.readBoolean();let Ta=!1;fn?e.readEG():Ta=e.readBoolean();const fr=Ta?1:e.readUEG()+1;if(me)for(let Fs=0;Fs<fr;Fs++)e.readUEG(),e.readUEG(),as&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(Sa)for(let Fs=0;Fs<fr;Fs++)e.readUEG(),e.readUEG(),as&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),I=e.readUEG())}let kt=k,De=K;if(O){let It=1,ge=1;C===1?It=ge=2:C==2&&(It=2),kt=k-It*$-It*F,De=K-ge*Q-ge*U}const ni=r?["A","B","C"][r]:"",ur=f<<24|d<<16|h<<8|g;let cn=0;for(let It=0;It<32;It++)cn=(cn|(ur>>It&1)<<31-It)>>>0;let yi=cn.toString(16);return o===1&&yi==="2"&&(yi="6"),{codecString:`hvc1.${ni}${o}.${yi}.${l?"H":"L"}${L}.B0`,params:{general_tier_flag:l,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[f,d,h,g],general_constraint_indicator_flags:[p,v,E,S,A,b],general_level_idc:L,bit_depth:st+8,bit_depth_luma_minus8:st,bit_depth_chroma_minus8:ut,min_spatial_segmentation_idc:I,chroma_format_idc:C,frame_rate:{fixed:nt,fps:ft/at}},width:kt,height:De,pixelRatio:[P,it]}}readPPS(t){const e=new ua(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const r=e.readBoolean(),l=e.readBoolean();let o=1;return l&&r?o=0:l?o=3:r&&(o=2),{parallelismType:o}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const ve=188;class Ns{constructor(t,e,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(t,e){const s=Ns.syncOffset(t);return s>0&&e.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(t){const e=t.length;let s=Math.min(ve*5,e-ve)+1,r=0;for(;r<s;){let l=!1,o=-1,f=0;for(let d=r;d<e;d+=ve)if(t[d]===71&&(e-d===ve||t[d+ve]===71)){if(f++,o===-1&&(o=d,o!==0&&(s=Math.min(o+ve*99,t.length-ve)+1)),l||(l=Sf(t,d)===0),l&&f>1&&(o===0&&f>2||d+ve>s))return o}else{if(f)return-1;break}r++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:Pp[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ns.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Ns.createTrack("audio",r),this._id3Track=Ns.createTrack("id3"),this._txtTrack=Ns.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:s}=this;t&&(t.pesData=null),e&&(e.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,s=!1,r=!1){s||(this.sampleAes=null);let l;const o=this._videoTrack,f=this._audioTrack,d=this._id3Track,h=this._txtTrack;let g=o.pid,p=o.pesData,v=f.pid,E=d.pid,S=f.pesData,A=d.pesData,b=null,L=this.pmtParsed,_=this._pmtId,D=t.length;if(this.remainderData&&(t=mi(this.remainderData,t),D=t.length,this.remainderData=null),D<ve&&!r)return this.remainderData=t,{audioTrack:f,videoTrack:o,id3Track:d,textTrack:h};const C=Math.max(0,Ns.syncOffset(t));D-=(D-C)%ve,D<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,D,t.buffer.byteLength-D));let k=0;for(let O=C;O<D;O+=ve)if(t[O]===71){const F=!!(t[O+1]&64),$=Sf(t,O),U=(t[O+3]&48)>>4;let Q;if(U>1){if(Q=O+5+t[O+4],Q===O+ve)continue}else Q=O+4;switch($){case g:F&&(p&&(l=Jn(p,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,h,l,!1)),p={data:[],size:0}),p&&(p.data.push(t.subarray(Q,O+ve)),p.size+=O+ve-Q);break;case v:if(F){if(S&&(l=Jn(S,this.logger)))switch(f.segmentCodec){case"aac":this.parseAACPES(f,l);break;case"mp3":this.parseMPEGPES(f,l);break;case"ac3":this.parseAC3PES(f,l);break}S={data:[],size:0}}S&&(S.data.push(t.subarray(Q,O+ve)),S.size+=O+ve-Q);break;case E:F&&(A&&(l=Jn(A,this.logger))&&this.parseID3PES(d,l),A={data:[],size:0}),A&&(A.data.push(t.subarray(Q,O+ve)),A.size+=O+ve-Q);break;case 0:F&&(Q+=t[Q]+1),_=this._pmtId=WA(t,Q);break;case _:{F&&(Q+=t[Q]+1);const st=ZA(t,Q,this.typeSupported,s,this.observer,this.logger);g=st.videoPid,g>0&&(o.pid=g,o.segmentCodec=st.segmentVideoCodec),v=st.audioPid,v>0&&(f.pid=v,f.segmentCodec=st.segmentAudioCodec),E=st.id3Pid,E>0&&(d.pid=E),b!==null&&!L&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${b}'. Backtracking to sync byte @${C} to parse all TS packets.`),b=null,O=C-188),L=this.pmtParsed=!0;break}case 17:case 8191:break;default:b=$;break}}else k++;k>0&&Tf(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=p,f.pesData=S,d.pesData=A;const K={audioTrack:f,videoTrack:o,id3Track:d,textTrack:h};return r&&this.extractRemainingSamples(K),K}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:s,id3Track:r,textTrack:l}=t,o=s.pesData,f=e.pesData,d=r.pesData;let h;if(o&&(h=Jn(o,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,l,h,!0),s.pesData=null)):s.pesData=o,f&&(h=Jn(f,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,h);break;case"mp3":this.parseMPEGPES(e,h);break;case"ac3":this.parseAC3PES(e,h);break}e.pesData=null}else f!=null&&f.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=f;d&&(h=Jn(d,this.logger))?(this.parseID3PES(r,h),r.pesData=null):r.pesData=d}demuxSampleAes(t,e,s){const r=this.demux(t,s,!0,!this.config.progressive),l=this.sampleAes=new qA(this.observer,this.config,e);return this.decrypt(r,l)}readyVideoParser(t){this.videoParser===null&&(t==="avc"?this.videoParser=new XA:t==="hevc"&&(this.videoParser=new QA))}decrypt(t,e){return new Promise(s=>{const{audioTrack:r,videoTrack:l}=t;r.samples&&r.segmentCodec==="aac"?e.decryptAacSamples(r.samples,0,()=>{l.samples?e.decryptAvcSamples(l.samples,0,0,()=>{s(t)}):s(t)}):l.samples&&e.decryptAvcSamples(l.samples,0,0,()=>{s(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let s=0;const r=this.aacOverFlow;let l=e.data;if(r){this.aacOverFlow=null;const p=r.missing,v=r.sample.unit.byteLength;if(p===-1)l=mi(r.sample.unit,l);else{const E=v-p;r.sample.unit.set(l.subarray(0,p),E),t.samples.push(r.sample),s=r.missing}}let o,f;for(o=s,f=l.length;o<f-1&&!yo(l,o);o++);if(o!==s){let p;const v=o<f-1;if(v?p=`AAC PES did not start with ADTS header,offset:${o}`:p="No ADTS header found in AAC PES",Tf(this.observer,new Error(p),v,this.logger),!v)return}Ey(t,this.observer,l,o,this.audioCodec);let d;if(e.pts!==void 0)d=e.pts;else if(r){const p=Sy(t.samplerate);d=r.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,g;for(;o<f;)if(g=Ty(t,l,o,d,h),o+=g.length,g.missing){this.aacOverFlow=g;break}else for(h++;o<f-1&&!yo(l,o);o++);}parseMPEGPES(t,e){const s=e.data,r=s.length;let l=0,o=0;const f=e.pts;if(f===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(Ry(s,o)){const d=by(t,s,o,f,l);if(d)o+=d.length,l++;else break}else o++}parseAC3PES(t,e){{const s=e.data,r=e.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=s.length;let o=0,f=0,d;for(;f<l&&(d=Iy(t,s,f,r,o++))>0;)f+=d}}parseID3PES(t,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Kt({},e,{type:this._videoTrack?ei.emsg:ei.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(s)}}function Sf(u,t){return((u[t+1]&31)<<8)+u[t+2]}function WA(u,t){return(u[t+10]&31)<<8|u[t+11]}function ZA(u,t,e,s,r,l){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},f=(u[t+1]&15)<<8|u[t+2],d=t+3+f-4,h=(u[t+10]&15)<<8|u[t+11];for(t+=12+h;t<d;){const g=Sf(u,t),p=(u[t+3]&15)<<8|u[t+4];switch(u[t]){case 207:if(!s){Xc("ADTS AAC",l);break}case 15:o.audioPid===-1&&(o.audioPid=g);break;case 21:o.id3Pid===-1&&(o.id3Pid=g);break;case 219:if(!s){Xc("H.264",l);break}case 27:o.videoPid===-1&&(o.videoPid=g);break;case 3:case 4:!e.mpeg&&!e.mp3?l.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="mp3");break;case 193:if(!s){Xc("AC-3",l);break}case 129:e.ac3?o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&p>0){let v=t+5,E=p;for(;E>2;){switch(u[v]){case 106:e.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=g,o.segmentAudioCodec="ac3");break}const A=u[v+1]+2;v+=A,E-=A}}break;case 194:case 135:return Tf(r,new Error("Unsupported EC-3 in M2TS found"),void 0,l),o;case 36:o.videoPid===-1&&(o.videoPid=g,o.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}t+=p+5}return o}function Tf(u,t,e,s){s.warn(`parsing error: ${t.message}`),u.emit(x.ERROR,x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:t,reason:t.message})}function Xc(u,t){t.log(`${u} with AES-128-CBC encryption found in unencrypted stream`)}function Jn(u,t){let e=0,s,r,l,o,f;const d=u.data;if(!u||u.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=mi(d[0],d[1]),d.splice(1,1);if(s=d[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>u.size-6)return null;const g=s[7];g&192&&(o=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,g&64?(f=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,o-f>60*9e4&&(t.warn(`${Math.round((o-f)/9e4)}s delta between PTS and DTS, align them`),o=f)):f=o),l=s[8];let p=l+9;if(u.size<=p)return null;u.size-=p;const v=new Uint8Array(u.size);for(let E=0,S=d.length;E<S;E++){s=d[E];let A=s.byteLength;if(p)if(p>A){p-=A;continue}else s=s.subarray(p),A-=p,p=0;v.set(s,e),e+=A}return r&&(r-=l+3),{data:v,pts:o,dts:f,len:r}}return null}class JA{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ms=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in H.types)H.types.hasOwnProperty(t)&&(H.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:e,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=l,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),f=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,o,d,o,f),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,r))}static box(t,...e){let s=8,r=e.length;const l=r;for(;r--;)s+=e[r].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(t,4),r=0,s=8;r<l;r++)o.set(e[r],s),s+=e[r].byteLength;return o}static hdlr(t){return H.box(H.types.hdlr,H.HDLR_TYPES[t])}static mdat(t){return H.box(H.types.mdat,t)}static mdhd(t,e){e*=t;const s=Math.floor(e/(Ms+1)),r=Math.floor(e%(Ms+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(t){return H.box(H.types.mdia,H.mdhd(t.timescale||0,t.duration||0),H.hdlr(t.type),H.minf(t))}static mfhd(t){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(t)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(t))}static moof(t,e,s){return H.box(H.types.moof,H.mfhd(t),H.traf(s,e))}static moov(t){let e=t.length;const s=[];for(;e--;)s[e]=H.trak(t[e]);return H.box.apply(null,[H.types.moov,H.mvhd(t[0].timescale||0,t[0].duration||0)].concat(s).concat(H.mvex(t)))}static mvex(t){let e=t.length;const s=[];for(;e--;)s[e]=H.trex(t[e]);return H.box.apply(null,[H.types.mvex,...s])}static mvhd(t,e){e*=t;const s=Math.floor(e/(Ms+1)),r=Math.floor(e%(Ms+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,l)}static sdtp(t){const e=t.samples||[],s=new Uint8Array(4+e.length);let r,l;for(r=0;r<e.length;r++)l=e[r].flags,s[r+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return H.box(H.types.sdtp,s)}static stbl(t){return H.box(H.types.stbl,H.stsd(t),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(t){let e=[],s=[],r,l,o;for(r=0;r<t.sps.length;r++)l=t.sps[r],o=l.byteLength,e.push(o>>>8&255),e.push(o&255),e=e.concat(Array.prototype.slice.call(l));for(r=0;r<t.pps.length;r++)l=t.pps[r],o=l.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(l));const f=H.box(H.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(s))),d=t.width,h=t.height,g=t.pixelRatio[0],p=t.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(t){const e=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e,6,1,2])}static audioStsd(t){const e=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,e>>8&255,e&255,0,0])}static mp4a(t){return H.box(H.types.mp4a,H.audioStsd(t),H.box(H.types.esds,H.esds(t)))}static mp3(t){return H.box(H.types[".mp3"],H.audioStsd(t))}static ac3(t){return H.box(H.types["ac-3"],H.audioStsd(t),H.box(H.types.dac3,t.config))}static stsd(t){const{segmentCodec:e}=t;if(t.type==="audio"){if(e==="aac")return H.box(H.types.stsd,H.STSD,H.mp4a(t));if(e==="ac3"&&t.config)return H.box(H.types.stsd,H.STSD,H.ac3(t));if(e==="mp3"&&t.codec==="mp3")return H.box(H.types.stsd,H.STSD,H.mp3(t))}else if(t.pps&&t.sps){if(e==="avc")return H.box(H.types.stsd,H.STSD,H.avc1(t));if(e==="hevc"&&t.vps)return H.box(H.types.stsd,H.STSD,H.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${e}/${t.codec})`)}static tkhd(t){const e=t.id,s=(t.duration||0)*(t.timescale||0),r=t.width||0,l=t.height||0,o=Math.floor(s/(Ms+1)),f=Math.floor(s%(Ms+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,f>>24,f>>16&255,f>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,l>>8&255,l&255,0,0]))}static traf(t,e){const s=H.sdtp(t),r=t.id,l=Math.floor(e/(Ms+1)),o=Math.floor(e%(Ms+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255])),H.trun(t,s.length+16+20+8+16+8+8),s)}static trak(t){return t.duration=t.duration||4294967295,H.box(H.types.trak,H.tkhd(t),H.mdia(t))}static trex(t){const e=t.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const s=t.samples||[],r=s.length,l=12+16*r,o=new Uint8Array(l);let f,d,h,g,p,v;for(e+=8+l,o.set([t.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),f=0;f<r;f++)d=s[f],h=d.duration,g=d.size,p=d.flags,v=d.cts,o.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*f);return H.box(H.types.trun,o)}static initSegment(t){H.types||H.init();const e=H.moov(t);return mi(H.FTYP,e)}static hvc1(t){const e=t.params,s=[t.vps,t.sps,t.pps],r=4,l=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),r-1|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),s.length]);let o=l.length;for(let S=0;S<s.length;S+=1){o+=3;for(let A=0;A<s[S].length;A+=1)o+=2+s[S][A].length}const f=new Uint8Array(o);f.set(l,0),o=l.length;const d=s.length-1;for(let S=0;S<s.length;S+=1){f.set(new Uint8Array([32+S|(S===d?128:0),0,s[S].length]),o),o+=3;for(let A=0;A<s[S].length;A+=1)f.set(new Uint8Array([s[S][A].length>>8,s[S][A].length&255]),o),o+=2,f.set(s[S][A],o),o+=s[S][A].length}const h=H.box(H.types.hvcC,f),g=t.width,p=t.height,v=t.pixelRatio[0],E=t.pixelRatio[1];return H.box(H.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,E>>24,E>>16&255,E>>8&255,E&255])))}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const Oy=9e4;function qf(u,t,e=1,s=!1){const r=u*t*e;return s?Math.round(r):r}function tb(u,t,e=1,s=!1){return qf(u,t,1/e,s)}function aa(u,t=!1){return qf(u,1e3,1/Oy,t)}function eb(u,t=1){return qf(u,Oy,1/t)}function tp(u){const{baseTime:t,timescale:e,trackId:s}=u;return`${t/e} (${t}/${e}) trackId: ${s}`}const ib=10*1e3,sb=1024,nb=1152,rb=1536;let tr=null,Qc=null;function ep(u,t,e,s){return{duration:t,size:e,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:u?2:1,isNonSync:u?0:1}}}class io extends pi{constructor(t,e,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=s,this.ISGenerated=!1,tr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);tr=o?parseInt(o[1]):0}if(Qc===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);Qc=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){const e=this._initPTS;(!e||!t||t.trackId!==e.trackId||t.baseTime!==e.baseTime||t.timescale!==e.timescale)&&this.log(`Reset initPTS: ${e&&tp(e)} > ${t&&tp(t)}`),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const s=t[0].pts,r=t.reduce((l,o)=>{let f=o.pts,d=f-l;return d<-4294967296&&(e=!0,f=ti(f,s),d=f-l),d>0?l:f},s);return e&&this.debug("PTS rollover detected"),r}remux(t,e,s,r,l,o,f,d){let h,g,p,v,E,S,A=l,b=l;const L=t.pid>-1,_=e.pid>-1,D=e.samples.length,C=t.samples.length>0,k=f&&D>0||D>1;if((!L||C)&&(!_||k)||this.ISGenerated||f){if(this.ISGenerated){var O,F,$,U;const ht=this.videoTrackConfig;(ht&&(e.width!==ht.width||e.height!==ht.height||((O=e.pixelRatio)==null?void 0:O[0])!==((F=ht.pixelRatio)==null?void 0:F[0])||(($=e.pixelRatio)==null?void 0:$[1])!==((U=ht.pixelRatio)==null?void 0:U[1]))||!ht&&k||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(t,e,l,o));const Q=this.isVideoContiguous;let st=-1,ut;if(k&&(st=ab(e.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,st>0){this.warn(`Dropped ${st} out of ${D} video samples due to a missing keyframe`);const ht=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(st),e.dropped+=st,b+=(e.samples[0].pts-ht)/e.inputTimeScale,ut=b}else st===-1&&(this.warn(`No keyframe found out of ${D} video samples`),S=!1);if(this.ISGenerated){if(C&&k){const ht=this.getVideoStartPts(e.samples),w=(ti(t.samples[0].pts,ht)-ht)/e.inputTimeScale;A+=Math.max(0,w),b+=Math.max(0,-w)}if(C){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(t,e,l,o)),g=this.remuxAudio(t,A,this.isAudioContiguous,o,_||k||d===dt.AUDIO?b:void 0),k){const ht=g?g.endPTS-g.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(t,e,l,o)),h=this.remuxVideo(e,b,Q,ht)}}else k&&(h=this.remuxVideo(e,b,Q,0));h&&(h.firstKeyFrame=st,h.independent=st!==-1,h.firstKeyFramePTS=ut)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(E=My(s,l,this._initPTS,this._initDTS)),r.samples.length&&(v=ky(r,l,this._initPTS))),{audio:g,video:h,initSegment:p,independent:S,text:v,id3:E}}computeInitPts(t,e,s,r){const l=Math.round(s*e);let o=ti(t,l);if(o<l+e)for(this.log(`Adjusting PTS for rollover in timeline near ${(l-o)/e} ${r}`);o<l+e;)o+=8589934592;return o-l}generateIS(t,e,s,r){const l=t.samples,o=e.samples,f=this.typeSupported,d={},h=this._initPTS;let g=!h||r,p="audio/mp4",v,E,S,A=-1;if(g&&(v=E=1/0),t.config&&l.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":f.mpeg?(p="audio/mpeg",t.codec=""):f.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3";break}d.audio={id:"audio",container:p,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&f.mpeg?new Uint8Array(0):H.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(A=t.id,S=t.inputTimeScale,!h||S!==h.timescale?v=E=this.computeInitPts(l[0].pts,S,s,"audio"):g=!1)}if(e.sps&&e.pps&&o.length){if(e.timescale=e.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:H.initSegment([e]),metadata:{width:e.width,height:e.height}},g)if(A=e.id,S=e.inputTimeScale,!h||S!==h.timescale){const b=this.getVideoStartPts(o),L=ti(o[0].dts,b),_=this.computeInitPts(L,S,s,"video"),D=this.computeInitPts(b,S,s,"video");E=Math.min(E,_),v=Math.min(v,D)}else g=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,g?(h&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${v/S} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${v/S} (${v}/${S}) trackId: ${A}`),this._initPTS={baseTime:v,timescale:S,trackId:A},this._initDTS={baseTime:E,timescale:S,trackId:A}):v=S=void 0,{tracks:d,initPTS:v,timescale:S,trackId:A}}remuxVideo(t,e,s,r){const l=t.inputTimeScale,o=t.samples,f=[],d=o.length,h=this._initPTS,g=h.baseTime*l/h.timescale;let p=this.nextVideoTs,v=8,E=this.videoSampleDuration,S,A,b=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,_=!1;if(!s||p===null){const I=g+e*l,P=o[0].pts-ti(o[0].dts,o[0].pts);tr&&p!==null&&Math.abs(I-P-(p+g))<15e3?s=!0:p=I-P-g}const D=p+g;for(let I=0;I<d;I++){const P=o[I];P.pts=ti(P.pts,D),P.dts=ti(P.dts,D),P.dts<o[I>0?I-1:I].dts&&(_=!0)}_&&o.sort(function(I,P){const it=I.dts-P.dts,nt=I.pts-P.pts;return it||nt}),S=o[0].dts,A=o[o.length-1].dts;const C=A-S,k=C?Math.round(C/(d-1)):E||t.inputTimeScale/30;if(s){const I=S-D,P=I>k,it=I<-1;if((P||it)&&(P?this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${aa(I,!0)} ms (${I}dts) hole between fragments detected at ${e.toFixed(3)}`):this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${aa(-I,!0)} ms (${I}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!it||D>=o[0].pts||tr)){S=D;const nt=o[0].pts-I;if(P)o[0].dts=S,o[0].pts=nt;else{let at=!0;for(let ft=0;ft<o.length&&!(o[ft].dts>nt&&at);ft++){const Et=o[ft].pts;if(o[ft].dts-=I,o[ft].pts-=I,ft<o.length-1){const wt=o[ft+1].pts,kt=o[ft].pts,De=wt<=kt,ni=wt<=Et;at=De==ni}}}this.log(`Video: Initial PTS/DTS adjusted: ${aa(nt,!0)}/${aa(S,!0)}, delta: ${aa(I,!0)} ms`)}}S=Math.max(0,S);let K=0,O=0,F=S;for(let I=0;I<d;I++){const P=o[I],it=P.units,nt=it.length;let at=0;for(let ft=0;ft<nt;ft++)at+=it[ft].data.length;O+=at,K+=nt,P.length=at,P.dts<F?(P.dts=F,F+=k/4|0||1):F=P.dts,b=Math.min(P.pts,b),L=Math.max(P.pts,L)}A=o[d-1].dts;const $=O+4*K+8;let U;try{U=new Uint8Array($)}catch(I){this.observer.emit(x.ERROR,x.ERROR,{type:pt.MUX_ERROR,details:V.REMUX_ALLOC_ERROR,fatal:!1,error:I,bytes:$,reason:`fail allocating video mdat ${$}`});return}const Q=new DataView(U.buffer);Q.setUint32(0,$),U.set(H.types.mdat,4);let st=!1,ut=Number.POSITIVE_INFINITY,ht=Number.POSITIVE_INFINITY,lt=Number.NEGATIVE_INFINITY,w=Number.NEGATIVE_INFINITY;for(let I=0;I<d;I++){const P=o[I],it=P.units;let nt=0;for(let Et=0,wt=it.length;Et<wt;Et++){const kt=it[Et],De=kt.data,ni=kt.data.byteLength;Q.setUint32(v,ni),v+=4,U.set(De,v),v+=ni,nt+=4+ni}let at;if(I<d-1)E=o[I+1].dts-P.dts,at=o[I+1].pts-P.pts;else{const Et=this.config,wt=I>0?P.dts-o[I-1].dts:k;if(at=I>0?P.pts-o[I-1].pts:k,Et.stretchShortVideoTrack&&this.nextAudioTs!==null){const kt=Math.floor(Et.maxBufferHole*l),De=(r?b+r*l:this.nextAudioTs+g)-P.pts;De>kt?(E=De-wt,E<0?E=wt:st=!0,this.log(`It is approximately ${De/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=wt}else E=wt}const ft=Math.round(P.pts-P.dts);ut=Math.min(ut,E),lt=Math.max(lt,E),ht=Math.min(ht,at),w=Math.max(w,at),f.push(ep(P.key,E,nt,ft))}if(f.length){if(tr){if(tr<70){const I=f[0].flags;I.dependsOn=2,I.isNonSync=0}}else if(Qc&&w-ht<lt-ut&&k/lt<.025&&f[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let I=S;for(let P=0,it=f.length;P<it;P++){const nt=I+f[P].duration,at=I+f[P].cts;if(P<it-1){const ft=nt+f[P+1].cts;f[P].duration=ft-at}else f[P].duration=P?f[P-1].duration:k;f[P].cts=0,I=nt}}}E=st||!E?k:E;const X=A+E;this.nextVideoTs=p=X-g,this.videoSampleDuration=E,this.isVideoContiguous=!0;const ot={data1:H.moof(t.sequenceNumber++,S,Kt(t,{samples:f})),data2:U,startPTS:(b-g)/l,endPTS:(L+E-g)/l,startDTS:(S-g)/l,endDTS:p/l,type:"video",hasAudio:!1,hasVideo:!0,nb:f.length,dropped:t.dropped};return t.samples=[],t.dropped=0,ot}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return nb;case"ac3":return rb;default:return sb}}remuxAudio(t,e,s,r,l){const o=t.inputTimeScale,f=t.samplerate?t.samplerate:o,d=o/f,h=this.getSamplesPerFrame(t),g=h*d,p=this._initPTS,v=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],S=l!==void 0;let A=t.samples,b=v?0:8,L=this.nextAudioTs||-1;const _=p.baseTime*o/p.timescale,D=_+e*o;if(this.isAudioContiguous=s=s||A.length&&L>0&&(r&&Math.abs(D-(L+_))<9e3||Math.abs(ti(A[0].pts,D)-(L+_))<20*g),A.forEach(function(w){w.pts=ti(w.pts,D)}),!s||L<0){const w=A.length;if(A=A.filter(X=>X.pts>=0),w!==A.length&&this.warn(`Removed ${A.length-w} of ${w} samples (initPTS ${_} / ${o})`),!A.length)return;l===0?L=0:r&&!S?L=Math.max(0,D-_):L=A[0].pts-_}if(t.segmentCodec==="aac"){const w=this.config.maxAudioFramesDrift;for(let X=0,Z=L+_;X<A.length;X++){const rt=A[X],ot=rt.pts,I=ot-Z,P=Math.abs(1e3*I/o);if(I<=-w*g&&S)X===0&&(this.warn(`Audio frame @ ${(ot/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*I/o)} ms.`),this.nextAudioTs=L=ot-_,Z=ot);else if(I>=w*g&&P<ib&&S){let it=Math.round(I/g);for(Z=ot-it*g;Z<0&&it&&g;)it--,Z+=g;X===0&&(this.nextAudioTs=L=Z-_),this.warn(`Injecting ${it} audio frames @ ${((Z-_)/o).toFixed(3)}s due to ${Math.round(1e3*I/o)} ms gap.`);for(let nt=0;nt<it;nt++){let at=JA.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);at||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),at=rt.unit.subarray()),A.splice(X,0,{unit:at,pts:Z}),Z+=g,X++}}rt.pts=Z,Z+=g}}let C=null,k=null,K,O=0,F=A.length;for(;F--;)O+=A[F].unit.byteLength;for(let w=0,X=A.length;w<X;w++){const Z=A[w],rt=Z.unit;let ot=Z.pts;if(k!==null){const P=E[w-1];P.duration=Math.round((ot-k)/d)}else if(s&&t.segmentCodec==="aac"&&(ot=L+_),C=ot,O>0){O+=b;try{K=new Uint8Array(O)}catch(P){this.observer.emit(x.ERROR,x.ERROR,{type:pt.MUX_ERROR,details:V.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:O,reason:`fail allocating audio mdat ${O}`});return}v||(new DataView(K.buffer).setUint32(0,O),K.set(H.types.mdat,4))}else return;K.set(rt,b);const I=rt.byteLength;b+=I,E.push(ep(!0,h,I,0)),k=ot}const $=E.length;if(!$)return;const U=E[E.length-1];L=k-_,this.nextAudioTs=L+d*U.duration;const Q=v?new Uint8Array(0):H.moof(t.sequenceNumber++,C/d,Kt({},t,{samples:E}));t.samples=[];const st=(C-_)/o,ut=this.nextAudioTs/o,lt={data1:Q,data2:K,startPTS:st,endPTS:ut,startDTS:st,endDTS:ut,type:"audio",hasAudio:!0,hasVideo:!1,nb:$};return this.isAudioContiguous=!0,lt}}function ti(u,t){let e;if(t===null)return u;for(t<u?e=-8589934592:e=8589934592;Math.abs(u-t)>4294967296;)u+=e;return u}function ab(u){for(let t=0;t<u.length;t++)if(u[t].key)return t;return-1}function My(u,t,e,s){const r=u.samples.length;if(!r)return;const l=u.inputTimeScale;for(let f=0;f<r;f++){const d=u.samples[f];d.pts=ti(d.pts-e.baseTime*l/e.timescale,t*l)/l,d.dts=ti(d.dts-s.baseTime*l/s.timescale,t*l)/l}const o=u.samples;return u.samples=[],{samples:o}}function ky(u,t,e){const s=u.samples.length;if(!s)return;const r=u.inputTimeScale;for(let o=0;o<s;o++){const f=u.samples[o];f.pts=ti(f.pts-e.baseTime*r/e.timescale,t*r)/r}u.samples.sort((o,f)=>o.pts-f.pts);const l=u.samples;return u.samples=[],{samples:l}}class lb extends pi{constructor(t,e,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(t){this.lastEndTime=null;const e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,s,r){this.audioCodec=e,this.videoCodec=s,this.generateInitSegment(t,r),this.emitInitSegment=!0}generateInitSegment(t,e){let{audioCodec:s,videoCodec:r}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:l,video:o}=this.initData=Fp(t);if(e)qT(t,e);else{const d=l||o;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}l&&(s=ip(l,Yt.AUDIO,this)),o&&(r=ip(o,Yt.VIDEO,this));const f={};l&&o?f.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:l?f.audio={container:"audio/mp4",codec:s,encrypted:l.encrypted,initSegment:t,id:"audio"}:o?f.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=f}remux(t,e,s,r,l,o){var f,d;let{initPTS:h,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};ct(g)||(g=this.lastEndTime=l||0);const v=e.samples;if(!v.length)return p;const E={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((f=S)!=null&&f.length||(this.generateInitSegment(v),S=this.initData),!((d=S)!=null&&d.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const A=QT(v,S,this),b=S.audio?A[S.audio.id]:null,L=S.video?A[S.video.id]:null,_=zl(L,1/0),D=zl(b,1/0),C=zl(L,0,!0),k=zl(b,0,!0);let K=l,O=0;const F=b&&(!L||!h&&D<_||h&&h.trackId===S.audio.id),$=F?b:L;if($){const Z=$.timescale,rt=$.start-l*Z,ot=F?S.audio.id:S.video.id;K=$.start/Z,O=F?k-D:C-_,(o||!h)&&(ob(h,K,l,O)||Z!==h.timescale)&&(h&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${l} ${rt/Z} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${l} offset: ${K-l} (${rt}/${Z}) trackId: ${ot}`),h=null,E.initPTS=rt,E.timescale=Z,E.trackId=ot)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${l}`);h?(E.initPTS=h.baseTime,E.timescale=h.timescale,E.trackId=h.trackId):((!E.timescale||E.trackId===void 0||E.initPTS===void 0)&&(this.warn("Could not set initPTS"),E.initPTS=K,E.timescale=1,E.trackId=-1),this.initPTS=h={baseTime:E.initPTS,timescale:E.timescale,trackId:E.trackId});const U=K-h.baseTime/h.timescale,Q=U+O;O>0?this.lastEndTime=Q:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const st=!!S.audio,ut=!!S.video;let ht="";st&&(ht+="audio"),ut&&(ht+="video");const lt=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),w={data1:v,startPTS:U,startDTS:U,endPTS:Q,endDTS:Q,type:ht,hasAudio:st,hasVideo:ut,nb:1,dropped:0,encrypted:lt};p.audio=st&&!ut?w:void 0,p.video=ut?w:void 0;const X=L==null?void 0:L.sampleCount;if(X){const Z=L.keyFrameIndex,rt=Z!==-1;w.nb=X,w.dropped=Z===0||this.isVideoContiguous?0:rt?Z:X,w.independent=rt,w.firstKeyFrame=Z,rt&&L.keyFrameStart&&(w.firstKeyFramePTS=(L.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(p.independent=rt),this.isVideoContiguous||(this.isVideoContiguous=rt),w.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Z}/${X} dropped: ${w.dropped} start: ${w.firstKeyFramePTS||"NA"}`)}return p.initSegment=E,p.id3=My(s,l,h,h),r.samples.length&&(p.text=ky(r,l,h)),p}}function zl(u,t,e=!1){return(u==null?void 0:u.start)!==void 0?(u.start+(e?u.duration:0))/u.timescale:t}function ob(u,t,e,s){if(u===null)return!0;const r=Math.max(s,1),l=t-u.baseTime/u.timescale;return Math.abs(l-e)>r}function ip(u,t,e){const s=u.codec;return s&&s.length>4?s:t===Yt.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?oo(s,!1):(e.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(e.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let rs;try{rs=self.performance.now.bind(self.performance)}catch{rs=Date.now}const so=[{demux:YA,remux:lb},{demux:Ns,remux:io},{demux:VA,remux:io},{demux:KA,remux:io}];so.splice(2,0,{demux:zA,remux:io});class sp{constructor(t,e,s,r,l,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=s,this.id=l,this.logger=o}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,s,r){const l=s.transmuxing;l.executeStart=rs();let o=new Uint8Array(t);const{currentTransmuxState:f,transmuxConfig:d}=this;r&&(this.currentTransmuxState=r);const{contiguous:h,discontinuity:g,trackSwitch:p,accurateTimeOffset:v,timeOffset:E,initSegmentChange:S}=r||f,{audioCodec:A,videoCodec:b,defaultInitPts:L,duration:_,initSegmentData:D}=d,C=ub(o,e);if(C&&nr(C.method)){const F=this.getDecrypter(),$=Ff(C.method);if(F.isSync()){let U=F.softwareDecrypt(o,C.key.buffer,C.iv.buffer,$);if(s.part>-1){const st=F.flush();U=st&&st.buffer}if(!U)return l.executeEnd=rs(),Wc(s);o=new Uint8Array(U)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(o,C.key.buffer,C.iv.buffer,$).then(U=>{const Q=this.push(U,null,s);return this.decryptionPromise=null,Q}),this.decryptionPromise}const k=this.needsProbing(g,p);if(k){const F=this.configureTransmuxer(o);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),l.executeEnd=rs(),Wc(s)}(g||p||S||k)&&this.resetInitSegment(D,A,b,_,e),(g||S||k)&&this.resetInitialTimestamp(L),h||this.resetContiguity();const K=this.transmux(o,C,E,v,s);this.asyncResult=pa(K);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,l.executeEnd=rs(),K}flush(t){const e=t.transmuxing;e.executeStart=rs();const{decrypter:s,currentTransmuxState:r,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(t));const o=[],{timeOffset:f}=r;if(s){const p=s.flush();p&&o.push(this.push(p.buffer,null,t))}const{demuxer:d,remuxer:h}=this;if(!d||!h){e.executeEnd=rs();const p=[Wc(t)];return this.asyncResult?Promise.resolve(p):p}const g=d.flush(f);return pa(g)?(this.asyncResult=!0,g.then(p=>(this.flushRemux(o,p,t),o))):(this.flushRemux(o,g,t),this.asyncResult?Promise.resolve(o):o)}flushRemux(t,e,s){const{audioTrack:r,videoTrack:l,id3Track:o,textTrack:f}=e,{accurateTimeOffset:d,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===dt.MAIN?"level":"track"} ${s.level}`);const g=this.remuxer.remux(r,l,o,f,h,d,!0,this.id);t.push({remuxResult:g,chunkMeta:s}),s.transmuxing.executeEnd=rs()}resetInitialTimestamp(t){const{demuxer:e,remuxer:s}=this;!e||!s||(e.resetTimeStamp(t),s.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,s,r,l){const{demuxer:o,remuxer:f}=this;!o||!f||(o.resetInitSegment(t,e,s,r),f.resetInitSegment(t,e,s,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,s,r,l){let o;return e&&e.method==="SAMPLE-AES"?o=this.transmuxSampleAes(t,e,s,r,l):o=this.transmuxUnencrypted(t,s,r,l),o}transmuxUnencrypted(t,e,s,r){const{audioTrack:l,videoTrack:o,id3Track:f,textTrack:d}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,o,f,d,e,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(t,e,s,r,l){return this.demuxer.demuxSampleAes(t,e,s).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,s,r,!1,this.id),chunkMeta:l}))}configureTransmuxer(t){const{config:e,observer:s,typeSupported:r}=this;let l;for(let p=0,v=so.length;p<v;p++){var o;if((o=so[p].demux)!=null&&o.probe(t,this.logger)){l=so[p];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const f=this.demuxer,d=this.remuxer,h=l.remux,g=l.demux;(!d||!(d instanceof h))&&(this.remuxer=new h(s,e,r,this.logger)),(!f||!(f instanceof g))&&(this.demuxer=new g(s,e,r,this.logger),this.probe=g.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Uf(this.config)),t}}function ub(u,t){let e=null;return u.byteLength>0&&(t==null?void 0:t.key)!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const Wc=u=>({remuxResult:{},chunkMeta:u});function pa(u){return"then"in u&&u.then instanceof Function}class cb{constructor(t,e,s,r,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=s,this.duration=r,this.defaultInitPts=l||null}}class fb{constructor(t,e,s,r,l,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=l,this.initSegmentChange=o}}let np=0;class wy{constructor(t,e,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=np++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const h=d.data,g=this.hls;if(!(!g||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{g.logger[h.data.logType]&&g.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,g.trigger(h.event,h.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const h=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const l=t.config;this.hls=t,this.id=e,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const o=(d,h)=>{h=h||{},h.frag=this.frag||void 0,d===x.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(d,h)};this.observer=new Hf,this.observer.on(x.FRAG_DECRYPTED,o),this.observer.on(x.ERROR,o);const f=Em(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(l.workerPath||mA()){try{l.workerPath?(d.log(`loading Web Worker ${l.workerPath} for "${e}"`),this.workerContext=yA(l.workerPath)):(d.log(`injecting Web Worker for "${e}"`),this.workerContext=pA());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:f,id:e,config:qt(l)})}catch(g){d.warn(`Error setting up "${e}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new sp(this.observer,f,l,"",e,t.logger)}return}}this.transmuxer=new sp(this.observer,f,l,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=np++;const e=this.hls.config,s=Em(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:s,id:this.id,config:qt(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),vA(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,s,r,l,o,f,d,h,g){var p,v;h.transmuxing.start=self.performance.now();const{instanceNo:E,transmuxer:S}=this,A=o?o.start:l.start,b=l.decryptdata,L=this.frag,_=!(L&&l.cc===L.cc),D=!(L&&h.level===L.level),C=L?h.sn-L.sn:-1,k=this.part?h.part-this.part.index:-1,K=C===0&&h.id>1&&h.id===(L==null?void 0:L.stats.chunkCount),O=!D&&(C===1||C===0&&(k===1||K&&k<=0)),F=self.performance.now();(D||C||l.stats.parsing.start===0)&&(l.stats.parsing.start=F),o&&(k||!O)&&(o.stats.parsing.start=F);const $=!(L&&((p=l.initSegment)==null?void 0:p.url)===((v=L.initSegment)==null?void 0:v.url)),U=new fb(_,O,d,D,A,$);if(!O||_||$){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===dt.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${_}
        trackSwitch: ${D}
        contiguous: ${O}
        accurateTimeOffset: ${d}
        timeOffset: ${A}
        initSegmentChange: ${$}`);const Q=new cb(s,r,e,f,g);this.configureTransmuxer(Q)}if(this.frag=l,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:E,cmd:"demux",data:t,decryptdata:b,chunkMeta:h,state:U},t instanceof ArrayBuffer?[t]:[]);else if(S){const Q=S.push(t,b,h,U);pa(Q)?Q.then(st=>{this.handleTransmuxComplete(st)}).catch(st=>{this.transmuxerError(st,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(Q)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(s){const r=s.flush(t);pa(r)?r.then(l=>{this.handleFlushResult(l,t)}).catch(l=>{this.transmuxerError(l,t,"transmuxer-interface flush error")}):this.handleFlushResult(r,t)}}transmuxerError(t,e,s){this.hls&&(this.error=t,this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:s}))}handleFlushResult(t,e){t.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):s&&s.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const rp=100;class hb extends Gf{constructor(t,e,s){super(t,e,s,"audio-stream-controller",dt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(x.BUFFER_RESET,this.onBufferReset,this),t.on(x.BUFFER_CREATED,this.onBufferCreated,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(x.FRAG_LOADING,this.onFragLoading,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(x.BUFFER_RESET,this.onBufferReset,this),t.off(x.BUFFER_CREATED,this.onBufferCreated,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(x.FRAG_LOADING,this.onFragLoading,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,{frag:e,id:s,initPTS:r,timescale:l,trackId:o}){if(s===dt.MAIN){const f=e.cc,d=this.fragCurrent;if(this.initPTS[f]={baseTime:r,timescale:l,trackId:o},this.log(`InitPTS for cc: ${f} found from main: ${r/l} (${r}/${l}) trackId: ${o}`),this.mainAnchor=e,this.state===J.WAITING_INIT_PTS){const h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==f)&&this.syncWithAnchor(e,h==null?void 0:h.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==f?(d.abortRequests(),this.syncWithAnchor(e,d)):this.state===J.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(e&&(r==null?void 0:r.cc)===e.cc)return;const l=(r||t).cc,o=this.getLevelDetails(),f=this.getLoadPosition(),d=Qp(o,l,f);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===J.IDLE&&this.doTickIdle())}startLoad(t,e){if(!this.levels){this.startPosition=t,this.state=J.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(rp),s>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),t=s,this.state=J.IDLE):this.state=J.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case J.IDLE:this.doTickIdle();break;case J.WAITING_TRACK:{const{levels:t,trackId:e}=this,s=t==null?void 0:t[e],r=s==null?void 0:s.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=J.WAITING_INIT_PTS}break}case J.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case J.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:e,part:s,cache:r,complete:l}=t,o=this.mainAnchor;if(this.initPTS[e.cc]!==void 0){this.waitingData=null,this.state=J.FRAG_LOADING;const f=r.flush().buffer,d={frag:e,part:s,payload:f,networkDetails:null};this._handleFragmentLoadProgress(d),l&&super._handleFragmentLoadComplete(d)}else o&&o.cc!==t.frag.cc&&this.syncWithAnchor(o,t.frag)}else this.state=J.IDLE}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:s,media:r,trackId:l}=this,o=e.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(s!=null&&s[l]))return;const f=s[l],d=f.details;if(!d||this.waitForLive(f)||this.waitForCdnTuneIn(d)){this.state=J.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,Yt.AUDIO,dt.AUDIO));const g=this.getFwdBufferInfo(h,dt.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,d)){e.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=J.ENDED;return}const p=g.len,v=e.maxBufferLength,E=d.fragments,S=E[0].start,A=this.getLoadPosition(),b=this.flushing?A:g.end;if(this.switchingTrack&&r){const D=A;d.PTSKnown&&D<S&&(g.end>S||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=S+.05)}if(p>=v&&!this.switchingTrack&&b<E[E.length-1].start)return;let L=this.getNextFragment(b,d);if(L&&this.isLoopLoading(L,b)&&(L=this.getNextFragmentLoopLoading(L,d,g,dt.MAIN,v)),!L){this.bufferFlushed=!0;return}let _=((t=this.mainFragLoading)==null?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&ae(L)&&!L.endList&&(!d.live||!this.loadingParts&&b<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===de.OK&&(this.mainFragLoading=_=null),_&&ae(_))){if(L.start>_.end){const C=this.fragmentTracker.getFragAtPos(b,dt.MAIN);C&&C.end>_.end&&(_=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(L.start>_.end)return}this.loadFragment(L,f,b)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(s=>new da(s))}onAudioTrackSwitching(t,e){const s=!!e.url;this.trackId=e.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==J.STOPPED&&(this.setInterval(rp),this.state=J.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(t,e){var s;const{levels:r}=this,{details:l,id:o,groupId:f,track:d}=e;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${d.name}" of "${f}"`);return}const h=this.mainDetails;if(!h||l.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=e,this.state!==J.STOPPED&&(this.state=J.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${d.name}" of "${f}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const g=r[o];let p=0;if(l.live||(s=g.details)!=null&&s.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(g.details){var v;p=this.alignPlaylists(l,g.details,(v=this.levelLastLoaded)==null?void 0:v.details)}l.alignedSliding||(gy(l,h),l.alignedSliding||po(l,h),p=l.fragmentStart)}g.details=l,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(h,p),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:l,id:o,groupId:e.groupId}),this.state===J.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=J.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const s=t.frag,{part:r,payload:l}=t,{config:o,trackId:f,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const h=d[f];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const g=h.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const p=o.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new wy(this.hls,dt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[s.cc],S=(e=s.initSegment)==null?void 0:e.data;if(E!==void 0){const b=r?r.index:-1,L=b!==-1,_=new Bf(s.level,s.sn,s.stats.chunkCount,l.byteLength,b,L);v.push(l,S,p,"",s,r,g.totalduration,!1,_,E)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${g.startSN} ,${g.endSN}],track ${f}`);const{cache:A}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new my,complete:!1};A.push(new Uint8Array(l)),this.state!==J.STOPPED&&(this.state=J.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const s=e.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(t,e){!this.audioOnly&&e.frag.type===dt.MAIN&&ae(e.frag)&&(this.mainFragLoading=e,this.state===J.IDLE&&this.tick())}onFragBuffered(t,e){const{frag:s,part:r}=e;if(s.type!==dt.AUDIO){!this.audioOnly&&s.type===dt.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ae(s)){this.fragPrevious=s;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,$t({},l)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(t,e){var s;if(e.fatal){this.state=J.ERROR;return}switch(e.details){case V.FRAG_GAP:case V.FRAG_PARSING_ERROR:case V.FRAG_DECRYPT_ERROR:case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(dt.AUDIO,e);break;case V.AUDIO_TRACK_LOAD_ERROR:case V.AUDIO_TRACK_LOAD_TIMEOUT:case V.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===J.WAITING_TRACK&&((s=e.context)==null?void 0:s.type)===Rt.AUDIO_TRACK&&(this.state=J.IDLE);break;case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case V.BUFFER_FULL_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case V.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushing(t,{type:e}){e!==Yt.VIDEO&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==Yt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===J.ENDED&&(this.state=J.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,e,dt.AUDIO),this.tick())}}_handleTransmuxComplete(t){var e;const s="audio",{hls:r}=this,{remuxResult:l,chunkMeta:o}=t,f=this.getCurrentContext(o);if(!f){this.resetWhenMissingContext(o);return}const{frag:d,part:h,level:g}=f,{details:p}=g,{audio:v,text:E,id3:S,initSegment:A}=l;if(this.fragContextChanged(d)||!p){this.fragmentTracker.removeFragment(d);return}if(this.state=J.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const b=d.initSegment||d;if(this.unhandledEncryptionError(A,d))return;this._bufferInitSegment(g,A.tracks,b,o),r.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:s,tracks:A.tracks})}if(v){const{startPTS:b,endPTS:L,startDTS:_,endDTS:D}=v;h&&(h.elementaryStreams[Yt.AUDIO]={startPTS:b,endPTS:L,startDTS:_,endDTS:D}),d.setElementaryStreamInfo(Yt.AUDIO,b,L,_,D),this.bufferFragmentData(v,d,h,o)}if(S!=null&&(e=S.samples)!=null&&e.length){const b=Kt({id:s,frag:d,details:p},S);r.trigger(x.FRAG_PARSING_METADATA,b)}if(E){const b=Kt({id:s,frag:d,details:p},E);r.trigger(x.FRAG_PARSING_USERDATA,b)}}_bufferInitSegment(t,e,s,r){if(this.state!==J.PARSING||(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio))return;const l=e.audio;l.id=dt.AUDIO;const o=t.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${o}/${l.codec}]`),o&&o.split(",").length===1&&(l.levelCodec=o),this.hls.trigger(x.BUFFER_CODECS,e);const f=l.initSegment;if(f!=null&&f.byteLength){const d={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:f};this.hls.trigger(x.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(t,e,s){const r=this.fragmentTracker.getState(t);if(this.switchingTrack||r===de.NOT_LOADED||r===de.PARTIAL){var l;if(!ae(t))this._loadInitSegment(t,e);else if((l=e.details)!=null&&l.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=J.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==e.details.fragmentStart&&po(e.details,o)}else super.loadFragment(t,e,s)}else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:s,assocLang:r,characteristics:l,audioCodec:o,channels:f}=this.bufferedTrack;on({name:e,lang:s,assocLang:r,characteristics:l,audioCodec:o,channels:f},t,ln)||(co(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(x.AUDIO_TRACK_SWITCHED,$t({},t))}}class Xf extends pi{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,s){const r=e==null?void 0:e.renditionReports;if(r){let l=-1;for(let o=0;o<r.length;o++){const f=r[o];let d;try{d=new self.URL(f.URI,e.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),d=f.URI||""}if(d===t){l=o;break}else d===t.substring(0,d.length)&&(l=o)}if(l!==-1){const o=r[l],f=parseInt(o["LAST-MSN"])||e.lastPartSn;let d=parseInt(o["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(e.age-e.partTarget,e.targetduration);d>=0&&g>e.partTarget&&(d+=1)}const h=s&&Sm(s);return new Tm(f,d>=0?d:void 0,h)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return t}playlistLoaded(t,e,s){const{details:r,stats:l}=e,o=self.performance.now(),f=l.loading.first?Math.max(0,o-l.loading.first):0;r.advancedDateTime=Date.now()-f;const d=this.hls.config.timelineOffset;if(d!==r.appliedTimelineOffset){const g=Math.max(d||0,0);r.appliedTimelineOffset=g,r.fragments.forEach(p=>{p.setStart(p.playlistOffset+g)})}if(r.live||s!=null&&s.live){const g="levelInfo"in e?e.levelInfo:e.track;if(r.reloaded(s),s&&r.fragments.length>0){nA(s,r,this);const _=r.playlistParsingError;if(_){this.warn(_);const D=this.hls;if(!D.config.ignorePlaylistParsingErrors){var h;const{networkDetails:C}=e;D.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:V.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:_,reason:_.message,level:e.level||void 0,parent:(h=r.fragments[0])==null?void 0:h.type,networkDetails:C,stats:l});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=l.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,E=(r.edge-v)*1e3,S=uy(r,E);if(r.requestScheduled+S<o?r.requestScheduled=o:r.requestScheduled+=S,this.log(`live playlist ${t} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let A,b,L;if(r.canBlockReload&&r.endSN&&r.advanced){const _=this.hls.config.lowLatencyMode,D=r.lastPartSn,C=r.endSN,k=r.lastPartIndex,K=k!==-1,O=D===C;K?O?(b=C+1,L=_?0:k):(b=D,L=_?k+1:r.maxPartIndex):b=C+1;const F=r.age,$=F+r.ageHeader;let U=Math.min($-r.partTarget,r.targetduration*1.5);if(U>0){if($>r.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),b=void 0,L=void 0;else if(s!=null&&s.tuneInGoal&&$-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${U} with playlist age: ${r.age}`),U=0;else{const Q=Math.floor(U/r.targetduration);if(b+=Q,L!==void 0){const st=Math.round(U%r.targetduration/r.partTarget);L+=st}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${U} skip sn ${Q} to part ${L}`)}r.tuneInGoal=U}if(A=this.getDeliveryDirectives(r,e.deliveryDirectives,b,L),_||!O){r.requestScheduled=o,this.loadingPlaylist(g,A);return}}else(r.canBlockReload||r.canSkipUntil)&&(A=this.getDeliveryDirectives(r,e.deliveryDirectives,b,L));A&&b!==void 0&&r.canBlockReload&&(r.requestScheduled=l.loading.first+Math.max(S-f*2,S/2)),this.scheduleLoading(g,A,r)}else this.clearTimer()}scheduleLoading(t,e,s){const r=s||t.details;if(!r){this.loadingPlaylist(t,e);return}const l=self.performance.now(),o=r.requestScheduled;if(l>=o){this.loadingPlaylist(t,e);return}const f=o-l;this.log(`reload live playlist ${t.name||t.bitrate+"bps"} in ${Math.round(f)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),f)}getDeliveryDirectives(t,e,s,r){let l=Sm(t);return e!=null&&e.skip&&t.deltaUpdateFailed&&(s=e.msn,r=e.part,l=to.No),new Tm(s,r,l)}checkRetry(t){const e=t.details,s=fo(t),r=t.errorAction,{action:l,retryCount:o=0,retryConfig:f}=r||{},d=!!r&&!!f&&(l===Le.RetryRequest||!r.resolved&&l===Le.SendAlternateToPenaltyBox);if(d){var h;if(o>=f.maxNumRetry)return!1;if(s&&(h=t.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${f.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const g=Pf(f,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${o+1}/${f.maxNumRetry} after "${e}" in ${g}ms`)}t.levelRetry=!0,r.resolved=!0}return d}}function Ny(u,t){if(u.length!==t.length)return!1;for(let e=0;e<u.length;e++)if(!ya(u[e].attrs,t[e].attrs))return!1;return!0}function ya(u,t,e){const s=u["STABLE-RENDITION-ID"];return s&&!e?s===t["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>u[r]!==t[r])}function xf(u,t){return t.label.toLowerCase()===u.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(u.lang||"").toLowerCase())}class db extends Xf{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVEL_LOADING,this.onLevelLoading,this),t.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:s,groupId:r,details:l}=e,o=this.tracksInGroup[s];if(!o||o.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const f=o.details;o.details=e.details,this.log(`Audio track ${s} "${o.name}" lang:${o.lang} group:${r} loaded [${l.startSN}-${l.endSN}]`),s===this.trackId&&this.playlistLoaded(s,e,f)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const s=e.audioGroups||null,r=this.groupIds;let l=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(f=>(r==null?void 0:r.indexOf(f))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const f=this.tracks.filter(v=>!s||s.indexOf(v.groupId)!==-1);if(f.length)this.selectDefaultTrack&&!f.some(v=>v.default)&&(this.selectDefaultTrack=!1),f.forEach((v,E)=>{v.id=E});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=f;const d=this.hls.config.audioPreference;if(!l&&d){const v=ki(d,f,ln);if(v>-1)l=f[v];else{const E=ki(d,this.tracks);l=this.tracks[E]}}let h=this.findTrackId(l);h===-1&&l&&(h=this.findTrackId(null));const g={audioTracks:f};this.log(`Updating audio tracks, ${f.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(f.length&&p===-1){var o;const v=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${f.length}`);this.warn(v.message),this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(t,e){e.fatal||!e.context||e.context.type===Rt.AUDIO_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&on(t,r,ln))return r;const l=ki(t,this.tracksInGroup,ln);if(l>-1){const o=this.tracksInGroup[l];return this.setAudioTrack(l),o}else if(r){let o=e.loadLevel;o===-1&&(o=e.firstAutoLevel);const f=Lx(t,e.levels,s,o,ln);if(f===-1)return null;e.nextLoadLevel=f}if(t.channels||t.audioCodec){const o=ki(t,s);if(o>-1)return s[o]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn(`Invalid audio track id: ${t}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=e[t],l=r.details&&!r.details.live;if(t===this.trackId&&r===s&&l||(this.log(`Switching to audio-track ${t} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=t,this.currentTrack=r,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,$t({},r)),l))return;const o=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(o)}findTrackId(t){const e=this.tracksInGroup;for(let s=0;s<e.length;s++){const r=e[s];if(!(this.selectDefaultTrack&&!r.default)&&(!t||on(t,r,ln)))return s}if(t){const{name:s,lang:r,assocLang:l,characteristics:o,audioCodec:f,channels:d}=t;for(let h=0;h<e.length;h++){const g=e[h];if(on({name:s,lang:r,assocLang:l,characteristics:o,audioCodec:f,channels:d},g,ln))return h}for(let h=0;h<e.length;h++){const g=e[h];if(ya(t.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<e.length;h++){const g=e[h];if(ya(t.attrs,g.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&co(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const s=t.id,r=t.groupId,l=this.getUrlWithDirectives(t.url,e),o=t.details,f=o==null?void 0:o.age;this.log(`Loading audio-track ${s} "${t.name}" lang:${t.lang} group:${r}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""}${f&&o.live?" age "+f.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:l,id:s,groupId:r,deliveryDirectives:e||null,track:t})}}class gb{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[e];r.push(t),r.length===1&&!s&&this.executeNext(e)}appendBlocker(t){return new Promise(e=>{const s={label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,t)})}prependBlocker(t){return new Promise(e=>{if(this.queues){const s={label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[t].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const s=(e=t[0])==null?void 0:e.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(t[0].execute(),t.splice(0,1))})}unblockAudio(t){if(this.queues===null)return;this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(this.queues===null||this.tracks===null)return;const e=this.queues[t];if(e.length){const r=e[0];try{r.execute()}catch(l){var s;if(r.onError(l),this.queues===null||this.tracks===null)return;const o=(s=this.tracks[t])==null?void 0:s.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){this.queues!==null&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return((e=this.queues)==null?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return t===null||e===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(t){var e,s;return(e=this.queues)!=null&&e[t]||(s=this.tracks)!=null&&s[t]?`${t}: (${this.listSbInfo(t)}) ${this.listOps(t)}`:""}listSbInfo(t){var e;const s=(e=this.tracks)==null?void 0:e[t],r=s==null?void 0:s.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(t){var e;return((e=this.queues)==null?void 0:e[t].map(s=>s.label).join(", "))||""}}const ap=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Py="HlsJsTrackRemovedError";class mb extends Error{constructor(t){super(t),this.name=Py}}class pb extends pi{constructor(t,e){super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:l}=this;s&&this.log("Media source opened"),!(!r||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:r,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=t,this.fragmentTracker=e,this.appendSource=BT(Us(t.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.BUFFER_RESET,this.onBufferReset,this),t.on(x.BUFFER_APPENDING,this.onBufferAppending,this),t.on(x.BUFFER_CODECS,this.onBufferCodecs,this),t.on(x.BUFFER_EOS,this.onBufferEos,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.FRAG_PARSED,this.onFragParsed,this),t.on(x.FRAG_CHANGED,this.onFragChanged,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.BUFFER_RESET,this.onBufferReset,this),t.off(x.BUFFER_APPENDING,this.onBufferAppending,this),t.off(x.BUFFER_CODECS,this.onBufferCodecs,this),t.off(x.BUFFER_EOS,this.onBufferEos,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.FRAG_PARSED,this.onFragParsed,this),t.off(x.FRAG_CHANGED,this.onFragChanged,this),t.off(x.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const s={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const o=this.isQueued();(l||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===e?Kt(s,r.tracks):this.sourceBuffers.forEach(l=>{const[o]=l;o&&(s[o]=Kt({},this.tracks[o]),this.removeBuffer(o)),l[0]=l[1]=null}),{media:t,mediaSource:e,tracks:s}}initTracks(){const t={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=t,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var s;let r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(t,e){const s=this.media=e.media;this.transferData=this.overrides=void 0;const r=Us(this.appendSource);if(r){const l=!!e.mediaSource;(l||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const o=this.mediaSource=e.mediaSource||new r;if(this.assignMediaSource(o),l)this._objectUrl=s.src,this.attachTransferred();else{const f=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{s.removeAttribute("src");const d=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||d&&o instanceof d,lp(s),yb(s,f),s.load()}catch{s.src=f}else s.src=f}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,s;this.log(`${((e=this.transferData)==null?void 0:e.mediaSource)===t?"transferred":"created"} media source: ${(s=t.constructor)==null?void 0:s.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const s=this.tracks,r=e.tracks,l=r?Object.keys(r):null,o=l?l.length:0,f=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&l&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${qt(s,(d,h)=>d==="initSegment"?void 0:h)};
transfer tracks: ${qt(r,(d,h)=>d==="initSegment"?void 0:h)}}`),!Mp(r,s)){e.mediaSource=null,e.tracks=void 0;const d=t.currentTime,h=this.details,g=Math.max(d,(h==null?void 0:h.fragments[0].start)||0);if(g-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${g} currentTime: ${d}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,e),t.currentTime=g;return}this.transferData=void 0,l.forEach(d=>{const h=d,g=r[h];if(g){const p=g.buffer;if(p){const v=this.fragmentTracker,E=g.id;if(v.hasFragments(E)||v.hasParts(E)){const b=Tt.getBuffered(p);v.detectEvictedFragments(h,b,E,null,!0)}const S=Zc(h),A=[h,p];this.sourceBuffers[S]=A,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,g)}}}),f(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),f()}get mediaSourceOpenOrEnded(){var t;const e=(t=this.mediaSource)==null?void 0:t.readyState;return e==="open"||e==="ended"}onMediaDetaching(t,e){const s=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:l,_objectUrl:o}=this;if(l){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([f])=>{f&&this.removeBuffer(f)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const f=l.readyState==="open";try{const d=l.sourceBuffers;for(let h=d.length;h--;)f&&d[h].abort(),l.removeSourceBuffer(d[h]);f&&l.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&lp(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(([t])=>{t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(t){var e;const s=(e=this.tracks[t])==null?void 0:e.buffer;if(this.removeBuffer(t),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(l){this.warn(`onBufferReset ${t}`,l)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[Zc(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new gb(this.tracks)}onBufferCodecs(t,e){var s;const r=this.tracks,l=Object.keys(e);this.log(`BUFFER_CODECS: "${l}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in e&&(r.audio||r.video)||r.audiovideo&&("audio"in e||"video"in e),f=!o&&this.sourceBufferCount&&this.media&&l.some(d=>!r[d]);if(o||f){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${l}" SourceBuffers`);return}l.forEach(d=>{var h,g;const p=e[d],{id:v,codec:E,levelCodec:S,container:A,metadata:b,supplemental:L}=p;let _=r[d];const D=(h=this.transferData)==null||(h=h.tracks)==null?void 0:h[d],C=D!=null&&D.buffer?D:_,k=(C==null?void 0:C.pendingCodec)||(C==null?void 0:C.codec),K=C==null?void 0:C.levelCodec;_||(_=r[d]={buffer:void 0,listeners:[],codec:E,supplemental:L,container:A,levelCodec:S,metadata:b,id:v});const O=Jl(k,K),F=O==null?void 0:O.replace(ap,"$1");let $=Jl(E,S);const U=(g=$)==null?void 0:g.replace(ap,"$1");$&&O&&F!==U&&(d.slice(0,5)==="audio"&&($=oo($,this.appendSource)),this.log(`switching codec ${k} to ${$}`),$!==(_.pendingCodec||_.codec)&&(_.pendingCodec=$),_.container=A,this.appendChangeType(d,A,$))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!e.video&&((s=e.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const s=this.tracks[e];return t[e]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},t},{})}appendChangeType(t,e,s){const r=`${e};codecs=${s}`,l={label:`change-type=${r}`,execute:()=>{const o=this.tracks[t];if(o){const f=o.buffer;f!=null&&f.changeType&&(this.log(`changing ${t} sourceBuffer type to ${r}`),f.changeType(r),o.codec=s,o.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${t} SourceBuffer type`,o)}};this.append(l,t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const s=t.start,r=s+t.duration*.05;if(((e=this.fragmentTracker.getAppendedFrag(s,dt.MAIN))==null?void 0:e.gap)===!0)return;const o={label:"block-audio",execute:()=>{var f;const d=this.tracks.video;(this.lastVideoAppendEnd>r||d!=null&&d.buffer&&Tt.isBuffered(d.buffer,r)||((f=this.fragmentTracker.getAppendedFrag(r,dt.MAIN))==null?void 0:f.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:f=>{this.warn("Error executing block-audio operation",f)}};this.blockedAudioAppend={op:o,frag:t},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:s}=this,{data:r,type:l,parent:o,frag:f,part:d,chunkMeta:h,offset:g}=e,p=h.buffering[l],{sn:v,cc:E}=f,S=self.performance.now();p.start=S;const A=f.stats.buffering,b=d?d.stats.buffering:null;A.start===0&&(A.start=S),b&&b.start===0&&(b.start=S);const L=s.audio;let _=!1;l==="audio"&&(L==null?void 0:L.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const D=s.video,C=D==null?void 0:D.buffer;if(C&&v!=="initSegment"){const O=d||f,F=this.blockedAudioAppend;if(l==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(D.ending||D.ended)){const U=O.start+O.duration*.05,Q=C.buffered,st=this.currentOp("video");!Q.length&&!st?this.blockAudio(O):!st&&!Tt.isBuffered(C,U)&&this.lastVideoAppendEnd<U&&this.blockAudio(O)}else if(l==="video"){const $=O.end;if(F){const U=F.frag.start;($>U||$<this.lastVideoAppendEnd||Tt.isBuffered(C,U))&&this.unblockAudio()}this.lastVideoAppendEnd=$}}const k=(d||f).start,K={label:`append-${l}`,execute:()=>{var O;p.executeStart=self.performance.now();const F=(O=this.tracks[l])==null?void 0:O.buffer;F&&(_?this.updateTimestampOffset(F,k,.1,l,v,E):g!==void 0&&ct(g)&&this.updateTimestampOffset(F,g,1e-6,l,v,E)),this.appendExecutor(r,l)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();p.executeEnd=p.end=O,A.first===0&&(A.first=O),b&&b.first===0&&(b.first=O);const F={};this.sourceBuffers.forEach(([$,U])=>{$&&(F[$]=Tt.getBuffered(U))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:l,frag:f,part:d,chunkMeta:h,parent:f.type,timeRanges:F})},onError:O=>{var F;const $={type:pt.MEDIA_ERROR,parent:f.type,details:V.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:f,part:d,chunkMeta:h,error:O,err:O,fatal:!1},U=(F=this.media)==null?void 0:F.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)$.details=V.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!U)$.errorAction=sr(!0);else if(O.name===Py&&this.sourceBufferCount===0)$.errorAction=sr(!0);else{const Q=++this.appendErrors[l];this.warn(`Failed ${Q}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${U||"no media error"})`),(Q>=this.hls.config.appendErrorMaxRetry||U)&&($.fatal=!0)}this.hls.trigger(x.ERROR,$)}};this.log(`queuing "${l}" append sn: ${v}${d?" p: "+d.index:""} of ${f.type===dt.MAIN?"level":"track"} ${f.level} cc: ${E}`),this.append(K,l,this.isPending(this.tracks[l]))}getFlushOp(t,e,s){return this.log(`queuing "${t}" remove ${e}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(t,e,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:t})},onError:r=>{this.warn(`Failed to remove ${e}-${s} from "${t}" SourceBuffer`,r)}}}onBufferFlushing(t,e){const{type:s,startOffset:r,endOffset:l}=e;s?this.append(this.getFlushOp(s,r,l),s):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,l),o)})}onFragParsed(t,e){const{frag:s,part:r}=e,l=[],o=r?r.elementaryStreams:s.elementaryStreams;o[Yt.AUDIOVIDEO]?l.push("audiovideo"):(o[Yt.AUDIO]&&l.push("audio"),o[Yt.VIDEO]&&l.push("video"));const f=()=>{const d=self.performance.now();s.stats.buffering.end=d,r&&(r.stats.buffering.end=d);const h=r?r.stats:s.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:s,part:r,stats:h,id:s.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(f,l).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(t,e){var s;this.sourceBuffers.forEach(([o])=>{if(o){const f=this.tracks[o];(!e.type||e.type===o)&&(f.ending=!0,f.ended||(f.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var f;return o&&!((f=this.tracks[o])!=null&&f.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)):e.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([t])=>{if(t!==null){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const t=this.getDurationAndRange();t&&this.updateMediaSource(t)})}onError(t,e){if(e.details===V.BUFFER_APPEND_ERROR&&e.frag){var s;const r=(s=e.errorAction)==null?void 0:s.nextAutoLevel;ct(r)&&r!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:s}=this;if(!s||e===null||!this.sourceBufferCount)return;const r=t.config,l=s.currentTime,o=e.levelTargetDuration,f=e.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ct(f)&&f>=0){const h=Math.max(f,o),g=Math.floor(l/o)*o-h;this.flushBackBuffer(l,o,g)}const d=r.frontBufferFlushThreshold;if(ct(d)&&d>0){const h=Math.max(r.maxBufferLength,d),g=Math.max(h,o),p=Math.floor(l/o)*o+g;this.flushFrontBuffer(l,o,p)}}flushBackBuffer(t,e,s){this.sourceBuffers.forEach(([r,l])=>{if(l){const f=Tt.getBuffered(l);if(f.length>0&&s>f.start(0)){var o;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:s});const d=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(d!=null&&d.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(t,e,s){this.sourceBuffers.forEach(([r,l])=>{if(l){const o=Tt.getBuffered(l),f=o.length;if(f<2)return;const d=o.start(f-1),h=o.end(f-1);if(s>d||t>=d&&t<=h)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:r})}})}getDurationAndRange(){var t;const{details:e,mediaSource:s}=this;if(!e||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const r=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&s.setLiveSeekableRange){const h=Math.max(0,e.fragmentStart),g=Math.max(h,r);return{duration:1/0,start:h,end:g}}return{duration:1/0}}const l=(t=this.overrides)==null?void 0:t.duration;if(l)return ct(l)?{duration:l}:null;const o=this.media.duration,f=ct(s.duration)?s.duration:0;return r>f&&r>o||!ct(o)?{duration:r}:null}updateMediaSource({duration:t,start:e,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==t&&(ct(t)&&this.log(`Updating MediaSource duration to ${t.toFixed(3)}`),r.duration=t),e!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${e}-${s}.`),r.setLiveSeekableRange(e,s)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${e} codec events expected: ${t}) ${qt(s)}`),this.tracksReady){var r;const l=(r=this.transferData)==null?void 0:r.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(([e,s])=>{if(e){const r=this.tracks[e];t[e]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:t}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in t){const o=l,f=t[o];if(this.isPending(f)){const d=this.getTrackCodec(f,o),h=`${f.container};codecs=${d}`;f.codec=d,this.log(`creating sourceBuffer(${h})${this.currentOp(o)?" Queued":""} ${qt(f)}`);try{const g=s.addSourceBuffer(h),p=Zc(o),v=[o,g];e[p]=v,f.buffer=g}catch(g){var r;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:o,mimeType:h,parent:f.id});return}this.trackSourceBuffer(o,f)}}this.bufferCreated()}getTrackCodec(t,e){const s=t.supplemental;let r=t.codec;s&&(e==="video"||e==="audiovideo")&&fa(s,"video")&&(r=ax(r,s));const l=Jl(r,t.levelCodec);return l?e.slice(0,5)==="audio"?oo(l,this.appendSource):l:""}trackSourceBuffer(t,e){const s=e.buffer;if(!s)return;const r=this.getTrackCodec(e,t);this.tracks[t]={buffer:s,codec:r,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(l,o)=>{const f=o.removedRanges;f!=null&&f.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var t,e;const s=((t=this.media)==null||(e=t.querySelector)==null?void 0:e.call(t,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)==="closed"){this.resetBuffer(t);return}const s=this.currentOp(t);s&&(s.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var s;const r=new Error(`${t} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,e),this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:r,fatal:!1});const l=this.currentOp(t);l&&l.onError(r)}updateTimestampOffset(t,e,s,r,l,o){const f=e-t.timestampOffset;Math.abs(f)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${e} (sn: ${l} cc: ${o})`),t.timestampOffset=e)}removeExecutor(t,e,s){const{media:r,mediaSource:l}=this,o=this.tracks[t],f=o==null?void 0:o.buffer;if(!r||!l||!f){this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(t);return}const d=ct(r.duration)?r.duration:1/0,h=ct(l.duration)?l.duration:1/0,g=Math.max(0,e),p=Math.min(s,d,h);p>g&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${g},${p}] from the ${t} SourceBuffer`),f.remove(g,p)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const s=this.tracks[e],r=s==null?void 0:s.buffer;if(!r)throw new mb(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([t,e])=>t&&e.updating)}isQueued(){return this.sourceBuffers.some(([t])=>t&&!!this.currentOp(t))}isPending(t){return!!t&&!t.buffer}blockBuffers(t,e=this.sourceBufferTypes){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:s}=this,r=e.map(o=>this.appendBlocker(o));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{s===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(e=>{var s;const r=(s=this.tracks[e])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(e)})}append(t,e,s){this.operationQueue&&this.operationQueue.append(t,e,s)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,[e])=>t+(e?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([t])=>t).filter(t=>!!t)}addBufferListener(t,e,s){const r=this.tracks[t];if(!r)return;const l=r.buffer;if(!l)return;const o=s.bind(this,t);r.listeners.push({event:e,listener:o}),l.addEventListener(e,o)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const s=e.buffer;s&&(e.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),e.listeners.length=0)}}function lp(u){const t=u.querySelectorAll("source");[].slice.call(t).forEach(e=>{u.removeChild(e)})}function yb(u,t){const e=self.document.createElement("source");e.type="video/mp4",e.src=t,u.appendChild(e)}function Zc(u){return u==="audio"?1:0}class Qf{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.BUFFER_CODECS,this.onBufferCodecs,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.BUFFER_CODECS,this.onBufferCodecs,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const s=this.hls.levels[e.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const s=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,s.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&ct(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const t=this.hls.levels;if(t.length){const e=this.hls,s=this.getMaxLevel(t.length-1);s!==this.autoLevelCapping&&e.logger.log(`Setting autoLevelCapping to ${s}: ${t[s].height}p@${t[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=s,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const s=e.filter((r,l)=>this.isLevelAllowed(r)&&l<=t);return this.clientRect=null,Qf.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const s=t.getBoundingClientRect();e.width=s.width,e.height=s.height,!e.width&&!e.height&&(e.width=s.right-s.left||t.width||0,e.height=s.bottom-s.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(s=>t.bitrate===s.bitrate&&t.width===s.width&&t.height===s.height)}static getMaxLevelByMediaSize(t,e,s){if(!(t!=null&&t.length))return-1;const r=(f,d)=>d?f.width!==d.width||f.height!==d.height:!0;let l=t.length-1;const o=Math.max(e,s);for(let f=0;f<t.length;f+=1){const d=t[f];if((d.width>=o||d.height>=o)&&r(d,t[f+1])){l=f;break}}return l}}const vb={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ge=vb,Eb={HLS:"h"},Sb=Eb;class Ni{constructor(t,e){Array.isArray(t)&&(t=t.map(s=>s instanceof Ni?s:new Ni(s))),this.value=t,this.params=e}}const Tb="Dict";function xb(u){return Array.isArray(u)?JSON.stringify(u):u instanceof Map?"Map{}":u instanceof Set?"Set{}":typeof u=="object"?JSON.stringify(u):String(u)}function Ab(u,t,e,s){return new Error(`failed to ${u} "${xb(t)}" as ${e}`,{cause:s})}function Pi(u,t,e){return Ab("serialize",u,t,e)}class Uy{constructor(t){this.description=t}}const op="Bare Item",bb="Boolean";function Lb(u){if(typeof u!="boolean")throw Pi(u,bb);return u?"?1":"?0"}function Rb(u){return btoa(String.fromCharCode(...u))}const _b="Byte Sequence";function Db(u){if(ArrayBuffer.isView(u)===!1)throw Pi(u,_b);return`:${Rb(u)}:`}const Ib="Integer";function Cb(u){return u<-999999999999999||999999999999999<u}function By(u){if(Cb(u))throw Pi(u,Ib);return u.toString()}function Ob(u){return`@${By(u.getTime()/1e3)}`}function Fy(u,t){if(u<0)return-Fy(-u,t);const e=Math.pow(10,t);if(Math.abs(u*e%1-.5)<Number.EPSILON){const r=Math.floor(u*e);return(r%2===0?r:r+1)/e}else return Math.round(u*e)/e}const Mb="Decimal";function kb(u){const t=Fy(u,3);if(Math.floor(Math.abs(t)).toString().length>12)throw Pi(u,Mb);const e=t.toString();return e.includes(".")?e:`${e}.0`}const wb="String",Nb=/[\x00-\x1f\x7f]+/;function Pb(u){if(Nb.test(u))throw Pi(u,wb);return`"${u.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Ub(u){return u.description||u.toString().slice(7,-1)}const Bb="Token";function up(u){const t=Ub(u);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t)===!1)throw Pi(t,Bb);return t}function Af(u){switch(typeof u){case"number":if(!ct(u))throw Pi(u,op);return Number.isInteger(u)?By(u):kb(u);case"string":return Pb(u);case"symbol":return up(u);case"boolean":return Lb(u);case"object":if(u instanceof Date)return Ob(u);if(u instanceof Uint8Array)return Db(u);if(u instanceof Uy)return up(u);default:throw Pi(u,op)}}const Fb="Key";function bf(u){if(/^[a-z*][a-z0-9\-_.*]*$/.test(u)===!1)throw Pi(u,Fb);return u}function Wf(u){return u==null?"":Object.entries(u).map(([t,e])=>e===!0?`;${bf(t)}`:`;${bf(t)}=${Af(e)}`).join("")}function $y(u){return u instanceof Ni?`${Af(u.value)}${Wf(u.params)}`:Af(u)}function $b(u){return`(${u.value.map($y).join(" ")})${Wf(u.params)}`}function Gb(u,t={whitespace:!0}){if(typeof u!="object"||u==null)throw Pi(u,Tb);const e=u instanceof Map?u.entries():Object.entries(u),s=t!=null&&t.whitespace?" ":"";return Array.from(e).map(([r,l])=>{l instanceof Ni||(l=new Ni(l));let o=bf(r);return l.value===!0?o+=Wf(l.params):(o+="=",Array.isArray(l.value)?o+=$b(l):o+=$y(l)),o}).join(`,${s}`)}function Gy(u,t){return Gb(u,t)}const Ci="CMCD-Object",se="CMCD-Request",rn="CMCD-Session",ks="CMCD-Status",Hb={br:Ci,ab:Ci,d:Ci,ot:Ci,tb:Ci,tpb:Ci,lb:Ci,tab:Ci,lab:Ci,url:Ci,pb:se,bl:se,tbl:se,dl:se,ltc:se,mtp:se,nor:se,nrr:se,rc:se,sn:se,sta:se,su:se,ttfb:se,ttfbb:se,ttlb:se,cmsdd:se,cmsds:se,smrt:se,df:se,cs:se,ts:se,cid:rn,pr:rn,sf:rn,sid:rn,st:rn,v:rn,msd:rn,bs:ks,bsd:ks,cdn:ks,rtp:ks,bg:ks,pt:ks,ec:ks,e:ks},Vb={REQUEST:se};function zb(u){return Object.keys(u).reduce((t,e)=>{var s;return(s=u[e])===null||s===void 0||s.forEach(r=>t[r]=e),t},{})}function Kb(u,t){const e={};if(!u)return e;const s=Object.keys(u),r=t?zb(t):{};return s.reduce((l,o)=>{var f;const d=Hb[o]||r[o]||Vb.REQUEST,h=(f=l[d])!==null&&f!==void 0?f:l[d]={};return h[o]=u[o],l},e)}function jb(u){return["ot","sf","st","e","sta"].includes(u)}function Yb(u){return typeof u=="number"?ct(u):u!=null&&u!==""&&u!==!1}const Hy="event";function qb(u,t){const e=new URL(u),s=new URL(t);if(e.origin!==s.origin)return u;const r=e.pathname.split("/").slice(1),l=s.pathname.split("/").slice(1,-1);for(;r[0]===l[0];)r.shift(),l.shift();for(;l.length;)l.shift(),r.unshift("..");return r.join("/")+e.search+e.hash}const no=u=>Math.round(u),Lf=(u,t)=>Array.isArray(u)?u.map(e=>Lf(e,t)):u instanceof Ni&&typeof u.value=="string"?new Ni(Lf(u.value,t),u.params):(t.baseUrl&&(u=qb(u,t.baseUrl)),t.version===1?encodeURIComponent(u):u),Kl=u=>no(u/100)*100,Xb=(u,t)=>{let e=u;return t.version>=2&&(u instanceof Ni&&typeof u.value=="string"?e=new Ni([u]):typeof u=="string"&&(e=[u])),Lf(e,t)},Qb={br:no,d:no,bl:Kl,dl:Kl,mtp:Kl,nor:Xb,rtp:Kl,tb:no},Vy="request",zy="response",Zf=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Wb=["e"],Zb=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function To(u){return Zb.test(u)}function Jb(u){return Zf.includes(u)||Wb.includes(u)||To(u)}const Ky=["d","dl","nor","ot","rtp","su"];function t1(u){return Zf.includes(u)||Ky.includes(u)||To(u)}const e1=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function i1(u){return Zf.includes(u)||Ky.includes(u)||e1.includes(u)||To(u)}const s1=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function n1(u){return s1.includes(u)||To(u)}const r1={[zy]:i1,[Hy]:Jb,[Vy]:t1};function jy(u,t={}){const e={};if(u==null||typeof u!="object")return e;const s=t.version||u.v||1,r=t.reportingMode||Vy,l=s===1?n1:r1[r];let o=Object.keys(u).filter(l);const f=t.filter;typeof f=="function"&&(o=o.filter(f));const d=r===zy||r===Hy;d&&!o.includes("ts")&&o.push("ts"),s>1&&!o.includes("v")&&o.push("v");const h=Kt({},Qb,t.formatters),g={version:s,reportingMode:r,baseUrl:t.baseUrl};return o.sort().forEach(p=>{let v=u[p];const E=h[p];if(typeof E=="function"&&(v=E(v,g)),p==="v"){if(s===1)return;v=s}p=="pr"&&v===1||(d&&p==="ts"&&!ct(v)&&(v=Date.now()),Yb(v)&&(jb(p)&&typeof v=="string"&&(v=new Uy(v)),e[p]=v))}),e}function a1(u,t={}){const e={};if(!u)return e;const s=jy(u,t),r=Kb(s,t==null?void 0:t.customHeaderMap);return Object.entries(r).reduce((l,[o,f])=>{const d=Gy(f,{whitespace:!1});return d&&(l[o]=d),l},e)}function l1(u,t,e){return Kt(u,a1(t,e))}const o1="CMCD";function u1(u,t={}){return u?Gy(jy(u,t),{whitespace:!1}):""}function c1(u,t={}){if(!u)return"";const e=u1(u,t);return encodeURIComponent(e)}function f1(u,t={}){if(!u)return"";const e=c1(u,t);return`${o1}=${e}`}const cp=/CMCD=[^&#]+/;function h1(u,t,e){const s=f1(t,e);if(!s)return u;if(cp.test(u))return u.replace(cp,s);const r=u.includes("?")?"&":"?";return`${u}${r}${s}`}class d1{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Ge.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=r=>{try{const{frag:l,part:o}=r,f=this.hls.levels[l.level],d=this.getObjectType(l),h={d:(o||l).duration*1e3,ot:d};(d===Ge.VIDEO||d===Ge.AUDIO||d==Ge.MUXED)&&(h.br=f.bitrate/1e3,h.tb=this.getTopBandwidth(d)/1e3,h.bl=this.getBufferLength(d));const g=o?this.getNextPart(o):this.getNextFrag(l);g!=null&&g.url&&g.url!==l.url&&(h.nor=g.url),this.apply(r,h)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=t;const e=this.config=t.config,{cmcd:s}=e;s!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||t.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHED,this.onMediaDetached,this),t.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHED,this.onMediaDetached,this),t.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var s,r;this.audioBuffer=(s=e.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=e.tracks.video)==null?void 0:r.buffer}createData(){var t;return{v:1,sf:Sb.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){Kt(e,this.createData());const s=e.ot===Ge.INIT||e.ot===Ge.VIDEO||e.ot===Ge.MUXED;this.starved&&s&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);const{includeKeys:r}=this;r&&(e=Object.keys(e).reduce((o,f)=>(r.includes(f)&&(o[f]=e[f]),o),{}));const l={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),l1(t.headers,e,l)):t.url=h1(t.url,e,l)}getNextFrag(t){var e;const s=(e=this.hls.levels[t.level])==null?void 0:e.details;if(s){const r=t.sn-s.startSN;return s.fragments[r+1]}}getNextPart(t){var e;const{index:s,fragment:r}=t,l=(e=this.hls.levels[r.level])==null||(e=e.details)==null?void 0:e.partList;if(l){const{sn:o}=r;for(let f=l.length-1;f>=0;f--){const d=l[f];if(d.index===s&&d.fragment.sn===o)return l[f+1]}}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return Ge.TIMED_TEXT;if(t.sn==="initSegment")return Ge.INIT;if(e==="audio")return Ge.AUDIO;if(e==="main")return this.hls.audioTracks.length?Ge.VIDEO:Ge.MUXED}getTopBandwidth(t){let e=0,s;const r=this.hls;if(t===Ge.AUDIO)s=r.audioTracks;else{const l=r.maxAutoLevel,o=l>-1?l+1:r.levels.length;s=r.levels.slice(0,o)}return s.forEach(l=>{l.bitrate>e&&(e=l.bitrate)}),e>0?e:NaN}getBufferLength(t){const e=this.media,s=t===Ge.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!e?NaN:Tt.bufferInfo(s,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,s=t||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new s(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,f){e(l),this.loader.load(l,o,f)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,s=t||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new s(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,f){e(l),this.loader.load(l,o,f)}}}}const g1=3e5;class m1 extends pi{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(t.indexOf(e.pathwayId)===-1&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=this.timeToLoad*1e3-(performance.now()-this.updated);if(t>0){this.scheduleRefresh(this.uri,t);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(s=>s!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:s}=e;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:s}=e;if((s==null?void 0:s.action)===Le.SendAlternateToPenaltyBox&&s.flags===Je.MoveAllAlternatesMatchingHost){const r=this.levels;let l=this._pathwayPriority,o=this.pathwayId;if(e.context){const{groupId:f,pathwayId:d,type:h}=e.context;f&&r?o=this.getPathwayForGroupId(f,h,o):d&&(o=d)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!l&&r&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),s.resolved=this.pathwayId!==o),e.details===V.BUFFER_APPEND_ERROR&&!e.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${qt(l)} penalized: ${qt(this.penalizedPathways)}`)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const s=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),e=this.getLevelsForPathway(s),this.pathwayId=s}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this._pathwayPriority=t;let e;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(l=>{r-s[l]>g1&&delete s[l]});for(let l=0;l<t.length;l++){const o=t[l];if(o in s)continue;if(o===this.pathwayId)return;const f=this.hls.nextLoadLevel,d=this.hls.levels[f];if(e=this.getLevelsForPathway(o),e.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,hy(e),this.hls.trigger(x.LEVELS_UPDATED,{levels:e});const h=this.hls.levels[f];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=f);break}}}getPathwayForGroupId(t,e,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let l=0;l<r.length;l++)if(e===Rt.AUDIO_TRACK&&r[l].hasAudioGroup(t)||e===Rt.SUBTITLE_TRACK&&r[l].hasSubtitleGroup(t))return r[l].pathwayId;return s}clonePathways(t){const e=this.levels;if(!e)return;const s={},r={};t.forEach(l=>{const{ID:o,"BASE-ID":f,"URI-REPLACEMENT":d}=l;if(e.some(g=>g.pathwayId===o))return;const h=this.getLevelsForPathway(f).map(g=>{const p=new Zt(g.attrs);p["PATHWAY-ID"]=o;const v=p.AUDIO&&`${p.AUDIO}_clone_${o}`,E=p.SUBTITLES&&`${p.SUBTITLES}_clone_${o}`;v&&(s[p.AUDIO]=v,p.AUDIO=v),E&&(r[p.SUBTITLES]=E,p.SUBTITLES=E);const S=Yy(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),A=new da({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:S,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let b=1;b<g.audioGroups.length;b++)A.addGroupId("audio",`${g.audioGroups[b]}_clone_${o}`);if(g.subtitleGroups)for(let b=1;b<g.subtitleGroups.length;b++)A.addGroupId("text",`${g.subtitleGroups[b]}_clone_${o}`);return A});e.push(...h),fp(this.audioTracks,s,d,o),fp(this.subtitleTracks,r,d,o)})}loadSteeringManifest(t){const e=this.hls.config,s=e.loader;this.loader&&this.loader.destroy(),this.loader=new s(e);let r;try{r=new self.URL(t)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(r.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+g)}const l={responseType:"json",url:r.href},o=e.steeringManifestLoadPolicy.default,f=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:f.maxNumRetry||0,retryDelay:f.retryDelayMs||0,maxRetryDelay:f.maxRetryDelayMs||0},h={onSuccess:(g,p,v,E)=>{this.log(`Loaded steering manifest: "${r}"`);const S=g.data;if((S==null?void 0:S.VERSION)!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":b,"PATHWAY-PRIORITY":L}=S;if(A)try{this.uri=new self.URL(A,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||v.url),b&&this.clonePathways(b);const _={steeringManifest:S,url:r.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,_),L&&this.updatePathwayPriority(L)},onError:(g,p,v,E)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let S=this.timeToLoad*1e3;if(g.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const b=A.getResponseHeader("Retry-After");b&&(S=parseFloat(b)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,S)},onTimeout:(g,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(l,d,h)}scheduleRefresh(t,e=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(t);return}this.scheduleRefresh(t,this.timeToLoad*1e3)},e)}}function fp(u,t,e,s){u&&Object.keys(t).forEach(r=>{const l=u.filter(o=>o.groupId===r).map(o=>{const f=Kt({},o);return f.details=void 0,f.attrs=new Zt(f.attrs),f.url=f.attrs.URI=Yy(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),f.groupId=f.attrs["GROUP-ID"]=t[r],f.attrs["PATHWAY-ID"]=s,f});u.push(...l)})}function Yy(u,t,e,s){const{HOST:r,PARAMS:l,[e]:o}=s;let f;t&&(f=o==null?void 0:o[t],f&&(u=f));const d=new self.URL(u);return r&&!f&&(d.host=r),l&&Object.keys(l).sort().forEach(h=>{h&&d.searchParams.set(h,l[h])}),d.href}class rr extends pi{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=rr.CDMCleanupPromise?[rr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:s,initData:r}=e,l=`"${e.type}" event: init data type: "${s}"`;if(this.debug(l),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=la(this.config));const f=o.map(zc).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(f)}this.keyFormatPromise.then(o=>{const f=eo(o);if(s!=="sinf"||f!==te.FAIRPLAY){this.log(`Ignoring "${e.type}" event with init data type: "${s}" for selected key-system ${f}`);return}let d;try{const E=he(new Uint8Array(r)),S=$f(JSON.parse(E).sinf),A=Gp(S);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(A.subarray(8,24))}catch(E){this.warn(`${l} Failed to parse sinf: ${E}`);return}const h=Re(d),{keyIdToKeySessionPromise:g,mediaKeySessions:p}=this;let v=g[h];for(let E=0;E<p.length;E++){const S=p[E],A=S.decryptdata;if(!A.keyId)continue;const b=Re(A.keyId);if(go(d,A.keyId)||A.uri.replace(/-/g,"").indexOf(h)!==-1){if(v=g[b],!v)continue;if(A.pssh)break;delete g[b],A.pssh=new Uint8Array(r),A.keyId=d,v=g[h]=v.then(()=>this.generateRequestWithPreferredKeySession(S,s,r,"encrypted-event-key-match")),v.catch(L=>this.handleError(L));break}}v||this.handleError(new Error(`Key ID ${h} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(x.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:s}=this.config,r=e==null?void 0:e[t];if(r)return r.licenseUrl;if(t===te.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(t){const e=this.getLicenseServerUrl(t);if(e===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return e}getServerCertificateUrl(t){const{drmSystems:e}=this.config,s=e==null?void 0:e[t];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,s=(o,f,d)=>!!o&&d.indexOf(o)===f,r=e.map(o=>o.audioCodec).filter(s),l=e.map(o=>o.videoCodec).filter(s);return r.length+l.length===0&&l.push("avc1.42e01e"),new Promise((o,f)=>{const d=h=>{const g=h.shift();this.getMediaKeysPromise(g,r,l).then(p=>o({keySystem:g,mediaKeys:p})).catch(p=>{h.length?d(h):p instanceof Ze?f(p):f(new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};d(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return ny===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(t,e)}getMediaKeysPromise(t,e,s){var r;const l=Xx(t,e,s,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[t],f=(r=o)==null?void 0:r.keySystemAccess;if(!f){this.log(`Requesting encrypted media "${t}" key-system access with config: ${qt(l)}`),f=this.requestMediaKeySystemAccess(t,l);const d=o=this.keySystemAccessPromises[t]={keySystemAccess:f};return f.catch(h=>{this.log(`Failed to obtain access to key-system "${t}": ${h}`)}),f.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);const g=this.fetchServerCertificate(t);this.log(`Create media-keys for "${t}"`);const p=d.mediaKeys=h.createMediaKeys().then(v=>(this.log(`Media-keys created for "${t}"`),d.hasMediaKeys=!0,g.then(E=>E?this.setMediaKeysServerCertificate(v,t,E):v)));return p.catch(v=>{this.error(`Failed to create media-keys for "${t}"}: ${v}`)}),p})}return f.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:s}){this.log(`Creating key-system session "${e}" keyId: ${Re(t.keyId||[])} keyUri: ${t.uri}`);const r=s.createSession(),l={decryptdata:t,keySystem:e,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const s=this.createMediaKeySessionContext(t),r=jl(e),l="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,l,e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}updateKeySession(t,e){const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Re(t.decryptdata.keyId||[])}
      } (data length: ${e.byteLength})`),s.update(e)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>zc(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:e,mediaKeys:s})=>this.attemptSetMediaKeys(e,s))}selectKeySystem(t){return new Promise((e,s)=>{this.getKeySystemSelectionPromise(t).then(({keySystem:r})=>{const l=zc(r);l?e(l):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){const e=la(this.config),s=t.map(eo).filter(r=>!!r&&e.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(t){const{mediaKeySessions:e}=this;for(let s=0;s<e.length;s++){const r=p1(t,e[s]);if(r)return r}}loadKey(t){const e=t.keyInfo.decryptdata,s=jl(e),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(e)==="internal-error"){const f=hp(r||"internal-error",e);return this.handleError(f,t.frag),Promise.reject(f)}const l=`(keyId: ${s} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${l}`);const o=this.keyIdToKeySessionPromise[s];if(!o){const f=this.getKeySystemForKeyPromise(e).then(({keySystem:d,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${l}`),this.attemptSetMediaKeys(d,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:h,decryptdata:e}))))).then(d=>{const h="cenc",g=e.pssh?e.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,h,g,"playlist-key")});return f.catch(d=>this.handleError(d,t.frag)),this.keyIdToKeySessionPromise[s]=f,f}return o.catch(f=>{if(f instanceof Ze){const d=$t({},f.data);this.getKeyStatus(e)==="internal-error"&&(d.decryptdata=e);const h=new Ze(d,f.message);this.handleError(h,t.frag)}}),o}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t,e){if(this.hls)if(t instanceof Ze){e&&(t.data.frag=e);const s=t.data.decryptdata;this.error(`${t.message}${s?` (${Re(s.keyId||[])})`:""}`),this.hls.trigger(x.ERROR,t.data)}else this.error(t.message),this.hls.trigger(x.ERROR,{type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})}getKeySystemForKeyPromise(t){const e=jl(t),s=this.keyIdToKeySessionPromise[e];if(!s){const r=eo(t.keyFormat),l=r?[r]:la(this.config);return this.attemptKeySystemAccess(l)}return s}getKeySystemSelectionPromise(t){if(t.length||(t=la(this.config)),t.length===0)throw new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${qt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,e){if(this.mediaResolved=void 0,this.mediaKeys===e)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const r=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(e):new Promise((l,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=e,this.media.setMediaKeys(e).then(l).catch(o)}}));return this.mediaKeys=e,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${t}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>s.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(t,e,s,r){var l;const o=(l=this.config.drmSystems)==null||(l=l[t.keySystem])==null?void 0:l.generateRequest;if(o)try{const S=o.call(this.hls,e,s,t);if(!S)throw new Error("Invalid response from configured generateRequest filter");e=S.initDataType,s=S.initData?S.initData:null,t.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(t);const f=jl(t.decryptdata),d=t.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${f} URI: ${d} (init data type: ${e} length: ${s.byteLength})`);const h=new Hf,g=t._onmessage=S=>{const A=t.mediaKeysSession;if(!A){h.emit("error",new Error("invalid state"));return}const{messageType:b,message:L}=S;this.log(`"${b}" message event for session "${A.sessionId}" message size: ${L.byteLength}`),b==="license-request"||b==="license-renewal"?this.renewLicense(t,L).catch(_=>{h.eventNames().length?h.emit("error",_):this.handleError(_)}):b==="license-release"?t.keySystem===te.FAIRPLAY&&this.updateKeySession(t,yf("acknowledged")).then(()=>this.removeSession(t)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${b}"`)},p=(S,A)=>{A.keyStatus=S;let b;S.startsWith("usable")?h.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?b=hp(S,A.decryptdata):S==="expired"?b=new Error(`key expired (keyId: ${f})`):S==="released"?b=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${f})`),b&&(h.eventNames().length?h.emit("error",b):this.handleError(b))},v=t._onkeystatuseschange=S=>{if(!t.mediaKeysSession){h.emit("error",new Error("invalid state"));return}const b=this.getKeyStatuses(t);if(!Object.keys(b).some(C=>b[C]!=="status-pending"))return;if(b[f]==="expired"){this.log(`Expired key ${qt(b)} in key-session "${t.mediaKeysSession.sessionId}"`),this.renewKeySession(t);return}let _=b[f];if(_)p(_,t);else{var D;t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(D=t.keyStatusTimeouts)[f]||(D[f]=self.setTimeout(()=>{if(!t.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(t.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${f} in key-session "${t.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),p(k,t);this.log(`key status for ${f} in key-session "${t.mediaKeysSession.sessionId}" timed out after 1000ms`),_="internal-error",p(_,t)},1e3)),this.log(`No status for keyId ${f} (${qt(b)}).`)}};ke(t.mediaKeysSession,"message",g),ke(t.mediaKeysSession,"keystatuseschange",v);const E=new Promise((S,A)=>{h.on("error",A),h.on("resolved",S)});return t.mediaKeysSession.generateRequest(e,s).then(()=>{this.log(`Request generated for key-session "${t.mediaKeysSession.sessionId}" keyId: ${f} URI: ${d}`)}).catch(S=>{throw new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:t.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>E).catch(S=>(h.removeAllListeners(),this.removeSession(t).then(()=>{throw S}))).then(()=>(h.removeAllListeners(),t))}getKeyStatuses(t){const e={};return t.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const f=r;r=s,s=f}const l="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(t.keySystem===te.PLAYREADY&&l.length===16){const f=Re(l);e[f]=s,iy(l)}const o=Re(l);s==="internal-error"&&(this.bannedKeyIds[o]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${o} key-session "${t.mediaKeysSession.sessionId}"`),e[o]=s}),e}fetchServerCertificate(t){const e=this.config,s=e.loader,r=new s(e),l=this.getServerCertificateUrl(t);return l?(this.log(`Fetching server certificate for "${t}"`),new Promise((o,f)=>{const d={responseType:"arraybuffer",url:l},h=e.certLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,E,S,A)=>{o(v.data)},onError:(v,E,S,A)=>{f(new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:$t({url:d.url,data:void 0},v)},`"${t}" certificate request failed (${l}). Status: ${v.code} (${v.text})`))},onTimeout:(v,E,S)=>{f(new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:d.url,data:void 0}},`"${t}" certificate request timed out (${l})`))},onAbort:(v,E,S)=>{f(new Error("aborted"))}};r.load(d,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,s){return new Promise((r,l)=>{t.setServerCertificate(s).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${s.byteLength}) on "${e}"`),r(t)}).catch(o=>{l(new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(s=>this.updateKeySession(t,new Uint8Array(s)).catch(r=>{throw new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(t,e){const s=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!s.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const r=new DOMParser().parseFromString(s,"application/xml"),l=r.querySelectorAll("HttpHeader");if(l.length>0){let g;for(let p=0,v=l.length;p<v;p++){var o,f;g=l[p];const E=(o=g.querySelector("name"))==null?void 0:o.textContent,S=(f=g.querySelector("value"))==null?void 0:f.textContent;E&&S&&t.setRequestHeader(E,S)}}const d=r.querySelector("Challenge"),h=d==null?void 0:d.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return yf(atob(h))}setupLicenseXHR(t,e,s,r){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return l.call(this.hls,t,e,s,r)}).catch(o=>{if(!s.decryptdata)throw o;return t.open("POST",e,!0),l.call(this.hls,t,e,s,r)}).then(o=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:o||r})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:r}))}requestLicense(t,e){const s=this.config.keyLoadPolicy.default;return new Promise((r,l)=>{const o=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${o}`);const f=new XMLHttpRequest;f.responseType="arraybuffer",f.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return l(new Error("invalid state"));if(f.readyState===4)if(f.status===200){this._requestLicenseFailureCount=0;let d=f.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const h=this.config.licenseResponseCallback;if(h)try{d=h.call(this.hls,f,o,t)}catch(g){this.error(g)}r(d)}else{const d=s.errorRetry,h=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||f.status>=400&&f.status<500)l(new Ze({type:pt.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:f,response:{url:o,data:void 0,code:f.status,text:f.statusText}},`License Request XHR failed (${o}). Status: ${f.status} (${f.statusText})`));else{const g=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(t,e).then(r,l)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=f,this.setupLicenseXHR(f,o,t,e).then(({xhr:d,licenseChallenge:h})=>{t.keySystem==te.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(d,h)),d.send(h)}).catch(l)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const s=e.media;this.media=s,ke(s,"encrypted",this.onMediaEncrypted),ke(s,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=s.mediaKeys}onMediaDetached(){const t=this.media;t&&(He(t,"encrypted",this.onMediaEncrypted),He(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const e=this.mediaResolved;if(e&&e(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ps.clearKeyUriToKeyIdMap();const l=r.length;rr.CDMCleanupPromise=Promise.all(r.map(o=>this.removeSession(o)).concat((s==null||(t=s.setMediaKeys(null))==null?void 0:t.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{l&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=e.reduce((r,l)=>(r.indexOf(l.keyFormat)===-1&&r.push(l.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:s,decryptdata:r}=t;if(e){this.log(`Remove licenses and keys and close session "${e.sessionId}" keyId: ${Re((r==null?void 0:r.keyId)||[])}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const l=this.mediaKeySessions.indexOf(t);l>-1&&this.mediaKeySessions.splice(l,1);const{keyStatusTimeouts:o}=t;o&&Object.keys(o).forEach(h=>self.clearTimeout(o[h]));const{drmSystemOptions:f}=this.config;return(Wx(f)?new Promise((h,g)=>{self.setTimeout(()=>g(new Error("MediaKeySession.remove() timeout")),8e3),e.remove().then(h).catch(g)}):Promise.resolve()).catch(h=>{this.log(`Could not remove session: ${h}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${h}`)})}).then(()=>e.close()).catch(h=>{this.log(`Could not close session: ${h}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${h}`)})})}return Promise.resolve()}}rr.CDMCleanupPromise=void 0;function jl(u){if(!u)throw new Error("Could not read keyId of undefined decryptdata");if(u.keyId===null)throw new Error("keyId is null");return Re(u.keyId)}function p1(u,t){if(u.keyId&&t.mediaKeysSession.keyStatuses.has(u.keyId))return t.mediaKeysSession.keyStatuses.get(u.keyId);if(u.matches(t.decryptdata))return t.keyStatus}class Ze extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}function hp(u,t){const e=u==="output-restricted",s=e?V.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:V.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ze({type:pt.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:t},e?"HDCP level output restricted":`key status changed to "${u}"`)}class y1{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,s){const r=performance.now();if(e){if(this.lastTime){const l=r-this.lastTime,o=s-this.lastDroppedFrames,f=e-this.lastDecodedFrames,d=1e3*o/l,h=this.hls;if(h.trigger(x.FPS_DROP,{currentDropped:o,currentDecoded:f,totalDroppedFrames:s}),d>0&&o>h.config.fpsDroppedMonitoringThreshold*f){let g=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=g)&&(g=g-1,h.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:h.currentLevel}),h.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}function qy(u,t){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=u,t.dispatchEvent(e)}function Xy(u,t){const e=u.mode;if(e==="disabled"&&(u.mode="hidden"),u.cues&&!u.cues.getCueById(t.id))try{if(u.addCue(t),!u.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(s){Gt.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,u.addCue(r)}catch(r){Gt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}e==="disabled"&&(u.mode=e)}function ir(u,t){const e=u.mode;if(e==="disabled"&&(u.mode="hidden"),u.cues)for(let s=u.cues.length;s--;)t&&u.cues[s].removeEventListener("enter",t),u.removeCue(u.cues[s]);e==="disabled"&&(u.mode=e)}function Rf(u,t,e,s){const r=u.mode;if(r==="disabled"&&(u.mode="hidden"),u.cues&&u.cues.length>0){const l=E1(u.cues,t,e);for(let o=0;o<l.length;o++)(!s||s(l[o]))&&u.removeCue(l[o])}r==="disabled"&&(u.mode=r)}function v1(u,t){if(t<=u[0].startTime)return 0;const e=u.length-1;if(t>u[e].endTime)return-1;let s=0,r=e,l;for(;s<=r;)if(l=Math.floor((r+s)/2),t<u[l].startTime)r=l-1;else if(t>u[l].startTime&&s<e)s=l+1;else return l;return u[s].startTime-t<t-u[r].startTime?s:r}function E1(u,t,e){const s=[],r=v1(u,t);if(r>-1)for(let l=r,o=u.length;l<o;l++){const f=u[l];if(f.startTime>=t&&f.endTime<=e)s.push(f);else if(f.startTime>e)return s}return s}function ro(u){const t=[];for(let e=0;e<u.length;e++){const s=u[e];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&t.push(u[e])}return t}class S1 extends Xf{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const s=ro(this.media.textTracks);for(let l=0;l<s.length;l++)if(s[l].mode==="hidden")e=s[l];else if(s[l].mode==="showing"){e=s[l];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVEL_LOADING,this.onLevelLoading,this),t.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(x.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const s=this.media;if(!s)return;const r=!!e.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;ro(s.textTracks).forEach(o=>{ir(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:s,groupId:r,details:l}=e,o=this.tracksInGroup[s];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const f=o.details;o.details=e.details,this.log(`Subtitle track ${s} "${o.name}" lang:${o.lang} group:${r} loaded [${l.startSN}-${l.endSN}]`),s===this.trackId&&this.playlistLoaded(s,e,f)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const s=e.subtitleGroups||null,r=this.groupIds;let l=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(g=>!s||s.indexOf(g.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(g=>g.default)&&(this.selectDefaultTrack=!1),o.forEach((g,p)=>{g.id=p});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const f=this.hls.config.subtitlePreference;if(!l&&f){this.selectDefaultTrack=!1;const g=ki(f,o);if(g>-1)l=o[g];else{const p=ki(f,this.tracks);l=this.tracks[p]}}let d=this.findTrackId(l);d===-1&&l&&(d=this.findTrackId(null));const h={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,h),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(t){const e=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<e.length;r++){const l=e[r];if(!(s&&!l.default||!s&&!t)&&(!t||on(l,t)))return r}if(t){for(let r=0;r<e.length;r++){const l=e[r];if(ya(t.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<e.length;r++){const l=e[r];if(ya(t.attrs,l.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let s=0;s<e.length;s++){const r=e[s];if(xf(r,t))return s}}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Rt.SUBTITLE_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(t.id===-1)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const s=this.currentTrack;if(s&&on(t,s))return s;const r=ki(t,this.tracksInGroup);if(r>-1){const l=this.tracksInGroup[r];return this.setSubtitleTrack(r),l}else{if(s)return null;{const l=ki(t,e);if(l>-1)return e[l]}}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const s=t.id,r=t.groupId,l=this.getUrlWithDirectives(t.url,e),o=t.details,f=o==null?void 0:o.age;this.log(`Loading subtitle ${s} "${t.name}" lang:${t.lang} group:${r}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""}${f&&o.live?" age "+f.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:l,id:s,groupId:r,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=ro(t.textTracks),s=this.currentTrack;let r;if(s&&(r=e.filter(l=>xf(s,l))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(e).forEach(l=>{l.mode!=="disabled"&&l!==r&&(l.mode="disabled")}),r){const l=this.subtitleDisplay?"showing":"hidden";r.mode!==l&&(r.mode=l)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(t<-1||t>=e.length||!ct(t)){this.warn(`Invalid subtitle track id: ${t}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=e[t]||null;if(this.trackId=t,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:t});return}const l=!!r.details&&!r.details.live;if(t===this.trackId&&r===s&&l)return;this.log(`Switching to subtitle-track ${t}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:f="",name:d,type:h,url:g}=r;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:o,groupId:f,name:d,type:h,url:g});const p=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(p)}}function T1(){try{return crypto.randomUUID()}catch{try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch{let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const l=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(r=="x"?l:l&3|8).toString(16)})}}}function ca(u){let t=5381,e=u.length;for(;e;)t=t*33^u.charCodeAt(--e);return(t>>>0).toString()}const ar=.025;let vo=(function(u){return u[u.Point=0]="Point",u[u.Range=1]="Range",u})({});function x1(u,t,e){return`${u.identifier}-${e+1}-${ca(t)}`}class A1{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,(t=this.assetListLoader)==null||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const s=this.playoutLimit;return t<=0||isNaN(s)?!1:s===0?!0:(((e=this.assetList[t])==null?void 0:e.startOffset)||0)>s}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return Jc(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime,s=Jc(e,t);return e-s<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=ct(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return Jc(t,e)}return t}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ar))}set appendInPlace(t){if(this.appendInPlaceStarted){this.resetOnResume=!t;return}this.appendInPlaceDisabled=!t}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?vo.Range:vo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return b1(this)}}function Jc(u,t){return u-t.start<t.duration/2&&!(Math.abs(u-(t.start+t.duration))<ar)?t.start:t.start+t.duration}function Qy(u,t,e){const s=new self.URL(u,e);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",t),s}function tf(u,t){for(;(e=u.assetList[++t])!=null&&e.error;)var e;return t}function b1(u){return`["${u.identifier}" ${u.cue.pre?"<pre>":u.cue.post?"<post>":""}${u.timelineStart.toFixed(2)}-${u.resumeTime.toFixed(2)}]`}function er(u){const t=u.timelineStart,e=u.duration||0;return`["${u.identifier}" ${t.toFixed(2)}-${(t+e).toFixed(2)}]`}class L1{constructor(t,e,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new t(e);this.interstitial=s,this.assetItem=r;const o=()=>{this.hasDetails=!0};l.once(x.LEVEL_LOADED,o),l.once(x.AUDIO_TRACK_LOADED,o),l.once(x.SUBTITLE_TRACK_LOADED,o),l.on(x.MEDIA_ATTACHING,(f,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&l.on(x.BUFFER_APPENDED,()=>{const g=this.bufferedEnd;this.reachedPlayout(g)&&(this._bufferedEosTime=g,l.trigger(x.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const t=this.hls;if(t)if(t.url)t.levels.length&&!t.started&&t.startLoad(-1,!0);else{let e=this.assetItem.uri;try{e=Qy(e,t.config.primarySessionId||"").href}catch{}t.loadSource(e)}}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!t)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,l=Tt.bufferInfo(t,r,0);return this.getAssetTime(l.end)>=s-.02}reachedPlayout(t){const s=this.interstitial.playoutLimit;return this.startOffset+t>=s}get destroyed(){var t;return!((t=this.hls)!=null&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return((t=this.hls)==null?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=Tt.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;if(!t)return 0;const e=this.interstitial.playoutLimit;if(e){const s=e-this.startOffset;if(s>0&&s<t)return s}return t}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return((t=this.hls)==null?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e){const s=t-e;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}}getAssetTime(t){const e=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,t-e),s)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var t;(t=this.hls)!=null&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){var e;this.loadSource(),(e=this.hls)==null||e.attachMedia(t)}detachMedia(){var t;this.removeMediaListeners(),this.mediaAttached=null,(t=this.hls)==null||t.detachMedia()}resumeBuffering(){var t;(t=this.hls)==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.hls)==null||t.pauseBuffering()}transferMedia(){var t;return this.bufferSnapShot(),((t=this.hls)==null?void 0:t.transferMedia())||null}resetDetails(){const t=this.hls;if(t&&this.hasDetails){t.stopLoad();const e=s=>delete s.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,s){var r;(r=this.hls)==null||r.on(t,e)}once(t,e,s){var r;(r=this.hls)==null||r.once(t,e)}off(t,e,s){var r;(r=this.hls)==null||r.off(t,e)}toString(){var t;return`HlsAssetPlayer: ${er(this.assetItem)} ${(t=this.hls)==null?void 0:t.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const dp=.033;class R1 extends pi{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((s,r)=>t<=r.startOffset&&e>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let s=-1;t.nextEvent?s=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(s=this.findEventIndex(t.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(e===void 0&&(e=t.start),s=this.findItemIndexAtTime(e));s>=0&&(l=r[s])!=null&&l.event;){var l;s--}return s}findItemIndexAtTime(t,e){const s=this.items;if(s)for(let r=0;r<s.length;r++){let l=s[r];if(e&&e!=="primary"&&(l=l[e]),t===l.start||t>l.start&&t<l.end)return r}return-1}findJumpRestrictedIndex(t,e){const s=this.items;if(s)for(let r=t;r<=e&&s[r];r++){const l=s[r].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return r}return-1}findEventIndex(t){const e=this.items;if(e)for(let r=e.length;r--;){var s;if(((s=e[r].event)==null?void 0:s.identifier)===t)return r}return-1}findAssetIndex(t,e){const s=t.assetList,r=s.length;if(r>1)for(let l=0;l<r;l++){const o=s[l];if(!o.error){const f=o.timelineStart;if(e===f||e>f&&(e<f+(o.duration||0)||l===r-1))return l}}return 0}get assetIdAtEnd(){var t;const e=(t=this.items)==null||(t=t[this.length-1])==null?void 0:t.event;if(e){const s=e.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(t,e){const s=t.main.details,{dateRanges:r}=s,l=this.events,o=this.parseDateRanges(r,{url:s.url},e),f=Object.keys(r),d=l?l.filter(h=>!f.includes(h.identifier)):[];o.length&&o.sort((h,g)=>{const p=h.cue.pre,v=h.cue.post,E=g.cue.pre,S=g.cue.post;if(p&&!E)return-1;if(E&&!p||v&&!S)return 1;if(S&&!v)return-1;if(!p&&!E&&!v&&!S){const A=h.startTime,b=g.startTime;if(A!==b)return A-b}return h.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=o,d.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(t,d)}updateSchedule(t,e=[],s=!1){const r=this.events||[];if(r.length||e.length||this.length<2){const l=this.items,o=this.parseSchedule(r,t);(s||e.length||(l==null?void 0:l.length)!==o.length||o.some((d,h)=>Math.abs(d.playout.start-l[h].playout.start)>.005||Math.abs(d.playout.end-l[h].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(e,l))}}parseDateRanges(t,e,s){const r=[],l=Object.keys(t);for(let o=0;o<l.length;o++){const f=l[o],d=t[f];if(d.isInterstitial){let h=this.eventMap[f];h?h.setDateRange(d):(h=new A1(d,e),this.eventMap[f]=h,s===!1&&(h.appendInPlace=s)),r.push(h)}}return r}parseSchedule(t,e){const s=[],r=e.main.details,l=r.live?1/0:r.edge;let o=0;if(t=t.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),t.length){this.resolveOffsets(t,e);let d=0,h=0;if(t.forEach((g,p)=>{const v=g.cue.pre,E=g.cue.post,S=t[p-1]||null,A=g.appendInPlace,b=E?l:g.startOffset,L=g.duration,_=g.timelineOccupancy===vo.Range?L:0,D=g.resumptionOffset,C=(S==null?void 0:S.startTime)===b,k=b+g.cumulativeDuration;let K=A?k+L:b+D;if(v||!E&&b<=0){const F=h;h+=_,g.timelineStart=k;const $=o;o+=L,s.push({event:g,start:k,end:K,playout:{start:$,end:o},integrated:{start:F,end:h}})}else if(b<=l){if(!C){const U=b-d;if(U>dp){const Q=d,st=h;h+=U;const ut=o;o+=U;const ht={previousEvent:t[p-1]||null,nextEvent:g,start:Q,end:Q+U,playout:{start:ut,end:o},integrated:{start:st,end:h}};s.push(ht)}else U>0&&S&&(S.cumulativeDuration+=U,s[s.length-1].end=b)}E&&(K=k),g.timelineStart=k;const F=h;h+=_;const $=o;o+=L,s.push({event:g,start:k,end:K,playout:{start:$,end:o},integrated:{start:F,end:h}})}else return;const O=g.resumeTime;E||O>l?d=l:d=O}),d<l){var f;const g=d,p=h,v=l-d;h+=v;const E=o;o+=v,s.push({previousEvent:((f=s[s.length-1])==null?void 0:f.event)||null,nextEvent:null,start:d,end:g+v,playout:{start:E,end:o},integrated:{start:p,end:h}})}this.setDurations(l,o,h)}else s.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return s}setDurations(t,e,s){this.durations={primary:t,playout:e,integrated:s}}resolveOffsets(t,e){const s=e.main.details,r=s.live?1/0:s.edge;let l=0,o=-1;t.forEach((f,d)=>{const h=f.cue.pre,g=f.cue.post,p=h?0:g?r:f.startTime;this.updateAssetDurations(f),o===p?f.cumulativeDuration=l:(l=0,o=p),!g&&f.snapOptions.in&&(f.resumeAnchor=un(null,s.fragments,f.startOffset+f.resumptionOffset,0,0)||void 0),f.appendInPlace&&!f.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(f,e)||(f.appendInPlace=!1)),!f.appendInPlace&&d+1<t.length&&t[d+1].startTime-t[d].resumeTime<dp&&(t[d+1].appendInPlace=!1,t[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${f}`));const E=ct(f.resumeOffset)?f.resumeOffset:f.duration;l+=E})}primaryCanResumeInPlaceAt(t,e){const s=t.resumeTime,r=t.startTime+t.resumptionOffset;return Math.abs(s-r)>ar?(this.log(`"${t.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(e).some(o=>{const f=e[o].details,d=f.edge;if(s>=d)return this.log(`"${t.identifier}" resumption ${s} past ${o} playlist end ${d}`),!1;const h=un(null,f.fragments,s);if(!h)return this.log(`"${t.identifier}" resumption ${s} does not align with any fragments in ${o} playlist (${f.fragStart}-${f.fragmentEnd})`),!0;const g=o==="audio"?.175:0;return Math.abs(h.start-s)<ar+g||Math.abs(h.end-s)<ar+g?!1:(this.log(`"${t.identifier}" resumption ${s} not aligned with ${o} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)})}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let s=0,r=!1,l=!1;for(let o=0;o<t.assetList.length;o++){const f=t.assetList[o],d=e+s;f.startOffset=s,f.timelineStart=d,r||(r=f.duration===null),l||(l=!!f.error);const h=f.error?0:f.duration||0;s+=h}r&&!l?t.duration=Math.max(s,t.duration):t.duration=s}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function xi(u){return`[${u.event?'"'+u.event.identifier+'"':"primary"}: ${u.start.toFixed(2)}-${u.end.toFixed(2)}]`}class _1{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const s=t.assetListUrl;let r;try{r=Qy(s,this.hls.sessionId,t.baseUrl)}catch(v){const E=this.assignAssetListError(t,V.ASSET_LIST_LOAD_ERROR,v,s);this.hls.trigger(x.ERROR,E);return}e&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+e);const l=this.hls.config,o=l.loader,f=new o(l),d={responseType:"json",url:r.href},h=l.interstitialAssetListLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,E,S,A)=>{const b=v.data,L=b==null?void 0:b.ASSETS;if(!Array.isArray(L)){const _=this.assignAssetListError(t,V.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,E,A);this.hls.trigger(x.ERROR,_);return}t.assetListResponse=b,this.hls.trigger(x.ASSET_LIST_LOADED,{event:t,assetListResponse:b,networkDetails:A})},onError:(v,E,S,A)=>{const b=this.assignAssetListError(t,V.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${E.url})`),E.url,A,S);this.hls.trigger(x.ERROR,b)},onTimeout:(v,E,S)=>{const A=this.assignAssetListError(t,V.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${E.url})`),E.url,v,S);this.hls.trigger(x.ERROR,A)}};return f.load(d,g,p),this.hls.trigger(x.ASSET_LIST_LOADING,{event:t}),f}assignAssetListError(t,e,s,r,l,o){return t.error=s,{type:pt.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:r,error:s,networkDetails:o,stats:l}}}function gp(u){var t;u==null||(t=u.play())==null||t.catch(()=>{})}function Yl(u,t){return`[${u}] Advancing timeline position to ${t}`}class D1 extends pi{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const f=this.playingItem;if(!f){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&s<f.start||s>=f.end){var d;const E=this.findItemIndex(f);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=E+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${s} (resolving from ${E} to ${S})`)),!this.isInterstitial(f)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!o&&S>E){const A=this.schedule.findJumpRestrictedIndex(E+1,S);if(A>E){this.setSchedulePosition(A);return}}this.setSchedulePosition(S);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(f)){const E=f.event.assetList[0];E&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,E))}return}const g=h.timelineStart,p=h.duration||0;if(o&&s<g||s>=g+p){var v;(v=f.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(f.event,f),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,h)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const f=this.findItemIndex(r);this.setSchedulePosition(f+1)}const l=this.playingAsset;if(!l)return;const o=l.timelineStart+(l.duration||0);s>=o&&this.setScheduleToAssetAtTime(s,l)},this.onScheduleUpdate=(s,r)=>{const l=this.schedule;if(!l)return;const o=this.playingItem,f=l.events||[],d=l.items||[],h=l.durations,g=s.map(A=>A.identifier),p=!!(f.length||g.length);(p||r)&&this.log(`INTERSTITIALS_UPDATED (${f.length}): ${f}
Schedule: ${d.map(A=>xi(A))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`);let v=null,E=null;o&&(v=this.updateItem(o,this.timelinePos),this.itemsMatch(o,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(E=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,E)?this.bufferingItem=E:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(A=>{A.assetList.forEach(b=>{this.clearAssetPlayer(b.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const b=A.assetItem.timelineStart,L=A.timelineOffset-b;if(L)try{A.timelineOffset=b}catch(_){Math.abs(L)>ar&&this.warn(`${_} ("${A.assetId}" ${A.timelineOffset}->${b})`)}}}),p||r){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:f.slice(0),schedule:d.slice(0),durations:h,removedIds:g}),this.isInterstitial(o)&&g.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(v,o),S&&E!==v&&this.trimInPlace(E,S),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new _1(t),this.schedule=new R1(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t&&(t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(x.BUFFER_APPENDED,this.onBufferAppended,this),t.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(x.MEDIA_ENDED,this.onMediaEnded,this),t.on(x.ERROR,this.onError,this),t.on(x.DESTROYING,this.onDestroying,this))}unregisterListeners(){const t=this.hls;t&&(t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(x.BUFFER_CODECS,this.onBufferCodecs,this),t.off(x.BUFFER_APPENDED,this.onBufferAppended,this),t.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(x.MEDIA_ENDED,this.onMediaEnded,this),t.off(x.ERROR,this.onError,this),t.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;(t=this.getBufferingPlayer())==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.getBufferingPlayer())==null||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){He(t,"play",this.onPlay),He(t,"pause",this.onPause),He(t,"seeking",this.onSeeking),He(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const s=this.media=e.media;ke(s,"seeking",this.onSeeking),ke(s,"timeupdate",this.onTimeupdate),ke(s,"play",this.onPlay),ke(s,"pause",this.onPause)}onMediaAttached(t,e){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const l=this.findItemIndex(s);this.setSchedulePosition(l)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const s=!!e.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.log(`Removing schedule state for detachedData and ${l}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const t=this,e=()=>t.bufferingItem||t.waitingItem,s=p=>p&&t.getAssetPlayer(p.identifier),r=(p,v,E,S,A)=>{if(p){let b=p[v].start;const L=p.event;if(L){if(v==="playout"||L.timelineOccupancy!==vo.Point){const _=s(E);(_==null?void 0:_.interstitial)===L&&(b+=_.assetItem.startOffset+_[A])}}else{const _=S==="bufferedPos"?o():t[S];b+=_-p.start}return b}return 0},l=(p,v)=>{var E;if(p!==0&&v!=="primary"&&(E=t.schedule)!=null&&E.length){var S;const A=t.schedule.findItemIndexAtTime(p),b=(S=t.schedule.items)==null?void 0:S[A];if(b){const L=b[v].start-b.start;return p+L}}return p},o=()=>{const p=t.bufferedPos;return p===Number.MAX_VALUE?f("primary"):Math.max(p,0)},f=p=>{var v,E;return(v=t.primaryDetails)!=null&&v.live?t.primaryDetails.edge:((E=t.schedule)==null?void 0:E.durations[p])||0},d=(p,v)=>{var E,S;const A=t.effectivePlayingItem;if(A!=null&&(E=A.event)!=null&&E.restrictions.skip||!t.schedule)return;t.log(`seek to ${p} "${v}"`);const b=t.effectivePlayingItem,L=t.schedule.findItemIndexAtTime(p,v),_=(S=t.schedule.items)==null?void 0:S[L],D=t.getBufferingPlayer(),C=D==null?void 0:D.interstitial,k=C==null?void 0:C.appendInPlace,K=b&&t.itemsMatch(b,_);if(b&&(k||K)){const O=s(t.playingAsset),F=(O==null?void 0:O.media)||t.primaryMedia;if(F){const $=v==="primary"?F.currentTime:r(b,v,t.playingAsset,"timelinePos","currentTime"),U=p-$,Q=(k?$:F.currentTime)+U;if(Q>=0&&(!O||k||Q<=O.duration)){F.currentTime=Q;return}}}if(_){let O=p;if(v!=="primary"){const $=_[v].start,U=p-$;O=_.start+U}const F=!t.isInterstitial(_);if((!t.isInterstitial(b)||b.event.appendInPlace)&&(F||_.event.appendInPlace)){const $=t.media||(k?D==null?void 0:D.media:null);$&&($.currentTime=O)}else if(b){const $=t.findItemIndex(b);if(L>$){const Q=t.schedule.findJumpRestrictedIndex($+1,L);if(Q>$){t.setSchedulePosition(Q);return}}let U=0;if(F)t.timelinePos=O,t.checkBuffer();else{const Q=_.event.assetList,st=p-(_[v]||_).start;for(let ut=Q.length;ut--;){const ht=Q[ut];if(ht.duration&&st>=ht.startOffset&&st<ht.startOffset+ht.duration){U=ut;break}}}t.setSchedulePosition(L,U)}}},h=()=>{const p=t.effectivePlayingItem;if(t.isInterstitial(p))return p;const v=e();return t.isInterstitial(v)?v:null},g={get bufferedEnd(){const p=e(),v=t.bufferingItem;if(v&&v===p){var E;return r(v,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((E=t.bufferingAsset)==null?void 0:E.startOffset)||0}return 0},get currentTime(){const p=h(),v=t.effectivePlayingItem;return v&&v===p?r(v,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=h(),E=t.effectivePlayingItem;E&&E===v&&d(p+E.playout.start,"playout")},get duration(){const p=h();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=h())==null?void 0:p.event.assetList;return v?v.map(E=>t.getAssetPlayer(E.identifier)):[]},get playingIndex(){var p;const v=(p=h())==null?void 0:p.event;return v&&t.effectivePlayingAsset?v.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return h()}};return this.manager={get events(){var p;return((p=t.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=t.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return h()?g:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const p=e();return t.findItemIndex(p)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){const p=t.effectivePlayingItem;return t.findItemIndex(p)},primary:{get bufferedEnd(){return o()},get currentTime(){const p=t.timelinePos;return p>0?p:0},set currentTime(p){d(p,"primary")},get duration(){return f("primary")},get seekableStart(){var p;return((p=t.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){d(p,"integrated")},get duration(){return f("integrated")},get seekableStart(){var p;return l(((p=t.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=t.effectivePlayingItem,v=p==null?void 0:p.event;if(v&&!v.restrictions.skip){const E=t.findItemIndex(p);if(v.appendInPlace){const S=p.playout.start+p.event.duration;d(S+.001,"playout")}else t.advanceAfterAssetEnded(v,E,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,s=(t=this.schedule)==null?void 0:t.items;return!this.playbackStarted||!e||!s?!1:this.findItemIndex(e)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var t,e;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(t=this.bufferingItem)!=null&&(t=t.event)!=null&&t.appendInPlace&&(r=this.primaryMedia);const l=(e=r)==null?void 0:e.currentTime;if(!(l===void 0||!ct(l)))return l}get primaryMedia(){var t;return this.media||((t=this.detachedData)==null?void 0:t.media)||null}isInterstitial(t){return!!(t!=null&&t.event)}retreiveMediaSource(t,e){const s=this.getAssetPlayer(t);s&&this.transferMediaFromPlayer(s,e)}transferMediaFromPlayer(t,e){const s=t.interstitial.appendInPlace,r=t.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&r){this.detachedData={media:r};return}const l=t.transferMedia();this.log(`transfer MediaSource from ${t} ${qt(l)}`),this.detachedData=l}else e&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(t,e){var s,r;if(t.media===e)return;let l=null;const o=this.hls,f=t!==o,d=f&&t.interstitial.appendInPlace,h=(s=this.detachedData)==null?void 0:s.mediaSource;let g;if(o.media)d&&(l=o.transferMedia(),this.detachedData=l),g="Primary";else if(h){const S=this.getBufferingPlayer();S?(l=S.transferMedia(),g=`${S}`):g="detached MediaSource"}else g="detached media";if(!l){if(h)l=this.detachedData,this.log(`using detachedData: MediaSource ${qt(l)}`);else if(!this.detachedData||o.media===e){const S=this.playerQueue;S.length>1&&S.forEach(A=>{if(f&&A.interstitial.appendInPlace!==d){const b=A.interstitial;this.clearInterstitial(A.interstitial,null),b.appendInPlace=!1,b.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${b}`)}}),this.hls.detachMedia(),this.detachedData={media:e}}}const p=l&&"mediaSource"in l&&((r=l.mediaSource)==null?void 0:r.readyState)!=="closed",v=p&&l?l:e;this.log(`${p?"transfering MediaSource":"attaching media"} to ${f?t:"Primary"} from ${g} (media.currentTime: ${e.currentTime})`);const E=this.schedule;if(v===l&&E){const S=f&&t.assetId===E.assetIdAtEnd;v.overrides={duration:E.duration,endOfStream:!f||S,cueRemoval:!f}}t.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=t==null?void 0:t.events;if(!e||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const l=this.hls.startPosition;if(this.log(Yl("checkStart",l)),this.timelinePos=l,e.length&&e[0].cue.pre){const o=t.findEventIndex(e[0].identifier);this.setSchedulePosition(o)}else if(l>=0||!this.primaryLive){const o=this.timelinePos=l>0?l:0,f=t.findItemIndexAtTime(o);this.setSchedulePosition(f)}}else if(r&&!this.playingItem){const l=t.findItemIndex(r);this.setSchedulePosition(l)}}advanceAssetBuffering(t,e){const s=t.event,r=s.findAssetIndex(e),l=tf(s,r);if(!s.isAssetPastPlayoutLimit(l))this.bufferedToEvent(t,l);else if(this.schedule){var o;const f=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(t)+1];f&&this.bufferedToItem(f)}}advanceAfterAssetEnded(t,e,s){const r=tf(t,s);if(t.isAssetPastPlayoutLimit(r)){if(this.schedule){const l=this.schedule.items;if(l){const o=e+1,f=l.length;if(o>=f){this.setSchedulePosition(-1);return}const d=t.resumeTime;this.timelinePos<d&&(this.log(Yl("advanceAfterAssetEnded",d)),this.timelinePos=d,t.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(o)}}}else{if(t.appendInPlace){const l=t.assetList[r];l&&this.advanceInPlace(l.timelineStart)}this.setSchedulePosition(e,r)}}setScheduleToAssetAtTime(t,e){const s=this.schedule;if(!s)return;const r=e.parentIdentifier,l=s.getEvent(r);if(l){const o=s.findEventIndex(r),f=s.findAssetIndex(l,t);this.advanceAfterAssetEnded(l,o,f-1)}}setSchedulePosition(t,e){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const l=t>=0?r[t]:null;this.log(`setSchedulePosition ${t}, ${e} (${l&&xi(l)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,f=this.playingLastItem;if(this.isInterstitial(o)){const g=o.event,p=this.playingAsset,v=p==null?void 0:p.identifier,E=v?this.getAssetPlayer(v):null;if(E&&v&&(!this.eventItemsMatch(o,l)||e!==void 0&&v!==g.assetList[e].identifier)){var d;const S=g.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${g.assetList.length} ${er(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:S,event:g,schedule:r.slice(0),scheduleIndex:t,player:E}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(g,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(v,l),E.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&E.detachMedia()}if(!this.eventItemsMatch(o,l)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${g} ${xi(o)}`),g.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:g,schedule:r.slice(0),scheduleIndex:t}),g.cue.once)){var h;this.updateSchedule();const S=(h=this.schedule)==null?void 0:h.items;if(l&&S){const A=this.findItemIndex(l);this.advanceSchedule(A,S,e,o,f)}return}}this.advanceSchedule(t,r,e,o,f)}advanceSchedule(t,e,s,r,l){const o=this.schedule;if(!o)return;const f=e[t]||null,d=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(g=>{const p=g.interstitial,v=o.findEventIndex(p.identifier);(v<t||v>t+1)&&this.clearInterstitial(p,f)}),this.isInterstitial(f)){this.timelinePos=Math.min(Math.max(this.timelinePos,f.start),f.end);const g=f.event;if(s===void 0){s=o.findAssetIndex(g,this.timelinePos);const S=tf(g,s-1);if(g.isAssetPastPlayoutLimit(S)||g.appendInPlace&&this.timelinePos===f.end){this.advanceAfterAssetEnded(g,t,s);return}s=S}const p=this.waitingItem;this.assetsBuffered(f,d)||this.setBufferingItem(f);let v=this.preloadAssets(g,s);if(this.eventItemsMatch(f,p||r)||(this.waitingItem=f,this.log(`INTERSTITIAL_STARTED ${xi(f)} ${g.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:g,schedule:e.slice(0),scheduleIndex:t})),!g.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${g}`);return}if(g.assetListLoader&&(g.assetListLoader.destroy(),g.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${g}`);return}this.waitingItem=this.endedItem=null,this.playingItem=f;const E=g.assetList[s];if(!E){this.advanceAfterAssetEnded(g,t,s||0);return}if(v||(v=this.getAssetPlayer(E.identifier)),v===null||v.destroyed){const S=g.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${g}`),v=this.createAssetPlayer(g,E,s),v.loadSource()}if(!this.eventItemsMatch(f,this.bufferingItem)&&g.appendInPlace&&this.isAssetBuffered(E))return;this.startAssetPlayer(v,s,e,t,d),this.shouldPlay&&gp(v.media)}else f?(this.resumePrimary(f,t,r),this.shouldPlay&&gp(this.hls.media)):l&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var t;return(t=this.mediaSelection)==null?void 0:t.main.details}get primaryLive(){var t;return!!((t=this.primaryDetails)!=null&&t.live)}resumePrimary(t,e,s){var r,l;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log(`resuming ${xi(t)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let f=this.timelinePos;(f<t.start||f>=t.end)&&(f=this.getPrimaryResumption(t,e),this.log(Yl("resumePrimary",f)),this.timelinePos=f),this.attachPrimary(f,t)}if(!s)return;const o=(l=this.schedule)==null?void 0:l.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${xi(t)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const s=t.start;if(this.primaryLive){const r=this.primaryDetails;if(e===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);return e!=null&&e.hls?e.hls.bufferedToEnd:Tt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,s){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,r),s&&this.startLoadingPrimaryAt(t,s)),s||(this.log(Yl("attachPrimary",t)),this.timelinePos=t,this.startLoadingPrimaryAt(t,s))}startLoadingPrimaryAt(t,e){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-t)>.5?r.startLoad(t,e):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var t;this.stopLoad(),(t=this.schedule)==null||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(e.level===-1||!this.schedule)return;const s=this.hls.levels[e.level];if(!s.details)return;const r=$t($t({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const s=this.hls.audioTracks[e.id],r=this.mediaSelection;if(!r){this.altSelection=$t($t({},this.altSelection),{},{audio:s});return}const l=$t($t({},r),{},{audio:s});this.mediaSelection=l}onSubtitleTrackUpdated(t,e){const s=this.hls.subtitleTracks[e.id],r=this.mediaSelection;if(!r){this.altSelection=$t($t({},this.altSelection),{},{subtitles:s});return}const l=$t($t({},r),{},{subtitles:s});this.mediaSelection=l}onAudioTrackSwitching(t,e){const s=Am(e);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(e)||r.setAudioOption(s)))}onSubtitleTrackSwitch(t,e){const s=Am(e);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(e)||e.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(t,e){const s=e.tracks;s&&(this.requiredTracks=s)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(t){if(!this.schedule)return;const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let r=0;r<e.length;r++){const l=e[r];if(l.cue.post){var s;const o=this.schedule.findEventIndex(l.identifier),f=(s=this.schedule.items)==null?void 0:s[o];this.isInterstitial(f)&&this.eventItemsMatch(f,this.bufferingItem)&&this.bufferedToItem(f,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const s=this.findItemIndex(e);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(t,e){var s;const r=(s=this.schedule)==null?void 0:s.items;if(t&&r){const l=this.findItemIndex(t,e);return r[l]||null}return null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((l,o)=>{t.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(l.identifier,null)});const s=t.end+.25,r=Tt.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${xi(t)} (was ${xi(e)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var s;return!!e&&(t===e||t.event.identifier===((s=e.event)==null?void 0:s.identifier))}findItemIndex(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1}updateSchedule(t=!1){var e;const s=this.mediaSelection;s&&((e=this.schedule)==null||e.updateSchedule(s,[],t))}checkBuffer(t){var e;const s=(e=this.schedule)==null?void 0:e.items;if(!s)return;const r=Tt.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=r.len<1),this.updateBufferedPos(r.end,s,t)}updateBufferedPos(t,e,s){const r=this.schedule,l=this.bufferingItem;if(this.bufferedPos>t||!r)return;if(e.length===1&&this.itemsMatch(e[0],l)){this.bufferedPos=t;return}const o=this.playingItem,f=this.findItemIndex(o);let d=r.findItemIndexAtTime(t);if(this.bufferedPos<t){var h;const g=this.findItemIndex(l),p=Math.min(g+1,e.length-1),v=e[p];if((d===-1&&l&&t>=l.end||(h=v.event)!=null&&h.appendInPlace&&t+.01>=v.start)&&(d=p),this.isInterstitial(l)){const E=l.event;if(p-f>1&&E.appendInPlace===!1||E.assetList.length===0&&E.assetListLoader)return}if(this.bufferedPos=t,d>g&&d>f)this.bufferedToItem(v);else{const E=this.primaryDetails;this.primaryLive&&E&&t>E.edge-E.targetduration&&v.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else s&&o&&!this.itemsMatch(o,l)&&(d===f?this.bufferedToItem(o):d===f+1&&this.bufferedToItem(e[d]))}assetsBuffered(t,e){return t.event.assetList.length===0?!1:!t.event.assetList.some(r=>{const l=this.getAssetPlayer(r.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(t,e)&&s){const{items:r,events:l}=s;if(!r||!l)return e;const o=this.isInterstitial(t),f=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const d=f?f.remaining:e?e.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${xi(t)}`+(e?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const h=s.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((g,p)=>{const v=this.getAssetPlayer(g.identifier);v&&(p===h&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering());this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return e}bufferedToItem(t,e=0){const s=this.setBufferingItem(t);if(!this.playbackDisabled){if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t):this.preloadPrimary(t)}}}preloadPrimary(t){const e=this.findItemIndex(t),s=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(s)}bufferedToEvent(t,e){const s=t.event,r=s.assetList.length===0&&!s.assetListLoader,l=s.cue.once;if(r||!l){const o=this.preloadAssets(s,e);if(o!=null&&o.interstitial.appendInPlace){const f=this.primaryMedia;f&&this.bufferAssetPlayer(o,f)}}}preloadAssets(t,e){const s=t.assetUrl,r=t.assetList.length,l=r===0&&!t.assetListLoader,o=t.cue.once;if(l){const d=t.timelineStart;if(t.appendInPlace){var f;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(f=v.nextEvent)==null?void 0:f.identifier)===t.identifier&&this.flushFrontBuffer(d+.25)}let h,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(t.cue.pre||t.cue.post)){const v=g-d;v>0&&(h=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${e+1}/${s?1:r} ${t}${h?` live-start: ${g} start-offset: ${h}`:""}`),s)return this.createAsset(t,0,0,d,t.duration,s);const p=this.assetListLoader.loadAssetList(t,h);p&&(t.assetListLoader=p)}else if(!o&&r){for(let h=e;h<r;h++){const g=t.assetList[h],p=this.getAssetPlayerQueueIndex(g.identifier);(p===-1||this.playerQueue[p].destroyed)&&!g.error&&this.createAssetPlayer(t,g,h)}const d=t.assetList[e];if(d){const h=this.getAssetPlayer(d.identifier);return h&&h.loadSource(),h}}return null}flushFrontBuffer(t){const e=this.requiredTracks;if(!e)return;this.log(`Removing front buffer starting at ${t}`),Object.keys(e).forEach(r=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let s=0;s<e.length;s++)if(t===e[s].assetId)return s;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e){for(let s=0;s<t.length;s++)if(t[s].media===e)return t[s]}return null}createAsset(t,e,s,r,l,o){const f={parentIdentifier:t.identifier,identifier:x1(t,o,e),duration:l,startOffset:s,timelineStart:r,uri:o};return this.createAssetPlayer(t,f,e)}createAssetPlayer(t,e,s){const r=this.hls,l=r.userConfig;let o=l.videoPreference;const f=r.loadLevelObj||r.levels[r.currentLevel];(o||f)&&(o=Kt({},o),f.videoCodec&&(o.videoCodec=f.videoCodec),f.videoRange&&(o.allowedVideoRanges=[f.videoRange]));const d=r.audioTracks[r.audioTrack],h=r.subtitleTracks[r.subtitleTrack];let g=0;if(this.primaryLive||t.appendInPlace){const C=this.timelinePos-e.timelineStart;if(C>1){const k=e.duration;k&&C<k&&(g=C)}}const p=e.identifier,v=$t($t({},l),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:d||l.audioPreference,subtitlePreference:h||l.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(v.timelineOffset=e.timelineStart));const E=v.cmcd;E!=null&&E.sessionId&&E.contentId&&(v.cmcd=Kt({},E,{contentId:ca(e.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${t} and asset ${p}`);const S=new L1(this.HlsPlayerClass,v,t,e);this.playerQueue.push(S),t.assetList[s]=e;let A=!0;const b=C=>{if(C.live){var k;const F=new Error(`Interstitials MUST be VOD assets ${t}`),$={fatal:!0,type:pt.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:F},U=((k=this.schedule)==null?void 0:k.findEventIndex(t.identifier))||-1;this.handleAssetItemError($,t,U,s,F.message);return}const K=C.edge-C.fragmentStart,O=e.duration;(A||O===null||K>O)&&(A=!1,this.log(`Interstitial asset "${p}" duration change ${O} > ${K}`),e.duration=K,this.updateSchedule())};S.on(x.LEVEL_UPDATED,(C,{details:k})=>b(k)),S.on(x.LEVEL_PTS_UPDATED,(C,{details:k})=>b(k)),S.on(x.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const L=(C,k)=>{const K=this.getAssetPlayer(p);if(K&&k.tracks){K.off(x.BUFFER_CODECS,L),K.tracks=k.tracks;const O=this.primaryMedia;this.bufferingAsset===K.assetItem&&O&&!K.media&&this.bufferAssetPlayer(K,O)}};S.on(x.BUFFER_CODECS,L);const _=()=>{var C;const k=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const K=this.schedule.findEventIndex(t.identifier),O=(C=this.schedule.items)==null?void 0:C[K];this.isInterstitial(O)&&this.advanceAssetBuffering(O,e)};S.on(x.BUFFERED_TO_END,_);const D=C=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const K=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,K,C)};return S.once(x.MEDIA_ENDED,D(s)),S.once(x.PLAYOUT_LIMIT_REACHED,D(1/0)),S.on(x.ERROR,(C,k)=>{if(!this.schedule)return;const K=this.getAssetPlayer(p);if(k.details===V.BUFFER_STALLED_ERROR){if(K!=null&&K.appendInPlace){this.handleInPlaceStall(t);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,t,this.schedule.findEventIndex(t.identifier),s,`Asset player error ${k.error} ${t}`)}),S.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${p}`),K={fatal:!0,type:pt.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(K,t,this.schedule.findEventIndex(t.identifier),s,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${er(e)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:s,event:t,player:S}),S}clearInterstitial(t,e){this.clearAssetPlayers(t,e),t.reset()}clearAssetPlayers(t,e){t.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,e)})}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(e!==-1){this.log(`reset asset player "${t}" after error`);const s=this.playerQueue[e];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(t,e){const s=this.getAssetPlayerQueueIndex(t);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${e&&xi(e)}`),this.transferMediaFromPlayer(r,e),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,s,r,l){const{interstitial:o,assetItem:f,assetId:d}=t,h=o.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=f,(!g||g.identifier!==d)&&(g&&(this.clearAssetPlayer(g.identifier,s[r]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${e+1}/${h} ${er(f)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:f,assetListIndex:e,event:o,schedule:s.slice(0),scheduleIndex:r,player:t})),this.bufferAssetPlayer(t,l)}bufferAssetPlayer(t,e){var s,r;if(!this.schedule)return;const{interstitial:l,assetItem:o}=t,f=this.schedule.findEventIndex(l.identifier),d=(s=this.schedule.items)==null?void 0:s[f];if(!d)return;t.loadSource(),this.setBufferingItem(d),this.bufferingAsset=o;const h=this.getBufferingPlayer();if(h===t)return;const g=l.appendInPlace;if(g&&(h==null?void 0:h.interstitial.appendInPlace)===!1)return;const p=(h==null?void 0:h.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(g&&o!==this.playingAsset){if(!t.tracks){this.log(`Waiting for track info before buffering ${t}`);return}if(p&&!Mp(p,t.tracks)){const v=new Error(`Asset ${er(o)} SourceBuffer tracks ('${Object.keys(t.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),E={fatal:!0,type:pt.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},S=l.findAssetIndex(o);this.handleAssetItemError(E,l,f,S,v.message);return}}this.transferMediaTo(t,e)}handleInPlaceStall(t){const e=this.schedule,s=this.primaryMedia;if(!e||!s)return;const r=s.currentTime,l=e.findAssetIndex(t,r),o=t.assetList[l];if(o){const f=this.getAssetPlayer(o.identifier);if(f){const d=f.currentTime||r-o.timelineStart,h=f.duration-d;if(this.warn(`Stalled at ${d} of ${d+h} in ${f} ${t} (media.currentTime: ${r})`),d&&(h/s.playbackRate<.5||f.bufferedInPlaceToEnd(s))&&f.hls){const g=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,g,l)}}}}advanceInPlace(t){const e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)}handleAssetItemError(t,e,s,r,l){if(t.details===V.BUFFER_STALLED_ERROR)return;const o=e.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&er(o)} ${t.error}`),!this.schedule)return;const f=(o==null?void 0:o.identifier)||"",d=this.getAssetPlayerQueueIndex(f),h=this.playerQueue[d]||null,g=this.schedule.items,p=Kt({},t,{fatal:!1,errorAction:sr(!0),asset:o,assetListIndex:r,event:e,schedule:g,scheduleIndex:s,player:h});if(this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,p),!t.fatal)return;const v=this.playingAsset,E=this.bufferingAsset,S=new Error(l);if(o&&(this.clearAssetPlayer(f,null),o.error=S),!e.assetList.some(A=>!A.error))e.error=S;else for(let A=r;A<e.assetList.length;A++)this.resetAssetPlayer(e.assetList[A].identifier);this.updateSchedule(!0),e.error?this.primaryFallback(e):v&&v.identifier===f?this.advanceAfterAssetEnded(e,s,r):E&&E.identifier===f&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,E)}primaryFallback(t){const e=t.timelineStart,s=this.effectivePlayingItem;let r=this.timelinePos;if(s){this.log(`Fallback to primary from event "${t.identifier}" start: ${e} pos: ${r} playing: ${xi(s)} error: ${t.error}`),r===-1&&(r=this.hls.startPosition);const o=this.updateItem(s,r);this.itemsMatch(s,o)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const l=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(l)}onAssetListLoaded(t,e){var s,r;const l=e.event,o=l.identifier,f=e.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(o)))return;const d=l.timelineStart,h=l.duration;let g=0;f.forEach((A,b)=>{const L=parseFloat(A.DURATION);this.createAsset(l,b,g,d+g,L,A.URI),g+=L}),l.duration=g,this.log(`Loaded asset-list with duration: ${g} (was: ${h}) ${l}`);const p=this.waitingItem,v=(p==null?void 0:p.event.identifier)===o;this.updateSchedule();const E=(r=this.bufferingItem)==null?void 0:r.event;if(v){var S;const A=this.schedule.findEventIndex(o),b=(S=this.schedule.items)==null?void 0:S[A];if(b){if(!this.playingItem&&this.timelinePos>b.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){l.error=new Error(`Interstitial ${f.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${l}`),this.log(l.error.message),this.updateSchedule(!0),this.primaryFallback(l);return}this.setBufferingItem(b)}this.setSchedulePosition(A)}else if((E==null?void 0:E.identifier)===o){const A=l.assetList[0];if(A){const b=this.getAssetPlayer(A.identifier);if(E.appendInPlace){const L=this.primaryMedia;b&&L&&this.bufferAssetPlayer(b,L)}else b&&b.loadSource()}}}onError(t,e){if(this.schedule)switch(e.details){case V.ASSET_LIST_PARSING_ERROR:case V.ASSET_LIST_LOAD_ERROR:case V.ASSET_LIST_LOAD_TIMEOUT:{const s=e.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case V.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const mp=500;class I1 extends Gf{constructor(t,e,s){super(t,e,s,"subtitle-stream-controller",dt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state=J.IDLE,this.setInterval(mp),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:s,success:r}=e;if(this.fragContextChanged(s)||(ae(s)&&(this.fragPrevious=s),this.state=J.IDLE),!r)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let o;const f=s.start;for(let h=0;h<l.length;h++)if(f>=l[h].start&&f<=l[h].end){o=l[h];break}const d=s.start+s.duration;o?o.end=d:(o={start:f,end:d},l.push(o)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:s,endOffset:r}=e;if(s===0&&r!==Number.POSITIVE_INFINITY){const l=r-1;if(l<=0)return;e.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(o=>{for(let f=0;f<o.length;){if(o[f].end<=l){o.shift();continue}else if(o[f].start<l)o[f].start=l;else break;f++}}),this.fragmentTracker.removeFragmentsInRange(s,l,dt.SUBTITLE)}}onError(t,e){const s=e.frag;(s==null?void 0:s.type)===dt.SUBTITLE&&(e.details===V.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==J.STOPPED&&(this.state=J.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(this.levels&&Ny(this.levels,e)){this.levels=e.map(s=>new da(s));return}this.tracksBuffered=[],this.levels=e.map(s=>{const r=new da(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,dt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){var s;if(this.currentTrackId=e.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==J.STOPPED&&this.setInterval(mp)}onSubtitleTrackLoaded(t,e){var s;const{currentTrackId:r,levels:l}=this,{details:o,id:f}=e;if(!l){this.warn(`Subtitle tracks were reset while loading level ${f}`);return}const d=l[f];if(f>=l.length||!d)return;this.log(`Subtitle track ${f} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(o.live||(s=d.details)!=null&&s.live){if(o.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const v=p.fragments[0];if(!d.details)o.hasProgramDateTime&&p.hasProgramDateTime?(po(o,p),h=o.fragmentStart):v&&(h=v.start,Ef(o,h));else{var g;h=this.alignPlaylists(o,d.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&v&&(h=v.start,Ef(o,h))}p&&!this.startFragRequested&&this.setStartPosition(p,h)}d.details=o,this.levelLastLoaded=d,f===r&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:o,id:f,groupId:e.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===J.IDLE&&(un(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(t){const{frag:e,payload:s}=t,r=e.decryptdata,l=this.hls;if(!this.fragContextChanged(e)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&nr(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,Ff(r.method)).catch(f=>{throw l.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:e}),f}).then(f=>{const d=performance.now();l.trigger(x.FRAG_DECRYPTED,{frag:e,payload:f,stats:{tstart:o,tdecrypt:d}})}).catch(f=>{this.warn(`${f.name}: ${f.message}`),this.state=J.IDLE})}}doTick(){if(!this.media){this.state=J.IDLE;return}if(this.state===J.IDLE){const{currentTrackId:t,levels:e}=this,s=e==null?void 0:e[t];if(!s||!e.length||!s.details||this.waitForLive(s))return;const{config:r}=this,l=this.getLoadPosition(),o=Tt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,r.maxBufferHole),{end:f,len:d}=o,h=s.details,g=this.hls.maxBufferLength+h.levelTargetDuration;if(d>g)return;const p=h.fragments,v=p.length,E=h.edge;let S=null;const A=this.fragPrevious;if(f<E){const _=r.maxFragLookUpTolerance,D=f>E-_?0:_;S=un(A,p,Math.max(p[0].start,f),D),!S&&A&&A.start<p[0].start&&(S=p[0])}else S=p[v-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const b=S.sn-h.startSN,L=p[b-1];if(L&&L.cc===S.cc&&this.fragmentTracker.getState(L)===de.NOT_LOADED&&(S=L),this.fragmentTracker.getState(S)===de.NOT_LOADED){const _=this.mapToInitFragWhenRequired(S);_&&this.loadFragment(_,s,f)}}}loadFragment(t,e,s){ae(t)?super.loadFragment(t,e,s):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new C1(this.tracksBuffered[this.currentTrackId]||[])}}class C1{constructor(t){this.buffered=void 0;const e=(s,r,l)=>{if(r=r>>>0,r>l-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${l})`);return t[r][s]};this.buffered={get length(){return t.length},end(s){return e("end",s,t.length)},start(s){return e("start",s,t.length)}}}}const O1={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Wy=u=>String.fromCharCode(O1[u]||u),Ai=15,ss=100,M1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},w1={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},N1={25:2,26:4,29:6,30:8,31:10,27:13,28:15},P1=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class U1{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const s=typeof e=="function"?e():e;Gt.log(`${this.time} [${t}] ${s}`)}}}const an=function(t){const e=[];for(let s=0;s<t.length;s++)e.push(t[s].toString(16));return e};class Zy{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let s=0;s<e.length;s++){const r=e[s];t.hasOwnProperty(r)&&(this[r]=t[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class B1{constructor(){this.uchar=" ",this.penState=new Zy}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class F1{constructor(t){this.chars=[],this.pos=0,this.currPenState=new Zy,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<ss;e++)this.chars.push(new B1);this.logger=t}equals(t){for(let e=0;e<ss;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<ss;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<ss;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ss&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ss)}moveCursor(t){const e=this.pos+t;if(t>1)for(let s=this.pos+1;s<e+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=Wy(t);if(this.pos>=ss){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<ss;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let s=0;s<ss;s++){const r=this.chars[s].uchar;r!==" "&&(e=!1),t.push(r)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class ef{constructor(t){this.rows=[],this.currRow=Ai-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<Ai;e++)this.rows.push(new F1(t));this.logger=t}reset(){for(let t=0;t<Ai;t++)this.rows[t].clear();this.currRow=Ai-1}equals(t){let e=!0;for(let s=0;s<Ai;s++)if(!this.rows[s].equals(t.rows[s])){e=!1;break}return e}copy(t){for(let e=0;e<Ai;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<Ai;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+qt(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let f=0;f<Ai;f++)this.rows[f].clear();const l=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const f=o.rows[l].cueStartTime,d=this.logger.time;if(f!==null&&d!==null&&f<d)for(let h=0;h<this.nrRollUpRows;h++)this.rows[e-this.nrRollUpRows+h+1].copy(o.rows[l+h])}}this.currRow=e;const s=this.rows[this.currRow];if(t.indent!==null){const l=t.indent,o=Math.max(l-1,0);s.setCursor(t.indent),t.color=s.chars[o].penState.foreground}const r={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+qt(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let s="",r=-1;for(let l=0;l<Ai;l++){const o=this.rows[l].getTextString();o&&(r=l+1,t?e.push("Row "+r+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(t?s="["+e.join(" | ")+"]":s=e.join(`
`)),s}getTextAndFormat(){return this.rows}}class pp{constructor(t,e,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new ef(s),this.nonDisplayedMemory=new ef(s),this.lastOutputScreen=new ef(s),this.currRollUpRow=this.displayedMemory.rows[Ai-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ai-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let s=0;s<t.length;s++)this.writeScreen.insertChar(t[s]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const s=Math.floor(t/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=r[s]}this.logger.log(2,"MIDROW: "+qt(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class yp{constructor(t,e,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=G1(),this.logger=void 0;const r=this.logger=new U1;this.channels=[null,new pp(t,e,r),new pp(t+1,s,r)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let s=0;s<e.length;s+=2){const r=e[s]&127,l=e[s+1]&127;let o=!1,f=null;if(r===0&&l===0)continue;this.logger.log(3,()=>"["+an([e[s],e[s+1]])+"] -> ("+an([r,l])+")");const d=this.cmdHistory;if(r>=16&&r<=31){if($1(r,l,d)){ql(null,null,d),this.logger.log(3,()=>"Repeated command ("+an([r,l])+") is dropped");continue}ql(r,l,this.cmdHistory),o=this.parseCmd(r,l),o||(o=this.parseMidrow(r,l)),o||(o=this.parsePAC(r,l)),o||(o=this.parseBackgroundAttributes(r,l))}else ql(null,null,d);if(!o&&(f=this.parseChars(r,l),f)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(f):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!f&&this.logger.log(2,()=>"Couldn't parse cleaned data "+an([r,l])+" orig: "+an([e[s],e[s+1]]))}}parseCmd(t,e){const s=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=33&&e<=35;if(!(s||r))return!1;const l=t===20||t===21||t===23?1:2,o=this.channels[l];return t===20||t===21||t===28||t===29?e===32?o.ccRCL():e===33?o.ccBS():e===34?o.ccAOF():e===35?o.ccAON():e===36?o.ccDER():e===37?o.ccRU(2):e===38?o.ccRU(3):e===39?o.ccRU(4):e===40?o.ccFON():e===41?o.ccRDC():e===42?o.ccTR():e===43?o.ccRTD():e===44?o.ccEDM():e===45?o.ccCR():e===46?o.ccENM():e===47&&o.ccEOC():o.ccTO(e-32),this.currentChannel=l,!0}parseMidrow(t,e){let s=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+an([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let s;const r=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,l=(t===16||t===24)&&e>=64&&e<=95;if(!(r||l))return!1;const o=t<=23?1:2;e>=64&&e<=95?s=o===1?M1[t]:w1[t]:s=o===1?k1[t]:N1[t];const f=this.channels[o];return f?(f.setPAC(this.interpretPAC(s,e)),this.currentChannel=o,!0):!1}interpretPAC(t,e){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?s=e-96:s=e-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(t,e){let s,r=null,l=null;if(t>=25?(s=2,l=t-8):(s=1,l=t),l>=17&&l<=19){let o;l===17?o=e+80:l===18?o=e+112:o=e+144,this.logger.log(2,()=>"Special char '"+Wy(o)+"' in channel "+s),r=[o]}else t>=32&&t<=127&&(r=e===0?[t]:[t,e]);return r&&this.logger.log(3,()=>"Char codes =  "+an(r).join(",")),r}parseBackgroundAttributes(t,e){const s=(t===16||t===24)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=45&&e<=47;if(!(s||r))return!1;let l;const o={};t===16||t===24?(l=Math.floor((e-32)/2),o.background=P1[l],e%2===1&&(o.background=o.background+"_semi")):e===45?o.background="transparent":(o.foreground="black",e===47&&(o.underline=!0));const f=t<=23?1:2;return this.channels[f].setBkgData(o),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}ql(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const s=this.channels[e];s&&s.cueSplitAtTime(t)}}}function ql(u,t,e){e.a=u,e.b=t}function $1(u,t,e){return e.a===u&&e.b===t}function G1(){return{a:null,b:null}}var Jf=(function(){if(mo!=null&&mo.VTTCue)return self.VTTCue;const u=["","lr","rl"],t=["start","middle","end","left","right"];function e(f,d){if(typeof d!="string"||!Array.isArray(f))return!1;const h=d.toLowerCase();return~f.indexOf(h)?h:!1}function s(f){return e(u,f)}function r(f){return e(t,f)}function l(f,...d){let h=1;for(;h<arguments.length;h++){const g=arguments[h];for(const p in g)f[p]=g[p]}return f}function o(f,d,h){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let v="",E=!1,S=f,A=d,b=h,L=null,_="",D=!0,C="auto",k="start",K=50,O="middle",F=50,$="middle";Object.defineProperty(g,"id",l({},p,{get:function(){return v},set:function(U){v=""+U}})),Object.defineProperty(g,"pauseOnExit",l({},p,{get:function(){return E},set:function(U){E=!!U}})),Object.defineProperty(g,"startTime",l({},p,{get:function(){return S},set:function(U){if(typeof U!="number")throw new TypeError("Start time must be set to a number.");S=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",l({},p,{get:function(){return A},set:function(U){if(typeof U!="number")throw new TypeError("End time must be set to a number.");A=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",l({},p,{get:function(){return b},set:function(U){b=""+U,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",l({},p,{get:function(){return L},set:function(U){L=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",l({},p,{get:function(){return _},set:function(U){const Q=s(U);if(Q===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",l({},p,{get:function(){return D},set:function(U){D=!!U,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",l({},p,{get:function(){return C},set:function(U){if(typeof U!="number"&&U!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",l({},p,{get:function(){return k},set:function(U){const Q=r(U);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");k=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",l({},p,{get:function(){return K},set:function(U){if(U<0||U>100)throw new Error("Position must be between 0 and 100.");K=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",l({},p,{get:function(){return O},set:function(U){const Q=r(U);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");O=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",l({},p,{get:function(){return F},set:function(U){if(U<0||U>100)throw new Error("Size must be between 0 and 100.");F=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",l({},p,{get:function(){return $},set:function(U){const Q=r(U);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");$=Q,this.hasBeenReset=!0}})),g.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class H1{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function Jy(u){function t(s,r,l,o){return(s|0)*3600+(r|0)*60+(l|0)+parseFloat(o||0)}const e=u.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class V1{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,s){return s?this.has(t)?this.values[t]:e[s]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,s){for(let r=0;r<s.length;++r)if(e===s[r]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const s=parseFloat(e);if(s>=0&&s<=100)return this.set(t,s),!0}return!1}}function tv(u,t,e,s){const r=s?u.split(s):[u];for(const l in r){if(typeof r[l]!="string")continue;const o=r[l].split(e);if(o.length!==2)continue;const f=o[0],d=o[1];t(f,d)}}const _f=new Jf(0,0,""),Xl=_f.align==="middle"?"middle":"center";function z1(u,t,e){const s=u;function r(){const f=Jy(u);if(f===null)throw new Error("Malformed timestamp: "+s);return u=u.replace(/^[^\sa-zA-Z-]+/,""),f}function l(f,d){const h=new V1;tv(f,function(v,E){let S;switch(v){case"region":for(let A=e.length-1;A>=0;A--)if(e[A].id===E){h.set(v,e[A].region);break}break;case"vertical":h.alt(v,E,["rl","lr"]);break;case"line":S=E.split(","),h.integer(v,S[0]),h.percent(v,S[0])&&h.set("snapToLines",!1),h.alt(v,S[0],["auto"]),S.length===2&&h.alt("lineAlign",S[1],["start",Xl,"end"]);break;case"position":S=E.split(","),h.percent(v,S[0]),S.length===2&&h.alt("positionAlign",S[1],["start",Xl,"end","line-left","line-right","auto"]);break;case"size":h.percent(v,E);break;case"align":h.alt(v,E,["start",Xl,"end","left","right"]);break}},/:/,/\s/),d.region=h.get("region",null),d.vertical=h.get("vertical","");let g=h.get("line","auto");g==="auto"&&_f.line===-1&&(g=-1),d.line=g,d.lineAlign=h.get("lineAlign","start"),d.snapToLines=h.get("snapToLines",!0),d.size=h.get("size",100),d.align=h.get("align",Xl);let p=h.get("position","auto");p==="auto"&&_f.position===50&&(p=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=p}function o(){u=u.replace(/^\s+/,"")}if(o(),t.startTime=r(),o(),u.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);u=u.slice(3),o(),t.endTime=r(),o(),l(u,t)}function ev(u){return u.replace(/<br(?: \/)?>/gi,`
`)}class K1{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new H1,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function s(){let l=e.buffer,o=0;for(l=ev(l);o<l.length&&l[o]!=="\r"&&l[o]!==`
`;)++o;const f=l.slice(0,o);return l[o]==="\r"&&++o,l[o]===`
`&&++o,e.buffer=l.slice(o),f}function r(l){tv(l,function(o,f){},/:/)}try{let l="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;l=s();const f=l.match(/^()?WEBVTT([ \t].*)?$/);if(!(f!=null&&f[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let o=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:l=s(),e.state){case"HEADER":/:/.test(l)?r(l):l||(e.state="ID");continue;case"NOTE":l||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){e.state="NOTE";break}if(!l)continue;if(e.cue=new Jf(0,0,""),e.state="CUE",l.indexOf("-->")===-1){e.cue.id=l;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{z1(l,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const f=l.indexOf("-->")!==-1;if(!l||f&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=l}continue;case"BADCUE":l||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const j1=/\r\n|\n\r|\n|\r/g,sf=function(t,e,s=0){return t.slice(s,s+e.length)===e},Y1=function(t){let e=parseInt(t.slice(-3));const s=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),l=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!ct(e)||!ct(s)||!ct(r)||!ct(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*s,e+=60*1e3*r,e+=3600*1e3*l,e};function th(u,t,e){return ca(u.toString())+ca(t.toString())+ca(e)}const q1=function(t,e,s){let r=t[e],l=t[r.prevCC];if(!l||!l.new&&r.new){t.ccOffset=t.presentationOffset=r.start,r.new=!1;return}for(;(o=l)!=null&&o.new;){var o;t.ccOffset+=r.start-l.start,r.new=!1,r=l,l=t[r.prevCC]}t.presentationOffset=s};function X1(u,t,e,s,r,l,o){const f=new K1,d=si(new Uint8Array(u)).trim().replace(j1,`
`).split(`
`),h=[],g=t?eb(t.baseTime,t.timescale):0;let p="00:00.000",v=0,E=0,S,A=!0;f.oncue=function(b){const L=e[s];let _=e.ccOffset;const D=(v-g)/9e4;if(L!=null&&L.new&&(E!==void 0?_=e.ccOffset=L.start:q1(e,s,D)),D){if(!t){S=new Error("Missing initPTS for VTT MPEGTS");return}_=D-e.presentationOffset}const C=b.endTime-b.startTime,k=ti((b.startTime+_-E)*9e4,r*9e4)/9e4;b.startTime=Math.max(k,0),b.endTime=Math.max(k+C,0);const K=b.text.trim();b.text=decodeURIComponent(encodeURIComponent(K)),b.id||(b.id=th(b.startTime,b.endTime,K)),b.endTime>0&&h.push(b)},f.onparsingerror=function(b){S=b},f.onflush=function(){if(S){o(S);return}l(h)},d.forEach(b=>{if(A)if(sf(b,"X-TIMESTAMP-MAP=")){A=!1,b.slice(16).split(",").forEach(L=>{sf(L,"LOCAL:")?p=L.slice(6):sf(L,"MPEGTS:")&&(v=parseInt(L.slice(7)))});try{E=Y1(p)/1e3}catch(L){S=L}return}else b===""&&(A=!1);f.parse(b+`
`)}),f.flush()}const nf="stpp.ttml.im1t",iv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,sv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Q1={left:"start",center:"center",right:"end",start:"start",end:"end"};function vp(u,t,e,s){const r=Lt(new Uint8Array(u),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const l=r.map(f=>si(f)),o=tb(t.baseTime,1,t.timescale);try{l.forEach(f=>e(W1(f,o)))}catch(f){s(f)}}function W1(u,t){const r=new DOMParser().parseFromString(u,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(l).reduce((p,v)=>(p[v]=r.getAttribute(`ttp:${v}`)||l[v],p),{}),f=r.getAttribute("xml:space")!=="preserve",d=Ep(rf(r,"styling","style")),h=Ep(rf(r,"layout","region")),g=rf(r,"body","[begin]");return[].map.call(g,p=>{const v=nv(p,f);if(!v||!p.hasAttribute("begin"))return null;const E=lf(p.getAttribute("begin"),o),S=lf(p.getAttribute("dur"),o);let A=lf(p.getAttribute("end"),o);if(E===null)throw Sp(p);if(A===null){if(S===null)throw Sp(p);A=E+S}const b=new Jf(E-t,A-t,v);b.id=th(b.startTime,b.endTime,b.text);const L=h[p.getAttribute("region")],_=d[p.getAttribute("style")],D=Z1(L,_,d),{textAlign:C}=D;if(C){const k=Q1[C];k&&(b.lineAlign=k),b.align=C}return Kt(b,D),b}).filter(p=>p!==null)}function rf(u,t,e){const s=u.getElementsByTagName(t)[0];return s?[].slice.call(s.querySelectorAll(e)):[]}function Ep(u){return u.reduce((t,e)=>{const s=e.getAttribute("xml:id");return s&&(t[s]=e),t},{})}function nv(u,t){return[].slice.call(u.childNodes).reduce((e,s,r)=>{var l;return s.nodeName==="br"&&r?e+`
`:(l=s.childNodes)!=null&&l.length?nv(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent},"")}function Z1(u,t,e){const s="http://www.w3.org/ns/ttml#styling";let r=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return o&&e.hasOwnProperty(o)&&(r=e[o]),l.reduce((f,d)=>{const h=af(t,s,d)||af(u,s,d)||af(r,s,d);return h&&(f[d]=h),f},{})}function af(u,t,e){return u&&u.hasAttributeNS(t,e)?u.getAttributeNS(t,e):null}function Sp(u){return new Error(`Could not parse ttml timestamp ${u}`)}function lf(u,t){if(!u)return null;let e=Jy(u);return e===null&&(iv.test(u)?e=J1(u,t):sv.test(u)&&(e=tL(u,t))),e}function J1(u,t){const e=iv.exec(u),s=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+s/t.frameRate}function tL(u,t){const e=sv.exec(u),s=Number(e[1]);switch(e[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/t.frameRate;case"t":return s/t.tickRate}return s}class Ql{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,s){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class eL{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=xp(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(x.FRAG_LOADING,this.onFragLoading,this),t.on(x.FRAG_LOADED,this.onFragLoaded,this),t.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(x.FRAG_LOADING,this.onFragLoading,this),t.off(x.FRAG_LOADED,this.onFragLoaded,this),t.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new Ql(this,"textTrack1"),e=new Ql(this,"textTrack2"),s=new Ql(this,"textTrack3"),r=new Ql(this,"textTrack4");this.cea608Parser1=new yp(1,t,e),this.cea608Parser2=new yp(3,s,r)}addCues(t,e,s,r,l){let o=!1;for(let f=l.length;f--;){const d=l[f],h=iL(d[0],d[1],e,s);if(h>=0&&(d[0]=Math.min(d[0],e),d[1]=Math.max(d[1],s),o=!0,h/(s-e)>.5))return}if(o||l.push([e,s]),this.config.renderTextTracksNatively){const f=this.captionsTracks[t];this.Cues.newCue(f,e,s,r)}else{const f=this.Cues.newCue(null,e,s,r);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:f,track:t})}}onInitPtsFound(t,{frag:e,id:s,initPTS:r,timescale:l,trackId:o}){const{unparsedVttFrags:f}=this;s===dt.MAIN&&(this.initPTS[e.cc]={baseTime:r,timescale:l,trackId:o}),f.length&&(this.unparsedVttFrags=[],f.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(x.FRAG_LOADED,d):this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(t,e){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const l=s.textTracks[r];if(Tp(l,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:s,media:r}=this,{label:l,languageCode:o}=e[t],f=this.getExistingTrack(l,o);if(f)s[t]=f,ir(s[t]),qy(s[t],r);else{const d=this.createTextTrack("captions",l,o);d&&(d[t]=!0,s[t]=d)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const s=e.label,r={_id:t,label:s,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(t,e,s){const r=this.media;if(r)return r.addTextTrack(t,e,s)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const s=!!e.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(l=>{ir(r[l]),delete r[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=xp(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let s=0;s<e.length;s++)ir(e[s])}onSubtitleTracksUpdated(t,e){const s=e.subtitleTracks||[],r=s.some(l=>l.textCodec===nf);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Ny(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const o=this.media,f=o?ro(o.textTracks):null;if(this.tracks.forEach((d,h)=>{let g;if(f){let p=null;for(let v=0;v<f.length;v++)if(f[v]&&Tp(f[v],d)){p=f[v],f[v]=null;break}p&&(g=p)}if(g)ir(g);else{const p=rv(d);g=this.createTextTrack(p,d.name,d.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),f!=null&&f.length){const d=f.filter(h=>h!==null).map(h=>h.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(f=>({label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const l=`textTrack${r[1]}`,o=this.captionsProperties[l];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===dt.MAIN){var s,r;const{cea608Parser1:l,cea608Parser2:o,lastSn:f}=this,{cc:d,sn:h}=e.frag,g=(s=(r=e.part)==null?void 0:r.index)!=null?s:-1;l&&o&&(h!==f+1||h===f&&g!==this.lastPartIndex+1||d!==this.lastCc)&&(l.reset(),o.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=g}}onFragLoaded(t,e){const{frag:s,payload:r}=e;if(s.type===dt.SUBTITLE)if(r.byteLength){const l=s.decryptdata,o="stats"in e;if(l==null||!l.encrypted||o){const f=this.tracks[s.level],d=this.vttCCs;d[s.cc]||(d[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),f&&f.textCodec===nf?this._parseIMSC1(s,r):this._parseVTTs(e)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const s=this.hls;vp(e,this.initPTS[t.cc],r=>{this._appendCues(r,t.level),s.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})})}_parseVTTs(t){var e;const{frag:s,payload:r}=t,{initPTS:l,unparsedVttFrags:o}=this,f=l.length-1;if(!l[s.cc]&&f===-1){o.push(t);return}const d=this.hls,h=(e=s.initSegment)!=null&&e.data?mi(s.initSegment.data,new Uint8Array(r)).buffer:r;X1(h,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,g=>{this._appendCues(g,s.level),d.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?o.push(t):this._fallbackToIMSC1(s,r),d.logger.log(`Failed to parse VTT cue: ${g}`),!(p&&f>s.cc)&&d.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:g})})}_fallbackToIMSC1(t,e){const s=this.tracks[t.level];s.textCodec||vp(e,this.initPTS[t.cc],()=>{s.textCodec=nf,this._parseIMSC1(t,e)},()=>{s.textCodec="wvtt"})}_appendCues(t,e){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[e];if(!r||r.mode==="disabled")return;t.forEach(l=>Xy(r,l))}else{const r=this.tracks[e];if(!r)return;const l=r.default?"default":"subtitles"+e;s.trigger(x.CUES_PARSED,{type:"subtitles",cues:t,track:l})}}onFragDecrypted(t,e){const{frag:s}=e;s.type===dt.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=e;if(!(s.type===dt.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let l=0;l<r.length;l++){const o=r[l].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const f=this.extractCea608Data(o);this.cea608Parser1.addData(r[l].pts,f[0]),this.cea608Parser2.addData(r[l].pts,f[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:s,endOffsetSubtitles:r,type:l}){const{media:o}=this;if(!(!o||o.currentTime<s)){if(!l||l==="video"){const{captionsTracks:f}=this;Object.keys(f).forEach(d=>Rf(f[d],e,s))}if(this.config.renderTextTracksNatively&&e===0&&r!==void 0){const{textTracks:f}=this;Object.keys(f).forEach(d=>Rf(f[d],e,r))}}}extractCea608Data(t){const e=[[],[]],s=t[0]&31;let r=2;for(let l=0;l<s;l++){const o=t[r++],f=127&t[r++],d=127&t[r++];if(f===0&&d===0)continue;if((4&o)!==0){const g=3&o;(g===0||g===1)&&(e[g].push(f),e[g].push(d))}}return e}}function rv(u){return u.characteristics&&/transcribes-spoken-dialog/gi.test(u.characteristics)&&/describes-music-and-sound/gi.test(u.characteristics)?"captions":"subtitles"}function Tp(u,t){return!!u&&u.kind===rv(t)&&xf(t,u)}function iL(u,t,e,s){return Math.min(t,s)-Math.max(u,e)}function xp(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const sL=/\s/,nL={newCue(u,t,e,s){const r=[];let l,o,f,d,h;const g=self.VTTCue||self.TextTrackCue;for(let v=0;v<s.rows.length;v++)if(l=s.rows[v],f=!0,d=0,h="",!l.isEmpty()){var p;for(let A=0;A<l.chars.length;A++)sL.test(l.chars[A].uchar)&&f?d++:(h+=l.chars[A].uchar,f=!1);l.cueStartTime=t,t===e&&(e+=1e-4),d>=16?d--:d++;const E=ev(h.trim()),S=th(t,e,E);u!=null&&(p=u.cues)!=null&&p.getCueById(S)||(o=new g(t,e,E),o.id=S,o.line=v+1,o.align="left",o.position=10+Math.min(80,Math.floor(d*8/32)*10),r.push(o))}return u&&r.length&&(r.sort((v,E)=>v.line==="auto"||E.line==="auto"?0:v.line>8&&E.line>8?E.line-v.line:v.line-E.line),r.forEach(v=>Xy(u,v))),r}};function rL(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const aL=/(\d+)-(\d+)\/(\d+)/;class Ap{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||cL,this.controller=new self.AbortController,this.stats=new Mf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const l=lL(t,this.controller.signal),o=t.responseType==="arraybuffer",f=o?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:h}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=s,this.request=this.fetchSetup(t,l),self.clearTimeout(this.requestTimeout),e.timeout=d&&ct(d)?d:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,t,this.response))},e.timeout),(pa(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const E=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,t,this.response))},h-(E-r.loading.start)),!p.ok){const{status:A,statusText:b}=p;throw new fL(b||"fetch, bad network response",A,p)}r.loading.first=E,r.total=uL(p.headers)||r.total;const S=(v=this.callbacks)==null?void 0:v.onProgress;return S&&ct(e.highWaterMark)?this.loadProgressively(p,r,t,e.highWaterMark,S):o?p.arrayBuffer():t.responseType==="json"?p.json():p.text()}).then(p=>{var v,E;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const A=p[f];A&&(r.loaded=r.total=A);const b={url:S.url,data:p,code:S.status},L=(v=this.callbacks)==null?void 0:v.onProgress;L&&!ct(e.highWaterMark)&&L(r,t,p,S),(E=this.callbacks)==null||E.onSuccess(b,r,t,S)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const E=p&&p.code||0,S=p?p.message:null;(v=this.callbacks)==null||v.onError({code:E,text:S},t,p?p.details:null,r)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,s,r=0,l){const o=new my,f=t.body.getReader(),d=()=>f.read().then(h=>{if(h.done)return o.dataLength&&l(e,s,o.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const g=h.value,p=g.length;return e.loaded+=p,p<r||o.dataLength?(o.push(g),o.dataLength>=r&&l(e,s,o.flush().buffer,t)):l(e,s,g.buffer,t),d()}).catch(()=>Promise.reject());return d()}}function lL(u,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Kt({},u.headers))};return u.rangeEnd&&e.headers.set("Range","bytes="+u.rangeStart+"-"+String(u.rangeEnd-1)),e}function oL(u){const t=aL.exec(u);if(t)return parseInt(t[2])-parseInt(t[1])+1}function uL(u){const t=u.get("Content-Range");if(t){const s=oL(t);if(ct(s))return s}const e=u.get("Content-Length");if(e)return parseInt(e)}function cL(u,t){return new self.Request(u.url,t)}class fL extends Error{constructor(t,e,s){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=s}}const hL=/^age:\s*[\d.]+\s*$/im;class av{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Mf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return l(s,e.url)}).catch(o=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",e.url,!0),l(s,e.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,e,t)}).catch(o=>{var f;(f=this.callbacks)==null||f.onError({code:s.status,text:o.message},e,s,r)}):this.openAndSendXhr(s,e,t)}openAndSendXhr(t,e,s){t.readyState||t.open("GET",e.url,!0);const r=e.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:o}=s.loadPolicy;if(r)for(const f in r)t.setRequestHeader(f,r[f]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),s.timeout=l&&ct(l)?l:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:s}=this;if(!t||!e)return;const r=e.readyState,l=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const h=e.status,g=e.responseType==="text"?e.responseText:null;if(h>=200&&h<300){const S=g??e.response;if(S!=null){var o,f;s.loading.end=Math.max(self.performance.now(),s.loading.first);const A=e.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=A,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const b=(o=this.callbacks)==null?void 0:o.onProgress;b&&b(s,t,S,e);const L={url:e.responseURL,data:S,code:h};(f=this.callbacks)==null||f.onSuccess(L,s,t,e);return}}const p=l.loadPolicy.errorRetry,v=s.retry,E={url:t.url,data:void 0,code:h};if(ho(p,v,!1,E))this.retry(p);else{var d;Gt.error(`${h} while loading ${t.url}`),(d=this.callbacks)==null||d.onError({code:h,text:e.statusText},t,e,s)}}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(ho(t,e,!0))this.retry(t);else{var s;Gt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:s}=this;this.retryDelay=Pf(t,s.retry),s.retry++,Gt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e==null?void 0:e.url}, retrying ${s.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&hL.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const dL={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},gL=$t($t({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:av,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Rx,bufferController:pb,capLevelController:Qf,errorController:Ox,fpsController:y1,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ny,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:dL},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},mL()),{},{subtitleStreamController:I1,subtitleTrackController:S1,timelineController:eL,audioStreamController:hb,audioTrackController:db,emeController:rr,cmcdController:d1,contentSteeringController:m1,interstitialsController:D1});function mL(){return{cueHandler:nL,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function pL(u,t,e){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Df(u),r=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const f=`${o==="level"?"playlist":o}LoadPolicy`,d=t[f]===void 0,h=[];l.forEach(g=>{const p=`${o}Loading${g}`,v=t[p];if(v!==void 0&&d){h.push(p);const E=s[f].default;switch(t[f]={default:E},g){case"TimeOut":E.maxLoadTimeMs=v,E.maxTimeToFirstByteMs=v;break;case"MaxRetry":E.errorRetry.maxNumRetry=v,E.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":E.errorRetry.retryDelayMs=v,E.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=v,E.timeoutRetry.maxRetryDelayMs=v;break}}}),h.length&&e.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${f}": ${qt(t[f])}`)}),$t($t({},s),t)}function Df(u){return u&&typeof u=="object"?Array.isArray(u)?u.map(Df):Object.keys(u).reduce((t,e)=>(t[e]=Df(u[e]),t),{}):u}function yL(u,t){const e=u.loader;e!==Ap&&e!==av?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1):rL()&&(u.loader=Ap,u.progressive=!0,u.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ao=2,vL=.1,EL=.05,SL=100;class TL extends Jp{constructor(t,e){super("gap-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})}},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(SL),this.mediaSource=e.mediaSource;const s=this.media=e.media;ke(s,"playing",this.onMediaPlaying),ke(s,"waiting",this.onMediaWaiting),ke(s,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:s}=this;s&&(He(s,"playing",this.onMediaPlaying),He(s,"waiting",this.onMediaWaiting),He(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(!((t=this.media)!=null&&t.readyState)||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var s,r;const l=(s=this.hls)==null?void 0:s.config;if(!l)return;const o=this.media;if(!o)return;const{seeking:f}=o,d=this.seeking&&!f,h=!this.seeking&&f,g=o.paused&&!f||o.ended||o.playbackRate===0;if(this.seeking=f,t!==e){e&&(this.ended=0),this.moved=!0,f||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!g&&t>e&&this.nudgeOnVideoHole(t,e)),this.waiting===0&&this.stallResolved(t);return}if(h||d){d&&this.stallResolved(t);return}if(g){this.nudgeRetry=0,this.stallResolved(t),!this.ended&&o.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}));return}if(!Tt.getBuffered(o).length){this.nudgeRetry=0;return}const p=Tt.bufferInfo(o,t,0),v=p.nextStart||0,E=this.fragmentTracker;if(f&&E&&this.hls){const K=bp(this.hls.inFlightFragments,t),O=p.len>ao,F=!v||K||v-t>ao&&!E.getPartialFragment(t);if(O||F)return;this.moved=!1}const S=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&E){if(!(p.len>0)&&!v)return;const O=Math.max(v,p.start||0)-t,$=!!(S!=null&&S.live)?S.targetduration*2:ao,U=Wl(t,E);if(O>0&&(O<=$||U)){o.paused||this._trySkipBufferHole(U);return}}const A=l.detectStallWithCurrentTimeMs,b=self.performance.now(),L=this.waiting;let _=this.stalled;if(_===null)if(L>0&&b-L<A)_=this.stalled=L;else{this.stalled=b;return}const D=b-_;if(!f&&(D>=A||L)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(t-((S==null?void 0:S.edge)||0))<1){if(this.ended)return;this.ended=t||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const k=Tt.bufferInfo(o,t,l.maxBufferHole);this._tryFixBufferStall(k,D,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-e;this.log(`playback not stuck anymore @${t}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&t>r.end(0)){const l=Tt.bufferedInfo(Tt.timeRangesToArray(this.buffered.audio),t,0);if(l.len>1&&e>=l.start){const o=Tt.timeRangesToArray(r),f=Tt.bufferedInfo(o,e,0).bufferedIndex;if(f>-1&&f<o.length-1){const d=Tt.bufferedInfo(o,t,0).bufferedIndex,h=o[f].end,g=o[f+1].start;if((d===-1||d>f)&&g-h<1&&t-h<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${t} hole: ${h} -> ${g} buffered index: ${d}`);this.warn(p.message),this.media.currentTime+=1e-6;let v=Wl(t,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const E=Tt.bufferInfo(this.media,t,0);this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:E.len,bufferInfo:E})}}}}}_tryFixBufferStall(t,e,s){var r,l;const{fragmentTracker:o,media:f}=this,d=(r=this.hls)==null?void 0:r.config;if(!f||!o||!d)return;const h=(l=this.hls)==null?void 0:l.latestLevelDetails,g=Wl(s,o);if((g||h!=null&&h.live&&s<h.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const p=t.buffered,v=this.adjacentTraversal(t,s);(p&&p.length>1&&t.len>d.maxBufferHole||t.nextStart&&(t.nextStart-s<d.maxBufferHole||v))&&(e>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const s=this.fragmentTracker,r=t.nextStart;if(s&&r){const l=s.getFragAtPos(e,dt.MAIN),o=s.getFragAtPos(r,dt.MAIN);if(l&&o)return o.sn-l.sn<2}return!1}_reportStall(t){const{hls:e,media:s,stallReported:r,stalled:l}=this;if(!r&&l!==null&&s&&e){this.stallReported=!0;const o=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${qt(t)})`);this.warn(o.message),e.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:t.len,bufferInfo:t,stalled:{start:l}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:s,media:r}=this,l=(e=this.hls)==null?void 0:e.config;if(!r||!s||!l)return 0;const o=r.currentTime,f=Tt.bufferInfo(r,o,0),d=o<f.start?f.start:f.nextStart;if(d&&this.hls){const g=f.len<=l.maxBufferHole,p=f.len>0&&f.len<1&&r.readyState<3,v=d-o;if(v>0&&(g||p)){if(v>l.maxBufferHole){let S=!1;if(o===0){const A=s.getAppendedFrag(0,dt.MAIN);A&&d<A.end&&(S=!0)}if(!S&&t){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||bp(this.hls.inFlightFragments,d))return 0;let b=!1,L=t.end;for(;L<d;){const _=Wl(L,s);if(_)L+=_.duration;else{b=!0;break}}if(b)return 0}}const E=Math.max(d+EL,o+vL);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${E}`),this.moved=!0,r.currentTime=E,!(t!=null&&t.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${E}`),A={type:pt.MEDIA_ERROR,details:V.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:f.len,bufferInfo:f};t&&("fragment"in t?A.part=t:A.frag=t),this.hls.trigger(x.ERROR,A)}return E}}return 0}_tryNudgeBuffer(t){const{hls:e,media:s,nudgeRetry:r}=this,l=e==null?void 0:e.config;if(!s||!l)return 0;const o=s.currentTime;if(this.nudgeRetry++,r<l.nudgeMaxRetry){const f=o+(r+1)*l.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${o} to ${f}`);this.warn(d.message),s.currentTime=f,e.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:t.len,bufferInfo:t})}else{const f=new Error(`Playhead still not moving while enough data buffered @${o} after ${l.nudgeMaxRetry} nudges`);this.error(f.message),e.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.BUFFER_STALLED_ERROR,error:f,fatal:!0,buffer:t.len,bufferInfo:t})}}}function bp(u,t){const e=Lp(u.main);if(e&&e.start<=t)return e;const s=Lp(u.audio);return s&&s.start<=t?s:null}function Lp(u){if(!u)return null;switch(u.state){case J.IDLE:case J.STOPPED:case J.ENDED:case J.ERROR:return null}return u.frag}function Wl(u,t){return t.getAppendedFrag(u,dt.MAIN)||t.getPartialFragment(u)}const xL=.25;function If(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function of(u,t,e,s,r){let l=new u(t,e,"");try{l.value=s,r&&(l.type=r)}catch{l=new u(t,e,qt(r?$t({type:r},s):s))}return l}const Zl=(()=>{const u=If();try{u&&new u(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class AL{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t&&(t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(t,e){var s;this.media=e.media,((s=e.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var t;const e=(t=this.hls)==null?void 0:t.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(t,e){this.media=null,!e.transferMedia&&(this.id3Track&&(this.removeCues&&ir(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const s=t[e];if(s.kind==="metadata"&&s.label==="id3")return qy(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:l}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=If();if(o)for(let f=0;f<l.length;f++){const d=l[f].type;if(d===ei.emsg&&!s||!r)continue;const h=xy(l[f].data),g=l[f].pts;let p=g+l[f].duration;p>Zl&&(p=Zl),p-g<=0&&(p=g+xL);for(let E=0;E<h.length;E++){const S=h[E];if(!Ay(S)){this.updateId3CueEnds(g,d);const A=of(o,g,p,S,d);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(t,e){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let l=r.length;l--;){const o=r[l];o.type===e&&o.startTime<t&&o.endTime===Zl&&(o.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:s,type:r}){const{id3Track:l,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:f,enableID3MetadataCues:d}}=o;if(l&&(f||d)){let h;r==="audio"?h=g=>g.type===ei.audioId3&&d:r==="video"?h=g=>g.type===ei.emsg&&f:h=g=>g.type===ei.audioId3&&d||g.type===ei.emsg&&f,Rf(l,e,s,h)}}onLevelUpdated(t,{details:e}){this.updateDateRangeCues(e,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:l,interstitialsController:o}=this.hls.config;if(!l)return;const f=If();if(s&&r&&!o){const{fragmentStart:A,fragmentEnd:b}=t;let L=this.assetCue;L?(L.startTime=A,L.endTime=b):f&&(L=this.assetCue=of(f,A,b,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),L&&(L.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(L),L.addEventListener("enter",this.onEventCueEnter)))}if(!t.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:h}=t,g=Object.keys(h);let p=this.dateRangeCuesAppended;if(d&&e){var v;if((v=d.cues)!=null&&v.length){const A=Object.keys(p).filter(b=>!g.includes(b));for(let b=A.length;b--;){var E;const L=A[b],_=(E=p[L])==null?void 0:E.cues;delete p[L],_&&Object.keys(_).forEach(D=>{const C=_[D];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(C)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const S=t.fragments[t.fragments.length-1];if(!(g.length===0||!ct(S==null?void 0:S.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<g.length;A++){const b=g[A],L=h[b],_=L.startTime,D=p[b],C=(D==null?void 0:D.cues)||{};let k=(D==null?void 0:D.durationKnown)||!1,K=Zl;const{duration:O,endDate:F}=L;if(F&&O!==null)K=_+O,k=!0;else if(L.endOnNext&&!k){const U=g.reduce((Q,st)=>{if(st!==L.id){const ut=h[st];if(ut.class===L.class&&ut.startDate>L.startDate&&(!Q||L.startDate<Q.startDate))return ut}return Q},null);U&&(K=U.startTime,k=!0)}const $=Object.keys(L.attr);for(let U=0;U<$.length;U++){const Q=$[U];if(!zx(Q))continue;const st=C[Q];if(st)k&&!(D!=null&&D.durationKnown)?st.endTime=K:Math.abs(st.startTime-_)>.01&&(st.startTime=_,st.endTime=K);else if(f){let ut=L.attr[Q];Kx(Q)&&(ut=kp(ut));const lt=of(f,_,K,{key:Q,data:ut},ei.dateRange);lt&&(lt.id=b,this.id3Track.addCue(lt),C[Q]=lt,o&&(Q==="X-ASSET-LIST"||Q==="X-ASSET-URL")&&lt.addEventListener("enter",this.onEventCueEnter))}}p[b]={cues:C,dateRange:L,durationKnown:k}}}}}class bL{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,s=this.levelDetails;if(!e||!s)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:o}=this.config;if(!l||o===1||!s.live)return;const f=this.targetLatency;if(f===null)return;const d=r-f,h=Math.min(this.maxLatency,f+s.targetduration);if(d<h&&d>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,o)),v=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,E=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(e,E)}else e.playbackRate!==1&&e.playbackRate!==0&&this.changeMediaPlaybackRate(e,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return((t=this.hls)==null?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(t.liveMaxLatencyDuration!==void 0)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(t===null||this.hls===null)return null;const{holdBack:e,partHoldBack:s,targetduration:r}=t,{liveSyncDuration:l,liveSyncDurationCount:o,lowLatencyMode:f}=this.config,d=this.hls.userConfig;let h=f&&s||e;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=l!==void 0?l:o*r);const g=r;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(t===null||e===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,l=t-e-this.edgeStalled,o=r-s.totalduration,f=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,l),f)}get drift(){const t=this.levelDetails;return t===null?1:t.drift}get edgeStalled(){const t=this.levelDetails;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const s=t.buffered.length;return(s?t.buffered.end(s-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var s;e.details===V.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var s,r;t.playbackRate!==e&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${t.playbackRate} to ${e}`),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}class LL extends Xf{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this),t.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this),t.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const s=this.hls.config.preferManagedMediaSource,r=[],l={},o={};let f=!1,d=!1,h=!1;e.levels.forEach(g=>{const p=g.attrs;let{audioCodec:v,videoCodec:E}=g;v&&(g.audioCodec=v=oo(v,s)||void 0),E&&(E=g.videoCodec=lx(E));const{width:S,height:A,unknownCodecs:b}=g,L=(b==null?void 0:b.length)||0;if(f||(f=!!(S&&A)),d||(d=!!E),h||(h=!!v),L||v&&!this.isAudioSupported(v)||E&&!this.isVideoSupported(E)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":D,"HDCP-LEVEL":C,"PATHWAY-ID":k,RESOLUTION:K,"VIDEO-RANGE":O}=p,$=`${`${k||"."}-`}${g.bitrate}-${K}-${D}-${_}-${O}-${C}`;if(l[$])if(l[$].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const U=o[$]+=1;g.attrs["PATHWAY-ID"]=new Array(U+1).join(".");const Q=this.createLevel(g);l[$]=Q,r.push(Q)}else l[$].addGroupId("audio",p.AUDIO),l[$].addGroupId("text",p.SUBTITLES);else{const U=this.createLevel(g);l[$]=U,o[$]=1,r.push(U)}}),this.filterAndSortMediaOptions(r,e,f,d,h)}createLevel(t){const e=new da(t),s=t.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),e.supportedResult=Kp(r,[])}return e}isAudioSupported(t){return fa(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return fa(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,s,r,l){var o;let f=[],d=[],h=t;const g=((o=e.stats)==null?void 0:o.parsing)||{};if((s||r)&&l&&(h=h.filter(({videoCodec:_,videoRange:D,width:C,height:k})=>(!!_||!!(C&&k))&&yx(D))),h.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",D=_;e.levels.length&&(D=`one or more CODECS in variant not supported: ${qt(e.levels.map(k=>k.attrs.CODECS).filter((k,K,O)=>O.indexOf(k)===K))}`,this.warn(D),_+=` (${D})`);const C=new Error(_);this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:V.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:C,reason:D})}}),g.end=performance.now();return}e.audioTracks&&(f=e.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),Rp(f)),e.subtitles&&(d=e.subtitles,Rp(d));const p=h.slice(0);h.sort((_,D)=>{if(_.attrs["HDCP-LEVEL"]!==D.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(D.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==D.height)return _.height-D.height;if(_.frameRate!==D.frameRate)return _.frameRate-D.frameRate;if(_.videoRange!==D.videoRange)return uo.indexOf(_.videoRange)-uo.indexOf(D.videoRange);if(_.videoCodec!==D.videoCodec){const C=ym(_.videoCodec),k=ym(D.videoCodec);if(C!==k)return k-C}if(_.uri===D.uri&&_.codecSet!==D.codecSet){const C=lo(_.codecSet),k=lo(D.codecSet);if(C!==k)return k-C}return _.averageBitrate!==D.averageBitrate?_.averageBitrate-D.averageBitrate:0});let v=p[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==p.length)){for(let _=0;_<p.length;_++)if(p[_].pathwayId===h[0].pathwayId){v=p[_];break}}this._levels=h;for(let _=0;_<h.length;_++)if(h[_]===v){var E;this._firstLevel=_;const D=v.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${h.length} level(s) found, first bitrate: ${D}`),((E=this.hls.userConfig)==null?void 0:E.abrEwmaDefaultEstimate)===void 0){const k=Math.min(D,this.hls.config.abrEwmaDefaultEstimateMax);k>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const S=l&&!r,A=this.hls.config,b=!!(A.audioStreamController&&A.audioTrackController),L={levels:h,audioTracks:f,subtitleTracks:d,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:l,video:r,altAudio:b&&!S&&f.some(_=>!!_.url)};g.end=performance.now(),this.hls.trigger(x.MANIFEST_PARSED,L)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const g=new Error("invalid level idx"),p=t<0;if(this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.LEVEL_SWITCH_ERROR,level:t,fatal:p,error:g,reason:g.message}),p)return;t=Math.min(t,e.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,l=r?r.attrs["PATHWAY-ID"]:void 0,o=e[t],f=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=o,s===t&&r&&l===f)return;this.log(`Switching to level ${t} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${f?" with Pathway "+f:""} from level ${s}${l?" with Pathway "+l:""}`);const d={level:t,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,d);const h=o.details;if(!h||h.live){const g=this.switchParams(o.uri,r==null?void 0:r.details,h);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),s=t.filter(r=>e.indexOf(r)!==-1);if(t.length<1){this.warn(`pathwayPriority ${t} should contain at least one pathway from list: ${e}`);return}this.steering.pathwayPriority=s}}onError(t,e){e.fatal||!e.context||e.context.type===Rt.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(e!==void 0&&e.type===dt.MAIN){const s=e.elementaryStreams;if(!Object.keys(s).some(l=>!!s[l]))return;const r=this._levels[e.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(t,e){var s;const{level:r,details:l}=e,o=e.levelInfo;if(!o){var f;this.warn(`Invalid level index ${r}`),(f=e.deliveryDirectives)!=null&&f.skip&&(l.deltaUpdateFailed=!0);return}if(o===this.currentLevel||e.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let d=o.details;d===e.details&&d.advanced&&(d=void 0),this.playlistLoaded(r,e,d)}else(s=e.deliveryDirectives)!=null&&s.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const s=this.getUrlWithDirectives(t.uri,e),r=this.currentLevelIndex,l=t.attrs["PATHWAY-ID"],o=t.details,f=o==null?void 0:o.age;this.log(`Loading level index ${r}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""}${l?" Pathway "+l:""}${f&&o.live?" age "+f.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(x.LEVEL_LOADING,{url:s,level:r,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(this._levels.length===1)return;const s=this._levels.filter((l,o)=>o!==t?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(f=>f.level=-1)),!1));hy(s),this._levels=s,this.currentLevelIndex>-1&&(e=this.currentLevel)!=null&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(x.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Rp(u){const t={};u.forEach(e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++})}function lv(){return self.SourceBuffer||self.WebKitSourceBuffer}function ov(){if(!Us())return!1;const t=lv();return!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function"}function RL(){if(!ov())return!1;const u=Us();return typeof(u==null?void 0:u.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>u.isTypeSupported(ha(t,"video")))||["mp4a.40.2","fLaC"].some(t=>u.isTypeSupported(ha(t,"audio"))))}function _L(){var u;const t=lv();return typeof(t==null||(u=t.prototype)==null?void 0:u.changeType)=="function"}const DL=100;class IL extends Gf{constructor(t,e,s){super(t,e,s,"stream-controller",dt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,l=r?r.currentTime:null;if(l===null||!ct(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const o=this.getFwdBufferInfoAtPos(r,l,dt.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(x.BUFFER_CREATED,this.onBufferCreated,this),t.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(x.BUFFER_CREATED,this.onBufferCreated,this),t.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(DL),this.level=-1,!this.startFragRequested){let l=r.startLevel;l===-1&&(r.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=r.firstAutoLevel),r.nextLoadLevel=l,this.level=r.loadLevel,this._hasEnoughToStart=!!e}s>0&&t===-1&&!e&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),t=s),this.state=J.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=J.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case J.WAITING_LEVEL:{const{levels:t,level:e}=this,s=t==null?void 0:t[e],r=s==null?void 0:s.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=J.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=J.IDLE;break}break}case J.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===J.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:s,media:r}=this;if(e===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?t.nextLoadLevel:t.loadLevel;if(!(s!=null&&s[l]))return;const o=s[l],f=this.getMainFwdBufferInfo();if(f===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(f,d)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(x.BUFFER_EOS,A),this.state=J.ENDED;return}if(!this.buffering)return;t.loadLevel!==l&&t.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=t.nextLoadLevel=l;const h=o.details;if(!h||this.state===J.WAITING_LEVEL||this.waitForLive(o)){this.level=l,this.state=J.WAITING_LEVEL,this.startFragRequested=!1;return}const g=f.len,p=this.getMaxBufferLength(o.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:f.end;let E=this.getNextFragment(v,h);if(this.couldBacktrack&&!this.fragPrevious&&E&&ae(E)&&this.fragmentTracker.getState(E)!==de.OK){var S;const b=((S=this.backtrackFragment)!=null?S:E).sn-h.startSN,L=h.fragments[b-1];L&&E.cc===L.cc&&(E=L,this.fragmentTracker.removeFragment(L))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,v)){if(!E.gap){const b=this.audioOnly&&!this.altAudio?Yt.AUDIO:Yt.VIDEO,L=(b===Yt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;L&&this.afterBufferFlushed(L,b,dt.MAIN)}E=this.getNextFragmentLoopLoading(E,h,f,dt.MAIN,p)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,o,v))}loadFragment(t,e,s){const r=this.fragmentTracker.getState(t);r===de.NOT_LOADED||r===de.PARTIAL?ae(t)?this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,s):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,dt.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let s;const r=this.getAppendedFrag(e.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const f=this.getMainFwdBufferInfo();if(!f||f.len<l.targetduration*2)return}if(!e.paused&&t){const f=this.hls.nextLoadLevel,d=t[f],h=this.fragLastKbps;h&&this.fragCurrent?s=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:s=0}else s=0;const o=this.getBufferedFrag(e.currentTime+s);if(o){const f=this.followingBufferedFrag(o);if(f){this.abortCurrentFrag();const d=f.maxStartPTS?f.maxStartPTS:f.start,h=f.duration,g=Math.max(o.end,d+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case J.KEY_LOADING:case J.FRAG_LOADING:case J.FRAG_LOADING_WAITING_RETRY:case J.PARSING:case J.PARSED:this.state=J.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio===2?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const s=e.media;ke(s,"playing",this.onMediaPlaying),ke(s,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:s}=this;s&&(He(s,"playing",this.onMediaPlaying),He(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e),!e.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let s=!1,r=!1;for(let l=0;l<e.levels.length;l++){const o=e.levels[l].audioCodec;o&&(s=s||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!_L(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:s}=this;if(!s||this.state!==J.IDLE)return;const r=e.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=J.WAITING_LEVEL)}onLevelLoaded(t,e){var s;const{levels:r,startFragRequested:l}=this,o=e.level,f=e.details,d=f.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${f.startSN},${f.endSN}]${f.lastPartSn?`[part-${f.lastPartSn}-${f.lastPartIndex}]`:""}, cc [${f.startCC}, ${f.endCC}] duration:${d}`);const h=e.levelInfo,g=this.fragCurrent;g&&(this.state===J.FRAG_LOADING||this.state===J.FRAG_LOADING_WAITING_RETRY)&&g.level!==e.level&&g.loader&&this.abortCurrentFrag();let p=0;if(f.live||(s=h.details)!=null&&s.live){var v;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;p=this.alignPlaylists(f,h.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(h.details=f,this.levelLastLoaded=h,l||this.setStartPosition(f,p),this.hls.trigger(x.LEVEL_UPDATED,{details:f,level:o}),this.state===J.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=J.IDLE}l&&f.live&&this.synchronizeToLiveEdge(f),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,l=this.getLoadPosition(),o=t.fragmentStart,f=t.edge,d=l>=o-e.maxFragLookUpTolerance&&l<=f;if(r!==null&&s.duration>r&&(l<r||!d)){const g=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!d&&s.readyState<4||l<f-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${f}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const p=Tt.bufferInfo(s,r,0);if(!((h=p.buffered)!=null&&h.length)){s.currentTime=r;return}if(p.start<=l){s.currentTime=r;return}const{nextStart:E}=Tt.bufferedInfo(p.buffered,l,0);E&&(s.currentTime=E)}else s.currentTime=r}}_handleFragmentLoadProgress(t){var e;const s=t.frag,{part:r,payload:l}=t,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const f=o[s.level];if(!f){this.warn(`Level ${s.level} not found on progress`);return}const d=f.details;if(!d){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const h=f.videoCodec,g=d.PTSKnown||!d.live,p=(e=s.initSegment)==null?void 0:e.data,v=this._getAudioCodec(f),E=this.transmuxer=this.transmuxer||new wy(this.hls,dt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=r?r.index:-1,A=S!==-1,b=new Bf(s.level,s.sn,s.stats.chunkCount,l.byteLength,S,A),L=this.initPTS[s.cc];E.push(l,p,v,h,s,r,d.totalduration,g,b,L)}onAudioTrackSwitching(t,e){const s=this.hls,r=this.altAudio!==0;if(co(e.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(x.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(x.AUDIO_TRACK_SWITCHED,e)}),s.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(x.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const s=co(e.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(t,e){const s=e.tracks;let r,l,o=!1;for(const f in s){const d=s[f];if(d.id==="main"){if(l=f,r=d,f==="video"){const h=s[f];h&&(this.videoBuffer=h.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:s,part:r}=e,l=s.type===dt.MAIN;if(l){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===J.PARSED&&(this.state=J.IDLE);return}const f=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*f.total/(f.buffering.end-f.loading.first)),ae(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Tt.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var s;if(e.fatal){this.state=J.ERROR;return}switch(e.details){case V.FRAG_GAP:case V.FRAG_PARSING_ERROR:case V.FRAG_DECRYPT_ERROR:case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(dt.MAIN,e);break;case V.LEVEL_LOAD_ERROR:case V.LEVEL_LOAD_TIMEOUT:case V.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===J.WAITING_LEVEL&&((s=e.context)==null?void 0:s.type)===Rt.LEVEL&&(this.state=J.IDLE);break;case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case V.BUFFER_FULL_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case V.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onFragLoadEmergencyAborted(){this.state=J.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Yt.AUDIO||!this.altAudio){const s=(e===Yt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,e,dt.MAIN),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let s=this.startPosition;if(s>=0&&e<s){if(t.seeking){this.log(`could not seek to ${s}, already seeking at ${e}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const l=this.getLevelDetails(),o=Tt.getBuffered(t),f=o.length?o.start(0):0,d=f-s,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<h||this.loadingParts&&d<2*((l==null?void 0:l.partTarget)||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),s+=d,this.startPosition=s),e<s&&(this.log(`seek to target start position ${s} from current time ${e} buffer start ${f}`),t.currentTime=s)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(s=>{const{hls:r}=this,l=s==null?void 0:s.frag;if(!l||this.fragContextChanged(l))return;e.fragmentError=0,this.state=J.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=l.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(x.FRAG_LOADED,s),l.bitrateTest=!1}).catch(s=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(s),this.resetFragmentLoading(t))})}_handleTransmuxComplete(t){const e=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:l}=t,o=this.getCurrentContext(l);if(!o){this.resetWhenMissingContext(l);return}const{frag:f,part:d,level:h}=o,{video:g,text:p,id3:v,initSegment:E}=r,{details:S}=h,A=this.altAudio?void 0:r.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=J.PARSING,E){const b=E.tracks;if(b){const C=f.initSegment||f;if(this.unhandledEncryptionError(E,f))return;this._bufferInitSegment(h,b,C,l),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:e,tracks:b})}const L=E.initPTS,_=E.timescale,D=this.initPTS[f.cc];if(ct(L)&&(!D||D.baseTime!==L||D.timescale!==_)){const C=E.trackId;this.initPTS[f.cc]={baseTime:L,timescale:_,trackId:C},s.trigger(x.INIT_PTS_FOUND,{frag:f,id:e,initPTS:L,timescale:_,trackId:C})}}if(g&&S){A&&g.type==="audiovideo"&&this.logMuxedErr(f);const b=S.fragments[f.sn-1-S.startSN],L=f.sn===S.startSN,_=!b||f.cc>b.cc;if(r.independent!==!1){const{startPTS:D,endPTS:C,startDTS:k,endDTS:K}=g;if(d)d.elementaryStreams[g.type]={startPTS:D,endPTS:C,startDTS:k,endDTS:K};else if(g.firstKeyFrame&&g.independent&&l.id===1&&!_&&(this.couldBacktrack=!0),g.dropped&&g.independent){const O=this.getMainFwdBufferInfo(),F=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,$=g.firstKeyFramePTS?g.firstKeyFramePTS:D;if(!L&&F<$-this.config.maxBufferHole&&!_){this.backtrack(f);return}else _&&(f.gap=!0);f.setElementaryStreamInfo(g.type,f.start,C,f.start,K,!0)}else L&&D-(S.appliedTimelineOffset||0)>ao&&(f.gap=!0);f.setElementaryStreamInfo(g.type,D,C,k,K),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(g,f,d,l,L||_)}else if(L||_)f.gap=!0;else{this.backtrack(f);return}}if(A){const{startPTS:b,endPTS:L,startDTS:_,endDTS:D}=A;d&&(d.elementaryStreams[Yt.AUDIO]={startPTS:b,endPTS:L,startDTS:_,endDTS:D}),f.setElementaryStreamInfo(Yt.AUDIO,b,L,_,D),this.bufferFragmentData(A,f,d,l)}if(S&&v!=null&&v.samples.length){const b={id:e,frag:f,details:S,samples:v.samples};s.trigger(x.FRAG_PARSING_METADATA,b)}if(S&&p){const b={id:e,frag:f,details:S,samples:p.samples};s.trigger(x.FRAG_PARSING_USERDATA,b)}}logMuxedErr(t){this.warn(`${ae(t)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${t.url}`)}_bufferInitSegment(t,e,s,r){if(this.state!==J.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(s));const{audio:l,video:o,audiovideo:f}=e;if(l){const h=t.audioCodec;let g=Jl(l.codec,h);g==="mp4a"&&(g="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){g&&(g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5");const v=l.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(g="mp4a.40.5")}g&&g.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(g="mp4a.40.2",this.log(`Android: force audio codec to ${g}`)),h&&h!==g&&this.log(`Swapping manifest audio codec "${h}" for "${g}"`),l.levelCodec=g,l.id=dt.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${g||""}/${h||""}/${l.codec}]`),delete e.audiovideo}if(o){o.levelCodec=t.videoCodec,o.id=dt.MAIN;const h=o.codec;if((h==null?void 0:h.length)===4)switch(h){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${t.videoCodec||""}/${h}]${o.codec!==h?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete e.audiovideo}f&&(this.log(`Init audiovideo buffer, container:${f.container}, codecs[level/parsed]=[${t.codecs}/${f.codec}]`),delete e.video,delete e.audio);const d=Object.keys(e);if(d.length){if(this.hls.trigger(x.BUFFER_CODECS,e),!this.hls)return;d.forEach(h=>{const p=e[h].initSegment;p!=null&&p.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:h,data:p,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,dt.MAIN)}get maxBufferLength(){const{levels:t,level:e}=this,s=t==null?void 0:t[e];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=J.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const s=t.currentTime;if(Tt.isBuffered(t,s)?e=this.getAppendedFrag(s):Tt.isBuffered(t,s+.1)&&(e=this.getAppendedFrag(s+.1)),e){this.backtrackFragment=null;const r=this.fragPlaying,l=e.level;(!r||e.sn!==r.sn||r.level!==l)&&(this.fragPlaying=e,this.hls.trigger(x.FRAG_CHANGED,{frag:e}),(!r||r.level!==l)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return ct(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(ct(e)){const s=this.getLevelDetails(),r=this.currentFrag||(s?un(null,s.fragments,e):null);if(r){const l=r.programDateTime;if(l!==null){const o=l+(e-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class CL extends pi{constructor(t,e){super("key-loader",e),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var e;if(t&&t!==((e=r.context)==null?void 0:e.frag.type))return;r.abort()}}}detach(){for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t].loader;e&&e.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(t,e=V.KEY_LOAD_ERROR,s,r,l){return new ns({type:pt.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:l,error:s,networkDetails:r})}loadClear(t,e,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length)for(let r=0,l=e.length;r<l;r++){const o=e[r];if(t.cc<=o.cc&&(!ae(t)||!ae(o)||t.sn<o.sn)||!s&&r==l-1)return this.emeController.selectKeySystemFormat(o).then(f=>{if(!this.emeController)return;o.setKeyFormat(f);const d=eo(f);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const r=la(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var s,r;e&&t.setKeyFormat(e);const l=t.decryptdata;if(!l){const h=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(t,V.KEY_LOAD_ERROR,h))}const o=l.uri;if(!o)return Promise.reject(this.createKeyLoadError(t,V.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const f=uf(l);let d=this.keyIdToKeyInfo[f];if((s=d)!=null&&s.decryptdata.key)return l.key=d.decryptdata.key,Promise.resolve({frag:t,keyInfo:d});if(this.emeController&&(r=d)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(g=>{const{keyInfo:p}=g;return l.key=p.decryptdata.key,{frag:t,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[f]?"Rel":"L"}oading${l.keyId?" keyId: "+Re(l.keyId):""} URI: ${l.uri} from ${t.type} ${t.level}`),d=this.keyIdToKeyInfo[f]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(d,t):this.loadKeyEME(d,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,t);default:return Promise.reject(this.createKeyLoadError(t,V.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(t,e){const s={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var r;if(!t.decryptdata.keyId&&(r=e.initSegment)!=null&&r.data){const o=XT(e.initSegment.data);if(o.length){let f=o[0];f.some(d=>d!==0)?(this.log(`Using keyId found in init segment ${Re(f)}`),Ps.setKeyIdForUri(t.decryptdata.uri,f)):(f=Ps.addKeyIdForUri(t.decryptdata.uri),this.log(`Generating keyId to patch media ${Re(f)}`)),t.decryptdata.keyId=f}}if(!t.decryptdata.keyId&&!ae(e))return Promise.resolve(s);const l=this.emeController.loadKey(s);return(t.keyLoadPromise=l.then(o=>(t.mediaKeySessionContext=o,s))).catch(o=>{throw t.keyLoadPromise=null,"data"in o&&(o.data.frag=e),o})}return Promise.resolve(s)}loadKeyHTTP(t,e){const s=this.config,r=s.loader,l=new r(s);return e.keyLoader=t.loader=l,t.keyLoadPromise=new Promise((o,f)=>{const d={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},h=s.keyLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,E,S,A)=>{const{frag:b,keyInfo:L}=S,_=uf(L.decryptdata);if(!b.decryptdata||L!==this.keyIdToKeyInfo[_])return f(this.createKeyLoadError(b,V.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));L.decryptdata.key=b.decryptdata.key=new Uint8Array(v.data),b.keyLoader=null,L.loader=null,o({frag:b,keyInfo:L})},onError:(v,E,S,A)=>{this.resetLoader(E),f(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),S,$t({url:d.url,data:void 0},v)))},onTimeout:(v,E,S)=>{this.resetLoader(E),f(this.createKeyLoadError(e,V.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(v,E,S)=>{this.resetLoader(E),f(this.createKeyLoadError(e,V.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};l.load(d,g,p)})}resetLoader(t){const{frag:e,keyInfo:s,url:r}=t,l=s.loader;e.keyLoader===l&&(e.keyLoader=null,s.loader=null);const o=uf(s.decryptdata)||r;delete this.keyIdToKeyInfo[o],l&&l.destroy()}}function uf(u){if(u.keyFormat!==_e.FAIRPLAY){const t=u.keyId;if(t)return Re(t)}return u.uri}function _p(u){const{type:t}=u;switch(t){case Rt.AUDIO_TRACK:return dt.AUDIO;case Rt.SUBTITLE_TRACK:return dt.SUBTITLE;default:return dt.MAIN}}function cf(u,t){let e=u.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class OL{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_LOADING,this.onLevelLoading,this),t.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,s=e.pLoader,r=e.loader,l=s||r,o=new l(e);return this.loaders[t.type]=o,o}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:s}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Rt.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:s,level:r,pathwayId:l,url:o,deliveryDirectives:f,levelInfo:d}=e;this.load({id:s,level:r,pathwayId:l,responseType:"text",type:Rt.LEVEL,url:o,deliveryDirectives:f,levelOrTrack:d})}onAudioTrackLoading(t,e){const{id:s,groupId:r,url:l,deliveryDirectives:o,track:f}=e;this.load({id:s,groupId:r,level:null,responseType:"text",type:Rt.AUDIO_TRACK,url:l,deliveryDirectives:o,levelOrTrack:f})}onSubtitleTrackLoading(t,e){const{id:s,groupId:r,url:l,deliveryDirectives:o,track:f}=e;this.load({id:s,groupId:r,level:null,responseType:"text",type:Rt.SUBTITLE_TRACK,url:l,deliveryDirectives:o,levelOrTrack:f})}onLevelsUpdated(t,e){const s=this.loaders[Rt.LEVEL];if(s){const r=s.context;r&&!e.levels.some(l=>l===r.levelOrTrack)&&(s.abort(),delete this.loaders[Rt.LEVEL])}}load(t){var e;const s=this.hls.config;let r=this.getInternalLoader(t);if(r){const h=this.hls.logger,g=r.context;if(g&&g.levelOrTrack===t.levelOrTrack&&(g.url===t.url||g.deliveryDirectives&&!t.deliveryDirectives)){g.url===t.url?h.log(`[playlist-loader]: ignore ${t.url} ongoing request`):h.log(`[playlist-loader]: ignore ${t.url} in favor of ${g.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),r.abort()}let l;if(t.type===Rt.MANIFEST?l=s.manifestLoadPolicy.default:l=Kt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(t),ct((e=t.deliveryDirectives)==null?void 0:e.part)){let h;if(t.type===Rt.LEVEL&&t.level!==null?h=this.hls.levels[t.level].details:t.type===Rt.AUDIO_TRACK&&t.id!==null?h=this.hls.audioTracks[t.id].details:t.type===Rt.SUBTITLE_TRACK&&t.id!==null&&(h=this.hls.subtitleTracks[t.id].details),h){const g=h.partTarget,p=h.targetduration;if(g&&p){const v=Math.max(g*3,p*.8)*1e3;l=Kt({},l,{maxTimeToFirstByteMs:Math.min(v,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,l.maxTimeToFirstByteMs)})}}}const o=l.errorRetry||l.timeoutRetry||{},f={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},d={onSuccess:(h,g,p,v)=>{const E=this.getInternalLoader(p);this.resetInternalLoader(p.type);const S=h.data;g.parsing.start=performance.now(),wi.isMediaPlaylist(S)||p.type!==Rt.MANIFEST?this.handleTrackOrLevelPlaylist(h,g,p,v||null,E):this.handleMasterPlaylist(h,g,p,v)},onError:(h,g,p,v)=>{this.handleNetworkError(g,p,!1,h,v)},onTimeout:(h,g,p)=>{this.handleNetworkError(g,p,!0,void 0,h)}};r.load(t,f,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:s}=this.hls;(t||s)&&(this.hls.logger.log(`${t?"auto":"force"} startLoad with configured startPosition ${e}`),this.hls.startLoad(e))}handleMasterPlaylist(t,e,s,r){const l=this.hls,o=t.data,f=cf(t,s),d=wi.parseMasterPlaylist(o,f);if(d.playlistParsingError){e.parsing.end=performance.now(),this.handleManifestParsingError(t,s,d.playlistParsingError,r,e);return}const{contentSteering:h,levels:g,sessionData:p,sessionKeys:v,startTimeOffset:E,variableList:S}=d;this.variableList=S,g.forEach(_=>{const{unknownCodecs:D}=_;if(D){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:k,videoCodec:K}=_;for(let O=D.length;O--;){const F=D[O];fa(F,"audio",C)?(_.audioCodec=k=k?`${k},${F}`:F,lr.audio[k.substring(0,4)]=2,D.splice(O,1)):fa(F,"video",C)&&(_.videoCodec=K=K?`${K},${F}`:F,lr.video[K.substring(0,4)]=2,D.splice(O,1))}}});const{AUDIO:A=[],SUBTITLES:b,"CLOSED-CAPTIONS":L}=wi.parseMasterPlaylistMedia(o,f,d);A.length&&!A.some(D=>!D.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Zt({}),bitrate:0,url:""})),l.trigger(x.MANIFEST_LOADED,{levels:g,audioTracks:A,subtitles:b,captions:L,contentSteering:h,url:f,stats:e,networkDetails:r,sessionData:p,sessionKeys:v,startTimeOffset:E,variableList:S})}handleTrackOrLevelPlaylist(t,e,s,r,l){const o=this.hls,{id:f,level:d,type:h}=s,g=cf(t,s),p=ct(d)?d:ct(f)?f:0,v=_p(s),E=wi.parseLevelPlaylist(t.data,g,p,v,0,this.variableList);if(h===Rt.MANIFEST){const S={attrs:new Zt({}),bitrate:0,details:E,name:"",url:g};E.requestScheduled=e.loading.start+uy(E,0),o.trigger(x.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:g,stats:e,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),s.levelDetails=E,this.handlePlaylistLoaded(E,t,e,s,r,l)}handleManifestParsingError(t,e,s,r,l){this.hls.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:V.MANIFEST_PARSING_ERROR,fatal:e.type===Rt.MANIFEST,url:t.url,err:s,error:s,reason:s.message,response:t,context:e,networkDetails:r,stats:l})}handleNetworkError(t,e,s=!1,r,l){let o=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${t.type}`;t.type===Rt.LEVEL?o+=`: ${t.level} id: ${t.id}`:(t.type===Rt.AUDIO_TRACK||t.type===Rt.SUBTITLE_TRACK)&&(o+=` id: ${t.id} group-id: "${t.groupId}"`);const f=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let d=V.UNKNOWN,h=!1;const g=this.getInternalLoader(t);switch(t.type){case Rt.MANIFEST:d=s?V.MANIFEST_LOAD_TIMEOUT:V.MANIFEST_LOAD_ERROR,h=!0;break;case Rt.LEVEL:d=s?V.LEVEL_LOAD_TIMEOUT:V.LEVEL_LOAD_ERROR,h=!1;break;case Rt.AUDIO_TRACK:d=s?V.AUDIO_TRACK_LOAD_TIMEOUT:V.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Rt.SUBTITLE_TRACK:d=s?V.SUBTITLE_TRACK_LOAD_TIMEOUT:V.SUBTITLE_LOAD_ERROR,h=!1;break}g&&this.resetInternalLoader(t.type);const p={type:pt.NETWORK_ERROR,details:d,fatal:h,url:t.url,loader:g,context:t,error:f,networkDetails:e,stats:l};if(r){const v=(e==null?void 0:e.url)||t.url;p.response=$t({url:v,data:void 0},r)}this.hls.trigger(x.ERROR,p)}handlePlaylistLoaded(t,e,s,r,l,o){const f=this.hls,{type:d,level:h,levelOrTrack:g,id:p,groupId:v,deliveryDirectives:E}=r,S=cf(e,r),A=_p(r);let b=typeof r.level=="number"&&A===dt.MAIN?h:void 0;const L=t.playlistParsingError;if(L){if(this.hls.logger.warn(`${L} ${t.url}`),!f.config.ignorePlaylistParsingErrors){f.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:V.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:L,reason:L.message,response:e,context:r,level:b,parent:A,networkDetails:l,stats:s});return}t.playlistParsingError=null}if(!t.fragments.length){const _=t.playlistParsingError=new Error("No Segments found in Playlist");f.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:V.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:_,reason:_.message,response:e,context:r,level:b,parent:A,networkDetails:l,stats:s});return}switch(t.live&&o&&(o.getCacheAge&&(t.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),d){case Rt.MANIFEST:case Rt.LEVEL:if(b){if(!g)b=0;else if(g!==f.levels[b]){const _=f.levels.indexOf(g);_>-1&&(b=_)}}f.trigger(x.LEVEL_LOADED,{details:t,levelInfo:g||f.levels[0],level:b||0,id:p||0,stats:s,networkDetails:l,deliveryDirectives:E,withoutMultiVariant:d===Rt.MANIFEST});break;case Rt.AUDIO_TRACK:f.trigger(x.AUDIO_TRACK_LOADED,{details:t,track:g,id:p||0,groupId:v||"",stats:s,networkDetails:l,deliveryDirectives:E});break;case Rt.SUBTITLE_TRACK:f.trigger(x.SUBTITLE_TRACK_LOADED,{details:t,track:g,id:p||0,groupId:v||"",stats:s,networkDetails:l,deliveryDirectives:E});break}}}class ii{static get version(){return ga}static isMSESupported(){return ov()}static isSupported(){return RL()}static getMediaSource(){return Us()}static get Events(){return x}static get MetadataSchema(){return ei}static get ErrorTypes(){return pt}static get ErrorDetails(){return V}static get DefaultConfig(){return ii.defaultConfig?ii.defaultConfig:gL}static set DefaultConfig(t){ii.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Hf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const e=this.logger=UT(t.debug||!1,"Hls instance",t.assetPlayerId),s=this.config=pL(ii.DefaultConfig,t,e);this.userConfig=t,s.progressive&&yL(s,e);const{abrController:r,bufferController:l,capLevelController:o,errorController:f,fpsController:d}=s,h=new f(this),g=this.abrController=new r(this),p=new Mx(this),v=s.interstitialsController,E=v?this.interstitialsController=new v(this,ii):null,S=this.bufferController=new l(this,p),A=this.capLevelController=new o(this),b=new d(this),L=new OL(this),_=s.contentSteeringController,D=_?new _(this):null,C=this.levelController=new LL(this,D),k=new AL(this),K=new CL(this.config,this.logger),O=this.streamController=new IL(this,p,K),F=this.gapController=new TL(this,p);A.setStreamController(O),b.setStreamController(O);const $=[L,C,O];E&&$.splice(1,0,E),D&&$.splice(1,0,D),this.networkControllers=$;const U=[g,S,F,A,b,k,p];this.audioTrackController=this.createController(s.audioTrackController,$);const Q=s.audioStreamController;Q&&$.push(this.audioStreamController=new Q(this,p,K)),this.subtitleTrackController=this.createController(s.subtitleTrackController,$);const st=s.subtitleStreamController;st&&$.push(this.subtititleStreamController=new st(this,p,K)),this.createController(s.timelineController,U),K.emeController=this.emeController=this.createController(s.emeController,U),this.cmcdController=this.createController(s.cmcdController,U),this.latencyController=this.createController(bL,U),this.coreComponents=U,$.push(h);const ut=h.onErrorOut;typeof ut=="function"&&this.on(x.ERROR,ut,h),this.on(x.MANIFEST_LOADED,L.onManifestLoaded,L)}createController(t,e){if(t){const s=new t(this);return e&&e.push(s),s}return null}on(t,e,s=this){this._emitter.on(t,e,s)}once(t,e,s=this){this._emitter.once(t,e,s)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,s=this,r){this._emitter.off(t,e,s,r)}listeners(t){return this._emitter.listeners(t)}emit(t,e,s){return this._emitter.emit(t,e,s)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(s){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=t===x.ERROR;this.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,fatal:r,event:t,error:s}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){const l=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:V.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const e="media"in t,s=e?t.media:t,r=e?t:{media:s};this._media=s,this.trigger(x.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const t=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();const e=this.media,s=this._url,r=this._url=Of.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),e&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(x.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,e){this.logger.log(`startLoad(${t+(e?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(t,e),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){const t={[dt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[dt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[dt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const t=this._media,e=t==null?void 0:t.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=T1()),t}get levels(){const t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){const{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){px(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const s=t.length;for(let r=0;r<s;r++)if(t[r].maxBitrate>=e)return r;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:s}=this;let r;if(e===-1&&t!=null&&t.length?r=t.length-1:r=e,s)for(let l=r;l--;){const o=t[l].attrs["HDCP-LEVEL"];if(o&&o<=s)return l}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(t))||null}setSubtitleOption(t){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(t))||null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,e=this.allAudioTracks){const s=qp(e);return jp(t,s,navigator.mediaCapabilities)}}ii.defaultConfig=void 0;const ML=({channel:u})=>{const t=Jt.useRef(null),[e,s]=Jt.useState(null),[r,l]=Jt.useState(!1),o=Jt.useRef(0),f=3;return Jt.useEffect(()=>{if(!u||!t.current){s(null),o.current=0;return}const d=t.current;let h=null;return s(null),o.current=0,(()=>{const p=window.location.protocol==="https:",v=u.url.startsWith("http:");if(p&&v){s({message:"Secure Connection Block: This stream uses HTTP, but SwagTV is running on HTTPS. Browsers block this for your security. Try an HTTPS stream or use a browser extension that allows mixed content.",type:"network",details:"Mixed Content Error"});return}ii.isSupported()?(h=new ii({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,manifestLoadingMaxRetry:2,manifestLoadingRetryDelay:1e3,xhrSetup:E=>{E.withCredentials=!1}}),h.loadSource(u.url),h.attachMedia(d),h.on(ii.Events.MANIFEST_PARSED,()=>{s(null),o.current=0,d.play().catch(E=>{console.warn("Autoplay blocked by browser. User interaction required.",E)})}),h.on(ii.Events.ERROR,(E,S)=>{var A;if(S.fatal){const b=(A=S.response)==null?void 0:A.code;switch(console.error(`[SwagTV] Fatal Player Error: ${S.details}`,{type:S.type,status:b,url:u.url,data:S}),S.type){case ii.ErrorTypes.NETWORK_ERROR:if(S.details==="manifestLoadError"){let L=`Manifest Load Error (Status ${b||"0/CORS"}).`;b===0?L="CORS Policy Restriction: The stream provider has blocked access from this website. This is a common security setting on their server.":b===404?L="Stream Not Found (404): The link has expired or is temporarily down.":b===403&&(L="Forbidden (403): You don't have permission to access this stream, or it requires a valid token."),s({message:L,type:"network",details:S.details,status:b}),h==null||h.destroy()}else o.current<f?(console.log(`Retrying network error (${o.current+1}/${f})...`),o.current++,h==null||h.startLoad()):s({message:`Connection persistent failure: ${S.details}.`,type:"network",details:S.details,status:b});break;case ii.ErrorTypes.MEDIA_ERROR:console.log("Media stall detected. Recovering..."),l(!0),h==null||h.recoverMediaError(),setTimeout(()=>l(!1),2e3);break;default:s({message:`Playback interrupted: ${S.details}`,type:"other",details:S.details}),h==null||h.destroy();break}}})):d.canPlayType("application/vnd.apple.mpegurl")&&(d.src=u.url,d.addEventListener("loadedmetadata",()=>{d.play().catch(E=>console.error("Native play failed",E))}),d.addEventListener("error",()=>{const E=d.error;s({message:"This browser encountered a native playback error. The stream might be offline or region-locked.",type:"network",details:`Native Error: ${(E==null?void 0:E.message)||"Code "+(E==null?void 0:E.code)}`})}))})(),()=>{h&&h.destroy()}},[u]),u?G.jsxs("div",{className:"relative aspect-video w-full rounded-xl overflow-hidden glass border border-white/10 shadow-2xl bg-black group",children:[e&&!r&&G.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/95 backdrop-blur-xl p-8 text-center animate-in fade-in duration-500",children:[e.details==="Mixed Content Error"?G.jsx(yT,{size:48,className:"text-orange-500 mb-6 drop-shadow-[0_0_15px_rgba(249,115,22,0.5)]"}):G.jsx(Cp,{size:48,className:"text-red-500 mb-6 drop-shadow-[0_0_15px_rgba(239,68,68,0.5)]"}),G.jsx("h3",{className:"text-xl font-black text-white mb-3 tracking-tighter uppercase italic",children:e.status===0?"CORS ACCESS DENIED":"BROADCAST FAILED"}),G.jsx("p",{className:"text-sm text-slate-400 max-w-md mb-8 leading-relaxed font-medium",children:e.message}),G.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[G.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2.5 bg-white/10 hover:bg-white/20 rounded-full text-xs font-black uppercase tracking-widest transition-all border border-white/10 text-white active:scale-95",children:"Reload Page"}),G.jsx("button",{onClick:()=>s(null),className:"px-6 py-2.5 bg-green-500 hover:bg-green-400 rounded-full text-xs font-black uppercase tracking-widest transition-all text-black shadow-lg shadow-green-500/20 active:scale-95",children:"Switch Channel"})]}),G.jsxs("div",{className:"mt-12 pt-6 border-t border-white/5 w-full max-w-sm flex items-center justify-between text-[9px] font-bold uppercase tracking-[0.2em] text-slate-600",children:[G.jsxs("span",{children:["ERROR: ",e.details]}),e.status!==void 0&&G.jsxs("span",{children:["HTTP: ",e.status]})]})]}),r&&G.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/60 backdrop-blur-md",children:[G.jsxs("div",{className:"relative mb-6",children:[G.jsx(gT,{size:40,className:"text-green-400 animate-spin"}),G.jsx("div",{className:"absolute inset-0 animate-ping opacity-20 bg-green-400 rounded-full"})]}),G.jsx("span",{className:"text-xs font-black uppercase tracking-[0.3em] text-white italic",children:"Signal Recovery in Progress..."})]}),G.jsx("video",{ref:t,controls:!0,playsInline:!0,crossOrigin:"anonymous",className:`w-full h-full transition-opacity duration-700 ${e?"opacity-10":"opacity-100"}`}),G.jsxs("div",{className:"absolute top-6 left-6 pointer-events-none z-10 flex items-center gap-3",children:[G.jsxs("div",{className:"flex items-center gap-2.5 px-3.5 py-2 rounded-xl bg-black/60 backdrop-blur-xl border border-white/10 shadow-2xl",children:[G.jsx("div",{className:"relative flex items-center justify-center",children:G.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-red-600 animate-pulse shadow-[0_0_8px_rgba(220,38,38,0.8)]"})}),G.jsx("div",{className:"h-4 w-[1px] bg-white/10 mx-0.5"}),G.jsxs("span",{className:"text-[11px] font-black text-white uppercase tracking-[0.25em] italic",children:["SWAG",G.jsx("span",{className:"text-green-400",children:"TV"})," LIVE"]})]}),G.jsx("div",{className:"px-3 py-2 rounded-xl bg-green-500/10 backdrop-blur-xl border border-green-500/20 text-[10px] font-black text-green-400 uppercase tracking-widest group-hover:opacity-100 opacity-0 transition-opacity duration-300",children:u.name})]})]}):G.jsxs("div",{className:"aspect-video w-full glass rounded-xl flex items-center justify-center border border-white/5 text-slate-500 overflow-hidden relative group",children:[G.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-500/5 to-transparent opacity-50"}),G.jsxs("div",{className:"text-center p-6 relative z-10",children:[G.jsx("div",{className:"w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4 border border-white/5 group-hover:scale-110 transition-transform duration-500",children:G.jsx(Op,{size:32,className:"text-slate-600"})}),G.jsx("p",{className:"font-bold mb-1 text-slate-300 tracking-tight",children:"SwagTV Match Center"}),G.jsx("p",{className:"text-[10px] uppercase tracking-widest text-slate-500",children:"Select a channel to begin broadcast"})]})]})},kL=()=>{const[u,t]=Jt.useState([]),[e,s]=Jt.useState(null),[r,l]=Jt.useState(),[o,f]=Jt.useState(),[d,h]=Jt.useState(!0),[g,p]=Jt.useState(!1),[v,E]=Jt.useState(""),S=Jt.useMemo(()=>zS(VS),[]),[A,b]=Jt.useState(null);Jt.useEffect(()=>{S.length>0&&!A&&b(S[0])},[S,A]);const L=Jt.useCallback(async()=>{h(!0);try{const C=await $S();t(C)}catch(C){console.error("Failed to load matches:",C)}finally{h(!1)}},[]);Jt.useEffect(()=>{L();const C=setInterval(L,6e4);return()=>clearInterval(C)},[L]);const _=async C=>{s(C),p(!0);const[k,K]=await Promise.all([GS(C.homeTeam,C.awayTeam),HS(C.homeTeam,C.awayTeam)]);l(k),f(K),p(!1)},D=u.filter(C=>C.homeTeam.toLowerCase().includes(v.toLowerCase())||C.awayTeam.toLowerCase().includes(v.toLowerCase())||C.league.toLowerCase().includes(v.toLowerCase()));return G.jsxs("div",{className:"min-h-screen flex flex-col bg-[#020617] text-slate-100",children:[G.jsx("header",{className:"glass sticky top-0 z-50 border-b border-white/5 backdrop-blur-xl",children:G.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 h-20 flex items-center justify-between gap-4",children:[G.jsxs("div",{className:"flex items-center gap-4",children:[G.jsx("div",{className:"bg-green-500 p-2.5 rounded-xl shadow-[0_0_20px_rgba(34,197,94,0.3)]",children:G.jsx(cm,{className:"text-white fill-white",size:24})}),G.jsxs("div",{className:"hidden sm:block",children:[G.jsxs("h1",{className:"text-2xl font-black tracking-tighter italic leading-none",children:["SWAG",G.jsx("span",{className:"text-green-500",children:"TV"}),G.jsx("span",{className:"text-slate-500 opacity-50 ml-1",children:"OFFICIAL"})]}),G.jsx("p",{className:"text-[10px] uppercase font-black text-green-500/60 tracking-[0.3em] mt-1",children:"Live Sports Infrastructure"})]})]}),G.jsxs("div",{className:"flex-1 max-w-xl relative group",children:[G.jsx(um,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-green-500 transition-colors",size:18}),G.jsx("input",{type:"text",placeholder:"Search live fixtures, leagues, or teams...",className:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 pl-12 pr-6 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/30 focus:border-green-500 transition-all placeholder:text-slate-600",value:v,onChange:C=>E(C.target.value)})]}),G.jsxs("div",{className:"flex items-center gap-3",children:[G.jsx("button",{onClick:L,className:"p-3 rounded-xl bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-all active:scale-95 border border-white/5",children:G.jsx(hT,{size:20,className:d?"animate-spin":""})}),G.jsxs("a",{href:"https://github.com",target:"_blank",className:"hidden lg:flex items-center gap-2 px-5 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-xs font-bold transition-all",children:[G.jsx(rT,{size:16}),G.jsx("span",{children:"SOURCE"})]})]})]})}),G.jsxs("main",{className:"flex-1 max-w-7xl mx-auto w-full px-4 md:px-8 py-10",children:[G.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12",children:[G.jsxs("div",{className:"lg:col-span-8 flex flex-col gap-6",children:[G.jsx(ML,{channel:A}),G.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 p-6 glass rounded-2xl border border-white/5",children:[G.jsxs("div",{children:[G.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[G.jsx("h2",{className:"text-2xl font-black tracking-tight uppercase italic",children:(A==null?void 0:A.name.replace(" FEATURED: ",""))||"Broadcast Standby"}),(A==null?void 0:A.name.includes("FEATURED"))&&G.jsx("span",{className:"px-2.5 py-1 bg-green-500 text-[10px] text-black rounded-lg font-black uppercase tracking-tighter shadow-lg shadow-green-500/20",children:"Verified Link"})]}),G.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-widest",children:[G.jsx(lT,{size:12,className:"text-green-500"}),"Global Node Routing Enabled  Ultra Low Latency"]})]}),G.jsxs("div",{className:"flex items-center gap-3",children:[G.jsx("button",{className:"flex-1 md:flex-none px-6 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-xs font-black uppercase tracking-widest transition-all border border-white/5",children:"Report Issue"}),G.jsx("button",{className:"flex-1 md:flex-none px-6 py-3 bg-green-500 hover:bg-green-400 text-black rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-xl shadow-green-500/20 active:scale-95",children:"Support SwagTV"})]})]})]}),G.jsx("div",{className:"lg:col-span-4 flex flex-col",children:G.jsxs("div",{className:"glass h-full rounded-2xl overflow-hidden border border-white/10 flex flex-col shadow-2xl",children:[G.jsxs("div",{className:"px-6 py-5 border-b border-white/10 flex items-center justify-between bg-white/[0.02]",children:[G.jsxs("div",{className:"flex items-center gap-3",children:[G.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center",children:G.jsx(LT,{size:18,className:"text-green-500"})}),G.jsx("h2",{className:"font-black text-sm tracking-[0.2em] uppercase italic",children:"Signal Feed"})]}),G.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-green-500/10 border border-green-500/20",children:[G.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),G.jsx("span",{className:"text-[10px] font-black text-green-500 tracking-tighter",children:"SECURE"})]})]}),G.jsx("div",{className:"flex-1 overflow-y-auto max-h-[500px] lg:max-h-[580px] p-5 space-y-3 custom-scrollbar",children:S.map((C,k)=>G.jsxs("button",{onClick:()=>b(C),className:`w-full text-left p-4 rounded-xl border-2 transition-all flex items-center justify-between group relative overflow-hidden ${(A==null?void 0:A.url)===C.url?"bg-green-500/10 border-green-500/40 text-green-400 shadow-[inset_0_0_20px_rgba(34,197,94,0.05)]":"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20 text-slate-400"}`,children:[G.jsxs("div",{className:"flex items-center gap-4 truncate relative z-10",children:[G.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${(A==null?void 0:A.url)===C.url?"bg-green-500 text-black":"bg-white/10"}`,children:G.jsx(iT,{size:16,fill:(A==null?void 0:A.url)===C.url?"currentColor":"none"})}),G.jsx("span",{className:"text-xs font-black uppercase tracking-wider truncate",children:C.name.replace(" FEATURED: ","")})]}),G.jsx(WS,{size:14,className:`relative z-10 transition-opacity shrink-0 ${(A==null?void 0:A.url)===C.url?"opacity-100":"opacity-0 group-hover:opacity-100"}`})]},k))})]})})]}),G.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-10",children:[G.jsxs("div",{className:"lg:col-span-7 xl:col-span-8 flex flex-col gap-8",children:[G.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 pb-4",children:[G.jsxs("h2",{className:"text-xl font-black italic flex items-center gap-3 tracking-tight",children:[G.jsx("div",{className:"w-1.5 h-8 bg-green-500 rounded-full"}),"LIVE FIXTURES ENGINE"]}),G.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-white/5 rounded-lg border border-white/5",children:[G.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),G.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:[D.length," Matches Detected"]})]})]}),d?G.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[1,2,3,4].map(C=>G.jsx("div",{className:"h-48 glass animate-pulse rounded-2xl border border-white/5"},C))}):D.length>0?G.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:D.map(C=>G.jsx(_T,{match:C,onSelect:_,isSelected:(e==null?void 0:e.id)===C.id},C.id))}):G.jsxs("div",{className:"flex flex-col items-center justify-center h-80 glass rounded-3xl border-2 border-dashed border-white/5 text-slate-600",children:[G.jsx(um,{size:64,className:"mb-6 opacity-10"}),G.jsx("p",{className:"font-black uppercase tracking-[0.2em] text-sm",children:"No Active Match Signals"}),G.jsx("button",{onClick:()=>E(""),className:"mt-4 text-green-500 text-xs font-black uppercase tracking-widest hover:text-green-400 transition-colors",children:"Reset Filter Engine"})]})]}),G.jsxs("div",{className:"lg:col-span-5 xl:col-span-4 flex flex-col gap-8",children:[G.jsxs("div",{className:"p-6 rounded-3xl bg-gradient-to-br from-green-500/10 via-blue-500/5 to-purple-600/10 border border-white/10 shadow-xl",children:[G.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[G.jsx(cm,{size:20,className:"text-green-500"}),G.jsx("h3",{className:"text-sm font-black uppercase tracking-[0.2em] italic",children:"Tactical AI Layer"})]}),G.jsx("p",{className:"text-xs text-slate-400 leading-relaxed font-medium",children:"SwagTV utilizes Gemini Flash 1.5 to aggregate real-time data, tactical formations, and probability models. Select a fixture to activate."})]}),G.jsx(DT,{streamingInfo:r,analysisInfo:o,isLoading:g})]})]}),G.jsxs("footer",{className:"mt-20 pt-10 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-8",children:[G.jsxs("div",{className:"max-w-md text-center md:text-left",children:[G.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-3 mb-4",children:[G.jsx(ET,{size:20,className:"text-green-500"}),G.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.3em] text-slate-400",children:"SwagTV Compliance Policy"})]}),G.jsx("p",{className:"text-[10px] text-slate-600 leading-relaxed uppercase tracking-widest",children:"SwagTV Official is a dashboard utility. We do not host, store, or transmit video files. All stream metadata is sourced from public M3U repositories for testing purposes. Engineering Excellence."})]}),G.jsxs("div",{className:"flex flex-wrap justify-center gap-6",children:[G.jsx("a",{href:"#",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-colors",children:"API Status"}),G.jsx("a",{href:"#",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-colors",children:"Legal Docs"}),G.jsx("a",{href:"#",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition-colors",children:"Match Archive"}),G.jsxs("div",{className:"text-[10px] font-black uppercase tracking-widest text-green-500",children:[" ",new Date().getFullYear()," SwagTV Laboratory"]})]})]})]})]})},uv=document.getElementById("root");if(!uv)throw new Error("Could not find root element to mount to");const wL=BS.createRoot(uv);wL.render(G.jsx(CS.StrictMode,{children:G.jsx(kL,{})}));
